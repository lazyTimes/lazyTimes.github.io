<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>LazyTimes的博客</title>
  
  <subtitle>生死有命，富贵在天</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://lazytime.site/"/>
  <updated>2020-08-29T14:37:01.665Z</updated>
  <id>http://lazytime.site/</id>
  
  <author>
    <name>阿东</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>简单分析Java的HashMap.entrySet()的实现</title>
    <link href="http://lazytime.site/2020/08/29/%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90Java%E7%9A%84HashMap-entrySet-%E7%9A%84%E5%AE%9E%E7%8E%B0/"/>
    <id>http://lazytime.site/2020/08/29/%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90Java%E7%9A%84HashMap-entrySet-%E7%9A%84%E5%AE%9E%E7%8E%B0/</id>
    <published>2020-08-29T14:34:22.000Z</published>
    <updated>2020-08-29T14:37:01.665Z</updated>
    
    <content type="html"><![CDATA[<h1 id="简单分析Java的HashMap-entrySet-的实现"><a href="#简单分析Java的HashMap-entrySet-的实现" class="headerlink" title="简单分析Java的HashMap.entrySet()的实现"></a>简单分析Java的HashMap.entrySet()的实现</h1><p>转载自：<a href="https://blog.csdn.net/weixin_30807779/article/details/99566016" target="_blank" rel="noopener">https://blog.csdn.net/weixin_30807779/article/details/99566016</a></p><a id="more"></a><h2 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h2><p>map通过Entry 实现一个 &lt;K,V&gt; 的存储，通过key 的哈希值确定哈希表的数组下标，通过下标找到桶位之后，通过遍历找到相对应的Value</p><p>map是用来存储key-value类型数据的，一个&lt;k, v&gt;对在Map的接口定义中被定义为Entry，HashMap内部实现了<code>Entry</code>接口。HashMap内部维护一个<code>Entry</code>数组。</p><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p><code>transient Entry[] table;</code> </p><p>注意关键字：<code>transient</code> 该关键字，对于此属性是不能进行序列化的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Entry[] table</span><br><span class="line">    +---+</span><br><span class="line">    | 0 | -&gt; entry_0_0 -&gt; entry_0_1 -&gt; null</span><br><span class="line">    +---+</span><br><span class="line">    | 1 | -&gt; null</span><br><span class="line">    +---+</span><br><span class="line">    |   |</span><br><span class="line"></span><br><span class="line">     ...</span><br><span class="line"></span><br><span class="line">    |n-1| -&gt; entry_n-1_0 -&gt; null</span><br><span class="line">    +---+</span><br></pre></td></tr></table></figure><p>使用map 的 entrySet() 方法，就可以获得一个<code>EntryIterator</code>类型的实例，该实例调用 <code>nextEntry()</code>方法，来获取迭代器的下一个元素。<code>EntryIterator</code>类型是泛型<code>HashIterator&lt;T&gt;</code>的一个子类，这个类的内容很简单，唯一的代码是在<code>next()</code>函数中调用了<code>HashIterator</code>的<code>nextEntry()</code>方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">HashMap</span><br><span class="line">    |- table &lt;------------------------------------\</span><br><span class="line">    \+ entrySet()                                 |iterates</span><br><span class="line">        |              HashMap.HashIterator&lt;T&gt;    |</span><br><span class="line">        |returns                ^       \- nextEntry()</span><br><span class="line">        V                       -                 ^</span><br><span class="line">HashMap.EntrySet                |                 |</span><br><span class="line">    \- iterator()               |extends          |</span><br><span class="line">            |                   |                 |</span><br><span class="line">            |  instantiats      |                 |calls</span><br><span class="line">            \----------&gt; HashMap.EntryIterator    |</span><br><span class="line">                                        \- next() /</span><br></pre></td></tr></table></figure><p><code>entrySet()</code>方法返回的是一个特殊的Set，定义为HashMap的内部私有类 <code>EntryIterator</code> ,它继承自 <code>HashIterator</code> </p><p><code>HashIterator</code>通过遍历<code>table</code>数组，实现对HashMap的遍历。内部维护几个变量：<code>index</code>记录当前在<code>table</code>数组中的下标，<code>current</code>用来记录当前在<code>table[index]</code>这个链表中的位置，<code>next</code>指向current的下一个元素。<code>nextEntry()</code>的完整代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> Entry&lt;K,V&gt; <span class="title">nextEntry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">    Entry&lt;K,V&gt; e = next;</span><br><span class="line">    <span class="keyword">if</span> (e == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> ((next = e.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">        Entry[] t = table;</span><br><span class="line">        <span class="keyword">while</span> (index &lt; t.length &amp;&amp; (next = t[index++]) == <span class="keyword">null</span>)</span><br><span class="line">            ;</span><br><span class="line">    &#125;</span><br><span class="line">    current = e;</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>从调用链路可以看出， entrySet() 最后得到的其实是一个关于 map 的一个<code>视图</code>，当他在迭代的时候，其实就是相当于对于map的元素进行查找，不会创建任何额外的空间。</p><p>同时，<code>entrySet</code> 本身也是迭代器的思想，在多线程的环境下其实是线程不安全的，这点需要注意</p><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><blockquote><p>为什么要对于table 进行非串行化？</p><p><a href="https://developer.aliyun.com/ask/62542?spm=a2c6h.13159736" target="_blank" rel="noopener">Java中HashMap关键字transient的疑惑</a></p><p>怎么理解? 看一下HashMap.get()/put()知道, 读写Map是根据Object.hashcode()来确定从哪个bucket读/写. 而Object.hashcode()是native方法, 不同的JVM里可能是不一样的.</p><p>打个比方说, 向HashMap存一个entry, key为 字符串”STRING”, 在第一个java程序里, “STRING”的hashcode()为1, 存入第1号bucket; 在第二个java程序里, “STRING”的hashcode()有可能就是2, 存入第2号bucket. 如果用默认的串行化(Entry[] table不用transient), 那么这个HashMap从第一个java程序里通过串行化导入第二个java程序后, 其内存分布是一样的. 这就不对了. HashMap现在的readObject和writeObject是把内容 输出/输入, 把HashMap重新生成出来.</p></blockquote><blockquote><p>关于JDK官方吧Entry 换为了Node 的讨论</p><ol><li>为什么要换为Node</li><li>更换之后和原来的设计有什么区别</li></ol><p>回答：JDK1.8 改动： 在<code>java1.8</code>中,<code>Entry</code>被<code>Node</code>替代(换了一个马甲)。</p></blockquote>]]></content>
    
    <summary type="html">
    
      hashmap的entrySet是如何实现的
    
    </summary>
    
    
      <category term="集合" scheme="http://lazytime.site/categories/%E9%9B%86%E5%90%88/"/>
    
    
      <category term="Map" scheme="http://lazytime.site/tags/Map/"/>
    
  </entry>
  
  <entry>
    <title>如何导出表结构（navicat）</title>
    <link href="http://lazytime.site/2020/08/29/%E5%A6%82%E4%BD%95%E5%AF%BC%E5%87%BA%E8%A1%A8%E7%BB%93%E6%9E%84%EF%BC%88navicat%EF%BC%89/"/>
    <id>http://lazytime.site/2020/08/29/%E5%A6%82%E4%BD%95%E5%AF%BC%E5%87%BA%E8%A1%A8%E7%BB%93%E6%9E%84%EF%BC%88navicat%EF%BC%89/</id>
    <published>2020-08-29T14:02:28.000Z</published>
    <updated>2020-08-29T14:05:59.568Z</updated>
    
    <content type="html"><![CDATA[<h1 id="如何导出表结构（navicat）"><a href="#如何导出表结构（navicat）" class="headerlink" title="如何导出表结构（navicat）"></a>如何导出表结构（navicat）</h1><h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><p>我需要将表复制到 markdow 或者 word里面的时候</p><a id="more"></a><h2 id="具体使用方法："><a href="#具体使用方法：" class="headerlink" title="具体使用方法："></a>具体使用方法：</h2><ol><li>复制sql 复制到 navicat的查询里面</li><li>需要设置数据库的名称：<code>table_schema</code></li><li>需要设置导出的表名：<code>table_name</code></li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">COLUMN_NAME 列名,</span><br><span class="line">COLUMN_TYPE 数据类型,</span><br><span class="line">DATA_TYPE 字段类型,</span><br><span class="line">CHARACTER_MAXIMUM_LENGTH 长度,</span><br><span class="line">IS_NULLABLE 是否为空,</span><br><span class="line">COLUMN_DEFAULT 默认值,</span><br><span class="line">COLUMN_COMMENT 备注 </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">INFORMATION_SCHEMA.COLUMNS </span><br><span class="line"><span class="keyword">WHERE</span><span class="comment">-- developerclub为数据库名称，到时候只需要修改成你要导出表结构的数据库即可</span></span><br><span class="line">table_schema = <span class="string">'galaxy_education'</span> </span><br><span class="line"><span class="keyword">AND</span> <span class="comment">-- article为表名，到时候换成你要导出的表的名称</span></span><br><span class="line"><span class="comment">-- 如果不写的话，默认会查询出所有表中的数据，这样可能就分不清到底哪些字段是哪张表中的了，所以还是建议写上要导出的名名称</span></span><br><span class="line">table_name = <span class="string">'表名称'</span></span><br></pre></td></tr></table></figure><p>table_name = ‘表名称’</p><h1 id="怎么样导出数据库所有的表结构和详细信息呢"><a href="#怎么样导出数据库所有的表结构和详细信息呢" class="headerlink" title="怎么样导出数据库所有的表结构和详细信息呢?"></a>怎么样导出数据库所有的表结构和详细信息呢?</h1><p>博客地址：<br><a href="https://blog.csdn.net/cai454692590/article/details/82799638" target="_blank" rel="noopener">https://blog.csdn.net/cai454692590/article/details/82799638</a><br><a href="https://www.cnblogs.com/LeeYongze/archive/2012/07/19/2599338.html" target="_blank" rel="noopener">https://www.cnblogs.com/LeeYongze/archive/2012/07/19/2599338.html</a></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">     表名       = <span class="keyword">Case</span> <span class="keyword">When</span> A.colorder=<span class="number">1</span> <span class="keyword">Then</span> D.name <span class="keyword">Else</span> <span class="string">''</span> <span class="keyword">End</span>,</span><br><span class="line">     表说明     = <span class="keyword">Case</span> <span class="keyword">When</span> A.colorder=<span class="number">1</span> <span class="keyword">Then</span> <span class="keyword">isnull</span>(F.value,<span class="string">''</span>) <span class="keyword">Else</span> <span class="string">''</span> <span class="keyword">End</span>,</span><br><span class="line">     字段序号   = A.colorder,</span><br><span class="line">     字段名     = A.name,</span><br><span class="line">     字段说明   = <span class="keyword">isnull</span>(G.[<span class="keyword">value</span>],<span class="string">''</span>),</span><br><span class="line">     标识       = <span class="keyword">Case</span> <span class="keyword">When</span> COLUMNPROPERTY( A.id,A.name,<span class="string">'IsIdentity'</span>)=<span class="number">1</span> <span class="keyword">Then</span> <span class="string">'√'</span><span class="keyword">Else</span> <span class="string">''</span> <span class="keyword">End</span>,</span><br><span class="line">     主键       = <span class="keyword">Case</span> <span class="keyword">When</span> <span class="keyword">exists</span>(<span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> sysobjects <span class="keyword">Where</span> xtype=<span class="string">'PK'</span> <span class="keyword">and</span> parent_obj=A.id <span class="keyword">and</span> <span class="keyword">name</span> <span class="keyword">in</span> (</span><br><span class="line">                      <span class="keyword">SELECT</span> <span class="keyword">name</span> <span class="keyword">FROM</span> sysindexes <span class="keyword">WHERE</span> indid <span class="keyword">in</span>( <span class="keyword">SELECT</span> indid <span class="keyword">FROM</span> sysindexkeys <span class="keyword">WHERE</span> <span class="keyword">id</span> = A.id <span class="keyword">AND</span> colid=A.colid))) <span class="keyword">then</span> <span class="string">'√'</span> <span class="keyword">else</span> <span class="string">''</span> <span class="keyword">end</span>,</span><br><span class="line">     类型       = B.name,</span><br><span class="line">     占用字节数 = A.Length,</span><br><span class="line">     长度       = COLUMNPROPERTY(A.id,A.name,<span class="string">'PRECISION'</span>),</span><br><span class="line">     小数位数   = <span class="keyword">isnull</span>(COLUMNPROPERTY(A.id,A.name,<span class="string">'Scale'</span>),<span class="number">0</span>),</span><br><span class="line">     允许空     = <span class="keyword">Case</span> <span class="keyword">When</span> A.isnullable=<span class="number">1</span> <span class="keyword">Then</span> <span class="string">'√'</span><span class="keyword">Else</span> <span class="string">''</span> <span class="keyword">End</span>,</span><br><span class="line">     默认值     = <span class="keyword">isnull</span>(E.Text,<span class="string">''</span>)</span><br><span class="line"> <span class="keyword">FROM</span></span><br><span class="line">     syscolumns A</span><br><span class="line"> <span class="keyword">Left</span> <span class="keyword">Join</span></span><br><span class="line">     systypes B</span><br><span class="line"> <span class="keyword">On</span></span><br><span class="line">     A.xusertype=B.xusertype</span><br><span class="line"> <span class="keyword">Inner</span> <span class="keyword">Join</span></span><br><span class="line">     sysobjects D</span><br><span class="line"> <span class="keyword">On</span></span><br><span class="line">     A.id=D.id  <span class="keyword">and</span> D.xtype=<span class="string">'U'</span> <span class="keyword">and</span>  D.name&lt;&gt;<span class="string">'dtproperties'</span></span><br><span class="line"> <span class="keyword">Left</span> <span class="keyword">Join</span></span><br><span class="line">     syscomments E</span><br><span class="line"> <span class="keyword">on</span></span><br><span class="line">     A.cdefault=E.id</span><br><span class="line"> <span class="keyword">Left</span> <span class="keyword">Join</span></span><br><span class="line"> sys.extended_properties  G</span><br><span class="line"> <span class="keyword">on</span></span><br><span class="line">     A.id=G.major_id <span class="keyword">and</span> A.colid=G.minor_id</span><br><span class="line"> <span class="keyword">Left</span> <span class="keyword">Join</span></span><br><span class="line"></span><br><span class="line"> sys.extended_properties F</span><br><span class="line"> <span class="keyword">On</span></span><br><span class="line">     D.id=F.major_id <span class="keyword">and</span> F.minor_id=<span class="number">0</span></span><br><span class="line">     <span class="comment">--where d.name='OrderInfo'    --如果只查询指定表,加上此条件</span></span><br><span class="line"> <span class="keyword">Order</span> <span class="keyword">By</span></span><br><span class="line">     A.id,A.colorder</span><br></pre></td></tr></table></figure><h1 id="使用方法："><a href="#使用方法：" class="headerlink" title="使用方法："></a>使用方法：</h1><p>以mysql为例，根据sql的内容。</p><p>根据示例的内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">COLUMN_NAME 列名,</span><br><span class="line">COLUMN_TYPE 数据类型,</span><br><span class="line">DATA_TYPE 字段类型,</span><br><span class="line">CHARACTER_MAXIMUM_LENGTH 长度,</span><br><span class="line">IS_NULLABLE 是否为空,</span><br><span class="line">COLUMN_DEFAULT 默认值,</span><br><span class="line">COLUMN_COMMENT 备注 </span><br><span class="line">FROM</span><br><span class="line">INFORMATION_SCHEMA.COLUMNS </span><br><span class="line">WHERE-- developerclub为数据库名称，到时候只需要修改成你要导出表结构的数据库即可</span><br><span class="line">table_schema &#x3D; &#39;hotel&#39; </span><br><span class="line">AND -- article为表名，到时候换成你要导出的表的名称</span><br><span class="line">-- 如果不写的话，默认会查询出所有表中的数据，这样可能就分不清到底哪些字段是哪张表中的了，所以还是建议写上要导出的名名称</span><br><span class="line">table_name &#x3D; &#39;orders&#39;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20200829215314.png" alt=""></p><p>点击<code>导出向导</code></p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20200829215354.png" alt=""></p><p>选择需要导出的内容，根据所需导出，即可，我这里选择导出<code>excel</code></p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20200829215901.png" alt=""></p><p>我们可以将导出的内容贴到md 里面</p><table><thead><tr><th>列名</th><th>数据类型</th><th>字段类型</th><th>长度</th><th>是否为空</th><th>默认值</th><th>备注</th></tr></thead><tbody><tr><td>id</td><td>int(11)</td><td>int</td><td></td><td>NO</td><td></td><td></td></tr><tr><td>table_id</td><td>int(11)</td><td>int</td><td></td><td>YES</td><td></td><td></td></tr><tr><td>orderDate</td><td>datetime</td><td>datetime</td><td></td><td>YES</td><td></td><td></td></tr><tr><td>totalPrice</td><td>double</td><td>double</td><td></td><td>YES</td><td></td><td></td></tr><tr><td>orderStatus</td><td>int(11)</td><td>int</td><td></td><td>YES</td><td>0</td><td></td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      如何导出表结构（navicat）
    
    </summary>
    
    
      <category term="数据库" scheme="http://lazytime.site/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
      <category term="数据库" scheme="http://lazytime.site/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>2020 轻薄本怎么选</title>
    <link href="http://lazytime.site/2020/08/29/2020-%E8%BD%BB%E8%96%84%E6%9C%AC%E6%80%8E%E4%B9%88%E9%80%89/"/>
    <id>http://lazytime.site/2020/08/29/2020-%E8%BD%BB%E8%96%84%E6%9C%AC%E6%80%8E%E4%B9%88%E9%80%89/</id>
    <published>2020-08-29T13:27:02.000Z</published>
    <updated>2020-08-29T14:05:44.022Z</updated>
    
    <content type="html"><![CDATA[<h1 id="2020-轻薄本怎么选"><a href="#2020-轻薄本怎么选" class="headerlink" title="2020 轻薄本怎么选"></a>2020 轻薄本怎么选</h1><h2 id="前情提示"><a href="#前情提示" class="headerlink" title="前情提示"></a>前情提示</h2><p><a href="https://post.smzdm.com/p/adwgq48z/?send_by=2270678428&amp;from=other&amp;invite_code=zdm33d96vsinv" target="_blank" rel="noopener">https://post.smzdm.com/p/adwgq48z/?send_by=2270678428&amp;from=other&amp;invite_code=zdm33d96vsinv</a></p><h2 id="追求性价比："><a href="#追求性价比：" class="headerlink" title="追求性价比："></a>追求性价比：</h2><p>2999元：联想扬天V14（AMD）</p><p>3400元： 战66（AMD）</p><p>3700元：联想小新air14或ThinkPad E14（AMD ）</p><p>4200元：小新pro13（AMD）</p><p>4500元：ThinkPad T14（AMD）</p><p>4700元：惠普战X（AMD）</p><p>4999元：华为matebook14（AMD）</p><p>4999元：ThinkPad X13（AMD）</p><p>5671元：ThinkPad T14s（AMD）</p><p>8099元：官翻MacBook pro13（intel），没错，我认为它具备一定性价比</p><a id="more"></a><h2 id="具有intel平台需求"><a href="#具有intel平台需求" class="headerlink" title="具有intel平台需求"></a>具有intel平台需求</h2><p>3400元： 宏碁 传奇14（intel）</p><p>3499元：宏碁 墨舞 14（intel）</p><p>4399元：宏碁 蜂鸟3（intel）</p><p>5000元以内：戴尔latitude 7300、7400（intel）</p><p>5299元：thinkpad S2（intel）</p><p>5679元：Matebook 14（intel）</p><h3 id="具体分析："><a href="#具体分析：" class="headerlink" title="具体分析："></a>具体分析：</h3><h4 id="联想扬天V14（AMD）"><a href="#联想扬天V14（AMD）" class="headerlink" title="联想扬天V14（AMD）"></a>联想扬天V14（AMD）</h4><h5 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h5><ul><li><strong>便宜；</strong></li><li>3个标准USB接口，内存硬盘可拓展</li></ul><h5 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a><strong>缺点：</strong></h5><ul><li>没有typec</li><li>电池容量小；</li><li>重达2kg</li></ul><h4 id="3424元-战66三代"><a href="#3424元-战66三代" class="headerlink" title="3424元 战66三代"></a>3424元 战66三代</h4><h5 id="优点：-1"><a href="#优点：-1" class="headerlink" title="优点："></a>优点：</h5><ul><li>老模具，因此支持2.5寸硬盘拓展，双内存插槽</li><li>有屏幕色彩需求可以买高色域版本，400nit 100%srgb还不错</li><li>接口齐全：三个标准USB接口，一个全功能typec接口、一个hdmi1.4、一个标准RJ45、一个SD<a href="https://www.smzdm.com/fenlei/dukaqi/" target="_blank" rel="noopener">读卡器</a></li><li>物理防窥<a href="https://www.smzdm.com/fenlei/shexiangtou/" target="_blank" rel="noopener">摄像头</a></li><li>标配防泼溅背光键盘</li></ul><h5 id="缺点：-1"><a href="#缺点：-1" class="headerlink" title="缺点："></a>缺点：</h5><ul><li>惠普祖传的垃圾上下方向键；</li><li><strong>老模具，所以额头和下巴都很宽，体重和尺寸略次于友商；</strong></li><li>45wh电池，续航捉急</li><li>HDMI 1.4只支持到4k@30hz，不支持4K@60hz</li><li>散热和性能释放捉急，4700u还不如小新的4600u性能强，详见<a href="https://www.notebookcheck.net/HP-ProBook-445-G7-laptop-review-Moving-forward-with-Renoir.483145.0.html" target="_blank" rel="noopener">notebookcheck的评测</a></li></ul><h4 id="3234元宏碁-传奇"><a href="#3234元宏碁-传奇" class="headerlink" title="3234元宏碁 传奇"></a>3234元宏碁 传奇</h4><h5 id="优点：-2"><a href="#优点：-2" class="headerlink" title="优点："></a>优点：</h5><ul><li>屏幕边框很窄</li><li><strong>非常轻薄：</strong>重1.2kg、厚15.9mm</li><li>wifi6网卡</li><li>接口齐全：1个USB2.0，一个USB3.0接口，一个全功能typec接口、一个hdmi、一个<strong>独立电源接口</strong></li><li>标配背光键盘</li></ul><h5 id="缺点：-2"><a href="#缺点：-2" class="headerlink" title="缺点："></a>缺点：</h5><ul><li>屏幕色域低；</li><li>板载内存不可更换</li></ul><h4 id="3459元-宏碁-墨舞"><a href="#3459元-宏碁-墨舞" class="headerlink" title="3459元 宏碁 墨舞"></a>3459元 宏碁 墨舞</h4><h3 id="优点：-3"><a href="#优点：-3" class="headerlink" title="优点："></a>优点：</h3><ul><li>一个内存槽可扩展；</li><li>接口丰富、Wifi6；</li><li>支持SSD+HDD；</li><li>180度翻转机身</li><li>14寸窄边框IPS；</li><li>带一年上门；</li></ul><h3 id="缺点：-3"><a href="#缺点：-3" class="headerlink" title="缺点："></a>缺点：</h3><ul><li>低色域屏幕</li></ul><h4 id="3649元-小新air14"><a href="#3649元-小新air14" class="headerlink" title="3649元 小新air14"></a>3649元 小新air14</h4><h5 id="优点：-4"><a href="#优点：-4" class="headerlink" title="优点："></a>优点：</h5><ul><li>性能释放强</li><li>接口配置中规中矩</li><li>大电池</li><li>高色域屏幕</li><li>双通道大内存</li></ul><h5 id="缺点：-4"><a href="#缺点：-4" class="headerlink" title="缺点："></a>缺点：</h5><ul><li><p>品控翻车厉害</p></li><li><p>作为商务办公不是很适合</p></li><li><p>京东售价比较贵</p></li></ul><h4 id="3699-ThinkPad-E14"><a href="#3699-ThinkPad-E14" class="headerlink" title="3699 ThinkPad E14"></a>3699 ThinkPad E14</h4><h5 id="优点：-5"><a href="#优点：-5" class="headerlink" title="优点："></a>优点：</h5><ul><li>默认ssd为2242 pcie3.0 x4，提供2280规格的空余插槽，T系列的2242接口只是pcie3.0 x2；</li><li>机身做工不错，而且D壳为镁铝合金，对比之下T14为塑料壳；</li><li>板载+内存插槽的配置；</li><li>键盘手感不错、指点杆。</li></ul><h5 id="缺点：-5"><a href="#缺点：-5" class="headerlink" title="缺点："></a>缺点：</h5><ul><li>45wh电池，续航约4小时；</li><li>HDMI接口不支持4k@60hz</li><li>只有一个typec接口，充电和typec不可兼得</li><li>USB接口中阉割一个为USB2.0</li><li>250nit低色域屏幕</li></ul><h4 id="4169元-小新pro13"><a href="#4169元-小新pro13" class="headerlink" title="4169元 小新pro13"></a>4169元 小新pro13</h4><h5 id="优点：-6"><a href="#优点：-6" class="headerlink" title="优点："></a>优点：</h5><ul><li>屏幕素质好</li><li>续航足</li><li>性能释放好， 4800H的处理器</li><li>性价比神机</li></ul><h5 id="缺点：-6"><a href="#缺点：-6" class="headerlink" title="缺点："></a>缺点：</h5><ul><li>接口不足</li></ul><h4 id="4399元-宏碁蜂鸟3，intel平台真香机"><a href="#4399元-宏碁蜂鸟3，intel平台真香机" class="headerlink" title="4399元 宏碁蜂鸟3，intel平台真香机"></a>4399元 宏碁蜂鸟3，intel平台真香机</h4><h5 id="优点：-7"><a href="#优点：-7" class="headerlink" title="优点："></a>优点：</h5><ul><li>屏幕好</li><li>3.2的屏幕占比</li><li>机身支持0-180度开合角，背光键盘下侧配有指纹识别模块（静态按压式）。接口方面，蜂鸟3支持wifi6，配备1×USB2.0+1×USB3.2 Gen1，1×Thunderbolt3，HDMI<em>1，*</em>具有独立电源口**</li></ul><h5 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h5><ul><li>散热问题</li><li>性能比较差</li></ul><h4 id="4450元-ThinkPad-T14-4650u-8G-512G"><a href="#4450元-ThinkPad-T14-4650u-8G-512G" class="headerlink" title="4450元 ThinkPad T14 4650u+8G+512G"></a>4450元 ThinkPad T14 4650u+8G+512G</h4><h5 id="优点：-8"><a href="#优点：-8" class="headerlink" title="优点："></a>优点：</h5><ul><li>thinkpad 键盘和指点杆加成</li><li>双热管散热系统，实际性能释放优于战66、X13、T14s，弱于小新系列</li><li>板载+空余内存插槽</li><li>双全功能typec+双usb3.0+HDMI 2.0+标准RJ45接口，接口配置吊打友商</li></ul><h5 id="缺点：-7"><a href="#缺点：-7" class="headerlink" title="缺点："></a>缺点：</h5><ul><li>250nit45%NTSC低色域屏幕</li><li>阉割背光键盘</li><li>塑料外壳</li><li>阉割2242带宽</li></ul><h4 id="4799元-惠普-战X-14寸-4650U-16G-512G"><a href="#4799元-惠普-战X-14寸-4650U-16G-512G" class="headerlink" title="4799元 惠普 战X 14寸 4650U+16G+512G"></a>4799元 惠普 战X 14寸 4650U+16G+512G</h4><h5 id="优点：-9"><a href="#优点：-9" class="headerlink" title="优点："></a>优点：</h5><ul><li>机身做工好；</li><li>内部扩展性和接口扩展性都不错</li><li>性价比高</li></ul><h5 id="缺点：-8"><a href="#缺点：-8" class="headerlink" title="缺点："></a>缺点：</h5><ul><li>电源键和上下方向键设计不合理</li><li>单风扇、单根长热管预计散热能力一般</li><li>没有RJ45标准网络接口</li></ul><h4 id="4999元-华为matebook14-锐龙版"><a href="#4999元-华为matebook14-锐龙版" class="headerlink" title="4999元 华为matebook14 锐龙版"></a>4999元 华为matebook14 锐龙版</h4><h5 id="优点：-10"><a href="#优点：-10" class="headerlink" title="优点："></a>优点：</h5><ul><li>性能释放出色；</li><li>体积重量控制不错；</li><li>高屏占比、高素质屏幕；</li></ul><h5 id="缺点：-9"><a href="#缺点：-9" class="headerlink" title="缺点："></a>缺点：</h5><ul><li>typec和HDMI接口阉割；</li><li>摄像头位置太尴尬；</li></ul><h4 id="4999元-Thinkpad-X13-4650u-16G-512G"><a href="#4999元-Thinkpad-X13-4650u-16G-512G" class="headerlink" title="4999元 Thinkpad X13 4650u+16G+512G"></a>4999元 Thinkpad X13 4650u+16G+512G</h4><h5 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h5><ul><li>thinkpad 键盘和指点杆加成</li><li>镁合金外壳</li><li>100%srgb屏幕</li><li>双全功能typec+双usb3.0+HDMI 2.0+mini RJ45接口，接口配置吊打友商</li></ul><h5 id="缺点：-10"><a href="#缺点：-10" class="headerlink" title="缺点："></a>缺点：</h5><ul><li>单热管散热，性能释放捉急；</li><li>无背光键盘</li></ul><h4 id="5299元-S2-2020-i5-10210u-16G-512G-触控"><a href="#5299元-S2-2020-i5-10210u-16G-512G-触控" class="headerlink" title="5299元 S2 2020 i5-10210u+16G+512G+触控"></a>5299元 S2 2020 i5-10210u+16G+512G+触控</h4><h5 id="优点：-11"><a href="#优点：-11" class="headerlink" title="优点："></a><strong>优点：</strong></h5><ul><li>背光键盘；</li><li>300nit 100%SRGB触屏；</li><li>金属A面；</li></ul><h5 id="缺点：-11"><a href="#缺点：-11" class="headerlink" title="缺点："></a><strong>缺点：</strong></h5><ul><li><strong>机身塑料感重；</strong></li><li><strong>接口阉割了雷电3；</strong></li><li>2020年，低压i5确实性能是一般的</li></ul><h4 id="5679：Matebook-14（intel）"><a href="#5679：Matebook-14（intel）" class="headerlink" title="5679：Matebook 14（intel）"></a>5679：Matebook 14（intel）</h4><h5 id="优点：-12"><a href="#优点：-12" class="headerlink" title="优点："></a>优点：</h5><ul><li>屏幕不错；</li><li>一碰传有意思；</li></ul><h5 id="缺点：-12"><a href="#缺点：-12" class="headerlink" title="缺点："></a>缺点：</h5><ul><li>接口稀少而且规格<strong>营养不良</strong>；</li><li>性能释放一般</li></ul><h4 id="5000以内-戴尔latitude-7300、7400"><a href="#5000以内-戴尔latitude-7300、7400" class="headerlink" title="5000以内 戴尔latitude 7300、7400"></a>5000以内 戴尔latitude 7300、7400</h4><p>不做推荐，因为美版官翻比国行便宜</p><h4 id="空缺的海淘XPS13-和海淘X1carbon"><a href="#空缺的海淘XPS13-和海淘X1carbon" class="headerlink" title="空缺的海淘XPS13 和海淘X1carbon"></a>空缺的海淘XPS13 和海淘X1carbon</h4><p>不做推荐</p><h4 id="8099元-官翻MacBook-pro13"><a href="#8099元-官翻MacBook-pro13" class="headerlink" title="8099元 官翻MacBook pro13"></a>8099元 官翻MacBook pro13</h4><p>如果买的到确实极具性价比</p>]]></content>
    
    <summary type="html">
    
      如何选择笔记本
    
    </summary>
    
    
      <category term="日常" scheme="http://lazytime.site/categories/%E6%97%A5%E5%B8%B8/"/>
    
    
      <category term="笔记本" scheme="http://lazytime.site/tags/%E7%AC%94%E8%AE%B0%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>显示器怎么选？</title>
    <link href="http://lazytime.site/2020/08/22/%E6%98%BE%E7%A4%BA%E5%99%A8%E6%80%8E%E4%B9%88%E9%80%89%EF%BC%9F/"/>
    <id>http://lazytime.site/2020/08/22/%E6%98%BE%E7%A4%BA%E5%99%A8%E6%80%8E%E4%B9%88%E9%80%89%EF%BC%9F/</id>
    <published>2020-08-22T13:10:06.000Z</published>
    <updated>2020-08-22T13:12:30.708Z</updated>
    
    <content type="html"><![CDATA[<h1 id="一图流："><a href="#一图流：" class="headerlink" title="一图流："></a>一图流：</h1><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20200822204710.png?ynotemdtimestamp=1598060052847" alt="img"></p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20200822204751.png?ynotemdtimestamp=1598060052847" alt="img"></p><h1 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h1><p>选显示器要注意以下几点：</p><ol><li>自己的需求：看电影？办公？打游戏</li><li>尺寸大小</li><li>性价比</li></ol><h2 id="屏幕厂商的排行"><a href="#屏幕厂商的排行" class="headerlink" title="屏幕厂商的排行"></a>屏幕厂商的排行</h2><p>一线：三星、LG、夏普、友达</p><p>二线：京东方、</p><p>二点五线：奇美（原因是屏幕普遍偏黄，偏暖）</p><h1 id="电脑尺寸："><a href="#电脑尺寸：" class="headerlink" title="电脑尺寸："></a>电脑尺寸：</h1><h2 id="1M-以下的桌子"><a href="#1M-以下的桌子" class="headerlink" title="1M 以下的桌子"></a>1M 以下的桌子</h2><ol><li>15、16、17 寸</li><li>最好不要超过27寸</li></ol><h2 id="1M以上的桌子（1-2M-0-6）"><a href="#1M以上的桌子（1-2M-0-6）" class="headerlink" title="1M以上的桌子（1.2M - *0.6）"></a>1M以上的桌子（1.2M - *0.6）</h2><ol><li>27 寸</li><li>29寸</li></ol><h2 id="1-4M-0-8m"><a href="#1-4M-0-8m" class="headerlink" title="1.4M * 0.8m"></a>1.4M * 0.8m</h2><p>32 寸以上</p><h1 id="色彩"><a href="#色彩" class="headerlink" title="色彩"></a>色彩</h1><h2 id="NTSC"><a href="#NTSC" class="headerlink" title="NTSC:"></a>NTSC:</h2><p>是一种美国的电视的标准，一般认为72%的NTSC就可以认为是高色准的屏幕，而设计类专业也最好以这一标准为参考</p><p>低色域：45%</p><p>高色域：72%</p><h2 id="sRGB"><a href="#sRGB" class="headerlink" title="sRGB:"></a>sRGB:</h2><p>微软联合HP、三菱、爱普生等厂商联合开发的sRGB(<em>standard Red GreenBlue</em>)通用色彩标准，受微软强大用户群体的影响力的威慑，绝大多数的数码图像采集设备厂<a href="https://baike.baidu.com/item/商都" target="_blank" rel="noopener">商都</a>已经全线支持sRGB标准</p><p>标准值：越接近100%说明色彩管理越好，而更高的则认为色域更好</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20200822205047.png?ynotemdtimestamp=1598060052847" alt="img"></p><h2 id="色差："><a href="#色差：" class="headerlink" title="色差："></a>色差：</h2><p>使用deltaE =&gt; △E</p><p>△E&gt; 大于6：人眼可辨的色差</p><p>△E &gt; 6 and △E &lt; 3 ：经过专业训练的人员可以辨别</p><p>△E &lt; 3 ：肉眼以及专业训练基本看不出色差的屏幕</p><p>专业设计</p><p>△E &lt; 1 :基本无法分辨</p><h1 id="分辨率"><a href="#分辨率" class="headerlink" title="分辨率"></a>分辨率</h1><p>1920*1080 =&gt; 24 寸</p><h1 id="刷新率"><a href="#刷新率" class="headerlink" title="刷新率"></a>刷新率</h1><p>计算方式：1秒可以刷新多少次</p><blockquote><p>例如：</p><p>60HZ 代表一秒可以显示60张图片</p><p>144HZ 代表一秒可以显示144张图片</p><p>越高的刷新率对于FPS游戏有很大的影响</p></blockquote><h2 id="灰阶响应时间："><a href="#灰阶响应时间：" class="headerlink" title="灰阶响应时间："></a>灰阶响应时间：</h2><p>简单概括：红绿蓝三原色切换的时间</p><p>响应时间：这个表现的事灰阶的响应时间</p><h1 id="面板类型："><a href="#面板类型：" class="headerlink" title="面板类型："></a>面板类型：</h1><h2 id="TN"><a href="#TN" class="headerlink" title="TN:"></a>TN:</h2><p>TN屏作为旧时代的产物本来应该淘汰了，但是由于电竞行业的兴起，又重回市场</p><p>优点：</p><ol><li>价格便宜</li><li>延迟低（可以达到最低的1 ms）</li></ol><p>缺点：</p><ol><li>可视角度低</li><li>色差大，色彩表现不佳</li></ol><h2 id="IPS："><a href="#IPS：" class="headerlink" title="IPS："></a>IPS：</h2><p>优点：</p><ol><li>可视角度大</li><li>色彩表现基VA和TN屏幕之间</li><li>目前主流屏幕</li></ol><p>缺点：</p><ol><li>屏幕漏光，不可避免</li></ol><h2 id="VA："><a href="#VA：" class="headerlink" title="VA："></a>VA：</h2><p>优点：</p><ol><li>色彩表现比IPS更好</li><li>多为曲面屏</li></ol><p>缺点：</p><ol><li>响应低</li><li>基本为三星屏幕</li></ol><h2 id="PLS："><a href="#PLS：" class="headerlink" title="PLS："></a>PLS：</h2><p>整体类似IPS</p><h1 id="硬件优化"><a href="#硬件优化" class="headerlink" title="硬件优化"></a>硬件优化</h1><h2 id="Free-sync"><a href="#Free-sync" class="headerlink" title="Free-sync"></a>Free-sync</h2><p>AMD研发</p><p>FreeSync<a href="https://baike.baidu.com/item/显示器/362722" target="_blank" rel="noopener">显示器</a>是指自身搭载FreeSync技术的显示设备，此类显示器特点在于能够解决画面撕裂以及卡顿等问题</p><h2 id="G-sync"><a href="#G-sync" class="headerlink" title="G-sync:"></a>G-sync:</h2><p>英特尔研发</p><blockquote><p>两者都只有在<strong>DP</strong>接口下面才会有作用</p></blockquote><h1 id="参考视频优选"><a href="#参考视频优选" class="headerlink" title="参考视频优选"></a>参考视频优选</h1><p><a href="https://www.bilibili.com/video/BV1b4411978M/?spm_id_from=trigger_reload" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1b4411978M/?spm_id_from=trigger_reload</a></p>]]></content>
    
    <summary type="html">
    
      显示器怎么选？
    
    </summary>
    
    
      <category term="未分类" scheme="http://lazytime.site/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/"/>
    
    
      <category term="无" scheme="http://lazytime.site/tags/%E6%97%A0/"/>
    
  </entry>
  
  <entry>
    <title>RestTemplate使用</title>
    <link href="http://lazytime.site/2020/08/22/RestTemplate%E4%BD%BF%E7%94%A8/"/>
    <id>http://lazytime.site/2020/08/22/RestTemplate%E4%BD%BF%E7%94%A8/</id>
    <published>2020-08-22T11:34:40.000Z</published>
    <updated>2020-08-22T11:39:40.786Z</updated>
    
    <content type="html"><![CDATA[<h1 id="RestTemplate介绍"><a href="#RestTemplate介绍" class="headerlink" title="RestTemplate介绍"></a><code>RestTemplate</code>介绍</h1><h2 id="借鉴"><a href="#借鉴" class="headerlink" title="借鉴"></a>借鉴</h2><p><a href="https://juejin.im/post/6844903842065154061" target="_blank" rel="noopener">https://juejin.im/post/6844903842065154061</a> 掘金</p><a id="more"></a><h2 id="认识-RestTemplate"><a href="#认识-RestTemplate" class="headerlink" title="认识 RestTemplate"></a>认识 <code>RestTemplate</code></h2><p>简要改过：HTTP请求工具，封装了HttpClient请求的一系列方法</p><p>所属：<a href="http://spring.web" target="_blank" rel="noopener">spring.web</a> 包 4.1.3 之后</p><p><strong>Spring Framework 3.0之后才开始引入</strong></p><h2 id="为什么会出现RestTemplate"><a href="#为什么会出现RestTemplate" class="headerlink" title="为什么会出现RestTemplate"></a>为什么会出现<code>RestTemplate</code></h2><ol><li>最大的作用就是简化Http请求。</li><li>无需自己编写底层</li><li>开箱即用</li></ol><h2 id="Spring-5-0之后的改变"><a href="#Spring-5-0之后的改变" class="headerlink" title="Spring 5.0之后的改变"></a>Spring 5.0之后的改变</h2><p>5.0之后，官方更加推荐应对非阻塞响应式的 HTTP 请求处理类 <code>org.springframework.web.reactive.client.WebClient</code>来处理</p><h2 id="一些常用API"><a href="#一些常用API" class="headerlink" title="一些常用API"></a>一些常用API</h2><p>其中多数是单个方法重载实现，这里我主要参考官方文档 <a href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/integration.html#rest-client-access" target="_blank" rel="noopener">rest-client-access</a> 进行如下分类：</p><table><thead><tr><th>方法名</th><th>描述</th></tr></thead><tbody><tr><td><code>getForObject</code></td><td>通过 GET 请求获得响应结果</td></tr><tr><td><code>getForEntity</code></td><td>通过 GET 请求获取 <code>ResponseEntity</code> 对象，包容有状态码，响应头和响应数据</td></tr><tr><td><code>headForHeaders</code></td><td>以 HEAD 请求资源返回所有响应头信息</td></tr><tr><td><code>postForLocation</code></td><td>用 POST 请求创建资源，并返回响应数据中响应头的字段 <code>Location</code>的数据</td></tr><tr><td><code>postForObject</code></td><td>通过 POST 请求创建资源，获得响应结果</td></tr><tr><td><code>put</code></td><td>通过 PUT 方式请求来创建或者更新资源</td></tr><tr><td><code>patchForObject</code></td><td>通过 PATH 方式请求来更新资源，并获得响应结果。(JDK <code>HttpURLConnection</code> 不支持 PATH 方式请求，其他 HTTP 客户端库支持)</td></tr><tr><td><code>delete</code></td><td>通过 DELETE 方式删除资源</td></tr><tr><td><code>optionsForAllow</code></td><td>通过 ALLOW 方式请求来获得资源所允许访问的所有 HTTP 方法，可用看某个请求支持哪些请求方式</td></tr><tr><td><code>exchange</code></td><td>更通用版本的请求处理方法，接受一个 <code>RequestEntity</code> 对象，可以设置路径，请求头，请求信息等，最后返回一个 <code>ResponseEntity</code> 实体</td></tr><tr><td><code>execute</code></td><td>最通用的执行 HTTP 请求的方法，上面所有方法都是基于 <code>execute</code>的封装，全面控制请求信息，并通过回调接口获得响应数据</td></tr></tbody></table><h2 id="常见用法："><a href="#常见用法：" class="headerlink" title="常见用法："></a>常见用法：</h2><h3 id="GET-请求："><a href="#GET-请求：" class="headerlink" title="GET 请求："></a>GET 请求：</h3><h4 id="使用GET请求获取JSON字符串"><a href="#使用GET请求获取JSON字符串" class="headerlink" title="使用GET请求获取JSON字符串:"></a>使用GET请求获取JSON字符串:</h4><p>我们只需要调用：<code>getForObject</code>即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String forObject &#x3D; build.getForObject(&quot;http:&#x2F;&#x2F;www.baidu.com&quot;, String.class);</span><br><span class="line">.....</span><br></pre></td></tr></table></figure><h4 id="使用GET请求获取JSON映射对象："><a href="#使用GET请求获取JSON映射对象：" class="headerlink" title="使用GET请求获取JSON映射对象："></a>使用GET请求获取JSON映射对象：</h4><p>只需要将后面的参数改为 对应实体对象即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Product forObject &#x3D; build.getForObject(&quot;http:&#x2F;&#x2F;www.baidu.com&quot;, Product.class);</span><br></pre></td></tr></table></figure><h4 id="使用GET请求获取更加详细的Entity对象"><a href="#使用GET请求获取更加详细的Entity对象" class="headerlink" title="使用GET请求获取更加详细的Entity对象"></a>使用GET请求获取更加详细的Entity对象</h4><p>使用<code>getForEntity</code>即可获取更为详细的对象</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ResponseEntity&lt;String&gt; forEntity &#x3D; build.getForEntity(&quot;http:&#x2F;&#x2F;www.baidu.com&quot;, String.class);</span><br></pre></td></tr></table></figure><h4 id="构建自定义的请求头："><a href="#构建自定义的请求头：" class="headerlink" title="构建自定义的请求头："></a>构建自定义的请求头：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MultiValueMap header &#x3D; new LinkedMultiValueMap();</span><br><span class="line">       header.add(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE);</span><br><span class="line">       HttpEntity&lt;Object&gt; requestEntity &#x3D; new HttpEntity&lt;&gt;(header);</span><br></pre></td></tr></table></figure><h4 id="构建自定义请求header"><a href="#构建自定义请求header" class="headerlink" title="构建自定义请求header"></a>构建自定义请求header</h4><p>一般使用<code>exchange</code>的相关方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ResponseEntity&lt;String&gt; exchange &#x3D; build.exchange(&quot;http:&#x2F;&#x2F;www.baidu.com&quot;, HttpMethod.GET, requestEntity, String.class);</span><br><span class="line">        System.out.println(&quot;get_product1返回结果：&quot; + exchange);</span><br></pre></td></tr></table></figure><h4 id="手动处理请求头以及返回信息"><a href="#手动处理请求头以及返回信息" class="headerlink" title="手动处理请求头以及返回信息"></a>手动处理请求头以及返回信息</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">build.execute(&quot;http:&#x2F;&#x2F;www.baidu.com&quot;, HttpMethod.GET, request -&gt; &#123;</span><br><span class="line">            request.getHeaders().add(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE);</span><br><span class="line">        &#125;, response -&gt; &#123;</span><br><span class="line">            HttpStatus statusCode &#x3D; response.getStatusCode();</span><br><span class="line">            int value &#x3D; statusCode.value();</span><br><span class="line">            System.err.println(&quot;响应code: &#x3D; &quot; + value);</span><br><span class="line">            return value;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure><p>这里有两个比较关键的接口</p><p><strong>RequestCallback requestCallback,</strong></p><p><strong>ResponseExtractor<T> responseExtractor</strong></p><p>可以使用lambada 表达式简化，或者使用匿名内部类</p><h4 id="使用带参数的Get请求"><a href="#使用带参数的Get请求" class="headerlink" title="使用带参数的Get请求"></a>使用带参数的Get请求</h4><ol><li>首先我们需要定义占位符</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String url &#x3D;&quot;htttp:&#x2F;&#x2F;localhost:8080?id&#x3D;&#123;id&#125;&quot;</span><br></pre></td></tr></table></figure><p>注意{id} 的写法,有点像<code>@PathValiable</code> 的写法</p><h5 id="使用动态参数："><a href="#使用动态参数：" class="headerlink" title="使用动态参数："></a>使用动态参数：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 带参数的GET请求</span><br><span class="line">String url &#x3D; &quot;http:&#x2F;&#x2F;localhost:7474?id&#x3D;&#123;id&#125;&quot;;</span><br><span class="line">build.getForObject(url, String.class, 11);</span><br></pre></td></tr></table></figure><h5 id="使用map设置参数"><a href="#使用map设置参数" class="headerlink" title="使用map设置参数"></a>使用map设置参数</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 使用map 设置参数</span><br><span class="line">Map&lt;String, Object&gt; uriVariables &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">uriVariables.put(&quot;id&quot;, 101);</span><br><span class="line">build.getForObject(url, String.class, uriVariables);</span><br></pre></td></tr></table></figure><h3 id="POST-请求："><a href="#POST-请求：" class="headerlink" title="POST 请求："></a>POST 请求：</h3><p>Post请求相对GET请求有更多的变化，这里也是列出日常开放比较常用的点</p><h4 id="发送-Content-Type-为-application-x-www-form-urlencoded的-POST-请求："><a href="#发送-Content-Type-为-application-x-www-form-urlencoded的-POST-请求：" class="headerlink" title="发送 Content-Type 为 application/x-www-form-urlencoded的 POST 请求："></a>发送 <code>Content-Type</code> 为 <code>application/x-www-form-urlencoded</code>的 POST 请求：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 设置请求头</span><br><span class="line">MultiValueMap multiValueMap &#x3D; new LinkedMultiValueMap();</span><br><span class="line">multiValueMap.add(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_FORM_URLENCODED_VALUE);</span><br><span class="line"></span><br><span class="line">User user &#x3D; new User();</span><br><span class="line">&#x2F;&#x2F;方式二： 将请求参数值以 K&#x3D;V 方式用 &amp; 拼接，发送请求使用</span><br><span class="line">String productStr &#x3D; &quot;id&#x3D;&quot; +  user.getId() + &quot;&amp;name&#x3D;&quot; + user.getName() + &quot;&amp;price&#x3D;&quot; + user.getSalt();</span><br><span class="line">&#x2F;&#x2F; 构建form参数的url</span><br><span class="line">HttpEntity&lt;String&gt; request &#x3D; new HttpEntity&lt;&gt;(productStr, header);</span><br><span class="line">ResponseEntity&lt;String&gt; exchange1 &#x3D; build.exchange(url, HttpMethod.POST, request, String.class);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 方式3 ，使用map</span><br><span class="line">&#x2F;&#x2F; 构建form参数的url</span><br><span class="line">HttpEntity&lt;String&gt; request &#x3D; new HttpEntity&lt;&gt;(productStr, header);</span><br><span class="line">ResponseEntity&lt;String&gt; exchange1 &#x3D; build.exchange(url, HttpMethod.POST, request, String.class);</span><br><span class="line"></span><br><span class="line">Map&lt;String, Object&gt; stringObjectMap &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">stringObjectMap.put(&quot;test&quot;, &quot;123&quot;);</span><br><span class="line">stringObjectMap.put(&quot;test1&quot;, &quot;123&quot;);</span><br><span class="line">stringObjectMap.put(&quot;test2&quot;, &quot;123&quot;);</span><br><span class="line">HttpEntity httpEntity &#x3D; new HttpEntity&lt;&gt;(stringObjectMap, header);</span><br><span class="line">ResponseEntity exchange2 &#x3D; build.exchange(url, HttpMethod.POST, httpEntity, String.class);</span><br></pre></td></tr></table></figure><h4 id="发送-Content-Type-为-application-json-的-POST-请求："><a href="#发送-Content-Type-为-application-json-的-POST-请求：" class="headerlink" title="发送 Content-Type 为 application/json 的 POST 请求："></a>发送 <code>Content-Type</code> 为 <code>application/json</code> 的 POST 请求：</h4><p>只需要将上面的案例当中的:</p><p><code>MediaType.APPLICATION_FORM_URLENCODED_VALUE</code>改为：<code>MediaType.APPLICATION_JSON_VALUE</code>即可</p><h3 id="DELETE-请求以及PUT请求"><a href="#DELETE-请求以及PUT请求" class="headerlink" title="DELETE 请求以及PUT请求"></a>DELETE 请求以及PUT请求</h3><p>因为都是<code>RestFul</code>的请求，所以简单描述</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">String url &#x3D; &quot;http:&#x2F;&#x2F;localhost:8080&#x2F;product&#x2F;update&quot;;</span><br><span class="line">Map&lt;String, ?&gt; variables &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">MultiValueMap&lt;String, String&gt; header &#x3D; new LinkedMultiValueMap();</span><br><span class="line">header.put(HttpHeaders.CONTENT_TYPE, Arrays.asList(MediaType.APPLICATION_FORM_URLENCODED_VALUE));</span><br><span class="line">Product product &#x3D; new Product(101, &quot;iWatch&quot;, BigDecimal.valueOf(2333));</span><br><span class="line">String productStr &#x3D; &quot;id&#x3D;&quot; + product.getId() + &quot;&amp;name&#x3D;&quot; + product.getName() + &quot;&amp;price&#x3D;&quot; + product.getPrice();</span><br><span class="line">HttpEntity&lt;String&gt; request &#x3D; new HttpEntity&lt;&gt;(productStr, header);</span><br><span class="line">restTemplate.put(url, request);</span><br></pre></td></tr></table></figure><h3 id="使用restTemplate实现文件上传"><a href="#使用restTemplate实现文件上传" class="headerlink" title="使用restTemplate实现文件上传"></a>使用restTemplate实现文件上传</h3><ol><li>需要设置multitype/file 文件请求头</li><li>需要设置headaer 以及 body</li><li>只能使用post请求</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">String ui &#x3D; &quot;&quot;;</span><br><span class="line">MultiValueMap&lt;String, Object&gt; body &#x3D; new LinkedMultiValueMap&lt;&gt;();</span><br><span class="line">FileSystemResource fileSystemResource &#x3D; new FileSystemResource();</span><br><span class="line">body.add(&quot;file&quot;, fileSystemResource);</span><br><span class="line"></span><br><span class="line">MultiValueMap&lt;String, String&gt; header2 &#x3D; new LinkedMultiValueMap();</span><br><span class="line">header2.put(HttpHeaders.CONTENT_TYPE, Arrays.asList(MediaType.MULTIPART_FORM_DATA_VALUE));</span><br><span class="line">HttpEntity httpquest &#x3D; new HttpEntity&lt;&gt;(body, header2);</span><br><span class="line">ResponseEntity&lt;String&gt; xxx &#x3D; build.postForEntity(&quot;xxx&quot;, httpquest, String.class);</span><br></pre></td></tr></table></figure><h2 id="进阶-RestTemplate"><a href="#进阶-RestTemplate" class="headerlink" title="进阶 RestTemplate"></a>进阶 RestTemplate</h2><h3 id="如何设置RestTempalate的默认底层引擎"><a href="#如何设置RestTempalate的默认底层引擎" class="headerlink" title="如何设置RestTempalate的默认底层引擎"></a>如何设置RestTempalate的默认底层引擎</h3><p>RestTemplate 默认使用的引擎：</p><ul><li>Apache HttpComponents</li><li>Netty</li><li>OkHttp</li></ul><p>一句话概括：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RestTemplate template &#x3D; new RestTemplate(new HttpComponentsClientHttpRequestFactory());</span><br></pre></td></tr></table></figure><h3 id="如何修改RestTemplate-的超时时间"><a href="#如何修改RestTemplate-的超时时间" class="headerlink" title="如何修改RestTemplate 的超时时间"></a>如何修改RestTemplate 的超时时间</h3><p>参考代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">RestTemplate customRestTemplate &#x3D; new RestTemplate(getClientHttpRequestFactory());</span><br><span class="line"></span><br><span class="line">private SimpleClientHttpRequestFactory getClientHttpRequestFactory() &#123;</span><br><span class="line">    SimpleClientHttpRequestFactory clientHttpRequestFactory</span><br><span class="line">            &#x3D; new SimpleClientHttpRequestFactory();</span><br><span class="line">    &#x2F;&#x2F; 连接超时设置 10s</span><br><span class="line">    clientHttpRequestFactory.setConnectTimeout(10_000);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 读取超时设置 10s</span><br><span class="line">    clientHttpRequestFactory.setReadTimeout(10_000);</span><br><span class="line">    return clientHttpRequestFactory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果要调整 <code>HttpComponentsClient</code> 的超时设置，可以参考文章<a href="https://howtodoinjava.com/spring-boot2/resttemplate-timeout-example/" target="_blank" rel="noopener">resttemplate-timeout-example</a> 。当然除了设置超时时间之外，还有更多参数进行定制，这里就不一一列举，可以参考文章 <a href="https://howtodoinjava.com/spring-restful/resttemplate-httpclient-java-config/" target="_blank" rel="noopener">resttemplate-httpclient-java-config</a> 进一步学习。</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://www.baeldung.com/rest-template" target="_blank" rel="noopener">www.baeldung.com/rest-templa…</a></p><p><a href="http://blog.didispace.com/spring-boot-learning-21-1-1" target="_blank" rel="noopener">blog.didispace.com/spring-boot…</a></p><p><a href="https://www.baeldung.com/spring-rest-template-multipart-upload" target="_blank" rel="noopener">www.baeldung.com/spring-rest…</a></p><p><a href="https://www.zhihu.com/question/28557115" target="_blank" rel="noopener">www.zhihu.com/question/28…</a></p><p><a href="https://howtodoinjava.com/spring-boot2/resttemplate-timeout-example" target="_blank" rel="noopener">howtodoinjava.com/spring-boot…</a></p><p><a href="https://docs.spring.io/spring/docs/5.1.6.RELEASE/spring-framework-reference/integration.html#rest-client-access" target="_blank" rel="noopener">docs.spring.io/spring/docs…</a></p><p><a href="https://zh.wikipedia.org/wiki/表现层状态转换" target="_blank" rel="noopener">zh.wikipedia.org/wiki/表现层状态转…</a></p><p><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/client/RestOperations.html" target="_blank" rel="noopener">docs.spring.io/spring-fram…</a></p><p>作者：闻人的技术博客 链接：<a href="https://juejin.im/post/6844903842065154061" target="_blank" rel="noopener">https://juejin.im/post/6844903842065154061</a> 来源：掘金 著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>]]></content>
    
    <summary type="html">
    
      RestTemplate
    
    </summary>
    
    
      <category term="Spring" scheme="http://lazytime.site/categories/Spring/"/>
    
    
      <category term="JAVA" scheme="http://lazytime.site/tags/JAVA/"/>
    
  </entry>
  
  <entry>
    <title>蓝牙应该怎么选？</title>
    <link href="http://lazytime.site/2020/08/22/%E8%93%9D%E7%89%99%E5%BA%94%E8%AF%A5%E6%80%8E%E4%B9%88%E9%80%89%EF%BC%9F/"/>
    <id>http://lazytime.site/2020/08/22/%E8%93%9D%E7%89%99%E5%BA%94%E8%AF%A5%E6%80%8E%E4%B9%88%E9%80%89%EF%BC%9F/</id>
    <published>2020-08-22T11:33:25.000Z</published>
    <updated>2020-08-22T11:34:05.166Z</updated>
    
    <content type="html"><![CDATA[<h1 id="先说说总结"><a href="#先说说总结" class="headerlink" title="先说说总结"></a>先说说总结</h1><p><a href="https://www.bilibili.com/video/BV1f4411M7R1" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1f4411M7R1</a> 文章的最终来源</p><ol><li>蓝牙 5.0 的耳机连接更加稳定、范围更大、更省电</li><li>一般情况下使用SBC或者AAC的编码足够<ol><li>华为的部分机型格式：HWA</li><li>索尼的格式：LDAC</li><li>高通的特殊格式：aptX</li></ol></li><li>蓝牙耳机不可能没有延迟，只能尽量减小、</li></ol><a id="more"></a><h1 id="为什么要买蓝牙耳机？"><a href="#为什么要买蓝牙耳机？" class="headerlink" title="为什么要买蓝牙耳机？"></a>为什么要买蓝牙耳机？</h1><ol><li>个人需求是出门的时候使用，因为方便听歌，</li><li>坐地铁的时候很方便</li><li>不是经常戴耳机的人</li><li>对音质有极度追求不建议用蓝牙耳机</li></ol><h1 id="蓝牙是如何音频到蓝牙耳机的？"><a href="#蓝牙是如何音频到蓝牙耳机的？" class="headerlink" title="蓝牙是如何音频到蓝牙耳机的？"></a>蓝牙是如何音频到蓝牙耳机的？</h1><ol><li>声源：音频芯片把声音编码为可供蓝牙传输的格式</li><li>蓝牙之间通信，将音频内容传到蓝牙耳机</li><li>蓝牙耳机：使用音频芯片翻译为音频信号</li><li>发出声音</li></ol><h1 id="影响蓝牙耳机使用体验的几个点："><a href="#影响蓝牙耳机使用体验的几个点：" class="headerlink" title="影响蓝牙耳机使用体验的几个点："></a>影响蓝牙耳机使用体验的几个点：</h1><ol><li>首先是手机的蓝牙协议支持<ol><li>4.1（目前已经被废弃）</li><li>4.2 </li><li>5.0 （推荐买带有5.0协议的手机）</li></ol></li><li>蓝牙音频的编码格式<ol><li>SBC<ol><li>有损音质</li><li>高延迟</li><li>码率低</li></ol></li><li>AAC<ol><li>延迟比SBC更低</li><li>码率更高</li><li>延迟一般</li></ol></li><li>aptX<ol><li>aptX<ol><li>无损</li></ol></li><li>aptX HD<ol><li>无损</li><li>延迟小于130</li><li>码率：576</li></ol></li><li>aptX 低延迟<ol><li>420 码率</li><li>延迟40MS</li><li>吴顺</li></ol></li></ol></li><li>LDAC<ol><li>无损音乐的无损输出</li></ol></li><li>HWA<ol><li>和索尼不相上下</li></ol></li></ol></li></ol><h1 id="结果："><a href="#结果：" class="headerlink" title="结果："></a>结果：</h1><p>蓝牙耳机个人认为只要够用就行，你是怎么选择的呢</p>]]></content>
    
    <summary type="html">
    
      蓝牙应该怎么选
    
    </summary>
    
    
      <category term="日常" scheme="http://lazytime.site/categories/%E6%97%A5%E5%B8%B8/"/>
    
    
      <category term="日常" scheme="http://lazytime.site/tags/%E6%97%A5%E5%B8%B8/"/>
    
  </entry>
  
  <entry>
    <title>mysql zip包安装指南</title>
    <link href="http://lazytime.site/2020/08/02/mysql-zip%E5%8C%85%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97v/"/>
    <id>http://lazytime.site/2020/08/02/mysql-zip%E5%8C%85%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97v/</id>
    <published>2020-08-02T02:28:05.000Z</published>
    <updated>2020-08-02T02:30:38.349Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-下载zip-包"><a href="#1-下载zip-包" class="headerlink" title="1. 下载zip 包"></a>1. 下载zip 包</h1><h2 id="地址："><a href="#地址：" class="headerlink" title="地址："></a>地址：</h2><p><a href="https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.31-winx64.zip" target="_blank" rel="noopener">https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.31-winx64.zip</a></p><a id="more"></a><h1 id="2-解压缩，放到D盘自定义位置"><a href="#2-解压缩，放到D盘自定义位置" class="headerlink" title="2. 解压缩，放到D盘自定义位置"></a>2. 解压缩，放到D盘自定义位置</h1><p>我的位置如下:</p><p>D:\soft\mysql-5.7.31-winx64</p><h1 id="3-配置环境变量"><a href="#3-配置环境变量" class="headerlink" title="3. 配置环境变量"></a>3. 配置环境变量</h1><p>以win10 为例：</p><ol><li>打开高级设置</li></ol><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20200801115826.png?ynotemdtimestamp=1596333875837" alt="img"></p><ol><li>在此处配置环境变量</li></ol><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20200801115848.png?ynotemdtimestamp=1596333875837" alt="img"></p><ol><li>配置如下</li></ol><p>MYSQL_HOME : mysql5.7zip包解压路径</p><p><strong>path：%MYSQL_HOME%\bin</strong></p><h1 id="4-新建my-ini文件（解压包里是没有my-dafault-ini或自带my-ini文件，需自己创建）编辑写入以下信息"><a href="#4-新建my-ini文件（解压包里是没有my-dafault-ini或自带my-ini文件，需自己创建）编辑写入以下信息" class="headerlink" title="4. 新建my.ini文件（解压包里是没有my-dafault.ini或自带my.ini文件，需自己创建）编辑写入以下信息"></a>4. 新建my.ini文件（解压包里是没有my-dafault.ini或自带my.ini文件，需自己创建）编辑写入以下信息</h1><p>配置如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[mysql]</span><br><span class="line"># 设置mysql客户端默认字符集</span><br><span class="line">default-character-set&#x3D;utf8 </span><br><span class="line">[mysqld]</span><br><span class="line"># 设置3306端口</span><br><span class="line">port &#x3D; 3306 </span><br><span class="line"># 设置mysql的安装目录</span><br><span class="line">basedir&#x3D;C:\Program Files\mysql-5.7.21-winx64</span><br><span class="line"># 设置mysql数据库的数据的存放目录</span><br><span class="line">datadir&#x3D;C:\Program Files\mysql-5.7.21-winx64\data</span><br><span class="line"># 允许最大连接数</span><br><span class="line">max_connections&#x3D;200</span><br><span class="line"># 设置mysql服务端默认字符集</span><br><span class="line">character-set-server&#x3D;utf8</span><br><span class="line"># 创建新表时将使用的默认存储引擎</span><br><span class="line">default-storage-engine&#x3D;INNODB</span><br></pre></td></tr></table></figure><h1 id="5-让配置生效"><a href="#5-让配置生效" class="headerlink" title="5. 让配置生效"></a>5. 让配置生效</h1><p>mysql初始化，以<strong>管理员权限</strong>打开cmd命令窗口，切换到<code>”C:\Program Files\mysql-5.7.21-winx64\bin”</code>路径下执行</p><p>这里可以获得ROOT密码：<code>j&lt;ASsKzqP8M4</code></p><blockquote><p>这里提示报错:</p><p>由于找不到msvcr120.dll无法继续执行代码</p><p>我的解决办法是，进入到：<a href="https://www.microsoft.com/zh-cn/download/confirmation.aspx?id=40784" target="_blank" rel="noopener">https://www.microsoft.com/zh-cn/download/confirmation.aspx?id=40784</a></p><p>这种错误是由于未安装 vcredist 引起的</p><p>引入自博客：<a href="https://blog.csdn.net/weixin_30517001/article/details/97706795" target="_blank" rel="noopener">https://blog.csdn.net/weixin_30517001/article/details/97706795</a></p></blockquote><blockquote><p>MySQL5.7执行mysqld命令出现Can‘t change dir to ‘C:\Program Files\MySQL\MySQL Server 5.7\data\‘错误</p><p>解决方法： 提示No such file or directory，到C:\Program Files\MySQL\MySQL Server 5.7\目录下创建data文件夹即可。</p><p>楼主这里手动创建了对应的目录以及对应的子目录</p></blockquote><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20200801123207.png?ynotemdtimestamp=1596333875837" alt="img"></p><h1 id="6-让my-ini-配置生效"><a href="#6-让my-ini-配置生效" class="headerlink" title="6. 让my.ini 配置生效"></a>6. 让my.ini 配置生效</h1><p>执行如下命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld install MySQL --defaults-file&#x3D;&quot;C:\Program Files\mysql-5.7.21-winx64\my.ini</span><br></pre></td></tr></table></figure><p>my.ini 为你自己建立的配置文件路径</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20200801123830.png?ynotemdtimestamp=1596333875837" alt="img"></p><h1 id="7-启动mysql服务，输入-net-start-mysql，启动成功，会出现下面的截图。如果服务一直处于启动中，说明上一步的操作有误，核实my-ini文件路径是否正确"><a href="#7-启动mysql服务，输入-net-start-mysql，启动成功，会出现下面的截图。如果服务一直处于启动中，说明上一步的操作有误，核实my-ini文件路径是否正确" class="headerlink" title="7. 启动mysql服务，输入 net start mysql，启动成功，会出现下面的截图。如果服务一直处于启动中，说明上一步的操作有误，核实my.ini文件路径是否正确"></a>7. 启动mysql服务，输入 net start mysql，启动成功，会出现下面的截图。<strong>如果服务一直处于启动中，说明上一步的操作有误，核实my.ini文件路径是否正确</strong></h1><p>如果之前有安装过mysql，这里可以查看这篇博客了解如何卸载:</p><p><a href="https://www.cnblogs.com/puhongjun/p/10189454.html" target="_blank" rel="noopener">https://www.cnblogs.com/puhongjun/p/10189454.html</a></p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20200801125305.png?ynotemdtimestamp=1596333875837" alt="img"></p><p>经过不懈的努力，安装成功</p><p>PS：mysql 还是建议装在c盘，个人碰到了各种莫名其妙的问题</p><h1 id="8-初次登陆设置mysql-root-用户密码："><a href="#8-初次登陆设置mysql-root-用户密码：" class="headerlink" title="8. 初次登陆设置mysql root 用户密码："></a>8. 初次登陆设置mysql root 用户密码：</h1><blockquote><p>ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.</p></blockquote><p>当使用mysql 安装生成的root 密码登录的时候，需要重新设置root 密码，修改root 密码为:</p><p>修改密码命令：<code>set password = password(‘新密码’)</code>;</p><h1 id="9-结语"><a href="#9-结语" class="headerlink" title="9. 结语"></a>9. 结语</h1><p>此时在服务里面可以看到Mysql 的服务已经启动了</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20200801132213.png?ynotemdtimestamp=1596333875837" alt="img"></p><p>用zip 包的安装方式可能会有各种各样的问题，这里找了百度先生处理一些常见的问题:</p><p><a href="https://jingyan.baidu.com/article/da1091fb1a46a6027849d6a8.html" target="_blank" rel="noopener">https://jingyan.baidu.com/article/da1091fb1a46a6027849d6a8.html</a></p>]]></content>
    
    <summary type="html">
    
      mysqlzip包的安装方式
    
    </summary>
    
    
      <category term="Linux" scheme="http://lazytime.site/categories/Linux/"/>
    
    
      <category term="mysql" scheme="http://lazytime.site/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>nodejs安装教程</title>
    <link href="http://lazytime.site/2020/07/26/nodejs%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/"/>
    <id>http://lazytime.site/2020/07/26/nodejs%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/</id>
    <published>2020-07-26T14:37:22.000Z</published>
    <updated>2020-07-26T14:41:15.460Z</updated>
    
    <content type="html"><![CDATA[<h1 id="nodejs安装教程（linux）"><a href="#nodejs安装教程（linux）" class="headerlink" title="nodejs安装教程（linux）"></a>nodejs安装教程（linux）</h1><h2 id="1-下载官方包"><a href="#1-下载官方包" class="headerlink" title="1. 下载官方包"></a>1. 下载官方包</h2><h3 id="1-1-相关命令"><a href="#1-1-相关命令" class="headerlink" title="1.1. 相关命令"></a>1.1. 相关命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># wget https:&#x2F;&#x2F;nodejs.org&#x2F;dist&#x2F;v10.9.0&#x2F;node-v10.9.0-linux-x64.tar.xz    &#x2F;&#x2F; 下载</span><br><span class="line"># tar xf  node-v10.9.0-linux-x64.tar.xz       &#x2F;&#x2F; 解压</span><br><span class="line"># cd node-v10.9.0-linux-x64&#x2F;                  &#x2F;&#x2F; 进入解压目录</span><br><span class="line"># .&#x2F;bin&#x2F;node -v                               &#x2F;&#x2F; 执行node命令 查看版本</span><br><span class="line">v10.9.0</span><br></pre></td></tr></table></figure><h2 id="2-设置软连接"><a href="#2-设置软连接" class="headerlink" title="2. 设置软连接"></a>2. 设置软连接</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s &#x2F;usr&#x2F;software&#x2F;nodejs&#x2F;bin&#x2F;npm   &#x2F;usr&#x2F;local&#x2F;bin&#x2F; </span><br><span class="line">ln -s &#x2F;usr&#x2F;software&#x2F;nodejs&#x2F;bin&#x2F;node   &#x2F;usr&#x2F;local&#x2F;bin&#x2F;</span><br></pre></td></tr></table></figure><h2 id="3-常见问题解决"><a href="#3-常见问题解决" class="headerlink" title="3.常见问题解决"></a>3.常见问题解决</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&gt; cat &#x2F;etc&#x2F;redhat-release</span><br><span class="line">&gt; &#x2F;&#x2F;查看python版本</span><br><span class="line">&gt; python -v</span><br><span class="line">&gt; &#x2F;&#x2F;查看gcc rpm gcc-c++是否安装</span><br><span class="line">&gt; rpm -q gcc rpm -q gcc-c++</span><br><span class="line">&gt; &#x2F;&#x2F;安装gcc-c++</span><br><span class="line">&gt; yum -v install gcc-c++ kernel-devel</span><br><span class="line">&gt; &#x2F;&#x2F;大招荡平一切环境问题</span><br><span class="line">&gt; yum -y update &amp;&amp; yum -y groupinstall &quot;Development Tools&quot;</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;复制官网链接（Source Code版本）进入&#x2F;usr&#x2F;src目录下载nodejs</span><br><span class="line">&gt;wget https:&#x2F;&#x2F;nodejs.org&#x2F;dist&#x2F;v6.11.4&#x2F;node-v6.11.4.tar.gz</span><br><span class="line">&#x2F;&#x2F;解压</span><br><span class="line">&gt;tar -xf node-v6.11.4.tar.gz</span><br><span class="line">&#x2F;&#x2F;删除压缩包</span><br><span class="line">&gt;rm node-v6.11.4.tar.gz</span><br><span class="line">&#x2F;&#x2F;进入node-v6.11.4目录，进行配置</span><br><span class="line">&gt;.&#x2F;configure</span><br><span class="line">&#x2F;&#x2F;编译</span><br><span class="line">&gt;make</span><br><span class="line">&#x2F;&#x2F;安装</span><br><span class="line">&gt;sodu make install</span><br></pre></td></tr></table></figure><p><strong>！！！编译Node 时候发现gcc 版本太低需要升级gcc编译器版本</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#获取源码(由于官方镜像速度较慢，这里使用了中国科学院开源协会的镜像</span><br><span class="line">sudo wget http:&#x2F;&#x2F;mirrors.opencas.org&#x2F;gnu&#x2F;gcc&#x2F;gcc-6.3.0&#x2F;gcc-6.3.0.tar.bz2</span><br><span class="line">#如果以上给出的镜像不可用，也可以是使用http:&#x2F;&#x2F;ftp.gnu.org&#x2F;gnu&#x2F;gcc&#x2F;，但由于有墙的存在，通常这样都很慢，建议本地通过shadowsocks 下载后放到服务器上再继续以下步骤</span><br><span class="line"></span><br><span class="line">#解压</span><br><span class="line">sudo tar -jxvf gcc-6.3.0.tar.bz2</span><br><span class="line">#下载编译所需的依赖项</span><br><span class="line">#如果想更快，可以利用中国科学院开源协会的镜像加速下载gmp和mpfr这两个包（另外两个包镜像没有收录），手动替换.&#x2F;contrib&#x2F;download_prerequisites的以下两处命令：</span><br><span class="line">#1) 把wget ftp:&#x2F;&#x2F;gcc.gnu.org&#x2F;pub&#x2F;gcc&#x2F;infrastructure&#x2F;$MPFR.tar.bz2 || exit 1 替换成wget http:&#x2F;&#x2F;mirrors.opencas.org&#x2F;gnu&#x2F;mpfr&#x2F;$MPFR.tar.bz2 || exit 1</span><br><span class="line">#2) 把wget ftp:&#x2F;&#x2F;gcc.gnu.org&#x2F;pub&#x2F;gcc&#x2F;infrastructure&#x2F;$GMP.tar.bz2 || exit 1 替换成wget http:&#x2F;&#x2F;mirrors.opencas.org&#x2F;gnu&#x2F;gmp&#x2F;$GMP.tar.bz2 || exit 1</span><br><span class="line">cd gcc-6.3.0</span><br><span class="line">sudo .&#x2F;contrib&#x2F;download_prerequisites</span><br><span class="line">cd ..</span><br><span class="line"></span><br><span class="line">#建立编译输出目录</span><br><span class="line">sudo mkdir gcc-build-6.3.0</span><br><span class="line"></span><br><span class="line">#进入此目录，执行以下命令，生成makefile文件</span><br><span class="line">cd gcc-build-6.3.0</span><br><span class="line">sudo ..&#x2F;gcc-6.3.0&#x2F;configure --enable-checking&#x3D;release --enable-languages&#x3D;c,c++ --disable-multilib</span><br><span class="line"></span><br><span class="line">#执行命令进行编译，此处利用4个job，需编译时约40分钟，此值不宜设置过高</span><br><span class="line">sudo make -j4</span><br><span class="line"></span><br><span class="line">#安装</span><br><span class="line"></span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><p>强烈建议 centeros使用 7.0 以上版本</p><h2 id="4-问题"><a href="#4-问题" class="headerlink" title="4. 问题"></a>4. 问题</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">make[2]: Leaving directory &#96;&#x2F;home&#x2F;imdb&#x2F;gcc-4.8.2&#x2F;gcc-build-4.8.2&#39;</span><br><span class="line">make[1]: *** [stage1-bubble] 错误 2</span><br><span class="line">make[1]: Leaving directory &#96;&#x2F;home&#x2F;imdb&#x2F;gcc-4.8.2&#x2F;gcc-build-4.8.2&#39;</span><br><span class="line"></span><br><span class="line">## make: *** [all] 错误 2</span><br><span class="line"></span><br><span class="line">解决办法</span><br><span class="line">ubuntu： apt-get install gcc g++ </span><br><span class="line">CentOS：yum install gcc gcc-c++</span><br></pre></td></tr></table></figure><h4 id=""><a href="#" class="headerlink" title=""></a></h4><h2 id="5-Npm-更换淘宝镜像"><a href="#5-Npm-更换淘宝镜像" class="headerlink" title="5. Npm 更换淘宝镜像"></a>5. Npm 更换淘宝镜像</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. npm config set registry https:&#x2F;&#x2F;registry.npm.taobao.org</span><br><span class="line">2. npm install</span><br></pre></td></tr></table></figure><h2 id="6-安装node-JS-pm2"><a href="#6-安装node-JS-pm2" class="headerlink" title="6.安装node JS pm2"></a>6.安装node JS pm2</h2><p>作用: 后台运行npm start 程序</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cnpm install pm2 -g </span><br><span class="line"></span><br><span class="line">pm2启动：</span><br><span class="line">pm2 start &quot;&#x2F;usr&#x2F;local&#x2F;src&#x2F;node&#x2F;bin&#x2F;npm&quot; --name &quot;law&quot; -- start .</span><br><span class="line"> </span><br><span class="line">pm2 list</span><br><span class="line">pm2 stop    </span><br><span class="line">pm2 restart </span><br><span class="line">pm2 delete  </span><br><span class="line"></span><br><span class="line">linux 找不到pm2 </span><br><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;nodebox&#x2F;nodejs&#x2F;lib&#x2F;node_modules&#x2F;pm2&#x2F;bin&#x2F;pm2 &#x2F;usr&#x2F;local&#x2F;bin</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      请输入描述信息
    
    </summary>
    
    
      <category term="NodeJS" scheme="http://lazytime.site/categories/NodeJS/"/>
    
    
      <category term="NodeJS" scheme="http://lazytime.site/tags/NodeJS/"/>
    
  </entry>
  
  <entry>
    <title>导出数据的踩坑记录</title>
    <link href="http://lazytime.site/2020/07/26/%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E7%9A%84%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/"/>
    <id>http://lazytime.site/2020/07/26/%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E7%9A%84%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/</id>
    <published>2020-07-26T14:23:40.000Z</published>
    <updated>2020-07-26T14:30:00.976Z</updated>
    
    <content type="html"><![CDATA[<h1 id="情感分析的导出"><a href="#情感分析的导出" class="headerlink" title="情感分析的导出"></a>情感分析的导出</h1><ol><li>将数据通过excel的形式导入到sqlsever</li><li>查询整个数据表，查找是否已经处理，如果已经处理，跳过，否则，执行情感分析</li><li>使用jsp Update 数据的状态，更新一条将标识位调整</li><li>每隔一定的时间进行处理</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">String sql &#x3D; &quot;select id,new_name,old_name from m_test where flag &#x3D; 0&quot;;</span><br><span class="line">    ObjectManager objectManager &#x3D; new ObjectManager();</span><br><span class="line">    List&lt;IDataSet&gt; dataList &#x3D; objectManager.list(sql);</span><br><span class="line">    if (dataList.isEmpty()) &#123;</span><br><span class="line">        out.print(&quot;开始执行统计分析程序，没有需要分析的数据！&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    out.print(&quot;开始执行统计分析程序，需要分析：&quot; + dataList.size() + &quot;条&quot;);</span><br><span class="line"></span><br><span class="line">    int i &#x3D; 0;</span><br><span class="line">    for (IDataSet data : dataList) &#123;</span><br><span class="line">        String new_name &#x3D; data.getString(&quot;new_name&quot;);</span><br><span class="line">        String old_name &#x3D; data.getString(&quot;old_name&quot;);</span><br><span class="line">        SentimentAnalysis new_name_result &#x3D; null;</span><br><span class="line">        SentimentAnalysis old_name_result &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            new_name_result &#x3D; NlpApi.sentimentAnalysisByText(new_name);</span><br><span class="line">            old_name_result &#x3D; NlpApi.sentimentAnalysisByText(old_name);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            System.out.println(&quot;调用分析接口出错！&quot; + e.getMessage());</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String new_sentimentname &#x3D; &quot;&quot;;</span><br><span class="line">        String new_confide &#x3D; &quot;&quot;;</span><br><span class="line">        String new_negative &#x3D; &quot;&quot;;</span><br><span class="line">        String new_positive &#x3D; &quot;&quot;;</span><br><span class="line">        String old_sentimentname &#x3D; &quot;&quot;;</span><br><span class="line">        String old_confide &#x3D; &quot;&quot;;</span><br><span class="line">        String old_negative &#x3D; &quot;&quot;;</span><br><span class="line">        String old_positive &#x3D; &quot;&quot;;</span><br><span class="line"></span><br><span class="line">        if(null !&#x3D; new_name_result)&#123;</span><br><span class="line">            new_sentimentname &#x3D; new_name_result.getSentimentName();</span><br><span class="line">            new_confide &#x3D; String.valueOf(new_name_result.getConfidence());</span><br><span class="line">            new_negative &#x3D; String.valueOf(new_name_result.getNegativeProb());</span><br><span class="line">            new_positive &#x3D; String.valueOf(new_name_result.getPositiveProb());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if(null !&#x3D; old_name_result)&#123;</span><br><span class="line">            old_sentimentname &#x3D; old_name_result.getSentimentName();</span><br><span class="line">            old_confide &#x3D; String.valueOf(old_name_result.getConfidence());</span><br><span class="line">            old_negative &#x3D; String.valueOf(old_name_result.getNegativeProb());</span><br><span class="line">            old_positive &#x3D; String.valueOf(old_name_result.getPositiveProb());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String updateSql &#x3D; &quot;update m_test set new_confide &#x3D; ? , new_negative &#x3D; ? , new_positive &#x3D; ?, new_anaresult &#x3D; ?,old_confide &#x3D; ? , old_negative &#x3D; ? , old_positive &#x3D; ?, old_anaresult &#x3D; ? , flag &#x3D; 1 where id &#x3D; ?&quot;;</span><br><span class="line"></span><br><span class="line">        objectManager.update(updateSql, new Object[]&#123;new_sentimentname, new_confide, new_negative, new_positive, old_sentimentname, old_confide, old_negative, old_positive, data.getInt(&quot;id&quot;)&#125;);</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    out.print(&quot;系统执行完毕，执行成功&quot; + i + &quot;条&quot;);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      情感分析的导出
    
    </summary>
    
    
      <category term="情感分析" scheme="http://lazytime.site/categories/%E6%83%85%E6%84%9F%E5%88%86%E6%9E%90/"/>
    
    
      <category term="情感分析" scheme="http://lazytime.site/tags/%E6%83%85%E6%84%9F%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>Neo4j 学习笔记</title>
    <link href="http://lazytime.site/2020/07/26/Neo4j-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://lazytime.site/2020/07/26/Neo4j-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2020-07-26T14:05:18.000Z</published>
    <updated>2020-07-26T14:17:57.094Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Neo4j-学习"><a href="#Neo4j-学习" class="headerlink" title="Neo4j 学习"></a>Neo4j 学习</h1><h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><h2 id="1-入门"><a href="#1-入门" class="headerlink" title="1. 入门"></a>1. 入门</h2><h3 id="1-1-安装neo4j"><a href="#1-1-安装neo4j" class="headerlink" title="1.1 安装neo4j"></a>1.1 安装neo4j</h3><p>直接安装 neo4j desktop 版本</p><p>如果是community 社区版本，则需要到安装目录的bin 下面执行如下命令</p><a id="more"></a><h2 id="2-Cypher简介"><a href="#2-Cypher简介" class="headerlink" title="2. Cypher简介"></a>2. <a href="https://neo4j.com/docs/getting-started/current/cypher-intro/" target="_blank" rel="noopener">Cypher简介</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">()</span><br><span class="line">(matrix)</span><br><span class="line">(:Movie)</span><br><span class="line">(matrix:Movie)</span><br><span class="line">(matrix:Movie &#123;title: &quot;The Matrix&quot;&#125;)</span><br><span class="line">(matrix:Movie &#123;title: &quot;The Matrix&quot;, released: 1997&#125;)</span><br></pre></td></tr></table></figure><h3 id="2-1-关系语法"><a href="#2-1-关系语法" class="headerlink" title="2.1 关系语法"></a>2.1 关系语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--&gt;</span><br><span class="line">-[role]-&gt;</span><br><span class="line">-[:ACTED_IN]-&gt;</span><br><span class="line">-[role:ACTED_IN]-&gt;</span><br><span class="line">-[role:ACTED_IN &#123;roles: [&quot;Neo&quot;]&#125;]-&gt;</span><br></pre></td></tr></table></figure><h3 id="2-2-模式语法"><a href="#2-2-模式语法" class="headerlink" title="2.2 模式语法"></a>2.2 模式语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(keanu:Person:Actor &#123;name:  &quot;Keanu Reeves&quot;&#125; )</span><br><span class="line">-[role:ACTED_IN     &#123;roles: [&quot;Neo&quot;] &#125; ]-&gt;</span><br><span class="line">(matrix:Movie       &#123;title: &quot;The Matrix&quot;&#125; )</span><br></pre></td></tr></table></figure><h2 id="3-Cypher-基本语法"><a href="#3-Cypher-基本语法" class="headerlink" title="3. Cypher 基本语法"></a>3. Cypher 基本语法</h2><h3 id="3-1-创建数据"><a href="#3-1-创建数据" class="headerlink" title="3.1 创建数据"></a>3.1 创建数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE (:MyMovie&#123;title:&quot;The Matrix&quot;, released:1997&#125;)</span><br></pre></td></tr></table></figure><h3 id="3-2-创建并且返回数据"><a href="#3-2-创建并且返回数据" class="headerlink" title="3.2 创建并且返回数据"></a>3.2 创建并且返回数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE (p:MyPeron&#123; name:&quot;test&quot;, relase:&quot;test&quot;&#125;) RETURN p</span><br></pre></td></tr></table></figure><h3 id="3-3-创建多个元素"><a href="#3-3-创建多个元素" class="headerlink" title="3.3 创建多个元素"></a>3.3 创建多个元素</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE (a:Person &#123; name:&quot;Tom Hanks&quot;,</span><br><span class="line">  born:1956 &#125;)-[r:ACTED_IN &#123; roles: [&quot;Forrest&quot;]&#125;]-&gt;(m:Movie &#123; title:&quot;Forrest Gump&quot;,released:1994 &#125;)</span><br><span class="line">                                                               </span><br><span class="line">CREATE (d:Person &#123; name:&quot;Robert Zemeckis&quot;, born:1951 &#125;)-[:DIRECTED]-&gt;(m)</span><br><span class="line">RETURN a,d,r,m</span><br></pre></td></tr></table></figure><h3 id="3-4-匹配模式"><a href="#3-4-匹配模式" class="headerlink" title="3.4 匹配模式"></a>3.4 匹配模式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MATCH (p:Person &#123; name:&quot;Tom Hanks&quot; &#125;)-[r:ACTED_IN]-&gt;(m:Movie)</span><br><span class="line">RETURN m.title, r.roles</span><br></pre></td></tr></table></figure><h3 id="3-5-连接结构"><a href="#3-5-连接结构" class="headerlink" title="3.5 连接结构"></a>3.5 连接结构</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MATCH (p:Person &#123; name:&quot;Tom Hanks&quot; &#125;)</span><br><span class="line">CREATE (m:Movie &#123; title:&quot;Cloud Atlas&quot;,released:2012 &#125;)</span><br><span class="line">CREATE (p)-[r:ACTED_IN &#123; roles: [&#39;Zachry&#39;]&#125;]-&gt;(m)</span><br><span class="line">RETURN p,r,m</span><br></pre></td></tr></table></figure><h3 id="3-6-完成模式"><a href="#3-6-完成模式" class="headerlink" title="3.6 完成模式"></a>3.6 完成模式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MERGE (m:Movie &#123; title:&quot;Cloud Atlas&quot; &#125;)</span><br><span class="line">ON CREATE SET m.released &#x3D; 2012</span><br><span class="line">RETURN m</span><br></pre></td></tr></table></figure><p>使用合并关联多个</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MATCH (m:Movie &#123; title:&quot;Cloud Atlas&quot; &#125;)</span><br><span class="line">MATCH (p:Person &#123; name:&quot;Tom Hanks&quot; &#125;)</span><br><span class="line">MERGE (p)-[r:ACTED_IN]-&gt;(m)</span><br><span class="line">ON CREATE SET r.roles &#x3D;[&#39;Zachry&#39;]</span><br><span class="line">RETURN p,r,m</span><br></pre></td></tr></table></figure><p>处理多重关联</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE (y:Year &#123; year:2014 &#125;)</span><br><span class="line">MERGE (y)&lt;-[:IN_YEAR]-(m10:Month &#123; month:10 &#125;)</span><br><span class="line">MERGE (y)&lt;-[:IN_YEAR]-(m11:Month &#123; month:11 &#125;)</span><br><span class="line">RETURN y,m10,m11</span><br></pre></td></tr></table></figure><h2 id="4-Cypher-筛选结果正确的结果"><a href="#4-Cypher-筛选结果正确的结果" class="headerlink" title="4. Cypher 筛选结果正确的结果"></a>4. Cypher 筛选结果正确的结果</h2><h3 id="4-1-测试数据"><a href="#4-1-测试数据" class="headerlink" title="4.1 测试数据"></a>4.1 测试数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE (xiaohong:Person &#123;name: &quot;小红&quot;, born: 1954&#125;)</span><br><span class="line">CREATE (xiaolv:Person &#123;name: &quot;小绿S&quot;, born: 1964&#125;)</span><br><span class="line">CREATE (xiaohuang:Person &#123;name: &quot;小黄&quot;, born: 1948&#125;)</span><br><span class="line">CREATE (xiaolan:Person &#123;name: &quot;小蓝&quot;, born: 1999&#125;)</span><br><span class="line">CREATE (xiyouji:Person &#123;name: &quot;西游记&quot;, date: &quot;1999-10-25&quot;&#125;)</span><br><span class="line">CREATE (lanjingling:Person &#123;name: &quot;蓝精灵&quot;, date: &quot;1969-5-16&quot;&#125;)</span><br><span class="line">CREATE (xiaolv)-[:ACTED_IN &#123; roles: [&quot;想看&quot;]&#125;]-&gt;(xiyouji)</span><br><span class="line">CREATE (xiaohuang)-[:ACTED_IN &#123; roles: [&quot;想看&quot;]&#125;]-&gt;(lanjingling)</span><br></pre></td></tr></table></figure><h3 id="4-2-根据where-条件查找"><a href="#4-2-根据where-条件查找" class="headerlink" title="4.2 根据where 条件查找"></a>4.2 根据where 条件查找</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MATCH (xiyouji:Person) WHERE xiyouji.name&#x3D;&quot;西游记&quot; RETURN xiyouji</span><br></pre></td></tr></table></figure><p>等同于如下查询</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MATCH (xiyouji:Person &#123;name:&quot;西游记&quot;&#125;) RETURN xiyouji</span><br></pre></td></tr></table></figure><p>使用正则匹配如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MATCH (xiaolv:Person)-[r:ACTED_IN]-&gt;(xiyouji) WHERE xiaolv.name &#x3D;~ &quot;小+&quot; OR &quot;Neo&quot; IN r.roles RETURN xiaolv,r,xiyouji</span><br></pre></td></tr></table></figure><h3 id="4-3-内置函数使用"><a href="#4-3-内置函数使用" class="headerlink" title="4.3 内置函数使用"></a>4.3 内置函数使用</h3><h4 id="使用NOT-排除关系"><a href="#使用NOT-排除关系" class="headerlink" title="使用NOT 排除关系"></a>使用NOT 排除关系</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MATCH (p:Person)-[:ACTED_IN]-&gt;(m)</span><br><span class="line">WHERE NOT (p)-[:DIRECTED]-&gt;()</span><br><span class="line">RETURN p,m</span><br></pre></td></tr></table></figure><h4 id="内置函数的"><a href="#内置函数的" class="headerlink" title="内置函数的"></a>内置函数的</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MATCH (p:Person) RETURN p,p.name AS name, toUpper(p.name), coalesce(p.name, &quot;n&#x2F;a&quot;) AS nickname, &#123; name: p.name, label: head(labels(p))&#125; AS person</span><br></pre></td></tr></table></figure><h3 id="4-4-汇总信息"><a href="#4-4-汇总信息" class="headerlink" title="4.4 汇总信息"></a>4.4 汇总信息</h3><h4 id="使用count"><a href="#使用count" class="headerlink" title="使用count"></a>使用count</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MATCH (:Person)</span><br><span class="line">RETURN count(*) AS people</span><br></pre></td></tr></table></figure><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MATCH (actor:Person)-[:ACTED_IN]-&gt;(movie:Movie)&lt;-[:DIRECTED]-(director:Person) RETURN actor, director, count(*) AS collacbotration</span><br></pre></td></tr></table></figure><h3 id="4-5-排序和分页"><a href="#4-5-排序和分页" class="headerlink" title="4.5 排序和分页"></a>4.5 排序和分页</h3><h4 id="使用-limit-以及-skip-进行分页"><a href="#使用-limit-以及-skip-进行分页" class="headerlink" title="使用 limit 以及 skip 进行分页"></a>使用 limit 以及 skip 进行分页</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MATCH (a:Person)-[:ACTED_IN]-&gt;(m:Movie) RETURN a, count(*) AS appearances ORDER BY appearances DESC LIMIT 10</span><br><span class="line">MATCH (a:Person)-[:ACTED_IN]-&gt;(m:Movie) RETURN a, count(*) AS appearances ORDER BY appearances DESC SKIP 10</span><br></pre></td></tr></table></figure><h3 id="4-6-收集汇总"><a href="#4-6-收集汇总" class="headerlink" title="4.6 收集汇总"></a>4.6 收集汇总</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MATCH (m:Movie)&lt;-[:ACTED_IN]-(a:Person) RETURN m.title AS movie, collect(a.name) AS cast, count(*) AS actors</span><br></pre></td></tr></table></figure><h3 id="4-7-使用UNION链接多个内容"><a href="#4-7-使用UNION链接多个内容" class="headerlink" title="4.7 使用UNION链接多个内容"></a>4.7 使用UNION链接多个内容</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MATCH (actor:Person)-[r:ACTED_IN]-&gt;(movie:Movie)</span><br><span class="line">RETURN actor.name AS name, type(r) AS type, movie.title AS title</span><br><span class="line">UNION</span><br><span class="line">MATCH (director:Person)-[r:DIRECTED]-&gt;(movie:Movie)</span><br><span class="line">RETURN director.name AS name, type(r) AS type, movie.title AS title</span><br></pre></td></tr></table></figure><h4 id="使用WITH"><a href="#使用WITH" class="headerlink" title="使用WITH"></a>使用WITH</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MATCH (person:Person)-[:ACTED_IN]-&gt;(m:Movie) WITH person, count(*) AS appear, collect(m.title) AS movies WHERE appear&gt;1 RETURN person.name, appear, movies</span><br></pre></td></tr></table></figure><h3 id="4-8-使用约束"><a href="#4-8-使用约束" class="headerlink" title="4.8 使用约束"></a>4.8 使用约束</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE CONSTRAINT ON (movie:Movie) ASSERT movie.title IS UNIQUE</span><br><span class="line">CALL db.constraints</span><br></pre></td></tr></table></figure><h3 id="4-9-使用import-导入数据"><a href="#4-9-使用import-导入数据" class="headerlink" title="4.9 使用import 导入数据"></a>4.9 使用import 导入数据</h3><p><a href="https://neo4j.com/docs/cypher-manual/3.5/clauses/load-csv/" target="_blank" rel="noopener">https://neo4j.com/docs/cypher-manual/3.5/clauses/load-csv/</a></p><h4 id="从CSV文件导入数据"><a href="#从CSV文件导入数据" class="headerlink" title="从CSV文件导入数据"></a>从CSV文件导入数据</h4><p>要使用的CSV文件<code>LOAD CSV</code>必须具有以下特征：</p><ul><li>字符编码为UTF-8；</li><li>终端线终端取决于系统，例如，它<code>\n</code>在UNIX上还是<code>\r\n</code>在Windows上；</li><li>默认的字段终止符是<code>,</code>;</li><li>可以使用命令中<code>FIELDTERMINATOR</code>可用的选项来更改字段终止符<code>LOAD CSV</code>；</li><li>CSV文件中允许带引号的字符串，并且在读取数据时将引号删除；</li><li>字符串引号的字符为双引号<code>&quot;</code>;</li><li>if <code>dbms.import.csv.legacy_quote_escaping</code>设置为默认值<code>true</code>，<code>\</code>用作转义字符；</li><li>双引号必须在带引号的字符串中并使用转义符或第二个双引号进行转义。</li></ul><p>下面为示例：</p><p>article.cvs</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1,ABBA,1992</span><br><span class="line">2,Roxette,1986</span><br><span class="line">3,Europe,1979</span><br><span class="line">4,The Cardigans,1992</span><br><span class="line">LOAD CSV FROM &#39;file:&#x2F;&#x2F;&#x2F;article.cvs&#39; AS line</span><br><span class="line">CREATE (:Artist &#123; name: line[1], year: toInteger(line[2])&#125;)</span><br></pre></td></tr></table></figure><p>注意此处会踩坑，因为neo4j 默认配置中将import 设置到安装根目录的<code>import</code> 目录下面</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dbms.security.allow_csv_import_from_file_urls&#x3D;true</span><br><span class="line"></span><br><span class="line">dbms.directories.import&#x3D;import</span><br></pre></td></tr></table></figure><p>注意第一个配置默认为false， 设置为true将允许neo4j访问系统文件，这样做是<strong>不建议</strong>的</p><p>注意linux 系统的用户访问权限的问题</p><h4 id="使用header-导入-csv文件"><a href="#使用header-导入-csv文件" class="headerlink" title="使用header 导入 csv文件"></a>使用header 导入 csv文件</h4><p>article_with_head.csv</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Id,Name,Year</span><br><span class="line">1,ABBA,1992</span><br><span class="line">2,Roxette,1986</span><br><span class="line">3,Europe,1979</span><br><span class="line">4,The Cardigans,1992</span><br></pre></td></tr></table></figure><p>注意语法有稍微的改变</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LOAD CSV WITH HEADERS FROM &#39;file:&#x2F;&#x2F;&#x2F;article_with_head.csv&#39; AS line</span><br><span class="line">CREATE (:Artist &#123; name: line.Name, year: toInteger(line.Year)&#125;)</span><br></pre></td></tr></table></figure><h4 id="使用自定义字段定界符从CSV文件导入数据"><a href="#使用自定义字段定界符从CSV文件导入数据" class="headerlink" title="使用自定义字段定界符从CSV文件导入数据"></a>使用自定义字段定界符从CSV文件导入数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LOAD CSV FROM &#39;file:&#x2F;&#x2F;&#x2F;article_fieldterminator.csv&#39; AS line FIELDTERMINATOR &#39;;&#39;</span><br><span class="line">CREATE (:Artist &#123; name: line[1], year: toInteger(line[2])&#125;)</span><br></pre></td></tr></table></figure><h4 id="导入大量数据"><a href="#导入大量数据" class="headerlink" title="导入大量数据"></a>导入大量数据</h4><p>可以指定读取多少行之后提交，防止数据过大，减少内存开销</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USING PERIODIC COMMIT LOAD CSV FROM &#39;file:&#x2F;&#x2F;&#x2F;artists.csv&#39; AS line CREATE (:Artist &#123; name: line[1], year: toInteger(line[2])&#125;)</span><br></pre></td></tr></table></figure><h4 id="设置定期提交的速率"><a href="#设置定期提交的速率" class="headerlink" title="设置定期提交的速率"></a>设置定期提交的速率</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USING PERIODIC COMMIT 500 LOAD CSV FROM &#39;file:&#x2F;&#x2F;&#x2F;artists.csv&#39; AS line CREATE (:Artist &#123; name: line[1], year: toInteger(line[2])&#125;)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Neo4j 学习
    
    </summary>
    
    
      <category term="Neo4j" scheme="http://lazytime.site/categories/Neo4j/"/>
    
    
      <category term="Neo4j" scheme="http://lazytime.site/tags/Neo4j/"/>
    
  </entry>
  
  <entry>
    <title>ElasticSearch6.2.4 踩坑</title>
    <link href="http://lazytime.site/2020/07/26/ElasticSearch6-2-4-%E8%B8%A9%E5%9D%91/"/>
    <id>http://lazytime.site/2020/07/26/ElasticSearch6-2-4-%E8%B8%A9%E5%9D%91/</id>
    <published>2020-07-26T13:32:58.000Z</published>
    <updated>2020-07-26T13:57:29.026Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Elasticsearch-踩坑-6-2-4-版本"><a href="#Elasticsearch-踩坑-6-2-4-版本" class="headerlink" title="Elasticsearch 踩坑 - 6.2.4 版本"></a>Elasticsearch 踩坑 - 6.2.4 版本</h1><h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><h2 id="自定义评分器"><a href="#自定义评分器" class="headerlink" title="自定义评分器"></a>自定义评分器</h2><p><strong>可以根据自己的规则去调整搜索结果的评分，修改权重</strong></p><ol><li>需要根据用户标签以及网站标签，收集用户最关注的标签内容，进行标签标记</li><li>收集数据生成可视化报告</li><li>关键字查询，基于用户的网站标签内容建设</li><li>形成综合信息关联库。以核心用户标签和核心业务标签为参考，对重点资源进行归纳合并，形成重点主题资源关联关系对应表。</li><li>设计一个标签关联模块，可以由运维进行标签关联的配置,即给用户分配权重</li></ol><a id="more"></a><h2 id="智能推荐："><a href="#智能推荐：" class="headerlink" title="智能推荐："></a>智能推荐：</h2><p>搜索优化查询</p><h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><ul><li><a href="#elasticsearch-踩坑-624-版本">Elasticsearch 踩坑 - 6.2.4 版本</a></li><li>目标<ul><li><a href="#自定义评分器">自定义评分器</a></li><li><a href="#智能推荐">智能推荐：</a></li></ul></li><li><a href="#目录">目录</a></li><li>官方改变1<ul><li><a href="#restful请求需要加入header">RestFul请求需要加入Header</a></li></ul></li><li>官方改变2：<ul><li><a href="#分词器-n元语法ngram">分词器 N元语法ngram</a></li></ul></li><li>\1. 基本使用<ul><li><a href="#11-创建索引">1.1 创建索引</a></li><li><a href="#12-查看索引信息">1.2 查看索引信息:</a></li><li>1.3 创建类型<ul><li><a href="#132-指定id的方式">1.3.2 指定id的方式：</a></li><li><a href="#131-不指定id的方式">1.3.1 不指定id的方式</a></li></ul></li><li><a href="#14-创建一个文档">1.4 创建一个文档</a></li></ul></li><li>\2. 基础搜索<ul><li>2.1 使用query 进行搜索<ul><li><a href="#原始方式">原始方式</a></li><li>kibana方式<ul><li><a href="#211-如果只想查找一个字段可以使用term">2.1.1 如果只想查找一个字段，可以使用term</a></li></ul></li></ul></li><li>2.2 过滤器<ul><li><a href="#221-es6以下">2.2.1 ES6以下：</a></li><li><a href="#222-es6及以上">2.2.2 ES6及以上：</a></li></ul></li><li>2.3 应用聚集<ul><li><a href="#231-es6以下">2.3.1 ES6以下：</a></li><li><a href="#232-es6及以上">2.3.2 ES6及以上：</a></li></ul></li><li><a href="#24-通过id获取文档">2.4 通过Id获取文档</a></li></ul></li><li>\3. elasticsearch配置<ul><li><a href="#31-指定集群名称">3.1 指定集群名称：</a></li><li><a href="#32-指定详细的日志记录">3.2 指定详细的日志记录</a></li><li>3.3 调整虚拟机大小<ul><li><a href="#331-linux-使用如下命令">3.3.1 linux 使用如下命令：</a></li><li><a href="#332-使用elasticsearchyml修改启动堆内存大小">3.3.2 使用elasticsearch.yml修改启动堆内存大小</a></li><li><a href="#333-使用修改binelasticsearchinsh-修改">3.3.3 使用修改bin/elasticsearch.in.sh 修改</a></li></ul></li><li>3.4 集群中加入节点<ul><li><a href="#341-查看节点状态">3.4.1 查看节点状态</a></li></ul></li></ul></li><li>\4. 映射_mapping<ul><li>4.1 检索和自定义映射<ul><li><a href="#411-获取目前的映射">4.1.1 获取目前的映射</a></li><li><a href="#412-获取自动生成的映射">4.1.2 获取自动生成的映射</a></li><li>4.1.3 定义新的映射<ul><li><a href="#es6以下版本">es6以下版本</a></li><li><a href="#es6以上版本">es6以上版本</a></li></ul></li><li><a href="#414-改变现有字段类型的方法">4.1.4 改变现有字段类型的方法：</a></li></ul></li><li>4.2 用于定义文档字段的核心类型<ul><li><a href="#421-定义映射当中的index选项">4.2.1 定义映射当中的index选项</a></li><li><a href="#422-如何创建嵌套类型">4.2.2 如何创建嵌套类型：</a></li><li><a href="#423-定义多字段和数组类型">4.2.3 定义多字段和数组类型</a></li></ul></li><li>4.3 使用预定义字段<ul><li><a href="#431-控制如何存储和搜索文档">4.3.1 控制如何存储和搜索文档</a></li></ul></li><li>4.4 更新现有文档<ul><li><a href="#441-文档更新包含如下步骤">4.4.1 文档更新包含如下步骤：</a></li></ul></li><li>4.5 删除文档<ul><li><a href="#451-删除文档的方式">4.5.1 删除文档的方式</a></li><li><a href="#452-删除文档">4.5.2 删除文档</a></li><li><a href="#453-删除单个文档">4.5.3 删除单个文档</a></li><li><a href="#454-删除映射类型和删除查询匹配的文档">4.5.4 删除映射类型和删除查询匹配的文档</a></li><li><a href="#455-删除索引">4.5.5 删除索引</a></li><li><a href="#456-关闭和开发索引">4.5.6 关闭和开发索引</a></li></ul></li></ul></li><li>\5. 版本控制<ul><li>5.1 乐观锁<ul><li><a href="#511-内部版本控制">5.1.1 内部版本控制</a></li><li><a href="#512-外部版本控制">5.1.2 外部版本控制</a></li></ul></li><li><a href="#52-自动重试">5.2 自动重试</a></li></ul></li><li>\6. 搜索与高级搜索分析<ul><li><a href="#61-搜索请求的基本模块">6.1 搜索请求的基本模块</a></li><li>6.2 基于url的搜索请求<ul><li><a href="#621-基于from-和szize的参数来实现结果分页">6.2.1 基于from 和szize的参数来实现结果分页</a></li><li><a href="#622-改变结果的顺序">6.2.2 改变结果的顺序</a></li><li><a href="#623-搜索结果当中限制_source-字段">6.2.3 搜索结果当中限制_source 字段</a></li><li><a href="#624-匹配查询">6.2.4 匹配查询</a></li></ul></li><li>6.3 基于请求主体的搜索请求<ul><li><a href="#631-使用from-和-size参数结果分页">6.3.1 使用from 和 size，参数结果分页</a></li><li>6.3.2 过滤返回_source 内容<ul><li><a href="#在source字段当中返回通配符">在source字段当中返回通配符</a></li><li><a href="#通过include以及exclude-过滤返回_source的内容">通过include以及exclude 过滤返回_source的内容</a></li></ul></li><li><a href="#633-基于结果的排序">6.3.3 基于结果的排序</a></li></ul></li><li>6.4 实践中的基础模块<ul><li><a href="#641-理解回复的内容">6.4.1 理解回复的内容</a></li></ul></li><li>6.5 查询和过滤器DSL （重点）<ul><li>6.5.1 match 查询和term过滤器<ul><li><a href="#过滤器和查询器有什么不同">过滤器和查询器有什么不同：</a></li><li><a href="#es6以下-以及旧版本使用的方式">es6以下 以及旧版本使用的方式</a></li><li><a href="#font-colorred这里需要注意下面使用的是es6以及以上版本font">这里需要注意下面使用的是es6以及以上版本</a></li></ul></li></ul></li><li>6.6 常用的基础查询和过滤器<ul><li><a href="#661-match_all-的使用场景">6.6.1 match_all 的使用场景</a></li><li>6.6.2 query_string 查询<ul><li><a href="#使用query_string-进行复杂的查询">使用query_string 进行复杂的查询</a></li></ul></li><li>6.6.3 term 查询和 term过滤器<ul><li><a href="#使用term-过滤器的得分和term查询器的得分对比">使用term 过滤器的得分，和term查询器的得分对比</a></li></ul></li><li><a href="#664-terms-查询">6.6.4 terms 查询</a></li><li>6.5.5 match查询和 term过滤器<ul><li><a href="#布尔查询行为">布尔查询行为</a></li><li>词组（phrase ）查询的方式<ul><li><a href="#es5版本以及以下的语法">es5版本以及以下的语法：</a></li><li><a href="#es6以及以上要使用以下语法">es6以及以上要使用以下语法</a></li></ul></li></ul></li><li>6.5.6 phrase_prefix 查询<ul><li><a href="#es5x-版本以及以下的语法">es5.x 版本以及以下的语法：</a></li><li><a href="#es6x-需要改成如下写法">es6.x 需要改成如下写法</a></li><li><a href="#使用multi_match-匹配多个字段">使用multi_match 匹配多个字段</a></li></ul></li></ul></li><li>6.7 组合查询和复合查询<ul><li><a href="#671-bool查询">6.7.1 bool查询</a></li><li><a href="#672-bool-的过滤器">6.7.2 bool 的过滤器</a></li></ul></li><li>6.8 超越match 和 过滤器的查询<ul><li>6.8.1 range 查询和过滤器<ul><li><a href="#模拟数据">模拟数据</a></li><li><a href="#现在需要查找出-11-年到-16年的数据">现在需要查找出 11 年到 16年的数据</a></li></ul></li><li>6.8.2 prefix 查询和过滤器<ul><li><a href="#在过滤器当中使用">在过滤器当中使用</a></li></ul></li><li><a href="#683-wildcard-查询">6.8.3 wildcard 查询</a></li></ul></li><li>6.9 使用过滤器查询字段的存在性<ul><li><a href="#691-exists-过滤器">6.9.1 exists 过滤器</a></li><li>6.9.2 missing 过滤器（6.x以上版本已经删除）<ul><li><a href="#作为测试先插入一条增加一个字段的数据">作为测试,先插入一条增加一个字段的数据</a></li><li><a href="#接下来查找字段里没有的值这样写是错误的没有正确写法6x">接下来，查找字段里没有的值,这样写是错误的，没有正确写法（6.x）</a></li></ul></li><li>6.9.3 将任何查询转为过滤器<ul><li><a href="#缓存过滤器">缓存过滤器</a></li></ul></li><li><a href="#694-为任务选择最好的查询">6.9.4 为任务选择最好的查询</a></li></ul></li></ul></li><li>\7. 分析数据<ul><li>7.1 什么是分析数据<ul><li><a href="#711-字符过滤">7.1.1 字符过滤</a></li><li><a href="#712-切分为分词">7.1.2 切分为分词</a></li><li><a href="#713-分词过滤器">7.1.3 分词过滤器</a></li><li><a href="#714-分词索引">7.1.4 分词索引</a></li></ul></li><li>7.2 为文档使用分析器<ul><li>7.2.1 创建索引的过程中，添加定制分析器<ul><li><a href="#旧版本的使用方式">旧版本的使用方式</a></li><li><a href="#网上的案例">网上的案例：</a></li><li><a href="#将书上的案例改为6x支持的形式格式如下">将书上的案例改为6.x支持的形式，格式如下:</a></li></ul></li><li><a href="#722-使用elasticsearchyml-的配置文件进行配置">7.2.2 使用elasticsearch.yml 的配置文件进行配置</a></li><li>7.2.3 在映射中指定某个字段的分析器<ul><li><a href="#书本的方式已经不适用于6x版本了根据官方文档的内容要进行如下定义">书本的方式已经不适用于6.x版本了，根据官方文档的内容要进行如下定义</a></li></ul></li></ul></li><li>7.3 使用API来分析文本<ul><li><a href="#731-使用_analyzer-内置api来进行分析分析器解析步骤">7.3.1 使用_analyzer 内置API来进行分析分析器解析步骤</a></li><li><a href="#732-分析中指定自定义分析器">7.3.2 分析中指定自定义分析器</a></li><li>7.3.3 使用组合即时创建分析器<ul><li><a href="#使用curl方式">使用curl方式</a></li><li><a href="#使用kibana方式">使用kibana方式</a></li></ul></li><li><a href="#734-使用基于某个字段的映射分析">7.3.4 使用基于某个字段的映射分析</a></li><li><a href="#735-使用词条向量api来学习索引词条">7.3.5 使用词条向量API来学习索引词条</a></li></ul></li><li>7.4 分析器/分词器和分词过滤器<ul><li><a href="#740-分析器的概览">7.4.0 分析器的概览</a></li><li>7.4.1 内置分析器<ul><li><a href="#标准分析器">标准分析器</a></li><li><a href="#简单分析器"><strong>简单分析器</strong></a></li><li><a href="#空白分析器"><strong>空白分析器</strong></a></li><li><a href="#停止分析器"><strong>停止分析器</strong></a></li><li><a href="#关键字分析器"><strong>关键字分析器</strong></a></li><li><a href="#模式分析器"><strong>模式分析器</strong></a></li><li><a href="#语言分析器"><strong>语言分析器</strong></a></li><li><a href="#指纹分析器"><strong>指纹分析器</strong></a></li><li><a href="#雪球分析器">雪球分析器</a></li></ul></li><li>7.4.2 分词器<ul><li><a href="#标准分词器"><strong>标准分词器</strong></a></li><li><a href="#字母分词器"><strong>字母分词器</strong></a></li><li><a href="#小写分词器"><strong>小写分词器</strong></a></li><li><a href="#空格分词器"><strong>空格分词器</strong></a></li><li><a href="#uax-url电子邮件令牌生成器">UAX URL电子邮件令牌生成器</a></li><li><a href="#经典分词器">经典分词器</a></li><li><a href="#泰语分词器">泰语分词器</a></li></ul></li><li>7.4.3 分词过滤器<ul><li><a href="#标准分词过滤器">标准分词过滤器</a></li><li><a href="#ascii-folding-token-filterascii折叠过滤器">ASCII Folding Token Filter（ASCII折叠过滤器）</a></li><li><a href="#flatten-graph-token-filter图形分词过滤器">Flatten Graph Token Filter（图形分词过滤器）</a></li><li><a href="#length-token-filter长度分词过滤器">Length Token Filter（长度分词过滤器）</a></li><li><a href="#lowercase-token-filter小写分词过滤器">Lowercase token filter（小写分词过滤器）</a></li><li><a href="#uppercase-token-filter大写分词过滤器">Uppercase Token Filter（大写分词过滤器）</a></li><li><a href="#ngram-token-filtern元语法过滤器">NGram Token Filter（N元语法过滤器）</a></li><li><a href="#edge-ngram-token-filter侧边n元语法过滤器">Edge NGram Token Filter（侧边N元语法过滤器）</a></li></ul></li><li>7.4.4 N元语法的使用场景以及使用案例<ul><li><a href="#使用案例">使用案例:</a></li><li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.4/analysis-shingle-tokenfilter.html" target="_blank" rel="noopener">Shingle Token Filter</a>（滑动窗口分词过滤器）</li></ul></li></ul></li><li>7.5 提取词干<ul><li>7.5.1 算分提取词干<ul><li><a href="#选取kstem-作为案例测试">选取kstem 作为案例测试</a></li></ul></li><li><a href="#752-使用字典提取词干">7.5.2 使用字典提取词干</a></li></ul></li></ul></li><li>\8. 使用相关性进行搜索<ul><li>8.1 es 的打分机制<ul><li><a href="#811-文档是如何运作的">8.1.1 文档是如何运作的：</a></li><li><a href="#812-词频">8.1.2 词频</a></li><li><a href="#813-逆文档词频">8.1.3 逆文档词频</a></li><li><a href="#814-lucene-评分公式">8.1.4 Lucene 评分公式</a></li></ul></li><li>8.2 其他打分方式<ul><li><a href="#如何指定索引的打分方式">如何指定索引的打分方式？</a></li></ul></li><li><a href="#83-索引期间boosting">8.3 索引期间Boosting</a></li><li>8.4 查询期间的Boosting<ul><li><a href="#841-跨越多个字段的查询">8.4.1 跨越多个字段的查询</a></li><li><a href="#842-使用multi_match-查询指定整个boost">8.4.2 使用multi_match 查询，指定整个Boost</a></li><li><a href="#843-使用特殊符号对于name-进行boost">8.4.3 使用特殊符号^对于name 进行boost</a></li><li><a href="#844-query_string-中对于针对单个的词条进行boost">8.4.4 query_string 中对于针对单个的词条进行boost</a></li></ul></li><li>8.5 使用”解释(explain)”来理解文档评分<ul><li><a href="#851-解释一篇文档不匹配的原因">8.5.1 解释一篇文档不匹配的原因</a></li></ul></li><li>8.6 使用查询再打分来减小评分操作影响<ul><li><a href="#861-官方文档介绍-62版本">8.6.1 官方文档介绍 6.2版本</a></li><li><a href="#862-使用rescore-特性对于匹配文档子集再评分">8.6.2 使用rescore 特性，对于匹配文档子集再评分</a></li></ul></li><li>8.7 function_score 来定制得分<ul><li><a href="#871-function_score-的基本结构">8.7.1 function_score 的基本结构</a></li><li>8.7.2 weight 函数<ul><li><a href="#可以指定多个weight函数">可以指定多个weight函数</a></li></ul></li><li><a href="#873-合并得分">8.7.3 合并得分</a></li><li><a href="#874-field_value_factor-函数">8.7.4 field_value_factor 函数</a></li><li><a href="#875-在function_score-查询中使用field_value_factor">8.7.5 在function_score 查询中使用field_value_factor</a></li></ul></li><li>8.8 painless脚本(5.0后go语言脚本支持已删除)<ul><li><a href="#875-random_score-函数">8.7.5 random_score 函数</a></li><li>8.7.6 衰减函数<ul><li><a href="#官方文档">官方文档</a></li><li><a href="#配置选项">配置选项</a></li></ul></li></ul></li><li><a href="#89-使用脚本排序">8.9 使用脚本排序</a></li></ul></li><li>\9. Elasticsearch REST API 的学习使用<ul><li><a href="#90-api官网">9.0 API官网</a></li><li>9.1 REST 低级 Api<ul><li><a href="#911-起步">9.1.1 起步</a></li><li><a href="#912-初始化">9.1.2 初始化</a></li><li><a href="#913-执行请求">9.1.3 执行请求</a></li><li><a href="#914-接受响应体的处理">9.1.4 接受响应体的处理</a></li></ul></li><li>9.2 REST 高级 API<ul><li><a href="#921-机器翻译介绍">9.2.1 机器翻译介绍</a></li><li><a href="#922-兼容性">9.2.2 </a><a href="https://github.com/elastic/elasticsearch/edit/6.2/docs/java-rest/high-level/getting-started.asciidoc" target="_blank" rel="noopener">兼容性</a></li><li><a href="#923-起步">9.2.3 起步</a></li><li><a href="#924-创建一个rest-连接">9.2.4 创建一个rest 连接</a></li><li>9.2.5 【6.2.4】版本 支持的相关API （重点）<ul><li><a href="#创建索引">创建索引</a></li><li><a href="#删除索引">删除索引</a></li><li><a href="#开放索引">开放索引</a></li><li><a href="#关闭索引">关闭索引</a></li></ul></li><li>9.2.6 索引本身的API<ul><li><a href="#直接根据索引创建一个文档需要如下参数">直接根据索引创建一个文档需要如下参数</a></li><li><a href="#提供文档来源的多种方式">提供文档来源的多种方式</a></li><li><a href="#可选参数">可选参数</a></li><li><a href="#获取响应内容">获取响应内容</a></li><li><a href="#根据上述内容整合">根据上述内容整合</a></li></ul></li></ul></li></ul></li><li>\10. Elasticsearch JAVA API 的学习使用<ul><li>10.1 起步：<ul><li><a href="#1011-maven-依赖">10.1.1 Maven 依赖</a></li></ul></li></ul></li><li>\11. Es painless 脚本插件使用（Elasticsearch script plugin）<ul><li>11.1 前置条件：windows安装gradle<ul><li><a href="#1111-官方下载地址">11.1.1 官方下载地址</a></li><li><a href="#1112-将gradle放入合适位置将gradle加入path环境变量">11.1.2 将gradle放入合适位置，将gradle加入path环境变量</a></li><li><a href="#1113-配置阿里云的镜像">11.1.3 配置阿里云的镜像</a></li></ul></li></ul></li><li>N kibana 学习es的所有内容<ul><li><a href="#20191014">2019.10.14</a></li><li><a href="#20191015">2019.10.15</a></li></ul></li></ul><h1 id="官方改变1"><a href="#官方改变1" class="headerlink" title="官方改变1"></a>官方改变1</h1><h2 id="RestFul请求需要加入Header"><a href="#RestFul请求需要加入Header" class="headerlink" title="RestFul请求需要加入Header"></a>RestFul请求需要加入Header</h2><blockquote><p>-H “Content-Type: application/json”</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H &quot;Content-Type: application&#x2F;json&quot; -XPUT &#39;localhost:9200&#x2F;get-together&#x2F;group&#x2F;1?pretty&#39; -d &#39;&#123;&quot;name&quot;:&quot;elastice denver&quot;,&quot;organizer&quot;:&quot;Lee&quot;&#125;&#39;</span><br></pre></td></tr></table></figure><h1 id="官方改变2："><a href="#官方改变2：" class="headerlink" title="官方改变2："></a>官方改变2：</h1><h2 id="分词器-N元语法ngram"><a href="#分词器-N元语法ngram" class="headerlink" title="分词器 N元语法ngram"></a>分词器 N元语法ngram</h2><p>分词器 N元语法ngram 由于在实际使用发生过巨大差异事故，在6.2.4 提示是被弃用的，但是后面社区提议在实际需求中使用发现没有效果，与开发交流过后，官方在7.0之后将弃用删除，继续使用ngram</p><blockquote><p>所以在这个6.2.4 版本中使用ngram 分词器 的参数 min_gram 和 max_gram 无法作用于N元语法</p></blockquote><h1 id="1-基本使用"><a href="#1-基本使用" class="headerlink" title="1. 基本使用"></a>1. 基本使用</h1><h2 id="1-1-创建索引"><a href="#1-1-创建索引" class="headerlink" title="1.1 创建索引"></a>1.1 创建索引</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;lib&#x2F;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  &quot;settings&quot;:&#123;</span><br><span class="line"></span><br><span class="line">      &quot;index&quot;:&#123;</span><br><span class="line"></span><br><span class="line">        &quot;number_of_shards&quot;: 5,</span><br><span class="line"></span><br><span class="line">        &quot;number_of_replicas&quot;: 1</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-2-查看索引信息"><a href="#1-2-查看索引信息" class="headerlink" title="1.2 查看索引信息:"></a>1.2 查看索引信息:</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;_settings</span><br><span class="line">curl -XGET &#39;192.168.92.180:9200&#x2F;lib&#x2F;_settings?pretty&#39;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;lib&quot; : &#123;</span><br><span class="line">    &quot;settings&quot; : &#123;</span><br><span class="line">      &quot;index&quot; : &#123;</span><br><span class="line">        &quot;creation_date&quot; : &quot;1570895449310&quot;,</span><br><span class="line">        &quot;number_of_shards&quot; : &quot;5&quot;,</span><br><span class="line">        &quot;number_of_replicas&quot; : &quot;1&quot;,</span><br><span class="line">        &quot;uuid&quot; : &quot;KF8Kfs3SSBKPhZX4pX5iVw&quot;,</span><br><span class="line">        &quot;version&quot; : &#123;</span><br><span class="line">          &quot;created&quot; : &quot;6020499&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;provided_name&quot; : &quot;lib&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">GET _all&#x2F;_settings</span><br><span class="line">curl -XGET &#39;192.168.92.180:9200&#x2F;_all&#x2F;_settings?pretty&#39;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;new-index&quot; : &#123;</span><br><span class="line">    &quot;settings&quot; : &#123;</span><br><span class="line">      &quot;index&quot; : &#123;</span><br><span class="line">        &quot;creation_date&quot; : &quot;1570877785070&quot;,</span><br><span class="line">        &quot;number_of_shards&quot; : &quot;5&quot;,</span><br><span class="line">        &quot;number_of_replicas&quot; : &quot;1&quot;,</span><br><span class="line">        &quot;uuid&quot; : &quot;0HE2lh_gS96UPRCIWMqaZA&quot;,</span><br><span class="line">        &quot;version&quot; : &#123;</span><br><span class="line">          &quot;created&quot; : &quot;6020499&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;provided_name&quot; : &quot;new-index&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;get-together&quot; : &#123;</span><br><span class="line">    &quot;settings&quot; : &#123;</span><br><span class="line">      &quot;index&quot; : &#123;</span><br><span class="line">        &quot;creation_date&quot; : &quot;1570878100116&quot;,</span><br><span class="line">        &quot;number_of_shards&quot; : &quot;5&quot;,</span><br><span class="line">        &quot;number_of_replicas&quot; : &quot;1&quot;,</span><br><span class="line">        &quot;uuid&quot; : &quot;t1a2Kwx-QvCjF-pSuTGntQ&quot;,</span><br><span class="line">        &quot;version&quot; : &#123;</span><br><span class="line">          &quot;created&quot; : &quot;6020499&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;provided_name&quot; : &quot;get-together&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;lib&quot; : &#123;</span><br><span class="line">    &quot;settings&quot; : &#123;</span><br><span class="line">      &quot;index&quot; : &#123;</span><br><span class="line">        &quot;creation_date&quot; : &quot;1570895449310&quot;,</span><br><span class="line">        &quot;number_of_shards&quot; : &quot;5&quot;,</span><br><span class="line">        &quot;number_of_replicas&quot; : &quot;1&quot;,</span><br><span class="line">        &quot;uuid&quot; : &quot;KF8Kfs3SSBKPhZX4pX5iVw&quot;,</span><br><span class="line">        &quot;version&quot; : &#123;</span><br><span class="line">          &quot;created&quot; : &quot;6020499&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;provided_name&quot; : &quot;lib&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-3-创建类型"><a href="#1-3-创建类型" class="headerlink" title="1.3 创建类型"></a>1.3 创建类型</h2><h3 id="1-3-2-指定id的方式："><a href="#1-3-2-指定id的方式：" class="headerlink" title="1.3.2 指定id的方式："></a>1.3.2 指定id的方式：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;lib&#x2F;user&#x2F;2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;first_name&quot;: &quot;book&quot;,</span><br><span class="line">  &quot;last_name&quot;: &quot;lin lin&quot;,</span><br><span class="line">  &quot;age&quot;: 20,</span><br><span class="line">  &quot;birthday&quot;: &quot;2019-4-28&quot;,</span><br><span class="line">  &quot;interesting&quot;: [</span><br><span class="line">    &quot;football&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-3-1-不指定id的方式"><a href="#1-3-1-不指定id的方式" class="headerlink" title="1.3.1 不指定id的方式"></a>1.3.1 不指定id的方式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;lib&#x2F;user&#x2F;</span><br><span class="line">&#123;</span><br><span class="line">    &quot;first_name&quot;: &quot;book&quot;,</span><br><span class="line">  &quot;last_name&quot;: &quot;lin lin&quot;,</span><br><span class="line">  &quot;age&quot;: 20,</span><br><span class="line">  &quot;birthday&quot;: &quot;20191122&quot;,</span><br><span class="line">  &quot;interesting&quot;: [ &quot;football&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST &#x2F;lib&#x2F;user&#x2F;</span><br><span class="line">&#123;</span><br><span class="line">    &quot;first_name&quot; :  &quot;Douglas&quot;,</span><br><span class="line">    &quot;last_name&quot; :   &quot;Fir&quot;,</span><br><span class="line">    &quot;age&quot; :         23,</span><br><span class="line">    &quot;about&quot;:        &quot;I like to build cabinets&quot;,</span><br><span class="line">    &quot;interests&quot;:  [ &quot;forestry&quot; ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-4-创建一个文档"><a href="#1-4-创建一个文档" class="headerlink" title="1.4 创建一个文档"></a>1.4 创建一个文档</h2><p>当使用curl 的时候， 他看上去是这样的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl -H &quot;Content-Type: application&#x2F;json&quot; -XPUT &#39;192.168.92.180:9200&#x2F;lib&#x2F;user&#x2F;1&#39; -d \</span><br><span class="line">&gt; &#39;&#123;</span><br><span class="line">&gt; &quot;first_name&quot;:&quot;Jane&quot;,</span><br><span class="line">&gt; &quot;last_name&quot;:&quot;Smith&quot;,</span><br><span class="line">&gt; &quot;age&quot;:32,</span><br><span class="line">&gt; &quot;about&quot;:&quot;I like to collect rock albums&quot;,</span><br><span class="line">&gt; &quot;interests&quot;: [&quot;music&quot;]</span><br><span class="line">&gt; &#125;&#39;</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;_index&quot;: &quot;lib&quot;,</span><br><span class="line">&quot;_type&quot;: &quot;user&quot;,</span><br><span class="line">&quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">&quot;_version&quot;: 1,</span><br><span class="line">&quot;result&quot;: &quot;created&quot;,</span><br><span class="line">&quot;_shards&quot;: &#123;</span><br><span class="line">&quot;total&quot;: 2,</span><br><span class="line">&quot;successful&quot;: 1,</span><br><span class="line">&quot;failed&quot;: 0</span><br><span class="line">&#125;,</span><br><span class="line">&quot;_seq_no&quot;: 0,</span><br><span class="line">&quot;_primary_term&quot;: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="2-基础搜索"><a href="#2-基础搜索" class="headerlink" title="2. 基础搜索"></a>2. 基础搜索</h1><h2 id="2-1-使用query-进行搜索"><a href="#2-1-使用query-进行搜索" class="headerlink" title="2.1 使用query 进行搜索"></a>2.1 使用query 进行搜索</h2><h3 id="原始方式"><a href="#原始方式" class="headerlink" title="原始方式"></a>原始方式</h3><p>curl -H “Content-Type: application/json”</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">curl -H &quot;Content-Type: application&#x2F;json&quot; -XGET &#39;119.23.219.183:9200&#x2F;lib&#x2F;user&#x2F;_search?pretty&#39; -d &#39;&#123;&quot;query&quot;:&#123;“defualt”: &quot;field_name&quot;, &quot;query_string&quot;: &#123;&quot;query&quot;: &quot;jone&quot;&#125;&#125;&#125;&#39;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;took&quot; : 11,</span><br><span class="line">  &quot;timed_out&quot; : false,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 5,</span><br><span class="line">    &quot;successful&quot; : 5,</span><br><span class="line">    &quot;skipped&quot; : 0,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 1,</span><br><span class="line">    &quot;max_score&quot; : 0.2876821,</span><br><span class="line">    &quot;hits&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;lib&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;user&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot; : 0.2876821,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;first_name&quot; : &quot;Jone&quot;,</span><br><span class="line">          &quot;last_name&quot; : &quot;pig&quot;,</span><br><span class="line">          &quot;age&quot; : 11,</span><br><span class="line">          &quot;birthday&quot; : &quot;2019-11-18&quot;,</span><br><span class="line">          &quot;interesting&quot; : [</span><br><span class="line">            &quot;basketball&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="kibana方式"><a href="#kibana方式" class="headerlink" title="kibana方式"></a>kibana方式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search?pretty </span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;query_string&quot;: &#123;</span><br><span class="line">      “defualt”: &quot;field_name&quot;</span><br><span class="line">      &quot;query&quot;: &quot;jone&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-1-1-如果只想查找一个字段，可以使用term"><a href="#2-1-1-如果只想查找一个字段，可以使用term" class="headerlink" title="2.1.1 如果只想查找一个字段，可以使用term"></a>2.1.1 如果只想查找一个字段，可以使用term</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search?pretty </span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;first_name&quot;: &quot;jone&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-2-过滤器"><a href="#2-2-过滤器" class="headerlink" title="2.2 过滤器"></a>2.2 过滤器</h2><h3 id="2-2-1-ES6以下："><a href="#2-2-1-ES6以下：" class="headerlink" title="2.2.1 ES6以下："></a>2.2.1 ES6以下：</h3><p>旧版本使用如下方式 <strong>es6版本以下</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;filtered&quot;:&#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;term&quot;:&#123;</span><br><span class="line">          &quot;first_name&quot;: &quot;jone&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-2-ES6及以上："><a href="#2-2-2-ES6及以上：" class="headerlink" title="2.2.2 ES6及以上："></a>2.2.2 ES6及以上：</h3><p>新版本的过滤器要使用如下方式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;term&quot;: &#123;</span><br><span class="line">          &quot;first_name&quot;: &quot;jone&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-3-应用聚集"><a href="#2-3-应用聚集" class="headerlink" title="2.3 应用聚集"></a>2.3 应用聚集</h2><h3 id="2-3-1-ES6以下："><a href="#2-3-1-ES6以下：" class="headerlink" title="2.3.1 ES6以下："></a>2.3.1 ES6以下：</h3><p>旧版本使用如下方式 <strong>es6版本以下</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">&quot;aggregations&quot;:&#123;</span><br><span class="line">&quot;organizers&quot;:&#123;</span><br><span class="line">&quot;terms&quot;: &#123; &quot;field&quot; : &quot;organizer&quot; &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-2-ES6及以上："><a href="#2-3-2-ES6及以上：" class="headerlink" title="2.3.2 ES6及以上："></a>2.3.2 ES6及以上：</h3><p>需求是根据年龄进行划分聚合</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0, </span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    </span><br><span class="line">    &quot;organizers&quot;:&#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;,</span><br><span class="line">        &quot;size&quot;: 10</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>（1）size</strong>：查询条数，这里设置为0，因为不关心搜索到的结果，只关心聚合结果，提供效率；</p><p><strong>（2）aggs</strong>：声明这是一个聚合查询，是aggregations的缩写；</p><p>结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;took&quot;: 47,</span><br><span class="line">  &quot;timed_out&quot;: false,</span><br><span class="line">  &quot;_shards&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 5,</span><br><span class="line">    &quot;successful&quot;: 5,</span><br><span class="line">    &quot;skipped&quot;: 0,</span><br><span class="line">    &quot;failed&quot;: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 3,</span><br><span class="line">    &quot;max_score&quot;: 0,</span><br><span class="line">    &quot;hits&quot;: []</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggregations&quot;: &#123;</span><br><span class="line">    &quot;organizers&quot;: &#123;</span><br><span class="line">      &quot;doc_count_error_upper_bound&quot;: 0,</span><br><span class="line">      &quot;sum_other_doc_count&quot;: 0,</span><br><span class="line">      &quot;buckets&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;key&quot;: 11,</span><br><span class="line">          &quot;doc_count&quot;: 1</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;key&quot;: 20,</span><br><span class="line">          &quot;doc_count&quot;: 1</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;key&quot;: 23,</span><br><span class="line">          &quot;doc_count&quot;: 1</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-4-通过Id获取文档"><a href="#2-4-通过Id获取文档" class="headerlink" title="2.4 通过Id获取文档"></a>2.4 通过Id获取文档</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;1</span><br></pre></td></tr></table></figure><h1 id="3-elasticsearch配置"><a href="#3-elasticsearch配置" class="headerlink" title="3. elasticsearch配置"></a>3. elasticsearch配置</h1><h2 id="3-1-指定集群名称："><a href="#3-1-指定集群名称：" class="headerlink" title="3.1 指定集群名称："></a>3.1 指定集群名称：</h2><p>在<strong>elasticsearch.yml</strong> 文件当中指定</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cluster.name: xxxx</span><br></pre></td></tr></table></figure><h2 id="3-2-指定详细的日志记录"><a href="#3-2-指定详细的日志记录" class="headerlink" title="3.2 指定详细的日志记录"></a>3.2 指定详细的日志记录</h2><ol><li><p>主要日志</p><p>基础的日志</p></li><li><p>慢搜索日志</p><p>多于半秒的查询都会被记录（默认）</p></li><li><p>慢索引日志</p><p>多于半秒的查询都会被记录（默认）</p></li></ol><p>在<strong>elasticsearch.yml</strong> 文件当中指定,查看所有的日志</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rootLogger: TRACE, console, file</span><br></pre></td></tr></table></figure><h2 id="3-3-调整虚拟机大小"><a href="#3-3-调整虚拟机大小" class="headerlink" title="3.3 调整虚拟机大小"></a>3.3 调整虚拟机大小</h2><h3 id="3-3-1-linux-使用如下命令："><a href="#3-3-1-linux-使用如下命令：" class="headerlink" title="3.3.1 linux 使用如下命令："></a>3.3.1 linux 使用如下命令：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export ES_HEAP_SIZE&#x3D;500m bin&#x2F;elasticsearch</span><br></pre></td></tr></table></figure><h3 id="3-3-2-使用elasticsearch-yml修改启动堆内存大小"><a href="#3-3-2-使用elasticsearch-yml修改启动堆内存大小" class="headerlink" title="3.3.2 使用elasticsearch.yml修改启动堆内存大小"></a>3.3.2 使用elasticsearch.yml修改启动堆内存大小</h3><h3 id="3-3-3-使用修改bin-elasticsearch-in-sh-修改"><a href="#3-3-3-使用修改bin-elasticsearch-in-sh-修改" class="headerlink" title="3.3.3 使用修改bin/elasticsearch.in.sh 修改"></a>3.3.3 使用修改bin/elasticsearch.in.sh 修改</h3><p>#!/bin/sh 后面加入ES_HEAP_SIZE=500m</p><h2 id="3-4-集群中加入节点"><a href="#3-4-集群中加入节点" class="headerlink" title="3.4 集群中加入节点"></a>3.4 集群中加入节点</h2><h3 id="3-4-1-查看节点状态"><a href="#3-4-1-查看节点状态" class="headerlink" title="3.4.1 查看节点状态"></a>3.4.1 查看节点状态</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cat&#x2F;shards?v</span><br></pre></td></tr></table></figure><h1 id="4-映射-mapping"><a href="#4-映射-mapping" class="headerlink" title="4. 映射_mapping"></a>4. 映射_mapping</h1><p>使用映射来定义文档：</p><p>注意同一个索引存在多个类型，所有映射也可以多个类型</p><p>但是多个类型可能存在文档里面相同名称的字段</p><h2 id="4-1-检索和自定义映射"><a href="#4-1-检索和自定义映射" class="headerlink" title="4.1 检索和自定义映射"></a>4.1 检索和自定义映射</h2><h3 id="4-1-1-获取目前的映射"><a href="#4-1-1-获取目前的映射" class="headerlink" title="4.1.1 获取目前的映射"></a>4.1.1 获取目前的映射</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_mapping?pretty</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;lib&quot;: &#123;</span><br><span class="line">    &quot;mappings&quot;: &#123;</span><br><span class="line">      &quot;user&quot;: &#123;</span><br><span class="line">        &quot;properties&quot;: &#123;</span><br><span class="line">          &quot;about&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">            &quot;fields&quot;: &#123;</span><br><span class="line">              &quot;keyword&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">                &quot;ignore_above&quot;: 256</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;age&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;long&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;birthday&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;date&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;first_name&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">            &quot;fields&quot;: &#123;</span><br><span class="line">              &quot;keyword&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">                &quot;ignore_above&quot;: 256</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;interesting&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">            &quot;fields&quot;: &#123;</span><br><span class="line">              &quot;keyword&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">                &quot;ignore_above&quot;: 256</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;interests&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">            &quot;fields&quot;: &#123;</span><br><span class="line">              &quot;keyword&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">                &quot;ignore_above&quot;: 256</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;last_name&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">            &quot;fields&quot;: &#123;</span><br><span class="line">              &quot;keyword&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">                &quot;ignore_above&quot;: 256</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-1-2-获取自动生成的映射"><a href="#4-1-2-获取自动生成的映射" class="headerlink" title="4.1.2 获取自动生成的映射"></a>4.1.2 获取自动生成的映射</h3><p>使用下面的实例：</p><p>第一步：创建一个新索引</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;get-together&#x2F;new-event&#x2F;1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;:&quot;late night with elastic&quot;,</span><br><span class="line">  &quot;date&quot;:&quot;2013-10-25T19:00&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第二步： 获取当前映射</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;get-together&#x2F;_mapping&#x2F;new-event?pretty</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;get-together&quot;: &#123;</span><br><span class="line">    &quot;mappings&quot;: &#123;</span><br><span class="line">      &quot;new-event&quot;: &#123;</span><br><span class="line">        &quot;properties&quot;: &#123;</span><br><span class="line">          &quot;date&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;date&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;name&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">            &quot;fields&quot;: &#123;</span><br><span class="line">              &quot;keyword&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;keyword&quot;,</span><br><span class="line">                &quot;ignore_above&quot;: 256</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-1-3-定义新的映射"><a href="#4-1-3-定义新的映射" class="headerlink" title="4.1.3 定义新的映射"></a>4.1.3 定义新的映射</h3><h4 id="es6以下版本"><a href="#es6以下版本" class="headerlink" title="es6以下版本"></a>es6以下版本</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;get-together&#x2F;_mapping&#x2F;new-event</span><br><span class="line">&#123;</span><br><span class="line">  &quot;new-event&quot;:&#123;</span><br><span class="line">    &quot;properties&quot;:&#123;</span><br><span class="line">      &quot;host&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;string&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="es6以上版本"><a href="#es6以上版本" class="headerlink" title="es6以上版本"></a>es6以上版本</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;get-together&#x2F;_mapping&#x2F;new-event</span><br><span class="line">&#123;</span><br><span class="line">  &quot;properties&quot;: &#123;</span><br><span class="line">    &quot;host&quot;:&#123;</span><br><span class="line">      &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时获取映射会发现新增了一个映射内容</p><h3 id="4-1-4-改变现有字段类型的方法："><a href="#4-1-4-改变现有字段类型的方法：" class="headerlink" title="4.1.4 改变现有字段类型的方法："></a>4.1.4 改变现有字段类型的方法：</h3><ol><li>删除 new-evenets 类型的所有数据</li><li>设置新的映射类型以及字段类型</li><li>再次索引所有数据</li></ol><h2 id="4-2-用于定义文档字段的核心类型"><a href="#4-2-用于定义文档字段的核心类型" class="headerlink" title="4.2 用于定义文档字段的核心类型"></a>4.2 用于定义文档字段的核心类型</h2><h3 id="4-2-1-定义映射当中的index选项"><a href="#4-2-1-定义映射当中的index选项" class="headerlink" title="4.2.1 定义映射当中的index选项"></a>4.2.1 定义映射当中的index选项</h3><ol><li>anaLyzed(默认) 将大写转为小写，字符串分解为单词</li><li>not_analyzed 分析过程略过，变成单独的词条索引</li><li>no 索引略过，没有词条产生<ol><li>节省存储空间，无须在该字段搜索的时候使用</li></ol></li></ol><h3 id="4-2-2-如何创建嵌套类型："><a href="#4-2-2-如何创建嵌套类型：" class="headerlink" title="4.2.2 如何创建嵌套类型："></a>4.2.2 如何创建嵌套类型：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;get-together&#x2F;_mapping&#x2F;new-event</span><br><span class="line">&#123;</span><br><span class="line">  &quot;properties&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &#123;</span><br><span class="line">      &quot;type&quot;: &quot;text&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;user&quot;:&#123;</span><br><span class="line">      &quot;type&quot;: &quot;nested&quot;,</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;myname&quot;:&#123;</span><br><span class="line">          &quot;type&quot;:&quot;text&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-3-定义多字段和数组类型"><a href="#4-2-3-定义多字段和数组类型" class="headerlink" title="4.2.3 定义多字段和数组类型"></a>4.2.3 定义多字段和数组类型</h3><h2 id="4-3-使用预定义字段"><a href="#4-3-使用预定义字段" class="headerlink" title="4.3 使用预定义字段"></a>4.3 使用预定义字段</h2><h3 id="4-3-1-控制如何存储和搜索文档"><a href="#4-3-1-控制如何存储和搜索文档" class="headerlink" title="4.3.1 控制如何存储和搜索文档"></a>4.3.1 控制如何存储和搜索文档</h3><ol><li><p>_source 存储原有内容</p><ol><li>按照原有格式存储原有文档</li><li>enable可以设置true,false</li><li>返回某些特定字段在url指定使用fields=xxx,如果需要多个字段用逗号隔开</li><li>使用”store”: “yes” 存储特定的字段</li></ol></li><li><p>_all 索引一切</p><ol><li>不指定字段名称默认是_all查找</li><li>默认隐藏属性为”<strong>include_in_all</strong>“ ， 可以设置为false不被包含</li></ol></li><li><p>_uid 识别文档</p><ol><li>_type和_id的结合体</li><li>es内部使用_uid 来确定唯一文档的身份</li></ol></li><li><p>_index 在文档中存储索引名称</p><ol><li>默认情况下是关闭的</li><li>如果需要了解其内容，需要实现使用put 请求将enabled 设置为true</li></ol></li><li><p>_update 更新现有文档</p><ol><li>默认使用go语言进行脚本的更新操作</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;lib&#x2F;user&#x2F;1&#x2F;_update</span><br><span class="line">&#123;</span><br><span class="line">  &quot;doc&quot;: &#123;</span><br><span class="line">    &quot;first_name&quot;:&quot;sss&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>upsert 创建不存在的文档（注意此时5不存在）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;lib&#x2F;user&#x2F;5&#x2F;_update</span><br><span class="line">&#123;</span><br><span class="line">  &quot;doc&quot;:&#123;</span><br><span class="line">    &quot;age&quot;:5</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;upsert&quot;: &#123;</span><br><span class="line">    &quot;myname&quot;: &quot;elastic&quot;,</span><br><span class="line">    &quot;age&quot;: 4</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>_open 以及 _close 分别表示开放索引和关闭索引</p></li></ol><h2 id="4-4-更新现有文档"><a href="#4-4-更新现有文档" class="headerlink" title="4.4 更新现有文档"></a>4.4 更新现有文档</h2><h3 id="4-4-1-文档更新包含如下步骤："><a href="#4-4-1-文档更新包含如下步骤：" class="headerlink" title="4.4.1 文档更新包含如下步骤："></a>4.4.1 文档更新包含如下步骤：</h3><ol><li>检索文档</li><li>处理文档</li><li>重新索引文档</li><li>先前文档被删除</li><li>完成</li></ol><h2 id="4-5-删除文档"><a href="#4-5-删除文档" class="headerlink" title="4.5 删除文档"></a>4.5 删除文档</h2><h3 id="4-5-1-删除文档的方式"><a href="#4-5-1-删除文档的方式" class="headerlink" title="4.5.1 删除文档的方式"></a>4.5.1 删除文档的方式</h3><ol><li>删除单个文档或者一组文档<ol><li>标记为删除</li><li>延迟用异步方式排出</li></ol></li><li>删除整个索引（删除多组文档的特例）<ol><li>移除和索引所有相关的文件</li><li>效率高</li></ol></li><li>关闭索引<ol><li>不允许读写操作，数据也不进内存</li><li>但是索引还是在磁盘内</li><li>可以再次打开关闭的索引</li></ol></li></ol><h3 id="4-5-2-删除文档"><a href="#4-5-2-删除文档" class="headerlink" title="4.5.2 删除文档"></a>4.5.2 删除文档</h3><ol><li>通过id删除单个文档</li><li>单个请求删除多个文档<ol><li>比单独删除效率高</li></ol></li><li>删除映射类型，包括其中文档</li><li>删除匹配某个查询的所有文档</li></ol><h3 id="4-5-3-删除单个文档"><a href="#4-5-3-删除单个文档" class="headerlink" title="4.5.3 删除单个文档"></a>4.5.3 删除单个文档</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE &#x2F;lib&#x2F;user&#x2F;5</span><br></pre></td></tr></table></figure><p>为了防止外部的并发更新与删除的操作：</p><p>es在一段时间内保留这篇文档的版本，拒绝比删除文档更低的更新操作</p><p>默认时间为60秒</p><p>yml或者索引配置的 <strong>index.gc_deletes</strong> 设置保留时间</p><h3 id="4-5-4-删除映射类型和删除查询匹配的文档"><a href="#4-5-4-删除映射类型和删除查询匹配的文档" class="headerlink" title="4.5.4 删除映射类型和删除查询匹配的文档"></a>4.5.4 删除映射类型和删除查询匹配的文档</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE &#x2F;get-together&#x2F;_query?q&#x3D;elasticsearch</span><br></pre></td></tr></table></figure><p>注意点：</p><ol><li>类型名称只是文档的另一个字段</li><li>索引的所有文档，无论属于哪个映射类型，都存在同一个分片</li><li><strong>针对删除类型和删除完整索引两者的性能进行比较的时候，删除类型比删除索引要更长的时间和更多的资源</strong></li></ol><h3 id="4-5-5-删除索引"><a href="#4-5-5-删除索引" class="headerlink" title="4.5.5 删除索引"></a>4.5.5 删除索引</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DELETE &#x2F;myindex[,xxx,xx] 删除一个或者多个索引</span><br><span class="line">DELETE &#x2F;_all 删除所有的索引</span><br></pre></td></tr></table></figure><blockquote><p>_all 删除所有文档是否过于危险？</p><p>elasticsearch.yml 文件中</p><p>action.destructive_requires_name: true</p><p>预防这种情况发生， 可以<strong>拒绝</strong>delete _all 操作</p><p>以及索引名称当中的<strong>通配符</strong></p></blockquote><p>注意这里的删除也是标记删除：在分段与合并中进行合并之后才会真实删除操作</p><blockquote><p>分段与合并是什么？</p><ol><li>一个分段是建立索引的时候创建的一块Lucene 索引</li><li>当es在分片上查询的时候，Luncene需要查询所有的分段</li><li>合并文档意味着分段的合并以及I/O和CPU读写操作（合并操作是异步进行的）</li><li>索引操作会产生许多小分段，需要定期进行合并</li></ol></blockquote><h3 id="4-5-6-关闭和开发索引"><a href="#4-5-6-关闭和开发索引" class="headerlink" title="4.5.6 关闭和开发索引"></a>4.5.6 关闭和开发索引</h3><p>使用POST 加上 _open 以及 _close 对于索引进行开放和关闭</p><ol><li>一旦索引被关闭，内存唯一痕迹是元数据，如名字以及分片的位置</li><li>如果条件允许，关闭索引比删除索引要好</li></ol><h1 id="5-版本控制"><a href="#5-版本控制" class="headerlink" title="5. 版本控制"></a>5. 版本控制</h1><h2 id="5-1-乐观锁"><a href="#5-1-乐观锁" class="headerlink" title="5.1 乐观锁"></a>5.1 乐观锁</h2><h3 id="5-1-1-内部版本控制"><a href="#5-1-1-内部版本控制" class="headerlink" title="5.1.1 内部版本控制"></a>5.1.1 内部版本控制</h3><p>PUT /lib/user/4?version=3</p><h3 id="5-1-2-外部版本控制"><a href="#5-1-2-外部版本控制" class="headerlink" title="5.1.2 外部版本控制"></a>5.1.2 外部版本控制</h3><p>version_type=external + 版本号</p><h2 id="5-2-自动重试"><a href="#5-2-自动重试" class="headerlink" title="5.2 自动重试"></a>5.2 自动重试</h2><p>retry_on_conflict=3(版本号) 自动重试</p><h1 id="6-搜索与高级搜索分析"><a href="#6-搜索与高级搜索分析" class="headerlink" title="6. 搜索与高级搜索分析"></a>6. 搜索与高级搜索分析</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl &#39;&#x2F;_search&#39;</span><br><span class="line">curl &#39;&#x2F;xxx&#x2F;_search&#39; 指定索引</span><br><span class="line">curl &#39;&#x2F;xxx&#x2F;xxx&#x2F;_search&#39; 搜索类型</span><br><span class="line">curl &#39;&#x2F;_all&#x2F;xxx&#x2F;_search&#39; 所有索引中搜索时事件类型</span><br><span class="line">curl &#39;&#x2F;*&#x2F;xxx&#x2F;_search&#39; 通配符搜索所有</span><br><span class="line">curl &#39;&#x2F;xxxx,xxxx&#x2F;xxx,xxxx&#x2F;_search&#39; 多个类型搜索</span><br><span class="line">curl &#39;&#x2F;+get-toge*,-get-together&#x2F;_search&#39; 搜索以get-toge 开头的索引，但是不包括get-together</span><br></pre></td></tr></table></figure><h2 id="6-1-搜索请求的基本模块"><a href="#6-1-搜索请求的基本模块" class="headerlink" title="6.1 搜索请求的基本模块"></a>6.1 搜索请求的基本模块</h2><ol><li>query：搜索请求最重要的部分，配置了基于评分返回最佳的文档</li><li>size：代表返回文档数量</li><li>from：和size一起使用，用于分页操作（注意：为了知道第二页的10项结果，必须先知道计算前20的结果，也就是说，<strong>越往后的翻页搜索代价越大</strong>）</li><li>_source：指定字段如何返回</li><li>sort：默认排序基于文档得分</li></ol><h2 id="6-2-基于url的搜索请求"><a href="#6-2-基于url的搜索请求" class="headerlink" title="6.2 基于url的搜索请求"></a>6.2 基于url的搜索请求</h2><h3 id="6-2-1-基于from-和szize的参数来实现结果分页"><a href="#6-2-1-基于from-和szize的参数来实现结果分页" class="headerlink" title="6.2.1 基于from 和szize的参数来实现结果分页"></a>6.2.1 基于from 和szize的参数来实现结果分页</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search?from&#x3D;2&amp;size&#x3D;2</span><br></pre></td></tr></table></figure><p>from=2 表示从第三条开始</p><p>size=2 表示读取2条记录</p><h3 id="6-2-2-改变结果的顺序"><a href="#6-2-2-改变结果的顺序" class="headerlink" title="6.2.2 改变结果的顺序"></a>6.2.2 改变结果的顺序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;_search?sort&#x3D;age:_id</span><br></pre></td></tr></table></figure><h3 id="6-2-3-搜索结果当中限制-source-字段"><a href="#6-2-3-搜索结果当中限制-source-字段" class="headerlink" title="6.2.3 搜索结果当中限制_source 字段"></a>6.2.3 搜索结果当中限制_source 字段</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;_search?sort&#x3D;age:_id&amp;_source&#x3D;first_name,age</span><br></pre></td></tr></table></figure><h3 id="6-2-4-匹配查询"><a href="#6-2-4-匹配查询" class="headerlink" title="6.2.4 匹配查询"></a>6.2.4 匹配查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;_search?sort&#x3D;age:_id&amp;_source&#x3D;first_name,age</span><br></pre></td></tr></table></figure><h2 id="6-3-基于请求主体的搜索请求"><a href="#6-3-基于请求主体的搜索请求" class="headerlink" title="6.3 基于请求主体的搜索请求"></a>6.3 基于请求主体的搜索请求</h2><h3 id="6-3-1-使用from-和-size，参数结果分页"><a href="#6-3-1-使用from-和-size，参数结果分页" class="headerlink" title="6.3.1 使用from 和 size，参数结果分页"></a>6.3.1 使用from 和 size，参数结果分页</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;: 2,</span><br><span class="line">  &quot;from&quot;: 2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-3-2-过滤返回-source-内容"><a href="#6-3-2-过滤返回-source-内容" class="headerlink" title="6.3.2 过滤返回_source 内容"></a>6.3.2 过滤返回_source 内容</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [&quot;first_name&quot;, &quot;age&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="在source字段当中返回通配符"><a href="#在source字段当中返回通配符" class="headerlink" title="在source字段当中返回通配符"></a>在source字段当中返回通配符</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [&quot;*_name&quot;, &quot;a*&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果是数组，可以指定: _source: [“name.*”, “address.*”]</p><h4 id="通过include以及exclude-过滤返回-source的内容"><a href="#通过include以及exclude-过滤返回-source的内容" class="headerlink" title="通过include以及exclude 过滤返回_source的内容"></a>通过include以及exclude 过滤返回_source的内容</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: &#123;</span><br><span class="line">    &quot;includes&quot;: [&quot;*_name&quot;, &quot;age&quot;],</span><br><span class="line">    &quot;excludes&quot;: [&quot;first_name&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>include: 包含匹配</p><p>excludes: 排除</p><h3 id="6-3-3-基于结果的排序"><a href="#6-3-3-基于结果的排序" class="headerlink" title="6.3.3 基于结果的排序"></a>6.3.3 基于结果的排序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;age&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;desc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"> </span><br><span class="line">    &quot;_score&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;took&quot;: 12,</span><br><span class="line">  &quot;timed_out&quot;: false,</span><br><span class="line">  &quot;_shards&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 5,</span><br><span class="line">    &quot;successful&quot;: 5,</span><br><span class="line">    &quot;skipped&quot;: 0,</span><br><span class="line">    &quot;failed&quot;: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 15,</span><br><span class="line">    &quot;max_score&quot;: null,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;lib&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;user&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;BrimyW0B5sayAd6P9LGl&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;first_name&quot;: &quot;Jane&quot;,</span><br><span class="line">          &quot;last_name&quot;: &quot;Smith&quot;,</span><br><span class="line">          &quot;age&quot;: 32,</span><br><span class="line">          &quot;about&quot;: &quot;I like to collect rock albums&quot;,</span><br><span class="line">          &quot;interests&quot;: [</span><br><span class="line">            &quot;music&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;sort&quot;: [</span><br><span class="line">          32,</span><br><span class="line">          1</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;lib&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;user&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;CbimyW0B5sayAd6P-LHO&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;first_name&quot;: &quot;Jane&quot;,</span><br><span class="line">          &quot;last_name&quot;: &quot;Smith&quot;,</span><br><span class="line">          &quot;age&quot;: 32,</span><br><span class="line">          &quot;about&quot;: &quot;I like to collect rock albums&quot;,</span><br><span class="line">          &quot;interests&quot;: [</span><br><span class="line">            &quot;music&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;sort&quot;: [</span><br><span class="line">          32,</span><br><span class="line">          1</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;lib&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;user&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;D7imyW0B5sayAd6P_LH0&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;first_name&quot;: &quot;Jane&quot;,</span><br><span class="line">          &quot;last_name&quot;: &quot;Smith&quot;,</span><br><span class="line">          &quot;age&quot;: 32,</span><br><span class="line">          &quot;about&quot;: &quot;I like to collect rock albums&quot;,</span><br><span class="line">          &quot;interests&quot;: [</span><br><span class="line">            &quot;music&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;sort&quot;: [</span><br><span class="line">          32,</span><br><span class="line">          1</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;lib&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;user&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;ELimyW0B5sayAd6P_bGM&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;first_name&quot;: &quot;Jane&quot;,</span><br><span class="line">          &quot;last_name&quot;: &quot;Smith&quot;,</span><br><span class="line">          &quot;age&quot;: 32,</span><br><span class="line">          &quot;about&quot;: &quot;I like to collect rock albums&quot;,</span><br><span class="line">          &quot;interests&quot;: [</span><br><span class="line">            &quot;music&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;sort&quot;: [</span><br><span class="line">          32,</span><br><span class="line">          1</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;lib&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;user&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;BbimyW0B5sayAd6P57Hs&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;first_name&quot;: &quot;Jane&quot;,</span><br><span class="line">          &quot;last_name&quot;: &quot;Smith&quot;,</span><br><span class="line">          &quot;age&quot;: 32,</span><br><span class="line">          &quot;about&quot;: &quot;I like to collect rock albums&quot;,</span><br><span class="line">          &quot;interests&quot;: [</span><br><span class="line">            &quot;music&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;sort&quot;: [</span><br><span class="line">          32,</span><br><span class="line">          1</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;lib&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;user&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;B7imyW0B5sayAd6P9rG3&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;first_name&quot;: &quot;Jane&quot;,</span><br><span class="line">          &quot;last_name&quot;: &quot;Smith&quot;,</span><br><span class="line">          &quot;age&quot;: 32,</span><br><span class="line">          &quot;about&quot;: &quot;I like to collect rock albums&quot;,</span><br><span class="line">          &quot;interests&quot;: [</span><br><span class="line">            &quot;music&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;sort&quot;: [</span><br><span class="line">          32,</span><br><span class="line">          1</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;lib&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;user&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;EbimyW0B5sayAd6P_rEo&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;first_name&quot;: &quot;Jane&quot;,</span><br><span class="line">          &quot;last_name&quot;: &quot;Smith&quot;,</span><br><span class="line">          &quot;age&quot;: 32,</span><br><span class="line">          &quot;about&quot;: &quot;I like to collect rock albums&quot;,</span><br><span class="line">          &quot;interests&quot;: [</span><br><span class="line">            &quot;music&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;sort&quot;: [</span><br><span class="line">          32,</span><br><span class="line">          1</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;lib&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;user&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;first_name&quot;: &quot;Jane&quot;,</span><br><span class="line">          &quot;last_name&quot;: &quot;Smith&quot;,</span><br><span class="line">          &quot;age&quot;: 32,</span><br><span class="line">          &quot;about&quot;: &quot;I like to collect rock albums&quot;,</span><br><span class="line">          &quot;interests&quot;: [</span><br><span class="line">            &quot;music&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;sort&quot;: [</span><br><span class="line">          32,</span><br><span class="line">          1</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;lib&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;user&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;CLimyW0B5sayAd6P97Hz&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;first_name&quot;: &quot;Jane&quot;,</span><br><span class="line">          &quot;last_name&quot;: &quot;Smith&quot;,</span><br><span class="line">          &quot;age&quot;: 32,</span><br><span class="line">          &quot;about&quot;: &quot;I like to collect rock albums&quot;,</span><br><span class="line">          &quot;interests&quot;: [</span><br><span class="line">            &quot;music&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;sort&quot;: [</span><br><span class="line">          32,</span><br><span class="line">          1</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;lib&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;user&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;CrimyW0B5sayAd6P-bGO&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;first_name&quot;: &quot;Jane&quot;,</span><br><span class="line">          &quot;last_name&quot;: &quot;Smith&quot;,</span><br><span class="line">          &quot;age&quot;: 32,</span><br><span class="line">          &quot;about&quot;: &quot;I like to collect rock albums&quot;,</span><br><span class="line">          &quot;interests&quot;: [</span><br><span class="line">            &quot;music&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;sort&quot;: [</span><br><span class="line">          32,</span><br><span class="line">          1</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-4-实践中的基础模块"><a href="#6-4-实践中的基础模块" class="headerlink" title="6.4 实践中的基础模块"></a>6.4 实践中的基础模块</h2><p>结合上面的几个点，总结出了下面一个查询内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 2,</span><br><span class="line">  &quot;_source&quot;: [&quot;*_name&quot;, &quot;age&quot;],</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;age&quot;:&quot;desc&quot;  </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-4-1-理解回复的内容"><a href="#6-4-1-理解回复的内容" class="headerlink" title="6.4.1 理解回复的内容"></a>6.4.1 理解回复的内容</h3><p>注意点： 如果没有存储文档的_source 和 fields, 无法从es 获取数值</p><h2 id="6-5-查询和过滤器DSL-（重点）"><a href="#6-5-查询和过滤器DSL-（重点）" class="headerlink" title="6.5 查询和过滤器DSL （重点）"></a>6.5 查询和过滤器DSL （重点）</h2><h3 id="6-5-1-match-查询和term过滤器"><a href="#6-5-1-match-查询和term过滤器" class="headerlink" title="6.5.1 match 查询和term过滤器"></a>6.5.1 match 查询和term过滤器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;first_name&quot;: &quot;Jane&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：此处 <strong>jane</strong> 是否大写对于查询结果没有影响</p><h4 id="过滤器和查询器有什么不同："><a href="#过滤器和查询器有什么不同：" class="headerlink" title="过滤器和查询器有什么不同："></a>过滤器和查询器有什么不同：</h4><p>查询器：为特定的词条计算得分</p><p>过滤器：</p><ol><li>“文档是否匹配这个查询” 返回简单的是或者否</li><li>限制了需要计算得分的文档数量</li><li>根据过滤器的种类，可以再“位集合”中缓存结果</li><li>允许手动指定一个过滤器是否应该被缓存</li></ol><blockquote><p>基于如上原因，过滤器会比查询器要快上很多，并且查询结果可以被缓存</p></blockquote><h4 id="es6以下-以及旧版本使用的方式"><a href="#es6以下-以及旧版本使用的方式" class="headerlink" title="es6以下 以及旧版本使用的方式"></a>es6以下 以及旧版本使用的方式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;:&#123;</span><br><span class="line">        &quot;filtedred&quot;:&#123; -- 表示指定一个附上过滤器的查询</span><br><span class="line">            &quot;query&quot;:&#123; -- 指定查询器</span><br><span class="line">                &quot;match&quot;: &quot;xxx&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;filter&quot;:&#123; -- 指定过滤器</span><br><span class="line">                &quot;term&quot;:&#123;</span><br><span class="line">                    ....</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>仅做了解即可，新版更为简单易用</p><h4 id="这里需要注意下面使用的是es6以及以上版本"><a href="#这里需要注意下面使用的是es6以及以上版本" class="headerlink" title="这里需要注意下面使用的是es6以及以上版本"></a>这里需要注意下面使用的是es6以及以上版本</h4><blockquote><p>es6 之后使用</p><p>bool:{</p><p>must 表示匹配操作</p><p>可以执行match 操作</p><p>filter:</p><p>对于结果进行过滤,</p><p>这要比在全部搜索中去匹配要快的多</p><p>}</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  </span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;about&quot;: &quot;hide&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ], </span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;term&quot;: &#123;</span><br><span class="line">          &quot;first_name&quot;: &quot;wang&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;took&quot;: 16,</span><br><span class="line">  &quot;timed_out&quot;: false,</span><br><span class="line">  &quot;_shards&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 5,</span><br><span class="line">    &quot;successful&quot;: 5,</span><br><span class="line">    &quot;skipped&quot;: 0,</span><br><span class="line">    &quot;failed&quot;: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 1,</span><br><span class="line">    &quot;max_score&quot;: 1.2039728,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;lib&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;user&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;E7joyW0B5sayAd6PEbFA&quot;,</span><br><span class="line">        &quot;_score&quot;: 1.2039728,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;first_name&quot;: &quot;wang&quot;,</span><br><span class="line">          &quot;last_name&quot;: &quot;laji&quot;,</span><br><span class="line">          &quot;age&quot;: 333,</span><br><span class="line">          &quot;about&quot;: &quot;I hide to collect rock albums&quot;,</span><br><span class="line">          &quot;interests&quot;: [</span><br><span class="line">            &quot;basket&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-6-常用的基础查询和过滤器"><a href="#6-6-常用的基础查询和过滤器" class="headerlink" title="6.6 常用的基础查询和过滤器"></a>6.6 常用的基础查询和过滤器</h2><h3 id="6-6-1-match-all-的使用场景"><a href="#6-6-1-match-all-的使用场景" class="headerlink" title="6.6.1 match_all 的使用场景"></a>6.6.1 match_all 的使用场景</h3><ol><li>希望使用过滤器的时候</li><li>希望返回被搜索的索引和类型的全部文档</li></ol><h3 id="6-6-2-query-string-查询"><a href="#6-6-2-query-string-查询" class="headerlink" title="6.6.2 query_string 查询"></a>6.6.2 query_string 查询</h3><blockquote><p>注意事项:</p><p>AND 必须大写， 即查询条件的连接符， 否则系统会当做查询字符串的内容进行识别</p><p>查询条件连接符两边必须加上一个空格区分</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;_search?q&#x3D;wang</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;query_string&quot;: &#123;</span><br><span class="line">      &quot;default_field&quot;: &quot;first_name&quot;,</span><br><span class="line">      &quot;query&quot;: &quot;first_name:wang AND age:333&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="使用query-string-进行复杂的查询"><a href="#使用query-string-进行复杂的查询" class="headerlink" title="使用query_string 进行复杂的查询"></a>使用query_string 进行复杂的查询</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; tags:search OR tags:lucene&#125; AND create_on:[1999-01-01 TO 2011-01-01]</span><br></pre></td></tr></table></figure><p>这是一个示例查询</p><p>下面为个人实验案例</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;query_string&quot;: &#123;</span><br><span class="line">      &quot;default_field&quot;: &quot;first_name&quot;,</span><br><span class="line">      &quot;query&quot;: &quot;first_name:wang OR first_name:jane AND age:[0 TO 999]&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>由于query_string 过于强大：建议的替代方案为使用 term, terms, match 或者 multi_match</p><p>允许你在一个或者多个文档搜索</p><p>或者使用 simple_query_string</p><p>使用 +、-、AND 和 OR 更容易使用的查询语法</p></blockquote><h3 id="6-6-3-term-查询和-term过滤器"><a href="#6-6-3-term-查询和-term过滤器" class="headerlink" title="6.6.3 term 查询和 term过滤器"></a>6.6.3 term 查询和 term过滤器</h3><ol><li>最简单的几个可执行查询之一</li><li>指定需要搜索的词条和字段</li><li>了解term(词条)查询</li></ol><blockquote><p>注意：被搜索的词条没有经过分析，文档的词条要经过精确匹配才能作为结果返回</p></blockquote><h4 id="使用term-过滤器的得分，和term查询器的得分对比"><a href="#使用term-过滤器的得分，和term查询器的得分对比" class="headerlink" title="使用term 过滤器的得分，和term查询器的得分对比"></a>使用term 过滤器的得分，和term查询器的得分对比</h4><p>使用过滤器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;term&quot;: &#123;</span><br><span class="line">          &quot;_id&quot;: 1</span><br><span class="line">        &#125;        </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;took&quot;: 10,</span><br><span class="line">  &quot;timed_out&quot;: false,</span><br><span class="line">  &quot;_shards&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 5,</span><br><span class="line">    &quot;successful&quot;: 5,</span><br><span class="line">    &quot;skipped&quot;: 0,</span><br><span class="line">    &quot;failed&quot;: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 1,</span><br><span class="line">    &quot;max_score&quot;: 0,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;lib&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;user&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot;: 0,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;first_name&quot;: &quot;Jane&quot;,</span><br><span class="line">          &quot;last_name&quot;: &quot;Smith&quot;,</span><br><span class="line">          &quot;age&quot;: 32,</span><br><span class="line">          &quot;about&quot;: &quot;I like to collect rock albums&quot;,</span><br><span class="line">          &quot;interests&quot;: [</span><br><span class="line">            &quot;music&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用查询器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;term&quot;: &#123;</span><br><span class="line">            &quot;first_name&quot;: &quot;wang&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;took&quot;: 9,</span><br><span class="line">  &quot;timed_out&quot;: false,</span><br><span class="line">  &quot;_shards&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 5,</span><br><span class="line">    &quot;successful&quot;: 5,</span><br><span class="line">    &quot;skipped&quot;: 0,</span><br><span class="line">    &quot;failed&quot;: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 1,</span><br><span class="line">    &quot;max_score&quot;: 1.2039728,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;lib&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;user&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;E7joyW0B5sayAd6PEbFA&quot;,</span><br><span class="line">        &quot;_score&quot;: 1.2039728,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;first_name&quot;: &quot;wang&quot;,</span><br><span class="line">          &quot;last_name&quot;: &quot;laji&quot;,</span><br><span class="line">          &quot;age&quot;: 333,</span><br><span class="line">          &quot;about&quot;: &quot;I hide to collect rock albums&quot;,</span><br><span class="line">          &quot;interests&quot;: [</span><br><span class="line">            &quot;basket&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-6-4-terms-查询"><a href="#6-6-4-terms-查询" class="headerlink" title="6.6.4 terms 查询"></a>6.6.4 terms 查询</h3><p>使用多词条查询搜索多个词条</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;terms&quot;: &#123;</span><br><span class="line">      &quot;about&quot;: [</span><br><span class="line">        &quot;i&quot;,</span><br><span class="line">        &quot;hide&quot;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以强制规定每篇文档中匹配词条的最小数量</p><p>mininum_should_match 参数</p><blockquote><p>注意：在新的版本当中只有过滤器才能制定该参数</p></blockquote><h3 id="6-5-5-match查询和-term过滤器"><a href="#6-5-5-match查询和-term过滤器" class="headerlink" title="6.5.5 match查询和 term过滤器"></a>6.5.5 match查询和 term过滤器</h3><p>match查询可以有多重行为方式，最常见就是<strong>布尔(bool)\</strong>和*<em>词组(phrase)*</em></p><h4 id="布尔查询行为"><a href="#布尔查询行为" class="headerlink" title="布尔查询行为"></a>布尔查询行为</h4><p>默认情况match查询使用布尔行为和OR操作符号， 如 “es den” 默认是”es OR den”</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;first_name&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;Jane wang&quot;,</span><br><span class="line">        &quot;operator&quot;: &quot;or&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>match 查询的第二个重要行为是作为phrase 查询</strong></p><h4 id="词组（phrase-）查询的方式"><a href="#词组（phrase-）查询的方式" class="headerlink" title="词组（phrase ）查询的方式"></a>词组（phrase ）查询的方式</h4><blockquote><p>在6.x已经不支持在math里面使用type， 可以修改为以下语法：</p></blockquote><p>可以设置slop 用来实现自动提示中的跨单词匹配的功能</p><h5 id="es5版本以及以下的语法："><a href="#es5版本以及以下的语法：" class="headerlink" title="es5版本以及以下的语法："></a>es5版本以及以下的语法：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;first_name&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;phrase&quot;,</span><br><span class="line">        &quot;query&quot;: &quot;hide&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>会出现如下报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;error&quot;: &#123;</span><br><span class="line">    &quot;root_cause&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;type&quot;: &quot;parsing_exception&quot;,</span><br><span class="line">        &quot;reason&quot;: &quot;[match] query does not support [type]&quot;,</span><br><span class="line">        &quot;line&quot;: 5,</span><br><span class="line">        &quot;col&quot;: 17</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;type&quot;: &quot;parsing_exception&quot;,</span><br><span class="line">    &quot;reason&quot;: &quot;[match] query does not support [type]&quot;,</span><br><span class="line">    &quot;line&quot;: 5,</span><br><span class="line">    &quot;col&quot;: 17</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;status&quot;: 400</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="es6以及以上要使用以下语法"><a href="#es6以及以上要使用以下语法" class="headerlink" title="es6以及以上要使用以下语法"></a>es6以及以上要使用以下语法</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase&quot;: &#123;</span><br><span class="line">      &quot;about&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;to rock&quot;,</span><br><span class="line">        &quot;slop&quot;:1</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：slop 为0 代表中间不进行跳行匹配,默认为0</p><h3 id="6-5-6-phrase-prefix-查询"><a href="#6-5-6-phrase-prefix-查询" class="headerlink" title="6.5.6 phrase_prefix 查询"></a>6.5.6 phrase_prefix 查询</h3><p>依据词组的最后一个词条进行前缀匹配</p><p>对于搜索框自动完成来说，是一个十分重要的功能</p><blockquote><p>注意：这种方式最好设置 max_expansions 设置最大的前缀扩展数量</p></blockquote><h4 id="es5-x-版本以及以下的语法："><a href="#es5-x-版本以及以下的语法：" class="headerlink" title="es5.x 版本以及以下的语法："></a>es5.x 版本以及以下的语法：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;first_name&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;phrase_prefix&quot;,</span><br><span class="line">        &quot;query&quot;: &quot;hide&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="es6-x-需要改成如下写法"><a href="#es6-x-需要改成如下写法" class="headerlink" title="es6.x 需要改成如下写法"></a>es6.x 需要改成如下写法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase_prefix&quot;: &#123;</span><br><span class="line">      &quot;first_name&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;wa&quot;,</span><br><span class="line">        &quot;max_expansions&quot;: 5</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;took&quot;: 24,</span><br><span class="line">  &quot;timed_out&quot;: false,</span><br><span class="line">  &quot;_shards&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 5,</span><br><span class="line">    &quot;successful&quot;: 5,</span><br><span class="line">    &quot;skipped&quot;: 0,</span><br><span class="line">    &quot;failed&quot;: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 1,</span><br><span class="line">    &quot;max_score&quot;: 1.2039728,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;lib&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;user&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;E7joyW0B5sayAd6PEbFA&quot;,</span><br><span class="line">        &quot;_score&quot;: 1.2039728,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;first_name&quot;: &quot;wang&quot;,</span><br><span class="line">          &quot;last_name&quot;: &quot;laji&quot;,</span><br><span class="line">          &quot;age&quot;: 333,</span><br><span class="line">          &quot;about&quot;: &quot;I hide to collect rock albums&quot;,</span><br><span class="line">          &quot;interests&quot;: [</span><br><span class="line">            &quot;basket&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>bool查询和phrase 查询 对于接受用户输入是很好的选择</p><h4 id="使用multi-match-匹配多个字段"><a href="#使用multi-match-匹配多个字段" class="headerlink" title="使用multi_match 匹配多个字段"></a>使用multi_match 匹配多个字段</h4><p>和match 多个字段有细微的区别：</p><p>允许搜索多个字段中的值</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;wang smith&quot;,</span><br><span class="line">        &quot;fields&quot;: [&quot;first_name&quot;, &quot;last_name&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>multi_match 也可以转化为 phrase(词组) 查询 或者 phrase_prefix 查询</strong></p><p>match 查询是核心的查询类型</p><h2 id="6-7-组合查询和复合查询"><a href="#6-7-组合查询和复合查询" class="headerlink" title="6.7 组合查询和复合查询"></a>6.7 组合查询和复合查询</h2><h3 id="6-7-1-bool查询"><a href="#6-7-1-bool查询" class="headerlink" title="6.7.1 bool查询"></a>6.7.1 bool查询</h3><p>有以下类别：</p><ol><li>必须(must)</li><li>应该(should)</li><li>不能(must_not)</li></ol><ul><li>如果指定了bool查询的部分是must匹配， 只有匹配上结果才能返回</li><li>如果指定了bool查询的部分是should匹配， 只有匹配上<strong>指定数量子句</strong>的文档才会被返回</li><li>如果没有must匹配，至少要匹配一个should子句才能返回</li><li>must_not 子句会使得文档被移除结果集合</li></ul><p>下面使用一个综合的例子进行试验</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;lib&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match_phrase&quot;:  &#123;</span><br><span class="line">            &quot;about&quot;: &#123;</span><br><span class="line">              &quot;query&quot;: &quot;i to&quot;,</span><br><span class="line">              &quot;slop&quot;: 1</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;should&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;term&quot;: &#123;</span><br><span class="line">            &quot;first_name&quot;: &#123;</span><br><span class="line">              &quot;value&quot;: &quot;wang&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;must_not&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;query_string&quot;: &#123;</span><br><span class="line">            &quot;default_field&quot;: &quot;age&quot;,</span><br><span class="line">            &quot;query&quot;: &quot;first_name:jane&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;minimum_should_match&quot;: 1 --指定至少shold子句匹配数，满足才能返回结果</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-7-2-bool-的过滤器"><a href="#6-7-2-bool-的过滤器" class="headerlink" title="6.7.2 bool 的过滤器"></a>6.7.2 bool 的过滤器</h3><p>ES6 经过调整，已经将bool的查询器移除，只做过滤功能</p><p>es存在如下写法:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">query</span><br><span class="line">filtered:</span><br><span class="line">        filter:</span><br><span class="line">            bool:</span><br><span class="line">                must:</span><br><span class="line">                should:</span><br><span class="line">                must_not:</span><br></pre></td></tr></table></figure><blockquote><p>小贴士：</p><p>mininum_should_match 默认有一些隐藏特性</p><p>如果指定了must 子句</p><p><strong>默认值就会变为0</strong>,</p><p>如果没有Must子句</p><p><strong>默认就是1</strong></p></blockquote><h2 id="6-8-超越match-和-过滤器的查询"><a href="#6-8-超越match-和-过滤器的查询" class="headerlink" title="6.8 超越match 和 过滤器的查询"></a>6.8 超越match 和 过滤器的查询</h2><h3 id="6-8-1-range-查询和过滤器"><a href="#6-8-1-range-查询和过滤器" class="headerlink" title="6.8.1 range 查询和过滤器"></a>6.8.1 range 查询和过滤器</h3><h4 id="模拟数据"><a href="#模拟数据" class="headerlink" title="模拟数据"></a>模拟数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;myindex&#x2F;test&#x2F;5</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;CHENLONG_looo&quot;,</span><br><span class="line">  &quot;age&quot;: 66,</span><br><span class="line">  &quot;birthday&quot;: &quot;2016-10-10&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST &#x2F;myindex&#x2F;test&#x2F;5</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;CHENLONG&quot;,</span><br><span class="line">  &quot;age&quot;: 15,</span><br><span class="line">  &quot;birthday&quot;: &quot;2011-02-14&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST &#x2F;myindex&#x2F;test&#x2F;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;lixiaolong&quot;,</span><br><span class="line">  &quot;age&quot;: 5,</span><br><span class="line">  &quot;birthday&quot;: &quot;2019-05-04&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="现在需要查找出-11-年到-16年的数据"><a href="#现在需要查找出-11-年到-16年的数据" class="headerlink" title="现在需要查找出 11 年到 16年的数据"></a>现在需要查找出 11 年到 16年的数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;myindex&#x2F;test&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;range&quot;: &#123;</span><br><span class="line">      &quot;birthday&quot;: &#123;</span><br><span class="line">        &quot;gte&quot;: &quot;2011-06-11&quot;,</span><br><span class="line">        &quot;lte&quot;: &quot;2020-01-01&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;took&quot;: 29,</span><br><span class="line">  &quot;timed_out&quot;: false,</span><br><span class="line">  &quot;_shards&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 5,</span><br><span class="line">    &quot;successful&quot;: 5,</span><br><span class="line">    &quot;skipped&quot;: 0,</span><br><span class="line">    &quot;failed&quot;: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 2,</span><br><span class="line">    &quot;max_score&quot;: 1,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;myindex&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;test&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;5&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;name&quot;: &quot;CHENLONG_looo&quot;,</span><br><span class="line">          &quot;age&quot;: 66,</span><br><span class="line">          &quot;birthday&quot;: &quot;2016-10-10&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;myindex&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;test&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;name&quot;: &quot;lixiaolong&quot;,</span><br><span class="line">          &quot;age&quot;: 55,</span><br><span class="line">          &quot;birthday&quot;: &quot;2019-05-04&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>range支持字符串的范围匹配，如 “li” 到 “e” 之间的分组</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;myindex&#x2F;test&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;range&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &#123;</span><br><span class="line">        &quot;gte&quot;: &quot;li&quot;,</span><br><span class="line">        &quot;lte&quot;: &quot;o&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>range 应该用于过滤而不是查询</p><h3 id="6-8-2-prefix-查询和过滤器"><a href="#6-8-2-prefix-查询和过滤器" class="headerlink" title="6.8.2 prefix 查询和过滤器"></a>6.8.2 prefix 查询和过滤器</h3><p>prefix 查询和过滤器允许给定的前缀来搜索词条,<strong>这里的前缀在搜索之前没有经过分析</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;myindex&#x2F;test&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;prefix&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;li&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>匹配 li 开头的词条</p><h4 id="在过滤器当中使用"><a href="#在过滤器当中使用" class="headerlink" title="在过滤器当中使用"></a>在过滤器当中使用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;myindex&#x2F;test&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;prefix&quot;: &#123;</span><br><span class="line">          &quot;name&quot;: &quot;li&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意过滤器会跳过得分计算，所以效率要高于查询</p><blockquote><p>注意： 由于搜索前缀不会被分析，所以大小写是进行区分的</p><p>原因：es分析文档和查询的方式引起的</p></blockquote><h3 id="6-8-3-wildcard-查询"><a href="#6-8-3-wildcard-查询" class="headerlink" title="6.8.3 wildcard 查询"></a>6.8.3 wildcard 查询</h3><p>正则表达式的搜索方式：</p><p>更像是 shell 通配符 globbing 的工作方式：</p><p>ls *foo?ar</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;myindex&#x2F;test&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;wildcard&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;lix?ao*&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>要注意的是：这种正则匹配并不像match 那样轻量级</p><p>如果需要用于系统，要进行数据分析以及测试</p><h2 id="6-9-使用过滤器查询字段的存在性"><a href="#6-9-使用过滤器查询字段的存在性" class="headerlink" title="6.9 使用过滤器查询字段的存在性"></a>6.9 使用过滤器查询字段的存在性</h2><h3 id="6-9-1-exists-过滤器"><a href="#6-9-1-exists-过滤器" class="headerlink" title="6.9.1 exists 过滤器"></a>6.9.1 exists 过滤器</h3><p>只查找那些特定字段有值的文档</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;myindex&#x2F;test&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;exists&quot;: &#123;</span><br><span class="line">          &quot;field&quot;: &quot;name&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-9-2-missing-过滤器（6-x以上版本已经删除）"><a href="#6-9-2-missing-过滤器（6-x以上版本已经删除）" class="headerlink" title="6.9.2 missing 过滤器（6.x以上版本已经删除）"></a>6.9.2 missing 过滤器（6.x以上版本已经删除）</h3><p>可以搜索字段里没有的值，或者映射的时候默认指定的默认值的文档（映射里的 null_value）</p><h4 id="作为测试-先插入一条增加一个字段的数据"><a href="#作为测试-先插入一条增加一个字段的数据" class="headerlink" title="作为测试,先插入一条增加一个字段的数据"></a>作为测试,先插入一条增加一个字段的数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;myindex&#x2F;test&#x2F;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;lixiaolong&quot;,</span><br><span class="line">  &quot;age&quot;: 5,</span><br><span class="line">  &quot;birthday&quot;: &quot;2019-05-04&quot;,</span><br><span class="line">  &quot;test_field&quot;: &quot;zzzzzz&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="接下来，查找字段里没有的值-这样写是错误的，没有正确写法（6-x）"><a href="#接下来，查找字段里没有的值-这样写是错误的，没有正确写法（6-x）" class="headerlink" title="接下来，查找字段里没有的值,这样写是错误的，没有正确写法（6.x）"></a>接下来，查找字段里没有的值,这样写是错误的，没有正确写法（6.x）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;myindex&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;missing&quot;: &#123;</span><br><span class="line">          &quot;field&quot;: &quot;test_field&quot;,</span><br><span class="line">          &quot;existence&quot;: true,</span><br><span class="line">          &quot;null_value&quot;: true</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-9-3-将任何查询转为过滤器"><a href="#6-9-3-将任何查询转为过滤器" class="headerlink" title="6.9.3 将任何查询转为过滤器"></a>6.9.3 将任何查询转为过滤器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;myindex&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;query_string&quot;: &#123;</span><br><span class="line">            &quot;default_field&quot;: &quot;name&quot;,</span><br><span class="line">            &quot;query&quot;: &quot;che*&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="缓存过滤器"><a href="#缓存过滤器" class="headerlink" title="缓存过滤器"></a>缓存过滤器</h4><p>加入 _cache: true 配置</p><h3 id="6-9-4-为任务选择最好的查询"><a href="#6-9-4-为任务选择最好的查询" class="headerlink" title="6.9.4 为任务选择最好的查询"></a>6.9.4 为任务选择最好的查询</h3><h1 id="7-分析数据"><a href="#7-分析数据" class="headerlink" title="7. 分析数据"></a>7. 分析数据</h1><h2 id="7-1-什么是分析数据"><a href="#7-1-什么是分析数据" class="headerlink" title="7.1 什么是分析数据"></a>7.1 什么是分析数据</h2><ol><li>字符过滤：使用字符过滤器转变字符</li><li>文本切分为分词：将文本切分为单个或者多个分词</li><li>分词过滤：使用分词过滤器转变为每个分词</li><li>分词索引：将这些分词存储到索引中</li></ol><h3 id="7-1-1-字符过滤"><a href="#7-1-1-字符过滤" class="headerlink" title="7.1.1 字符过滤"></a>7.1.1 字符过滤</h3><p>主要是排除一些HTML标签以及特殊符号转为可以搜索是是别的词条</p><h3 id="7-1-2-切分为分词"><a href="#7-1-2-切分为分词" class="headerlink" title="7.1.2 切分为分词"></a>7.1.2 切分为分词</h3><p>标准分词器：根据空格，换行，破折号进行划分单词</p><h3 id="7-1-3-分词过滤器"><a href="#7-1-3-分词过滤器" class="headerlink" title="7.1.3 分词过滤器"></a>7.1.3 分词过滤器</h3><p>最有用和最常用的是<strong>小写分词过滤器</strong>（外国）</p><p>中国建议使用 ik 中文分词器</p><p>书本的分词过滤为下：</p><ol><li>分词转小写</li><li>删除”停用词”</li><li>同义词添加</li></ol><h3 id="7-1-4-分词索引"><a href="#7-1-4-分词索引" class="headerlink" title="7.1.4 分词索引"></a>7.1.4 分词索引</h3><p>经过分词过滤器过滤之后，将发送到Lucene进行文档索引。最终组成倒排索引</p><p>所有不同部分，组成一个分析器</p><blockquote><p>搜索时候的分析：</p><p>如果搜索没有达到预期效果，牢记一条</p><p><strong>分析方式和预想的不一致</strong></p></blockquote><h2 id="7-2-为文档使用分析器"><a href="#7-2-为文档使用分析器" class="headerlink" title="7.2 为文档使用分析器"></a>7.2 为文档使用分析器</h2><p>以下两种方式指定字段使用的分析器</p><ul><li>创建索引的时候，为特定索引进行设置</li><li>es配置文件中，配置全局分析器</li></ul><h3 id="7-2-1-创建索引的过程中，添加定制分析器"><a href="#7-2-1-创建索引的过程中，添加定制分析器" class="headerlink" title="7.2.1 创建索引的过程中，添加定制分析器"></a>7.2.1 创建索引的过程中，添加定制分析器</h3><p>参考：</p><p><a href="https://blog.csdn.net/wsyw126/article/details/71080285" target="_blank" rel="noopener">https://blog.csdn.net/wsyw126/article/details/71080285</a></p><h4 id="旧版本的使用方式"><a href="#旧版本的使用方式" class="headerlink" title="旧版本的使用方式"></a>旧版本的使用方式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;mymyindex&#x2F;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;:&#123;</span><br><span class="line">    &quot;number_of_shards&quot;: 2,</span><br><span class="line">    &quot;number_of_replicas&quot;: 1,</span><br><span class="line">    &quot;index&quot;: &#123;</span><br><span class="line">      &quot;analysis&quot;: &#123;</span><br><span class="line">        &quot;myCustomAnalyzer&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;custom&quot;,</span><br><span class="line">          &quot;tokenizer&quot;: &quot;myCustomTokenizer&quot;,</span><br><span class="line">          &quot;filter&quot;: [&quot;myCustomFilter1&quot;, &quot;myCustomFilter2&quot;],</span><br><span class="line">          &quot;char_filter&quot;: [&quot;myCustomCharFilter&quot;]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;tokenizer&quot;: &#123;</span><br><span class="line">      &quot;myCustomTokenizer&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;letter&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;filter&quot;: &#123;</span><br><span class="line">      &quot;myCustomFilter1&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;lowercase&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;myCustomFilter2&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;kstem&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;char_filter&quot;:&#123;</span><br><span class="line">      &quot;myCustomCharFilter&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;mapping&quot;,</span><br><span class="line">        &quot;mappings&quot;: [&quot;ph&#x3D;&gt;f&quot;, &quot;u&#x3D;&gt;you&quot;]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;mappings&quot;:&#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="网上的案例："><a href="#网上的案例：" class="headerlink" title="网上的案例："></a>网上的案例：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;my_index</span><br><span class="line">&#123;</span><br><span class="line">    &quot;settings&quot;: &#123;</span><br><span class="line">        &quot;analysis&quot;: &#123;</span><br><span class="line">            &quot;char_filter&quot;: &#123;</span><br><span class="line">                &quot;&amp;_to_and&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;:       &quot;mapping&quot;,</span><br><span class="line">                    &quot;mappings&quot;: [ &quot;&amp; &#x3D;&gt; and &quot;]</span><br><span class="line">            &#125;&#125;,</span><br><span class="line">            &quot;filter&quot;: &#123;</span><br><span class="line">                &quot;my_stopwords&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;:       &quot;stop&quot;,</span><br><span class="line">                    &quot;stopwords&quot;: [ &quot;the&quot;, &quot;a&quot; ]</span><br><span class="line">            &#125;&#125;,</span><br><span class="line">            &quot;analyzer&quot;: &#123;</span><br><span class="line">                &quot;my_analyzer&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;:         &quot;custom&quot;,</span><br><span class="line">                    &quot;char_filter&quot;:  [ &quot;html_strip&quot;, &quot;&amp;_to_and&quot; ],</span><br><span class="line">                    &quot;tokenizer&quot;:    &quot;standard&quot;,</span><br><span class="line">                    &quot;filter&quot;:       [ &quot;lowercase&quot;, &quot;my_stopwords&quot; ]</span><br><span class="line">            &#125;&#125;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的网上案例使用 _settings 查看结果是这样的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;my_index&quot;: &#123;</span><br><span class="line">    &quot;settings&quot;: &#123;</span><br><span class="line">      &quot;index&quot;: &#123;</span><br><span class="line">        &quot;number_of_shards&quot;: &quot;5&quot;,</span><br><span class="line">        &quot;provided_name&quot;: &quot;my_index&quot;,</span><br><span class="line">        &quot;creation_date&quot;: &quot;1571079347660&quot;,</span><br><span class="line">        &quot;analysis&quot;: &#123;</span><br><span class="line">          &quot;filter&quot;: &#123;</span><br><span class="line">            &quot;my_stopwords&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;stop&quot;,</span><br><span class="line">              &quot;stopwords&quot;: [</span><br><span class="line">                &quot;the&quot;,</span><br><span class="line">                &quot;a&quot;</span><br><span class="line">              ]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;analyzer&quot;: &#123;</span><br><span class="line">            &quot;my_analyzer&quot;: &#123;</span><br><span class="line">              &quot;filter&quot;: [</span><br><span class="line">                &quot;lowercase&quot;,</span><br><span class="line">                &quot;my_stopwords&quot;</span><br><span class="line">              ],</span><br><span class="line">              &quot;char_filter&quot;: [</span><br><span class="line">                &quot;html_strip&quot;,</span><br><span class="line">                &quot;&amp;_to_and&quot;</span><br><span class="line">              ],</span><br><span class="line">              &quot;type&quot;: &quot;custom&quot;,</span><br><span class="line">              &quot;tokenizer&quot;: &quot;standard&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;char_filter&quot;: &#123;</span><br><span class="line">            &quot;&amp;_to_and&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;mapping&quot;,</span><br><span class="line">              &quot;mappings&quot;: [</span><br><span class="line">                &quot;&amp; &#x3D;&gt; and &quot;</span><br><span class="line">              ]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;number_of_replicas&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;uuid&quot;: &quot;gYyxkcIRRWqLtWhjMd24CQ&quot;,</span><br><span class="line">        &quot;version&quot;: &#123;</span><br><span class="line">          &quot;created&quot;: &quot;6020499&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="将书上的案例改为6-x支持的形式，格式如下"><a href="#将书上的案例改为6-x支持的形式，格式如下" class="headerlink" title="将书上的案例改为6.x支持的形式，格式如下:"></a>将书上的案例改为6.x支持的形式，格式如下:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;mymyindex&#x2F;</span><br><span class="line">&#123;</span><br><span class="line">&quot;settings&quot;: &#123;</span><br><span class="line">&quot;number_of_shards&quot;: 2,</span><br><span class="line">&quot;number_of_replicas&quot;: 1,</span><br><span class="line">&quot;analysis&quot;: &#123;</span><br><span class="line">&quot;myCustomAnalyzer&quot;: &#123;</span><br><span class="line">&quot;type&quot;: &quot;custom&quot;,</span><br><span class="line">&quot;tokenizer&quot;: &quot;myCustomTokenizer&quot;,</span><br><span class="line">&quot;filter&quot;: [&quot;myCustomFilter1&quot;, &quot;myCustomFilter2&quot;],</span><br><span class="line">&quot;char_filter&quot;: [&quot;myCustomCharFilter&quot;]</span><br><span class="line">&#125;,</span><br><span class="line">&quot;tokenizer&quot;: &#123;</span><br><span class="line">&quot;myCustomTokenizer&quot;: &#123;</span><br><span class="line">&quot;type&quot;: &quot;letter&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;filter&quot;: &#123;</span><br><span class="line">&quot;myCustomFilter1&quot;: &#123;</span><br><span class="line">&quot;type&quot;: &quot;lowercase&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;myCustomFilter2&quot;: &#123;</span><br><span class="line">&quot;type&quot;: &quot;kstem&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;char_filter&quot;: &#123;</span><br><span class="line">&quot;myCustomCharFilter&quot;: &#123;</span><br><span class="line">&quot;type&quot;: &quot;mapping&quot;,</span><br><span class="line">&quot;mappings&quot;: [&quot;ph&#x3D;&gt;f&quot;, &quot;u&#x3D;&gt;you&quot;]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line">&quot;mappings&quot;: &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-2-2-使用elasticsearch-yml-的配置文件进行配置"><a href="#7-2-2-使用elasticsearch-yml-的配置文件进行配置" class="headerlink" title="7.2.2 使用elasticsearch.yml 的配置文件进行配置"></a>7.2.2 使用elasticsearch.yml 的配置文件进行配置</h3><p>目前没有理解如何配置，需要到官方文档去摸索</p><h3 id="7-2-3-在映射中指定某个字段的分析器"><a href="#7-2-3-在映射中指定某个字段的分析器" class="headerlink" title="7.2.3 在映射中指定某个字段的分析器"></a>7.2.3 在映射中指定某个字段的分析器</h3><h4 id="书本的方式已经不适用于6-x版本了，根据官方文档的内容要进行如下定义"><a href="#书本的方式已经不适用于6-x版本了，根据官方文档的内容要进行如下定义" class="headerlink" title="书本的方式已经不适用于6.x版本了，根据官方文档的内容要进行如下定义"></a>书本的方式已经不适用于6.x版本了，根据官方文档的内容要进行如下定义</h4><p>注意下文有使用到该索引</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;mymyindex</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;analysis&quot;: &#123;</span><br><span class="line">      &quot;analyzer&quot;: &#123;</span><br><span class="line">        &quot;std_folded&quot;: &#123; </span><br><span class="line">          &quot;type&quot;: &quot;custom&quot;,</span><br><span class="line">          &quot;tokenizer&quot;: &quot;standard&quot;,</span><br><span class="line">          &quot;filter&quot;: [</span><br><span class="line">            &quot;lowercase&quot;,</span><br><span class="line">            &quot;asciifolding&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;_doc&quot;: &#123;</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;my_text&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">          &quot;analyzer&quot;: &quot;std_folded&quot; </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-3-使用API来分析文本"><a href="#7-3-使用API来分析文本" class="headerlink" title="7.3 使用API来分析文本"></a>7.3 使用API来分析文本</h2><h3 id="7-3-1-使用-analyzer-内置API来进行分析分析器解析步骤"><a href="#7-3-1-使用-analyzer-内置API来进行分析分析器解析步骤" class="headerlink" title="7.3.1 使用_analyzer 内置API来进行分析分析器解析步骤"></a>7.3.1 使用_analyzer 内置API来进行分析分析器解析步骤</h3><p>下面是官方的测试用例：使用的官方内置的 <strong>standard（标准）</strong>分析器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST &quot;192.168.92.180:9200&#x2F;_analyze?pretty&quot; -H &#39;Content-Type: application&#x2F;json&#39; -d&#39;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;standard&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;The 2 QUICK Brown-Foxes jumped over the lazy dog\u0027s bone.&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#39;</span><br></pre></td></tr></table></figure><p>结果如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;the&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 3,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;2&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 4,</span><br><span class="line">      &quot;end_offset&quot; : 5,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;NUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;quick&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 6,</span><br><span class="line">      &quot;end_offset&quot; : 11,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;brown&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 12,</span><br><span class="line">      &quot;end_offset&quot; : 17,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;foxes&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 18,</span><br><span class="line">      &quot;end_offset&quot; : 23,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 4</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;jumped&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 24,</span><br><span class="line">      &quot;end_offset&quot; : 30,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 5</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;over&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 31,</span><br><span class="line">      &quot;end_offset&quot; : 35,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 6</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;the&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 36,</span><br><span class="line">      &quot;end_offset&quot; : 39,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 7</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;lazy&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 40,</span><br><span class="line">      &quot;end_offset&quot; : 44,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 8</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;dog&#39;s&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 45,</span><br><span class="line">      &quot;end_offset&quot; : 50,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 9</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;bone&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 51,</span><br><span class="line">      &quot;end_offset&quot; : 55,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 10</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>POST my_index/_analyze?analyzer=standard 注意：传参数这样使用时 错误的</p><p>需要使用如下方式</p><p>POST my_index/_analyze { “analyzer”: “standard”, “text”: “The 2 QUICK Brown-Foxes jumped over the lazy dog’s bone.” }</p></blockquote><h3 id="7-3-2-分析中指定自定义分析器"><a href="#7-3-2-分析中指定自定义分析器" class="headerlink" title="7.3.2 分析中指定自定义分析器"></a>7.3.2 分析中指定自定义分析器</h3><p>这里在建立索引的时候用到了上面官方改动案例的索引</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;mymyindex&#x2F;_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;std_folded&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;this is test word I AM LAZY BOY&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-3-3-使用组合即时创建分析器"><a href="#7-3-3-使用组合即时创建分析器" class="headerlink" title="7.3.3 使用组合即时创建分析器"></a>7.3.3 使用组合即时创建分析器</h3><h4 id="使用curl方式"><a href="#使用curl方式" class="headerlink" title="使用curl方式"></a>使用curl方式</h4><p>6.x 语法有变，必须放在大括号里面</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST &quot;192.168.92.180:9200&#x2F;_analyze?pretty&quot; -H &#39;Content-Type: application&#x2F;json&#39; -d&#39;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;text&quot;: &quot;The 2 QUICK Brown-Foxes jumped over the lazy dog\u0027s bone.&quot;,</span><br><span class="line"></span><br><span class="line"> &quot;filter&quot;: [&quot;lowercase&quot;, &quot;reverse&quot;],</span><br><span class="line"></span><br><span class="line">&quot;tokenizer&quot;: &quot;whitespace&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#39;</span><br></pre></td></tr></table></figure><p>此时会发现结果以倒序的方式进行分析</p><h4 id="使用kibana方式"><a href="#使用kibana方式" class="headerlink" title="使用kibana方式"></a>使用kibana方式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;my_index&#x2F;_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;whitespace&quot;, </span><br><span class="line">  &quot;filter&quot;: [</span><br><span class="line">    &quot;reverse&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;text&quot;: &quot;The 2 QUICK Brown-Foxes jumped over the lazy dog\u0027s bone.&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>大同小异，如果结果没有反转，可能是解析的过程中有其他干扰因素</p><h3 id="7-3-4-使用基于某个字段的映射分析"><a href="#7-3-4-使用基于某个字段的映射分析" class="headerlink" title="7.3.4 使用基于某个字段的映射分析"></a>7.3.4 使用基于某个字段的映射分析</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;mymyindex&#x2F;_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;whitespace&quot;, </span><br><span class="line">  &quot;filter&quot;: [</span><br><span class="line">    &quot;reverse&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;text&quot;: &quot;The 2 QUICK Brown-Foxes jumped over the lazy dog\u0027s bone.&quot;,</span><br><span class="line">  &quot;field&quot;: &quot;my_text&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>前提条件是必须是存在索引的字段才能进行映射分析</p><h3 id="7-3-5-使用词条向量API来学习索引词条"><a href="#7-3-5-使用词条向量API来学习索引词条" class="headerlink" title="7.3.5 使用词条向量API来学习索引词条"></a>7.3.5 使用词条向量API来学习索引词条</h3><p>使用_termvector 的端点来获取词条的更多信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;get-together&#x2F;group&#x2F;3q8nz20BXNiyabSjyH-c&#x2F;_termvectors</span><br></pre></td></tr></table></figure><p>虽然可以使用，但是内容已经被官方改动，无法查看词条索引</p><h2 id="7-4-分析器-分词器和分词过滤器"><a href="#7-4-分析器-分词器和分词过滤器" class="headerlink" title="7.4 分析器/分词器和分词过滤器"></a>7.4 分析器/分词器和分词过滤器</h2><h3 id="7-4-0-分析器的概览"><a href="#7-4-0-分析器的概览" class="headerlink" title="7.4.0 分析器的概览"></a>7.4.0 分析器的概览</h3><ul><li>输入文本</li><li>分析器<ul><li>字符过滤器</li><li>分词器</li><li>分词过滤器</li></ul></li><li>输出分词</li></ul><h3 id="7-4-1-内置分析器"><a href="#7-4-1-内置分析器" class="headerlink" title="7.4.1 内置分析器"></a>7.4.1 内置分析器</h3><p><strong>Standard Analyzer</strong></p><p>The <code>standard</code> analyzer divides text into terms on word boundaries, as defined by the Unicode Text Segmentation algorithm. It removes most punctuation, lowercases terms, and supports removing stop words.</p><p><strong>Simple Analyzer</strong></p><p>The <code>simple</code> analyzer divides text into terms whenever it encounters a character which is not a letter. It lowercases all terms.</p><p><strong>Whitespace Analyzer</strong></p><p>The <code>whitespace</code> analyzer divides text into terms whenever it encounters any whitespace character. It does not lowercase terms.</p><p><strong>Stop Analyzer</strong></p><p>The <code>stop</code> analyzer is like the <code>simple</code> analyzer, but also supports removal of stop words.</p><p><strong>Keyword Analyzer</strong></p><p>The <code>keyword</code> analyzer is a “noop” analyzer that accepts whatever text it is given and outputs the exact same text as a single term.</p><p><strong>Pattern Analyzer</strong></p><p>The <code>pattern</code> analyzer uses a regular expression to split the text into terms. It supports lower-casing and stop words.</p><p><strong>Language Analyzers</strong></p><p>Elasticsearch provides many language-specific analyzers like <code>english</code> or <code>french</code>.</p><p><strong>Fingerprint Analyzer</strong></p><p>The <code>fingerprint</code> analyzer is a specialist analyzer which creates a fingerprint which can be used for duplicate detection.</p><p><strong>谷歌翻译之后</strong></p><h4 id="标准分析器"><a href="#标准分析器" class="headerlink" title="标准分析器"></a>标准分析器</h4><p>“标准”分析器根据Unicode文本分段算法的定义，将文本划分为单词边界上的各个术语。它删除大多数标点符号，小写术语，并支持删除停用词。</p><h4 id="简单分析器"><a href="#简单分析器" class="headerlink" title="简单分析器"></a><strong>简单分析器</strong></h4><p>“简单”分析器在遇到非字母字符时会将文本划分为多个词。它小写所有术语。</p><p>只使用小写转化为分词器，注意不适用于亚洲的语言，在欧美这种单词划分的语言适用</p><h4 id="空白分析器"><a href="#空白分析器" class="headerlink" title="空白分析器"></a><strong>空白分析器</strong></h4><p>每当遇到任何空白字符时，“空白”分析器都会将文本划分为多个词。它不小写。</p><h4 id="停止分析器"><a href="#停止分析器" class="headerlink" title="停止分析器"></a><strong>停止分析器</strong></h4><p>“停止”分析器类似于“简单”分析器，但也支持删除停用词。</p><h4 id="关键字分析器"><a href="#关键字分析器" class="headerlink" title="关键字分析器"></a><strong>关键字分析器</strong></h4><p>“关键字”分析器是一个“空”分析器，它接受给出的任何文本，并输出与单个术语完全相同的文本。</p><h4 id="模式分析器"><a href="#模式分析器" class="headerlink" title="模式分析器"></a><strong>模式分析器</strong></h4><p>“模式”分析器使用正则表达式将文本分割为多个词。它支持小写字母和停用词。</p><h4 id="语言分析器"><a href="#语言分析器" class="headerlink" title="语言分析器"></a><strong>语言分析器</strong></h4><p>Elasticsearch提供了许多特定于语言的分析器，例如“ english”或“ french”。</p><h4 id="指纹分析器"><a href="#指纹分析器" class="headerlink" title="指纹分析器"></a><strong>指纹分析器</strong></h4><p>“指纹”分析仪是一种专业分析仪，可创建可用于重复检测的指纹。</p><h4 id="雪球分析器"><a href="#雪球分析器" class="headerlink" title="雪球分析器"></a>雪球分析器</h4><p>除了使用标准分词器和标准分词过滤器，也使用了小写分词过滤器以及停用词过滤器，还使用雪球词干进行词干提取</p><h3 id="7-4-2-分词器"><a href="#7-4-2-分词器" class="headerlink" title="7.4.2 分词器"></a>7.4.2 分词器</h3><p><strong>Standard Tokenizer</strong></p><p>The <code>standard</code> tokenizer divides text into terms on word boundaries, as defined by the Unicode Text Segmentation algorithm. It removes most punctuation symbols. It is the best choice for most languages.</p><p><strong>Letter Tokenizer</strong></p><p>The <code>letter</code> tokenizer divides text into terms whenever it encounters a character which is not a letter.</p><p><strong>Lowercase Tokenizer</strong></p><p>The <code>lowercase</code> tokenizer, like the <code>letter</code> tokenizer, divides text into terms whenever it encounters a character which is not a letter, but it also lowercases all terms.</p><p><strong>Whitespace Tokenizer</strong></p><p>The <code>whitespace</code> tokenizer divides text into terms whenever it encounters any whitespace character.</p><p><strong>UAX URL Email Tokenizer</strong></p><p>The <code>uax_url_email</code> tokenizer is like the <code>standard</code> tokenizer except that it recognises URLs and email addresses as single tokens.</p><p><strong>Classic Tokenizer</strong></p><p>The <code>classic</code> tokenizer is a grammar based tokenizer for the English Language.</p><p><strong>Thai Tokenizer</strong></p><p>The <code>thai</code> tokenizer segments Thai text into words.</p><p><strong>谷歌翻译之后</strong></p><h4 id="标准分词器"><a href="#标准分词器" class="headerlink" title="标准分词器"></a><strong>标准分词器</strong></h4><p>标准分词器将文本划分为单词边界上的术语，这由Unicode文本分段算法定义。 它删除大多数标点符号。 这是大多数语言的最佳选择。 注意标点符号回进行过滤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;lib&#x2F;_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;standard&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;I have, photos&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置：</p><table><thead><tr><th><code>max_token_length</code></th><th>The maximum token length. If a token is seen that exceeds this length then it is split at <code>max_token_length</code> intervals. Defaults to <code>255</code>.</th></tr></thead><tbody><tr><td>最大分词数</td><td>允许设置最大分次数，如果分词长度超过最大分词数，将会进行切割作为下一个分词。默认为255</td></tr></tbody></table><h4 id="字母分词器"><a href="#字母分词器" class="headerlink" title="字母分词器"></a><strong>字母分词器</strong></h4><p>字母分词器在遇到非字母字符时会将文本分为多个术语</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;lib&#x2F;_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;letter&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;The 2 QUICK Brown-Foxes jumped over the lazy dog&#39;s bone&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ The, QUICK, Brown, Foxes, jumped, over, the, lazy, dog, s, bone ]</span><br></pre></td></tr></table></figure><p>该<code>letter</code>分词器是不可配置</p><h4 id="小写分词器"><a href="#小写分词器" class="headerlink" title="小写分词器"></a><strong>小写分词器</strong></h4><p>小写分词器与字母分词器一样，在遇到非字母的字符时，会将文本分为多个词，但所有词都小写。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;lowercase&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;The 2 QUICK Brown-Foxes jumped over the lazy dog&#39;s bone.&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>该<code>letter</code>分词器是不可配置</p><h4 id="空格分词器"><a href="#空格分词器" class="headerlink" title="空格分词器"></a><strong>空格分词器</strong></h4><p>每当遇到任何空白字符时，空白令牌生成器都会将文本划分为多个术语。(但是不会对大小写进行转化，只判断空白字符)</p><p>配置：</p><table><thead><tr><th><code>max_token_length</code></th><th>The maximum token length. If a token is seen that exceeds this length then it is split at <code>max_token_length</code> intervals. Defaults to <code>255</code>.</th></tr></thead><tbody><tr><td>最大分词数</td><td>允许设置最大分次数，如果分词长度超过最大分词数，将会进行切割作为下一个分词。默认为255</td></tr></tbody></table><h4 id="UAX-URL电子邮件令牌生成器"><a href="#UAX-URL电子邮件令牌生成器" class="headerlink" title="UAX URL电子邮件令牌生成器"></a>UAX URL电子邮件令牌生成器</h4><p><strong>uax_url_email</strong> 分词器类似于标准令牌生成器，不同之处在于它将URL和电子邮件地址识别为单个分词。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;uax_url_email&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;Email me at john.smith@global-international.com&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意分词出来的email类型为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;token&quot;: &quot;john.smith@global-international.com&quot;,</span><br><span class="line">    &quot;start_offset&quot;: 12,</span><br><span class="line">    &quot;end_offset&quot;: 47,</span><br><span class="line">    &quot;type&quot;: &quot;&lt;EMAIL&gt;&quot;,</span><br><span class="line">    &quot;position&quot;: 3</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置</p><table><thead><tr><th><code>max_token_length</code></th><th>The maximum token length. If a token is seen that exceeds this length then it is split at <code>max_token_length</code> intervals. Defaults to <code>255</code>.</th></tr></thead><tbody><tr><td>最大分词数</td><td>允许设置最大分次数，如果分词长度超过最大分词数，将会进行切割作为下一个分词。默认为255</td></tr></tbody></table><h4 id="经典分词器"><a href="#经典分词器" class="headerlink" title="经典分词器"></a>经典分词器</h4><p>经典的分词器是用于英语的基于语法的分词器。</p><blockquote><p>可以说是为英语而生的分词器. 这个分词器对于英文的首字符缩写、 公司名字、 email 、 大部分网站域名.都能很好的解决。 但是, 对于除了英语之外的其他语言，都不是很好使。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;classic&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;The 2 QUICK Brown-Foxes jumped over the lazy dog&#39;s bone.&quot;</span><br><span class="line">&#125;</span><br><span class="line">[ The, 2, QUICK, Brown, Foxes, jumped, over, the, lazy, dog&#39;s, bone ]</span><br></pre></td></tr></table></figure><p>下面是官方文档谷歌翻译</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">该&#96;classic&#96;标记生成器是一种基于语法标记生成器是好的英语语言文档。该令牌生成器具有试探法，可对首字母缩写词，公司名称，电子邮件地址和互联网主机名进行特殊处理。但是，这些规则并不总是有效，并且分词器不适用于英语以外的大多数其他语言：</span><br><span class="line"></span><br><span class="line">- 它最多将标点符号拆分为单词，删除标点符号。但是，不带空格的点被认为是令牌的一部分。</span><br><span class="line">- 除非令牌中没有数字，否则它将使用连字符对单词进行拆分，在这种情况下，整个令牌将被解释为产品编号，并且不会拆分。</span><br><span class="line">- 它将电子邮件地址和互联网主机名识别为一个令牌。</span><br></pre></td></tr></table></figure><p>配置：</p><table><thead><tr><th><code>max_token_length</code></th><th>The maximum token length. If a token is seen that exceeds this length then it is split at <code>max_token_length</code> intervals. Defaults to <code>255</code>.</th></tr></thead><tbody><tr><td>最大分词数</td><td>允许设置最大分次数，如果分词长度超过最大分词数，将会进行切割作为下一个分词。默认为255</td></tr></tbody></table><h4 id="泰语分词器"><a href="#泰语分词器" class="headerlink" title="泰语分词器"></a>泰语分词器</h4><p>泰语分词器将泰语文本分成单词。</p><h3 id="7-4-3-分词过滤器"><a href="#7-4-3-分词过滤器" class="headerlink" title="7.4.3 分词过滤器"></a>7.4.3 分词过滤器</h3><p>官方定义了大概20多种分词过滤，涵盖内容较多，以官方6.2.4文档为准</p><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.4/analysis-tokenfilters.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/6.4/analysis-tokenfilters.html</a></p><h4 id="标准分词过滤器"><a href="#标准分词过滤器" class="headerlink" title="标准分词过滤器"></a>标准分词过滤器</h4><p>不要以为有多牛逼，其实什么事情都没有干。在以后的版本中有可能扩展功能。只是单纯占位符</p><h4 id="ASCII-Folding-Token-Filter（ASCII折叠过滤器）"><a href="#ASCII-Folding-Token-Filter（ASCII折叠过滤器）" class="headerlink" title="ASCII Folding Token Filter（ASCII折叠过滤器）"></a>ASCII Folding Token Filter（ASCII折叠过滤器）</h4><p>官网翻译介绍：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">类型为asciifolding的分词过滤器，用于将前127个ASCII字符（“基本拉丁” Unicode块）中不存在的字母，数字和符号Unicode字符转换为等效的ASCII字符。 例：</span><br><span class="line">PUT &#x2F;asciifold_example</span><br><span class="line">&#123;</span><br><span class="line">    &quot;settings&quot; : &#123;</span><br><span class="line">        &quot;analysis&quot; : &#123;</span><br><span class="line">            &quot;analyzer&quot; : &#123;</span><br><span class="line">                &quot;default&quot; : &#123;</span><br><span class="line">                    &quot;tokenizer&quot; : &quot;standard&quot;,</span><br><span class="line">                    &quot;filter&quot; : [&quot;standard&quot;, &quot;asciifolding&quot;]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>允许进行如下配置：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;asciifold_example</span><br><span class="line">&#123;</span><br><span class="line">    &quot;settings&quot; : &#123;</span><br><span class="line">        &quot;analysis&quot; : &#123;</span><br><span class="line">            &quot;analyzer&quot; : &#123;</span><br><span class="line">                &quot;default&quot; : &#123;</span><br><span class="line">                    &quot;tokenizer&quot; : &quot;standard&quot;,</span><br><span class="line">                    &quot;filter&quot; : [&quot;standard&quot;, &quot;my_ascii_folding&quot;]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;filter&quot; : &#123;</span><br><span class="line">                &quot;my_ascii_folding&quot; : &#123;</span><br><span class="line">                    &quot;type&quot; : &quot;asciifolding&quot;,</span><br><span class="line">                    &quot;preserve_original&quot; : true --默认为false</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>翻译版</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preserve_original： 接受默认值为false的preserve_original设置，但如果为true，则将保留原始令牌并发出折叠后的令牌</span><br></pre></td></tr></table></figure><h4 id="Flatten-Graph-Token-Filter（图形分词过滤器）"><a href="#Flatten-Graph-Token-Filter（图形分词过滤器）" class="headerlink" title="Flatten Graph Token Filter（图形分词过滤器）"></a>Flatten Graph Token Filter（图形分词过滤器）</h4><blockquote><p>注意：此功能在Lucene中被标记为实验性的</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flatten_graph令牌过滤器接受任意图形令牌流，例如“同义词图形令牌过滤器”生成的图形令牌流，并将其展平为适合索引的单个线性令牌链。</span><br><span class="line"></span><br><span class="line">这是一个有损耗的过程，因为单独的边路径相互挤压，但是在索引过程中使用图形令牌流时是必需的，因为Lucene索引当前无法表示图形。 因此，最好仅在搜索时应用图形分析器，因为这样可以保留完整的图形结构并为接近查询提供正确的匹配项。</span><br><span class="line"></span><br><span class="line">有关此主题及其复杂性的更多信息，请阅读Lucene的TokenStreams实际上是图博客文章。</span><br></pre></td></tr></table></figure><h4 id="Length-Token-Filter（长度分词过滤器）"><a href="#Length-Token-Filter（长度分词过滤器）" class="headerlink" title="Length Token Filter（长度分词过滤器）"></a>Length Token Filter（长度分词过滤器）</h4><p>将超出最短和最长限制范围的单词过滤掉，如min=2，max=8，不在此范围的单词都会进行过滤</p><p>配置项如下</p><table><thead><tr><th><code>min</code></th><th>The minimum number. Defaults to <code>0</code>.</th></tr></thead><tbody><tr><td><strong>max</strong></td><td><strong>The maximum number. Defaults to <code>Integer.MAX_VALUE</code>, which is <code>2^31-1</code> or 2147483647.</strong></td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;length-filter</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;analysis&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;myfilter&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;length&quot;,</span><br><span class="line">          &quot;max&quot;: 8,</span><br><span class="line">          &quot;min&quot;: 2</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, </span><br><span class="line">      &quot;analyzer&quot;: &#123;</span><br><span class="line">        &quot;defulat&quot;: &#123;</span><br><span class="line">          &quot;tokenizer&quot;: &quot;standard&quot;,</span><br><span class="line">          &quot;filter&quot;: [&quot;standard&quot;, &quot;myfilter&quot;]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;acknowledged&quot;: true,</span><br><span class="line">  &quot;shards_acknowledged&quot;: true,</span><br><span class="line">  &quot;index&quot;: &quot;length-filter&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Lowercase-token-filter（小写分词过滤器）"><a href="#Lowercase-token-filter（小写分词过滤器）" class="headerlink" title="Lowercase token filter（小写分词过滤器）"></a>Lowercase token filter（小写分词过滤器）</h4><p>可以讲任何经过的分词变成小写</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;lowercase_example</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;analysis&quot;: &#123;</span><br><span class="line">      &quot;analyzer&quot;: &#123;</span><br><span class="line">        &quot;standard_lowercase_example&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;custom&quot;,</span><br><span class="line">          &quot;tokenizer&quot;: &quot;standard&quot;,</span><br><span class="line">          &quot;filter&quot;: [&quot;lowercase&quot;]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;greek_lowercase_example&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;custom&quot;,</span><br><span class="line">          &quot;tokenizer&quot;: &quot;standard&quot;,</span><br><span class="line">          &quot;filter&quot;: [&quot;greek_lowercase&quot;]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;greek_lowercase&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;lowercase&quot;,</span><br><span class="line">          &quot;language&quot;: &quot;greek&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Uppercase-Token-Filter（大写分词过滤器）"><a href="#Uppercase-Token-Filter（大写分词过滤器）" class="headerlink" title="Uppercase Token Filter（大写分词过滤器）"></a>Uppercase Token Filter（大写分词过滤器）</h4><p>讲所有经过的分词转大写</p><h4 id="NGram-Token-Filter（N元语法过滤器）"><a href="#NGram-Token-Filter（N元语法过滤器）" class="headerlink" title="NGram Token Filter（N元语法过滤器）"></a>NGram Token Filter（N元语法过滤器）</h4><table><thead><tr><th>Setting</th><th>Description</th></tr></thead><tbody><tr><td><code>min_gram</code></td><td>Defaults to <code>1</code>.</td></tr><tr><td><code>max_gram</code></td><td>Defaults to <code>2</code>.</td></tr></tbody></table><p>索引级别设置index.max_ngram_diff控制max_gram和min_gram之间的最大允许差异。</p><p>N元语法过滤器即：</p><p>控制被切分单词的数量</p><p>举例：</p><blockquote><ol><li><strong>1-grams</strong>:一元语法过滤器</li></ol><p>以：＂spaghetti＂为例：</p><p>ｓ　ｐ　ａ　ｇ　ｈ　ｅ　ｔ　ｔ　ｉ</p><ol><li><p>二元语法过滤器</p><p>将会拆分为: sp，pa，ag，gh，he，et，tt，ti</p></li><li><p>三元语法过滤器</p><p>将会拆分为：spa，pag，agh，ghe，het，ett，tti</p></li></ol></blockquote><h4 id="Edge-NGram-Token-Filter（侧边N元语法过滤器）"><a href="#Edge-NGram-Token-Filter（侧边N元语法过滤器）" class="headerlink" title="Edge NGram Token Filter（侧边N元语法过滤器）"></a>Edge NGram Token Filter（侧边N元语法过滤器）</h4><table><thead><tr><th>Setting</th><th>Description</th></tr></thead><tbody><tr><td><code>min_gram</code></td><td>Defaults to <code>1</code>.</td></tr><tr><td><code>max_gram</code></td><td>Defaults to <code>2</code>.</td></tr><tr><td><code>side</code></td><td>deprecated. Either <code>front</code> or <code>back</code>. Defaults to <code>front</code>.</td></tr></tbody></table><p>为N元语法的变体：</p><p>仅仅从边缘构建N元语法</p><p>如:min = 2 ,max = 6</p><p>“spaghetti” 将会切分为： sp spa spag spagh spaghe</p><h3 id="7-4-4-N元语法的使用场景以及使用案例"><a href="#7-4-4-N元语法的使用场景以及使用案例" class="headerlink" title="7.4.4 N元语法的使用场景以及使用案例"></a>7.4.4 N元语法的使用场景以及使用案例</h3><p>N元语法过滤器主要是可以用于处理因为的错误单词拼写，将单词进行切分组合，匹配相同的部分，这能保证即使错误的书写依然可以进行正确的匹配，但是中文的拼写修改有待进一步学习</p><p>当不知道是什么语言的时候，N元语法是一种很好的文本分析方式：</p><p>可以分析单词之间没有空格的单词！！！</p><p>指定依然靠min和max这两个重要参数</p><h4 id="使用案例"><a href="#使用案例" class="headerlink" title="使用案例:"></a>使用案例:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;n-gram-filter</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;analysis&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;myfilter&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;ngram&quot;,</span><br><span class="line">          &quot;min_gram&quot;: 2,</span><br><span class="line">          &quot;max_gram&quot;: 6</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, </span><br><span class="line">      &quot;analyzer&quot;: &#123;</span><br><span class="line">        &quot;defulat&quot;: &#123;</span><br><span class="line">          &quot;tokenizer&quot;: &quot;standard&quot;,</span><br><span class="line">          &quot;filter&quot;: [&quot;standard&quot;, &quot;myfilter&quot;]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果：会出现一个报错提示官方已经弃用这两个参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Deprecation: Deprecated big difference between max_gram and min_gram in NGram Tokenizer,expected difference must be less than or equal to: [1]</span><br></pre></td></tr></table></figure><p>有关该问题的社区讨论</p><p><a href="https://discuss.elastic.co/t/deprecation-deprecated-big-difference-between-max-gram-and-min-gram-in-ngram/122969" target="_blank" rel="noopener">https://discuss.elastic.co/t/deprecation-deprecated-big-difference-between-max-gram-and-min-gram-in-ngram/122969</a></p><h4 id="Shingle-Token-Filter（滑动窗口分词过滤器）"><a href="#Shingle-Token-Filter（滑动窗口分词过滤器）" class="headerlink" title="Shingle Token Filter（滑动窗口分词过滤器）"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.4/analysis-shingle-tokenfilter.html" target="_blank" rel="noopener">Shingle Token Filter</a>（滑动窗口分词过滤器）</h4><h2 id="7-5-提取词干"><a href="#7-5-提取词干" class="headerlink" title="7.5 提取词干"></a>7.5 提取词干</h2><h3 id="7-5-1-算分提取词干"><a href="#7-5-1-算分提取词干" class="headerlink" title="7.5.1 算分提取词干"></a>7.5.1 算分提取词干</h3><p>es提供三种算法词干：</p><ol><li>snowball 过滤器</li><li>porter stem 过滤器</li><li>kstem 过滤器</li></ol><h4 id="选取kstem-作为案例测试"><a href="#选取kstem-作为案例测试" class="headerlink" title="选取kstem 作为案例测试"></a>选取kstem 作为案例测试</h4><h3 id="7-5-2-使用字典提取词干"><a href="#7-5-2-使用字典提取词干" class="headerlink" title="7.5.2 使用字典提取词干"></a>7.5.2 使用字典提取词干</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">DELETE &#x2F;kstem-filter</span><br><span class="line"></span><br><span class="line">PUT &#x2F;kstem-filter</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;analysis&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;myfilter&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;kstem&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, </span><br><span class="line">      &quot;analyzer&quot;: &#123;</span><br><span class="line">        &quot;defulat&quot;: &#123;</span><br><span class="line">          &quot;tokenizer&quot;: &quot;standard&quot;,</span><br><span class="line">          &quot;filter&quot;: [&quot;lowercase&quot;, &quot;myfilter&quot;]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET kstem-filter&#x2F;_settings</span><br></pre></td></tr></table></figure><h1 id="8-使用相关性进行搜索"><a href="#8-使用相关性进行搜索" class="headerlink" title="8. 使用相关性进行搜索"></a>8. 使用相关性进行搜索</h1><h2 id="8-1-es-的打分机制"><a href="#8-1-es-的打分机制" class="headerlink" title="8.1 es 的打分机制"></a>8.1 es 的打分机制</h2><h3 id="8-1-1-文档是如何运作的："><a href="#8-1-1-文档是如何运作的：" class="headerlink" title="8.1.1 文档是如何运作的："></a>8.1.1 文档是如何运作的：</h3><p>默认使用的是<strong>词频-逆文档</strong>（TF-IDF）词频</p><p>TF：词频</p><p>IDF：逆文档频率</p><h3 id="8-1-2-词频"><a href="#8-1-2-词频" class="headerlink" title="8.1.2 词频"></a>8.1.2 词频</h3><p>词条在文本当中出现的次数</p><h3 id="8-1-3-逆文档词频"><a href="#8-1-3-逆文档词频" class="headerlink" title="8.1.3 逆文档词频"></a>8.1.3 逆文档词频</h3><p>如果一个分词在索引的不同文档中出现的次数越多， 就越<strong>不重要</strong></p><blockquote><ul><li>文档频率的逆源自得分乘以 1/DF , DF是文档频率。意味着越高频率得分就会越低</li><li>逆文档频率只关心“是否”</li></ul></blockquote><h3 id="8-1-4-Lucene-评分公式"><a href="#8-1-4-Lucene-评分公式" class="headerlink" title="8.1.4 Lucene 评分公式"></a>8.1.4 Lucene 评分公式</h3><ul><li>词频</li><li>逆文档频率</li><li>调和因子<ul><li>搜索过多少文档以及发现多少词条</li></ul></li><li>查询标准化<ul><li>试图让不同的查询结果具有可比性</li></ul></li></ul><h2 id="8-2-其他打分方式"><a href="#8-2-其他打分方式" class="headerlink" title="8.2 其他打分方式"></a>8.2 其他打分方式</h2><ul><li>Okapi BM25</li><li>随机性分歧，DFR相似度</li><li>基于信息，IB相似度</li><li>LM Dirichlet 相似度</li><li>LM Jelinek Mercer 相似度</li></ul><h3 id="如何指定索引的打分方式？"><a href="#如何指定索引的打分方式？" class="headerlink" title="如何指定索引的打分方式？"></a>如何指定索引的打分方式？</h3><ul><li><p>修改字段映射的similarity 参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;take_score</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;number_of_shards&quot;: 2,</span><br><span class="line">    &quot;number_of_replicas&quot;: 1</span><br><span class="line">  &#125;, </span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;mytype&quot;:&#123;</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;title&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">          &quot;similarity&quot;: &quot;defualt&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line">PUT &#x2F;like</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;get-together&quot;:&#123;</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;tilte&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">          &quot;similarity&quot;: &quot;BM25&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在settings 中扩展，为某个索引设置打分算法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;dislike</span><br><span class="line">&#123;</span><br><span class="line">&quot;settings&quot;: &#123;</span><br><span class="line">    &quot;similarity&quot;: &#123;</span><br><span class="line">      &quot;my_custom&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;BM25&quot;,</span><br><span class="line">        &quot;k1&quot;: 1.2,</span><br><span class="line">        &quot;b&quot;: 0.75,</span><br><span class="line">        &quot;discount_overlaps&quot;: false</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">GET &#x2F;dislike&#x2F;_settings</span><br></pre></td></tr></table></figure><blockquote><p>重要改变：6.0以后官方已不提倡使用TF-IDF，因为该评分方式已经不适用与当今时代的实际需要，官方推荐使用BM25，并且建议7.0 以后的版本移除TF-IDF算法的所有内容，所以TF-IDF这种打分机制只做了解即可</p></blockquote></li></ul><h2 id="8-3-索引期间Boosting"><a href="#8-3-索引期间Boosting" class="headerlink" title="8.3 索引期间Boosting"></a>8.3 索引期间Boosting</h2><p>不推荐在创建索引的时候使用Boosting, 而是在查询的时候,原因如下</p><ul><li>缺少灵活性</li><li>以低精度的数值在Lucene 的内部索引结构当中，只有一个字节存储，可能丢失精度</li><li>boost 是运用于一个词条，配上多个词条，就意味着多次的boost， 进一步增加权重</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;my-gettogether</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;groups&quot;: &#123;</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;name&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">          &quot;boost&quot;: 2.0</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">GET &#x2F;my-gettogether&#x2F;_mapping</span><br></pre></td></tr></table></figure><h2 id="8-4-查询期间的Boosting"><a href="#8-4-查询期间的Boosting" class="headerlink" title="8.4 查询期间的Boosting"></a>8.4 查询期间的Boosting</h2><ul><li>match、multi_match、simple_query_string、query_string</li><li>funcation_score (更为精确)</li></ul><p>使用match 查询进行boosting</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;lib&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;should&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;about&quot;: &#123;</span><br><span class="line">              &quot;query&quot;: &quot;i hide&quot;,</span><br><span class="line">              &quot;boost&quot;: 2.5</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;last_name&quot;: &#123;</span><br><span class="line">              &quot;query&quot;: &quot;Simith&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第一个match 将会比第二个match 查询有更大的影响力</p><h3 id="8-4-1-跨越多个字段的查询"><a href="#8-4-1-跨越多个字段的查询" class="headerlink" title="8.4.1 跨越多个字段的查询"></a>8.4.1 跨越多个字段的查询</h3><h3 id="8-4-2-使用multi-match-查询，指定整个Boost"><a href="#8-4-2-使用multi-match-查询，指定整个Boost" class="headerlink" title="8.4.2 使用multi_match 查询，指定整个Boost"></a>8.4.2 使用multi_match 查询，指定整个Boost</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;lib&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;smit wang&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;first_name&quot;, &quot;last_name&quot;],</span><br><span class="line">      &quot;boost&quot;: 2.5</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-4-3-使用特殊符号-对于name-进行boost"><a href="#8-4-3-使用特殊符号-对于name-进行boost" class="headerlink" title="8.4.3 使用特殊符号^对于name 进行boost"></a>8.4.3 使用特殊符号^对于name 进行boost</h3><p>使用3倍boost 修改某个字段查询的Boost</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;myindex&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;long&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;name^3&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-4-4-query-string-中对于针对单个的词条进行boost"><a href="#8-4-4-query-string-中对于针对单个的词条进行boost" class="headerlink" title="8.4.4 query_string 中对于针对单个的词条进行boost"></a>8.4.4 query_string 中对于针对单个的词条进行boost</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST myindex&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;query_string&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;lixiao* OR *long^3&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>一个字段被boost 4 倍，并不是意味着得分会乘以4，所以得分不是按照严格的乘法</p><h2 id="8-5-使用”解释-explain-”来理解文档评分"><a href="#8-5-使用”解释-explain-”来理解文档评分" class="headerlink" title="8.5 使用”解释(explain)”来理解文档评分"></a>8.5 使用”解释(explain)”来理解文档评分</h2><ul><li>请求体 expliane = true 告诉es 运行解释操作</li><li>Url指定_explain</li></ul><p>下面为请求体重设置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST myindex&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;query_string&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;lixiao* OR *long^3&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;explain&quot;: true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果，内容较为庞大，不过应该不是很难懂</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;took&quot;: 58,</span><br><span class="line">  &quot;timed_out&quot;: false,</span><br><span class="line">  &quot;_shards&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 5,</span><br><span class="line">    &quot;successful&quot;: 5,</span><br><span class="line">    &quot;skipped&quot;: 0,</span><br><span class="line">    &quot;failed&quot;: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 3,</span><br><span class="line">    &quot;max_score&quot;: 4,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_shard&quot;: &quot;[myindex][2]&quot;,</span><br><span class="line">        &quot;_node&quot;: &quot;Q58S9K26RxqIiVA-UQNrgg&quot;,</span><br><span class="line">        &quot;_index&quot;: &quot;myindex&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;test&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;Fbggy20B5sayAd6PVrE2&quot;,</span><br><span class="line">        &quot;_score&quot;: 4,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;name&quot;: &quot;lixiaolong&quot;,</span><br><span class="line">          &quot;age&quot;: 5,</span><br><span class="line">          &quot;birthday&quot;: &quot;2019-05-04&quot;,</span><br><span class="line">          &quot;test_field&quot;: &quot;zzzzzz&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;_explanation&quot;: &#123;</span><br><span class="line">          &quot;value&quot;: 4, # 最后得分</span><br><span class="line">          &quot;description&quot;: &quot;sum of:&quot;,</span><br><span class="line">          &quot;details&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;value&quot;: 1,</span><br><span class="line">              &quot;description&quot;: &quot;max of:&quot;,</span><br><span class="line">              &quot;details&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                  &quot;value&quot;: 1,</span><br><span class="line">                  &quot;description&quot;: &quot;name:lixiao*&quot;,</span><br><span class="line">                  &quot;details&quot;: []</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                  &quot;value&quot;: 1,</span><br><span class="line">                  &quot;description&quot;: &quot;name.keyword:lixiao*&quot;,</span><br><span class="line">                  &quot;details&quot;: []</span><br><span class="line">                &#125;</span><br><span class="line">              ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;value&quot;: 3,</span><br><span class="line">              &quot;description&quot;: &quot;max of:&quot;,</span><br><span class="line">              &quot;details&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                  &quot;value&quot;: 3,</span><br><span class="line">                  &quot;description&quot;: &quot;name:*long^3.0&quot;,</span><br><span class="line">                  &quot;details&quot;: []</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                  &quot;value&quot;: 3,</span><br><span class="line">                  &quot;description&quot;: &quot;name.keyword:*long^3.0&quot;,</span><br><span class="line">                  &quot;details&quot;: []</span><br><span class="line">                &#125;</span><br><span class="line">              ]</span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_shard&quot;: &quot;[myindex][3]&quot;,</span><br><span class="line">        &quot;_node&quot;: &quot;Q58S9K26RxqIiVA-UQNrgg&quot;,</span><br><span class="line">        &quot;_index&quot;: &quot;myindex&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;test&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot;: 4,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;name&quot;: &quot;lixiaolong&quot;,</span><br><span class="line">          &quot;age&quot;: 55,</span><br><span class="line">          &quot;birthday&quot;: &quot;2019-05-04&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;_explanation&quot;: &#123;</span><br><span class="line">          &quot;value&quot;: 4,</span><br><span class="line">          &quot;description&quot;: &quot;sum of:&quot;,</span><br><span class="line">          &quot;details&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;value&quot;: 1,</span><br><span class="line">              &quot;description&quot;: &quot;max of:&quot;,</span><br><span class="line">              &quot;details&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                  &quot;value&quot;: 1,</span><br><span class="line">                  &quot;description&quot;: &quot;name:lixiao*&quot;,</span><br><span class="line">                  &quot;details&quot;: []</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                  &quot;value&quot;: 1,</span><br><span class="line">                  &quot;description&quot;: &quot;name.keyword:lixiao*&quot;,</span><br><span class="line">                  &quot;details&quot;: []</span><br><span class="line">                &#125;</span><br><span class="line">              ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;value&quot;: 3,</span><br><span class="line">              &quot;description&quot;: &quot;max of:&quot;,</span><br><span class="line">              &quot;details&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                  &quot;value&quot;: 3,</span><br><span class="line">                  &quot;description&quot;: &quot;name:*long^3.0&quot;,</span><br><span class="line">                  &quot;details&quot;: []</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                  &quot;value&quot;: 3,</span><br><span class="line">                  &quot;description&quot;: &quot;name.keyword:*long^3.0&quot;,</span><br><span class="line">                  &quot;details&quot;: []</span><br><span class="line">                &#125;</span><br><span class="line">              ]</span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_shard&quot;: &quot;[myindex][3]&quot;,</span><br><span class="line">        &quot;_node&quot;: &quot;Q58S9K26RxqIiVA-UQNrgg&quot;,</span><br><span class="line">        &quot;_index&quot;: &quot;myindex&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;test&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;FLjrym0B5sayAd6PrrGN&quot;,</span><br><span class="line">        &quot;_score&quot;: 3,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;name&quot;: &quot;CHENLONG&quot;,</span><br><span class="line">          &quot;age&quot;: 15,</span><br><span class="line">          &quot;birthday&quot;: &quot;2011-02-14&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;_explanation&quot;: &#123;</span><br><span class="line">          &quot;value&quot;: 3,</span><br><span class="line">          &quot;description&quot;: &quot;sum of:&quot;,</span><br><span class="line">          &quot;details&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;value&quot;: 3,</span><br><span class="line">              &quot;description&quot;: &quot;max of:&quot;,</span><br><span class="line">              &quot;details&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                  &quot;value&quot;: 3,</span><br><span class="line">                  &quot;description&quot;: &quot;name:*long^3.0&quot;,</span><br><span class="line">                  &quot;details&quot;: []</span><br><span class="line">                &#125;</span><br><span class="line">              ]</span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>从改结果中我们其实可以了解到：</p><p>es 官方的分析内容表示官方其实已经将原有的TF-IDF(词频-逆文档频率)进行移除</p><p>现在默认使用的是BM25</p><p>并无法进行yml配置操作</p></blockquote><h3 id="8-5-1-解释一篇文档不匹配的原因"><a href="#8-5-1-解释一篇文档不匹配的原因" class="headerlink" title="8.5.1 解释一篇文档不匹配的原因"></a>8.5.1 解释一篇文档不匹配的原因</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;myindex&#x2F;test&#x2F;5&#x2F;_explain</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;xiaolong&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8-6-使用查询再打分来减小评分操作影响"><a href="#8-6-使用查询再打分来减小评分操作影响" class="headerlink" title="8.6 使用查询再打分来减小评分操作影响"></a>8.6 使用查询再打分来减小评分操作影响</h2><h3 id="8-6-1-官方文档介绍-6-2版本"><a href="#8-6-1-官方文档介绍-6-2版本" class="headerlink" title="8.6.1 官方文档介绍 6.2版本"></a>8.6.1 官方文档介绍 6.2版本</h3><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-request-rescore.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-request-rescore.html</a></p><ul><li>使用脚本评分</li><li>进行phrase 查询，搜索一段距离内的单词，使用很大的slop值</li></ul><p>使用es的再打分特性，计算返回结果集合的第二轮计算得分</p><h3 id="8-6-2-使用rescore-特性，对于匹配文档子集再评分"><a href="#8-6-2-使用rescore-特性，对于匹配文档子集再评分" class="headerlink" title="8.6.2 使用rescore 特性，对于匹配文档子集再评分"></a>8.6.2 使用rescore 特性，对于匹配文档子集再评分</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;myindex&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;query_string&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;lixiao* OR *long^3&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;rescore&quot;: &#123;</span><br><span class="line">    &quot;window_size&quot;: 20,</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">      &quot;rescore_query&quot;: &#123;</span><br><span class="line">        &quot;match_phrase&quot;:&#123;</span><br><span class="line">          &quot;name&quot;: &#123;</span><br><span class="line">            &quot;query&quot;: &quot;li&quot;,</span><br><span class="line">            &quot;slop&quot;: 5</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;query_weight&quot;: 0.8,</span><br><span class="line">      &quot;rescore_query_weight&quot;: 1.3</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>query_weight：初始查询得分权重</p><p>rescore_query_weight：再评分查询得分权重</p><h2 id="8-7-function-score-来定制得分"><a href="#8-7-function-score-来定制得分" class="headerlink" title="8.7 function_score 来定制得分"></a>8.7 function_score 来定制得分</h2><h3 id="8-7-1-function-score-的基本结构"><a href="#8-7-1-function-score-的基本结构" class="headerlink" title="8.7.1 function_score 的基本结构"></a>8.7.1 function_score 的基本结构</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;myindex&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;function_score&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &#123;</span><br><span class="line">        &quot;match&quot;: &#123;</span><br><span class="line">          &quot;name&quot;: &quot;lixiaolong&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;functions&quot;: [</span><br><span class="line">        </span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-7-2-weight-函数"><a href="#8-7-2-weight-函数" class="headerlink" title="8.7.2 weight 函数"></a>8.7.2 weight 函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;myindex&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;function_score&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &#123;</span><br><span class="line">        &quot;match_phrase&quot;: &#123;</span><br><span class="line">          &quot;name&quot;:&#123;</span><br><span class="line">            &quot;query&quot;: &quot;lixiaolong&quot;,</span><br><span class="line">            &quot;slop&quot;: 5</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;functions&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;weight&quot;: 3</span><br><span class="line">          &quot;filter&quot;: &#123;</span><br><span class="line">            &quot;term&quot;: &#123;</span><br><span class="line">              &quot;age&quot;: 5</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>大致意识是将过滤出age =5 的文档将权重加3倍</p><h4 id="可以指定多个weight函数"><a href="#可以指定多个weight函数" class="headerlink" title="可以指定多个weight函数"></a>可以指定多个weight函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;myindex&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;function_score&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &#123;</span><br><span class="line">        &quot;match_phrase&quot;: &#123;</span><br><span class="line">          &quot;name&quot;:&#123;</span><br><span class="line">            &quot;query&quot;: &quot;lixiaolong&quot;,</span><br><span class="line">            &quot;slop&quot;: 5</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;functions&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;weight&quot;: 1.5,</span><br><span class="line">          &quot;filter&quot;: &#123;</span><br><span class="line">            &quot;term&quot;: &#123;</span><br><span class="line">              &quot;age&quot;: 5</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;weight&quot;: 1.8,</span><br><span class="line">          &quot;filter&quot;: &#123;</span><br><span class="line">            &quot;term&quot;: &#123;</span><br><span class="line">              &quot;test_field&quot;: &quot;zzzzzz&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-7-3-合并得分"><a href="#8-7-3-合并得分" class="headerlink" title="8.7.3 合并得分"></a>8.7.3 合并得分</h3><p>得分合并的两种因素：</p><ul><li>从每个单独的函数而来的分数如何合并，score_mode</li><li>从函数而来的得分如何同原始查询得分合并，boost_mode</li></ul><p>第一个因素称为score_mode 参数， 处理不同函数得分如何合并</p><p>可以设置的参数如下</p><ul><li>multiply</li><li>sum</li><li>avg</li><li>first</li><li>max</li><li>min</li></ul><p>默认是得分相乘 multiply</p><p>如果设置为first,则会优先选择第一个匹配的Boost因子</p><p>第二种得分合并设置，称为boost_mode。控制原始查询的得分和函数得分如何合并</p><p>可以设置的参数如下:</p><ul><li>sum</li><li>avg</li><li>max</li><li>min</li><li>replayce</li></ul><p>默认为初始查询得分和函数得分相乘</p><p>设置为replace 则原有的查询被函数得分替换</p><h3 id="8-7-4-field-value-factor-函数"><a href="#8-7-4-field-value-factor-函数" class="headerlink" title="8.7.4 field_value_factor 函数"></a>8.7.4 field_value_factor 函数</h3><p>该函数将包含数值的字段的名称作为输入，选择性的乘以常熟，然后进行数学运算</p><h3 id="8-7-5-在function-score-查询中使用field-value-factor"><a href="#8-7-5-在function-score-查询中使用field-value-factor" class="headerlink" title="8.7.5 在function_score 查询中使用field_value_factor"></a>8.7.5 在function_score 查询中使用field_value_factor</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;myindex&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;function_score&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &#123;</span><br><span class="line">        &quot;match&quot;: &#123;</span><br><span class="line">          &quot;name&quot;: &quot;lixiaolong&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;functions&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;field_value_factor&quot;: &#123;</span><br><span class="line">            &quot;field&quot;: &quot;age&quot;,</span><br><span class="line">            &quot;factor&quot;: 1.2, </span><br><span class="line">            &quot;modifier&quot;: &quot;ln&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>modifier 可选参数：</p><ul><li>none (默认)</li><li>log</li><li>log1p</li><li>log2p</li><li>ln1p</li><li>ln2p</li><li>square</li><li>sqrt</li><li>reciprocal</li><li>ln</li></ul><h2 id="8-8-painless脚本-5-0后go语言脚本支持已删除"><a href="#8-8-painless脚本-5-0后go语言脚本支持已删除" class="headerlink" title="8.8 painless脚本(5.0后go语言脚本支持已删除)"></a>8.8 painless脚本(5.0后go语言脚本支持已删除)</h2><p>使用一个脚本进行评分</p><p>5.0 之后已经将go语言等脚本移除，使用Lucene官方指定的脚本语言 painless 类js语言</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;myindex&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;function_score&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &#123;</span><br><span class="line">        &quot;term&quot;: &#123;</span><br><span class="line">          &quot;name&quot;: &quot;lixiaolong&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;functions&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;script_score&quot;: &#123;</span><br><span class="line">            &quot;script&quot;: &#123;</span><br><span class="line">              &quot;lang&quot;: &quot;painless&quot;, </span><br><span class="line">              &quot;params&quot;: &#123;</span><br><span class="line">                &quot;mytest&quot;:555</span><br><span class="line">              &#125;, </span><br><span class="line">              &quot;source&quot;: &quot;&quot;&quot;</span><br><span class="line">                int total &#x3D; 0;</span><br><span class="line">                for (int i &#x3D; 0; i &lt; doc[&#39;age&#39;].length; ++i) &#123;</span><br><span class="line">                  total +&#x3D; doc[&#39;age&#39;][i] + params.mytest;</span><br><span class="line">                &#125;</span><br><span class="line">                return total;</span><br><span class="line">              &quot;&quot;&quot;</span><br><span class="line">              </span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果要引用params的值，需要使用params.xxx进行脚本的常量引用</p><h3 id="8-7-5-random-score-函数"><a href="#8-7-5-random-score-函数" class="headerlink" title="8.7.5 random_score 函数"></a>8.7.5 random_score 函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;myindex&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;function_score&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &#123;</span><br><span class="line">        &quot;term&quot;: &#123;</span><br><span class="line">          &quot;name&quot;: &quot;lixiaolong&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;functions&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;random_score&quot;: &#123;</span><br><span class="line">            &quot;seed&quot;: 1234,</span><br><span class="line">            &quot;field&quot;: &quot;age&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>It was possible to set a seed without setting a field, but this has been deprecated as this requires loading fielddata on the <code>_id</code> field which consumes a lot of memory.</p></blockquote><p>注意需要指定field 对于文档字段的排序</p><p>否则会报一个必要参数提示</p><h3 id="8-7-6-衰减函数"><a href="#8-7-6-衰减函数" class="headerlink" title="8.7.6 衰减函数"></a>8.7.6 衰减函数</h3><ul><li>linear</li><li>gauss</li><li>exp</li></ul><h4 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h4><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/query-dsl-function-score-query.html#function-decay" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/6.2/query-dsl-function-score-query.html#function-decay</a></p><p>官方配置案例如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;function_score&quot;: &#123;</span><br><span class="line">            &quot;gauss&quot;: &#123;</span><br><span class="line">                &quot;date&quot;: &#123;</span><br><span class="line">                      &quot;origin&quot;: &quot;2013-09-17&quot;, </span><br><span class="line">                      &quot;scale&quot;: &quot;10d&quot;,</span><br><span class="line">                      &quot;offset&quot;: &quot;5d&quot;, </span><br><span class="line">                      &quot;decay&quot; : 0.5 </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="配置选项"><a href="#配置选项" class="headerlink" title="配置选项"></a>配置选项</h4><ul><li>origin：曲线原点，表示期望值。地理距离，日期或者数值型</li><li>offset：分数开始衰减的位置</li><li>scale 和 decay ：字段值为scale的时候，分数减少到指定的decay</li></ul><p>根据上面分析，从5天开始，到第10天的时候，衰减到原分数的0.5</p><h2 id="8-9-使用脚本排序"><a href="#8-9-使用脚本排序" class="headerlink" title="8.9 使用脚本排序"></a>8.9 使用脚本排序</h2><h1 id="9-Elasticsearch-REST-API-的学习使用"><a href="#9-Elasticsearch-REST-API-的学习使用" class="headerlink" title="9. Elasticsearch REST API 的学习使用"></a>9. Elasticsearch REST API 的学习使用</h1><h2 id="9-0-API官网"><a href="#9-0-API官网" class="headerlink" title="9.0 API官网"></a>9.0 API官网</h2><p>rest 低级 api：<a href="https://artifacts.elastic.co/javadoc/org/elasticsearch/client/elasticsearch-rest-client/6.2.4/org/elasticsearch/client/package-summary.html" target="_blank" rel="noopener">https://artifacts.elastic.co/javadoc/org/elasticsearch/client/elasticsearch-rest-client/6.2.4/org/elasticsearch/client/package-summary.html</a></p><p>rest 高级 api：<a href="https://artifacts.elastic.co/javadoc/org/elasticsearch/client/elasticsearch-rest-high-level-client/6.2.4/index.html" target="_blank" rel="noopener">https://artifacts.elastic.co/javadoc/org/elasticsearch/client/elasticsearch-rest-high-level-client/6.2.4/index.html</a></p><h2 id="9-1-REST-低级-Api"><a href="#9-1-REST-低级-Api" class="headerlink" title="9.1 REST 低级 Api"></a>9.1 REST 低级 Api</h2><p>低级客户端的功能包括：</p><ul><li>最小依赖</li><li>跨所有可用节点进行负载平衡</li><li>发生节点故障并根据特定响应代码进行故障转移</li><li>失败的连接惩罚（是否重试失败的节点取决于失败的连续次数；失败尝试次数越多，客户端在再次尝试该相同节点之前将等待的时间越长）</li><li>持续的联系</li><li>跟踪记录请求和响应</li><li>可选的自动<a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/6.2/sniffer.html" target="_blank" rel="noopener">发现群集节点</a></li></ul><h3 id="9-1-1-起步"><a href="#9-1-1-起步" class="headerlink" title="9.1.1 起步"></a>9.1.1 起步</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.elasticsearch.client&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;elasticsearch-rest-client&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;6.2.4&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure><h3 id="9-1-2-初始化"><a href="#9-1-2-初始化" class="headerlink" title="9.1.2 初始化"></a>9.1.2 初始化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">可以通过相应的RestClientBuilder类（通过RestClient＃builder（HttpHost ...）静态方法创建）来构建RestClient实例。 唯一必需的参数是客户端将与之通信的一个或多个主机，以HttpHost的实例形式提供，如下所示：</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">        RestClientBuilder restClientBuilder &#x3D; RestClient.builder(</span><br><span class="line">                new HttpHost(&quot;192.168.92.180&quot;, 9200, &quot;http&quot;));</span><br><span class="line">        &#x2F;&#x2F; 设置最大超时时间</span><br><span class="line">        restClientBuilder.setMaxRetryTimeoutMillis(10000);</span><br><span class="line">        &#x2F;&#x2F; 监听失效</span><br><span class="line">        restClientBuilder.setFailureListener(new RestClient.FailureListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onFailure(HttpHost host) &#123;</span><br><span class="line">                System.err.println(&quot;连接失效&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        &#x2F;&#x2F; 设置连接的回调内容</span><br><span class="line">        restClientBuilder.setRequestConfigCallback(new RestClientBuilder.RequestConfigCallback() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public RequestConfig.Builder customizeRequestConfig(RequestConfig.Builder builder) &#123;</span><br><span class="line">                System.err.println(&quot;sss&quot;);</span><br><span class="line">                System.err.println(&quot;sss&quot;);</span><br><span class="line">                System.err.println(&quot;sssf&quot;);</span><br><span class="line">                &#x2F;&#x2F; socket套接字连接超时时间</span><br><span class="line">                return builder.setSocketTimeout(10000);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        &#x2F;&#x2F; 设置回调的代理客户端</span><br><span class="line">        restClientBuilder.setHttpClientConfigCallback(new RestClientBuilder.HttpClientConfigCallback() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public HttpAsyncClientBuilder customizeHttpClient(HttpAsyncClientBuilder httpClientBuilder) &#123;</span><br><span class="line">                return httpClientBuilder.setProxy(new HttpHost(&quot;proxy&quot;, 9000, &quot;http&quot;));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        RestClient restClient &#x3D; restClientBuilder.build();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li>RestClient 是线程安全的</li><li>可以再建造器里面设置连接最大超时时间，默认为30秒</li><li>可以设置代理客户端</li><li>可以设置socket套接字超时时间</li></ul><h3 id="9-1-3-执行请求"><a href="#9-1-3-执行请求" class="headerlink" title="9.1.3 执行请求"></a>9.1.3 执行请求</h3><p>一旦<code>RestClient</code>被创建，请求可以通过调用可用的一个被发送<code>performRequest</code>或<code>performRequestAsync</code>方法的变体。这些<code>performRequest</code>方法是同步的，并且<code>Response</code>直接返回，这意味着客户端将阻塞并等待返回响应。该<code>performRequestAsync</code>变种返回<code>void</code>并接受额外的 <code>ResponseListener</code>作为参数来代替，这意味着它们是异步执行的。请求完成或失败时，将通知提供的侦听器。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">        RestClientBuilder restClientBuilder &#x3D; RestClient.builder(</span><br><span class="line">                new HttpHost(&quot;192.168.92.180&quot;, 9200, &quot;http&quot;));</span><br><span class="line">        RestClient restClient &#x3D; restClientBuilder.build();</span><br><span class="line">        &#x2F;&#x2F; 1. 发送一个普通的get请求</span><br><span class="line">&#x2F;&#x2F;        Map&lt;String, String&gt; params &#x3D; Collections.singletonMap(&quot;pretty&quot;, &quot;true&quot;);</span><br><span class="line">&#x2F;&#x2F;        Response response &#x3D; restClient.performRequest(&quot;GET&quot;, &quot;&#x2F;&quot;, params);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 2. 发送一个带参数的请求，并创建一个文档</span><br><span class="line">        Map&lt;Object, Object&gt; singletonMap &#x3D; Collections.emptyMap();</span><br><span class="line">        &#x2F;&#x2F; 请求url参数</span><br><span class="line">        Map&lt;String, String&gt; params &#x3D; Collections.singletonMap(&quot;pretty&quot;, &quot;true&quot;);</span><br><span class="line">        String jsonString &#x3D; &quot;&#123;&quot; +</span><br><span class="line">                &quot;\&quot;user\&quot;:\&quot;kimchy\&quot;,&quot; +</span><br><span class="line">                &quot;\&quot;postDate\&quot;:\&quot;2013-01-30\&quot;,&quot; +</span><br><span class="line">                &quot;\&quot;message\&quot;:\&quot;trying out Elasticsearch\&quot;&quot; +</span><br><span class="line">                &quot;&#125;&quot;;</span><br><span class="line">        &#x2F;&#x2F; 构建http请求体</span><br><span class="line">        HttpEntity entity &#x3D; new NStringEntity(jsonString, ContentType.APPLICATION_JSON);</span><br><span class="line">        &#x2F;&#x2F; 创建一个文档</span><br><span class="line">&#x2F;&#x2F;        Response response &#x3D; restClient.performRequest(&quot;PUT&quot;, &quot;&#x2F;posts&#x2F;doc&#x2F;1&quot;, params, entity);</span><br><span class="line">        &#x2F;&#x2F; 3. 创建一个_search 请求， 并且指定缓冲区的大小</span><br><span class="line">        HttpAsyncResponseConsumerFactory.HeapBufferedResponseConsumerFactory heapBufferedResponseConsumerFactory</span><br><span class="line">                &#x3D; new HttpAsyncResponseConsumerFactory.HeapBufferedResponseConsumerFactory(30 * 1024 * 1024);</span><br><span class="line">        &#x2F;&#x2F; 创建一个响应监听器</span><br><span class="line">        ResponseListener responseListener &#x3D; new ResponseListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onSuccess(Response response) &#123;</span><br><span class="line">                System.err.println(&quot;响应成功&quot;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onFailure(Exception e) &#123;</span><br><span class="line">                System.err.println(&quot;响应失败&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        restClient.performRequestAsync(&quot;GET&quot;, &quot;&#x2F;posts&#x2F;_search&quot;, params, null, heapBufferedResponseConsumerFactory, responseListener);</span><br></pre></td></tr></table></figure><blockquote><p>注意：为HttpEntity指定的ContentType很重要，因为它将用于设置Content-Type标头，以便Elasticsearch可以正确解析内容。</p></blockquote><h3 id="9-1-4-接受响应体的处理"><a href="#9-1-4-接受响应体的处理" class="headerlink" title="9.1.4 接受响应体的处理"></a>9.1.4 接受响应体的处理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Response response &#x3D; restClient.performRequest(&quot;PUT&quot;, &quot;&#x2F;posts&#x2F;doc&#x2F;1&quot;, params, entity);</span><br><span class="line">RequestLine requestLine &#x3D; response.getRequestLine();</span><br><span class="line">HttpHost host &#x3D; response.getHost();</span><br><span class="line">int statusCode &#x3D; response.getStatusLine().getStatusCode();</span><br><span class="line">Header[] headers &#x3D; response.getHeaders();</span><br><span class="line">String responseBody &#x3D; EntityUtils.toString(response.getEntity());</span><br><span class="line"></span><br><span class="line">System.err.println(requestLine.getUri());</span><br><span class="line">System.err.println(responseBody);</span><br></pre></td></tr></table></figure><blockquote><p>对于返回404状态代码的HEAD请求，不会引发ResponseException，因为这是预期的HEAD响应，它仅表示未找到资源。 除非ignore参数包含404，否则所有其他HTTP方法（例如GET）都将引发404响应的ResponseException。ignore是一个特殊的客户端参数，不会发送到Elasticsearch，并且包含逗号分隔的错误状态代码列表。 它允许控制是否将某些错误状态代码视为预期的响应而不是异常。 例如，这对于使用get api很有用，因为当缺少文档时它可以返回404，在这种情况下，响应主体将不包含错误，而是通常的get api响应，只是没有找到未找到的文档。</p></blockquote><h2 id="9-2-REST-高级-API"><a href="#9-2-REST-高级-API" class="headerlink" title="9.2 REST 高级 API"></a>9.2 REST 高级 API</h2><h3 id="9-2-1-机器翻译介绍"><a href="#9-2-1-机器翻译介绍" class="headerlink" title="9.2.1 机器翻译介绍"></a>9.2.1 机器翻译介绍</h3><p>Java高级REST客户端在Java高级REST客户端之上工作。它的主要目的是公开API特定的方法，这些方法接受请求对象作为参数并返回响应对象，以便请求编组和响应解编组由客户端本身处理。</p><p>每个API可以同步或异步调用。同步方法返回一个响应对象，而名称以<code>async</code>后缀结尾的异步方法则需要一个侦听器参数，一旦收到响应或错误，该参数将被通知（在低级客户端管理的线程池上）。</p><p>Java高级REST客户端取决于Elasticsearch核心项目。它接受与相同的请求参数，<code>TransportClient</code>并返回相同的响应对象。</p><h3 id="9-2-2-兼容性"><a href="#9-2-2-兼容性" class="headerlink" title="9.2.2 兼容性"></a>9.2.2 <a href="https://github.com/elastic/elasticsearch/edit/6.2/docs/java-rest/high-level/getting-started.asciidoc" target="_blank" rel="noopener">兼容性</a></h3><p>Java高级REST客户端需要Java 1.8，并依赖于Elasticsearch核心项目。客户端版本与为其开发客户端的Elasticsearch版本相同。它接受与相同的请求参数，<code>TransportClient</code> 并返回相同的响应对象。 如果需要将应用程序从其迁移到新的REST客户端，请参阅《<a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/6.2/java-rest-high-level-migration.html" target="_blank" rel="noopener"><em>迁移指南》</em></a><code>TransportClient</code>。</p><p>确保高级客户端能够与在相同主要版本和较大或相等的次要版本上运行的任何Elasticsearch节点进行通信。它不需要与与其通信的Elasticsearch节点处于相同的次要版本，因为它是前向兼容的，这意味着它支持与比其开发的版本更高的Elasticsearch通信。</p><p>6.0客户端可以与任何6.x Elasticsearch节点进行通信，而6.1客户端可以与6.1、6.2和任何更高版本的6.x版本进行通信，但是与先前的Elasticsearch节点进行通信时可能会出现不兼容问题如果6.1客户端支持6.0节点不知道的某些API的新请求正文字段，则版本介于6.1和6.0之间。</p><p>建议将Elasticsearch群集升级到新的主要版本时升级High Level Client，因为REST API的重大更改可能会导致意外结果，具体取决于请求所命中的节点，并且新添加的API仅受支持。客户端的较新版本。一旦集群中的所有节点都已升级到新的主要版本，客户端应始终最后更新。</p><h3 id="9-2-3-起步"><a href="#9-2-3-起步" class="headerlink" title="9.2.3 起步"></a>9.2.3 起步</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.elasticsearch.client&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;6.2.4&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure><ul><li>org.elasticsearch.client:elasticsearch-rest-client</li><li>org.elasticsearch:elasticsearch</li></ul><h3 id="9-2-4-创建一个rest-连接"><a href="#9-2-4-创建一个rest-连接" class="headerlink" title="9.2.4 创建一个rest 连接"></a>9.2.4 创建一个rest 连接</h3><h3 id="9-2-5-【6-2-4】版本-支持的相关API-（重点）"><a href="#9-2-5-【6-2-4】版本-支持的相关API-（重点）" class="headerlink" title="9.2.5 【6.2.4】版本 支持的相关API （重点）"></a>9.2.5 【6.2.4】版本 支持的相关API （重点）</h3><h4 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * 创建索引</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static void createIndex(RestHighLevelClient client) throws Exception &#123;</span><br><span class="line">        &#x2F;&#x2F; 1. 创建索引请求，并且指定索引名称</span><br><span class="line">        CreateIndexRequest indexRequest &#x3D; new CreateIndexRequest(&quot;twitter&quot;);</span><br><span class="line">        &#x2F;&#x2F; 2. 设置索引的 settings 注意和es原生方式不同需要加index.</span><br><span class="line">        indexRequest.settings(Settings.builder()</span><br><span class="line">            .put(&quot;index.number_of_shards&quot;, 3)</span><br><span class="line">            .put(&quot;index.number_of_shards&quot;, 2));</span><br><span class="line">        &#x2F;&#x2F; 3. 设置mappings 映射。由于5.0升级需要加上 header请求类型</span><br><span class="line">        indexRequest.mapping(&quot;tweet&quot;,</span><br><span class="line">                &quot;  &#123;\n&quot; +</span><br><span class="line">                        &quot;    \&quot;tweet\&quot;: &#123;\n&quot; +</span><br><span class="line">                        &quot;      \&quot;properties\&quot;: &#123;\n&quot; +</span><br><span class="line">                        &quot;        \&quot;message\&quot;: &#123;\n&quot; +</span><br><span class="line">                        &quot;          \&quot;type\&quot;: \&quot;text\&quot;\n&quot; +</span><br><span class="line">                        &quot;        &#125;\n&quot; +</span><br><span class="line">                        &quot;      &#125;\n&quot; +</span><br><span class="line">                        &quot;    &#125;\n&quot; +</span><br><span class="line">                        &quot;  &#125;&quot;,</span><br><span class="line">                XContentType.JSON);</span><br><span class="line">        &#x2F;&#x2F; 4. 指定索引的别名</span><br><span class="line">        indexRequest.alias(</span><br><span class="line">                new Alias(&quot;twitter_alias&quot;)</span><br><span class="line">        );</span><br><span class="line">        &#x2F;&#x2F; 5. 可选参数提供</span><br><span class="line">        &#x2F;&#x2F; TODO: 这两个参数作用目前不太明确</span><br><span class="line">        indexRequest.timeout(TimeValue.timeValueMinutes(2));</span><br><span class="line">        indexRequest.timeout(&quot;2m&quot;);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 5.1连接到主节点的超时时间</span><br><span class="line">        indexRequest.masterNodeTimeout(TimeValue.timeValueMinutes(1));</span><br><span class="line">        indexRequest.masterNodeTimeout(&quot;1m&quot;);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 5.2 在创建索引API返回响应之前，要等待的活动碎片副本数</span><br><span class="line">        indexRequest.waitForActiveShards(2);</span><br><span class="line">        indexRequest.waitForActiveShards(ActiveShardCount.DEFAULT);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 6. 同步执行的方式</span><br><span class="line">        CreateIndexResponse createIndexResponse &#x3D; client.indices().create(indexRequest);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 7. 异步执行方式</span><br><span class="line">        &#x2F;&#x2F; 由于异步方式不能立刻返回结果，所以需要监听器去监听异步请求结果</span><br><span class="line">&#x2F;&#x2F;        ActionListener&lt;CreateIndexResponse&gt; listener &#x3D; new ActionListener&lt;CreateIndexResponse&gt;() &#123;</span><br><span class="line">&#x2F;&#x2F;            @Override</span><br><span class="line">&#x2F;&#x2F;            public void onResponse(CreateIndexResponse createIndexResponse) &#123;</span><br><span class="line">&#x2F;&#x2F;                System.err.println(&quot;返回结果&quot;);</span><br><span class="line">&#x2F;&#x2F;            &#125;</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;            @Override</span><br><span class="line">&#x2F;&#x2F;            public void onFailure(Exception e) &#123;</span><br><span class="line">&#x2F;&#x2F;                System.err.println(&quot;出现异常&quot;);</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;            &#125;</span><br><span class="line">&#x2F;&#x2F;        &#125;;</span><br><span class="line">&#x2F;&#x2F;        client.indices().createAsync(indexRequest, listener);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 8. 处理返回结果</span><br><span class="line">        boolean acknowledged &#x3D; createIndexResponse.isAcknowledged();</span><br><span class="line">        boolean shardsAcknowledged &#x3D; createIndexResponse.isShardsAcknowledged();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * 删除索引</span><br><span class="line">     * @param client</span><br><span class="line">     * @throws Exception</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static void deleteIndex(RestHighLevelClient client) throws Exception &#123;</span><br><span class="line">        &#x2F;&#x2F; 创建删除索引的对象</span><br><span class="line">        DeleteIndexRequest deleteIndexRequest &#x3D; new DeleteIndexRequest(&quot;twitter&quot;);</span><br><span class="line">        &#x2F;&#x2F; 2. TODO: 这两个参数作用目前不太明确</span><br><span class="line">        deleteIndexRequest.timeout(TimeValue.timeValueMinutes(2));</span><br><span class="line">        deleteIndexRequest.timeout(&quot;2m&quot;);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 2.1 连接到主节点的超时时间</span><br><span class="line">        deleteIndexRequest.masterNodeTimeout(TimeValue.timeValueMinutes(1));</span><br><span class="line">        deleteIndexRequest.masterNodeTimeout(&quot;1m&quot;);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 3. 设置IndicesOptions可以控制如何解决不可用的索引以及如何扩展通配符表达式</span><br><span class="line">        &#x2F;&#x2F; 3.1 IndicesOptions.lenientExpandOpen()</span><br><span class="line">        &#x2F;&#x2F; 索引选项将忽略不可用的索引，仅将通配符扩展为打开的索引，并不允许通配符表达式解析任何索引（不返回错误）</span><br><span class="line">        deleteIndexRequest.indicesOptions(IndicesOptions.lenientExpandOpen());</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 4.1 同步方式</span><br><span class="line">        DeleteIndexResponse delete &#x3D; client.indices().delete(deleteIndexRequest);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 4.2 异步方式</span><br><span class="line">&#x2F;&#x2F;        client.indices().deleteAsync(deleteIndexRequest, new ActionListener&lt;DeleteIndexResponse&gt;()&#123;</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;            @Override</span><br><span class="line">&#x2F;&#x2F;            public void onResponse(DeleteIndexResponse deleteIndexResponse) &#123;</span><br><span class="line">&#x2F;&#x2F;                System.err.println(&quot;返回结果&quot;);</span><br><span class="line">&#x2F;&#x2F;            &#125;</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;            @Override</span><br><span class="line">&#x2F;&#x2F;            public void onFailure(Exception e) &#123;</span><br><span class="line">&#x2F;&#x2F;                System.err.println(&quot;出现异常&quot;);</span><br><span class="line">&#x2F;&#x2F;            &#125;</span><br><span class="line">&#x2F;&#x2F;        &#125;);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 5. 如果删除的时候没有索引会发生什么？</span><br><span class="line">        &#x2F;&#x2F; 请根据如下代码进行处理</span><br><span class="line">&#x2F;&#x2F;        try &#123;</span><br><span class="line">&#x2F;&#x2F;            DeleteIndexRequest request &#x3D; new DeleteIndexRequest(&quot;does_not_exist&quot;);</span><br><span class="line">&#x2F;&#x2F;            client.indices().delete(request);</span><br><span class="line">&#x2F;&#x2F;        &#125; catch (ElasticsearchException exception) &#123;</span><br><span class="line">&#x2F;&#x2F;            if (exception.status() &#x3D;&#x3D; RestStatus.NOT_FOUND) &#123;</span><br><span class="line">&#x2F;&#x2F;              &#x2F;&#x2F;处理异常</span><br><span class="line">&#x2F;&#x2F;            &#125;</span><br><span class="line">&#x2F;&#x2F;        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="开放索引"><a href="#开放索引" class="headerlink" title="开放索引"></a>开放索引</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * 开放索引</span><br><span class="line">     * @param client</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static void openIndex(RestHighLevelClient client) throws Exception&#123;</span><br><span class="line">        &#x2F;&#x2F; 1. 创建一个开放索引的请求</span><br><span class="line">        OpenIndexRequest openIndexRequest &#x3D; new OpenIndexRequest(&quot;myindex&quot;);</span><br><span class="line">        &#x2F;&#x2F; 2. 等待所有节点确认索引的超时被打开</span><br><span class="line">        openIndexRequest.timeout(TimeValue.timeValueMinutes(2));</span><br><span class="line">        &#x2F;&#x2F; 3. 设置请求开放索引处理策略</span><br><span class="line">        &#x2F;&#x2F; 要求每个指定索引都存在的索引选项，仅将通配符扩展为打开的索引，并且不允许通配符表达式解析任何索引（不返回错误）。</span><br><span class="line">        openIndexRequest.indicesOptions(IndicesOptions.strictExpandOpen());</span><br><span class="line">        &#x2F;&#x2F; 4. 设置开放索引API返回响应之前要等待的活动分片副本数</span><br><span class="line">        openIndexRequest.waitForActiveShards(2);</span><br><span class="line">        &#x2F;&#x2F; 4.1 ActiveShardCount 存在多个选下那个</span><br><span class="line">        openIndexRequest.waitForActiveShards(ActiveShardCount.ONE);</span><br><span class="line">        &#x2F;&#x2F; 5. 同步方式</span><br><span class="line">        OpenIndexResponse openIndexResponse &#x3D; client.indices().open(openIndexRequest);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 6. 异步方式</span><br><span class="line">        &#x2F;&#x2F; 由于异步方式不能立刻返回结果，所以需要监听器去监听异步请求结果</span><br><span class="line">&#x2F;&#x2F;        ActionListener&lt;OpenIndexResponse&gt; listener &#x3D; new ActionListener&lt;OpenIndexResponse&gt;() &#123;</span><br><span class="line">&#x2F;&#x2F;            @Override</span><br><span class="line">&#x2F;&#x2F;            public void onResponse(CreateIndexResponse createIndexResponse) &#123;</span><br><span class="line">&#x2F;&#x2F;                System.err.println(&quot;返回结果&quot;);</span><br><span class="line">&#x2F;&#x2F;            &#125;</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;            @Override</span><br><span class="line">&#x2F;&#x2F;            public void onFailure(Exception e) &#123;</span><br><span class="line">&#x2F;&#x2F;                System.err.println(&quot;出现异常&quot;);</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;            &#125;</span><br><span class="line">&#x2F;&#x2F;        &#125;;</span><br><span class="line">&#x2F;&#x2F;        client.indices().openAsync(openIndexRequest, listener);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 7. 分片是否正常响应</span><br><span class="line">        openIndexResponse.isShardsAcknowledged();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="关闭索引"><a href="#关闭索引" class="headerlink" title="关闭索引"></a>关闭索引</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">   * 关闭索引</span><br><span class="line">   * @param client</span><br><span class="line">   *&#x2F;</span><br><span class="line">  private static void closeIndex(RestHighLevelClient client) throws Exception&#123;</span><br><span class="line">      &#x2F;&#x2F; 1. 创建一个关闭索引的对象</span><br><span class="line">      CloseIndexRequest closeIndexRequest &#x3D; new CloseIndexRequest(&quot;myindex&quot;);</span><br><span class="line">      &#x2F;&#x2F; 2. 基本设置： 大同小异，不多啰嗦了</span><br><span class="line">      closeIndexRequest.timeout(TimeValue.timeValueMinutes(2));</span><br><span class="line">      closeIndexRequest.timeout(&quot;2m&quot;);</span><br><span class="line">      closeIndexRequest.masterNodeTimeout(TimeValue.timeValueMinutes(1));</span><br><span class="line">      closeIndexRequest.masterNodeTimeout(&quot;1m&quot;);</span><br><span class="line">      closeIndexRequest.indicesOptions(IndicesOptions.lenientExpandOpen());</span><br><span class="line">      &#x2F;&#x2F; 3. 同步方式</span><br><span class="line">      CloseIndexResponse closeIndexResponse &#x3D; client.indices().close(closeIndexRequest);</span><br><span class="line">      &#x2F;&#x2F; 4. 异步方式</span><br><span class="line">      client.indices().closeAsync(closeIndexRequest, new ActionListener&lt;CloseIndexResponse&gt;() &#123;</span><br><span class="line">          @Override</span><br><span class="line">          public void onResponse(CloseIndexResponse closeIndexResponse) &#123;</span><br><span class="line">              &#x2F;&#x2F; ....</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          @Override</span><br><span class="line">          public void onFailure(Exception e) &#123;</span><br><span class="line">              &#x2F;&#x2F; ....</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      boolean acknowledged &#x3D; closeIndexResponse.isAcknowledged();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="9-2-6-索引本身的API"><a href="#9-2-6-索引本身的API" class="headerlink" title="9.2.6 索引本身的API"></a>9.2.6 索引本身的API</h3><h4 id="直接根据索引创建一个文档需要如下参数"><a href="#直接根据索引创建一个文档需要如下参数" class="headerlink" title="直接根据索引创建一个文档需要如下参数"></a>直接根据索引创建一个文档需要如下参数</h4><ol><li>索引名称</li><li>索引类型</li><li>文档id</li><li>文档数据：提供一个json数据</li></ol><h4 id="提供文档来源的多种方式"><a href="#提供文档来源的多种方式" class="headerlink" title="提供文档来源的多种方式"></a>提供文档来源的多种方式</h4><p>可以使用不同的方式来创建文档源数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; jsonMap &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">jsonMap.put(&quot;user&quot;, &quot;kimchy&quot;);</span><br><span class="line">jsonMap.put(&quot;postData&quot;, new Date());</span><br><span class="line">jsonMap.put(&quot;message&quot;, &quot;trying out Elasticsearch&quot;);</span><br><span class="line">&#x2F;&#x2F; 5. 使用map创建</span><br><span class="line">indexRequest.source(indexRequest, jsonMap);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 6. es 官方开发了 XContentBuilder 来构建_source 的请求json</span><br><span class="line">XContentBuilder xContentBuilder &#x3D; XContentFactory.jsonBuilder();</span><br><span class="line">xContentBuilder.startObject();</span><br><span class="line">&#123;</span><br><span class="line">    xContentBuilder.field(&quot;user&quot;, &quot;kimchy&quot;);</span><br><span class="line">    xContentBuilder.field(&quot;postDate&quot;, new Date());</span><br><span class="line">    xContentBuilder.field(&quot;message&quot;, &quot;trying out Elasticsearch&quot;);</span><br><span class="line">&#125;</span><br><span class="line">xContentBuilder.endObject();</span><br><span class="line">IndexRequest source &#x3D; indexRequest.source(xContentBuilder);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 7. 也可以在_soucre 的时候直接传入键值对数据</span><br><span class="line">indexRequest.source(&quot;user&quot;, &quot;kimchy&quot;,</span><br><span class="line">                    &quot;postDate&quot;, new Date(),</span><br><span class="line">                    &quot;message&quot;, &quot;trying out Elasticsearch&quot;);</span><br></pre></td></tr></table></figure><h4 id="可选参数"><a href="#可选参数" class="headerlink" title="可选参数"></a>可选参数</h4><p>设置路由</p><p>设置parent 值</p><p>设置分片处理的超时时间</p><p>将策略刷新为WriteRequest.RefreshPolicy实例</p><p>设置初始版本号</p><p>设置版本类型?</p><p>提供类型形式修改操作类型，以及以字符串形式提供的操作类型：可以创建或更新（默认）</p><p>索引文档之前要执行的管道流的名称</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 8. 可选参数</span><br><span class="line">&#x2F;&#x2F; 8.1 设置路由</span><br><span class="line">indexRequest.routing(&quot;routing&quot;);</span><br><span class="line">&#x2F;&#x2F; 8.2 设置父索引</span><br><span class="line">indexRequest.parent(&quot;parent&quot;);</span><br><span class="line">&#x2F;&#x2F; 8.3 设置分片处理的超时时间</span><br><span class="line">indexRequest.timeout(TimeValue.timeValueSeconds(1));</span><br><span class="line">indexRequest.timeout(&quot;1s&quot;);</span><br><span class="line">&#x2F;&#x2F; 8.4 设置刷新策略</span><br><span class="line">indexRequest.setRefreshPolicy(WriteRequest.RefreshPolicy.WAIT_UNTIL);</span><br><span class="line">indexRequest.setRefreshPolicy(&quot;wait_for&quot;);</span><br><span class="line">&#x2F;&#x2F; 8.5 设置版本号</span><br><span class="line">indexRequest.version(2);</span><br><span class="line">&#x2F;&#x2F; 8.6 设置版本类型</span><br><span class="line">indexRequest.versionType(VersionType.EXTERNAL);</span><br><span class="line">&#x2F;&#x2F; 8.7 提供类型形式修改操作类型，以及以字符串形式提供的操作类型：可以创建或更新（默认）</span><br><span class="line">indexRequest.opType(DocWriteRequest.OpType.CREATE);</span><br><span class="line">indexRequest.opType(&quot;create&quot;);</span><br><span class="line">&#x2F;&#x2F; 8.8 索引文档之前要执行的管道流的名称</span><br><span class="line">indexRequest.setPipeline(&quot;pipeline&quot;);</span><br></pre></td></tr></table></figure><h4 id="获取响应内容"><a href="#获取响应内容" class="headerlink" title="获取响应内容"></a>获取响应内容</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 11. 处理响应体内容</span><br><span class="line">indexResponse.getIndex();</span><br><span class="line">indexResponse.getId();</span><br><span class="line">indexResponse.getType();</span><br><span class="line">indexResponse.getVersion();</span><br><span class="line">if (indexResponse.getResult() &#x3D;&#x3D; DocWriteResponse.Result.CREATED) &#123;</span><br><span class="line">    &#x2F;&#x2F; 如果是创建</span><br><span class="line"></span><br><span class="line">&#125; else if (indexResponse.getResult() &#x3D;&#x3D; DocWriteResponse.Result.UPDATED) &#123;</span><br><span class="line">    &#x2F;&#x2F; 如果是修改</span><br><span class="line">&#125;</span><br><span class="line">ReplicationResponse.ShardInfo shardInfo &#x3D; indexResponse.getShardInfo();</span><br><span class="line">if (shardInfo.getTotal() !&#x3D; shardInfo.getSuccessful()) &#123;</span><br><span class="line">    &#x2F;&#x2F; 如果存在失败分片（即返回部分信息）如何处理</span><br><span class="line">&#125;</span><br><span class="line">if (shardInfo.getFailed() &gt; 0) &#123;</span><br><span class="line">    for (ReplicationResponse.ShardInfo.Failure failure : shardInfo.getFailures()) &#123;</span><br><span class="line">        &#x2F;&#x2F; 获取失败原因</span><br><span class="line">        String reason &#x3D; failure.reason();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="根据上述内容整合"><a href="#根据上述内容整合" class="headerlink" title="根据上述内容整合"></a>根据上述内容整合</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * 根据索引创建一个索引文档</span><br><span class="line">     * @param client</span><br><span class="line">     * @throws Exception</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static void createIndexDocumentByIndex(RestHighLevelClient client) throws Exception&#123;</span><br><span class="line">        &#x2F;&#x2F; 1. 创建 索引请求</span><br><span class="line">        IndexRequest indexRequest &#x3D; new IndexRequest(</span><br><span class="line">                &quot;posts&quot;,</span><br><span class="line">                &quot;doc&quot;,</span><br><span class="line">                &quot;1&quot;);</span><br><span class="line">        &#x2F;&#x2F; 2. _source 元数据</span><br><span class="line">        String jsonString &#x3D; &quot;&#123;&quot; +</span><br><span class="line">                &quot;\&quot;user\&quot;:\&quot;kimchy\&quot;,&quot; +</span><br><span class="line">                &quot;\&quot;postDate\&quot;:\&quot;2013-01-30\&quot;,&quot; +</span><br><span class="line">                &quot;\&quot;message\&quot;:\&quot;trying out Elasticsearch\&quot;&quot; +</span><br><span class="line">                &quot;&#125;&quot;;</span><br><span class="line">        &#x2F;&#x2F; 3. 设置元数据</span><br><span class="line">        indexRequest.source(indexRequest, jsonString);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 4. 提供另外一种方式</span><br><span class="line">        Map&lt;String, Object&gt; jsonMap &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">        jsonMap.put(&quot;user&quot;, &quot;kimchy&quot;);</span><br><span class="line">        jsonMap.put(&quot;postData&quot;, new Date());</span><br><span class="line">        jsonMap.put(&quot;message&quot;, &quot;trying out Elasticsearch&quot;);</span><br><span class="line">        &#x2F;&#x2F; 5. 使用map创建</span><br><span class="line">        indexRequest.source(indexRequest, jsonMap);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 6. es 官方开发了 XContentBuilder 来构建_source 的请求json</span><br><span class="line">        XContentBuilder xContentBuilder &#x3D; XContentFactory.jsonBuilder();</span><br><span class="line">        xContentBuilder.startObject();</span><br><span class="line">        &#123;</span><br><span class="line">            xContentBuilder.field(&quot;user&quot;, &quot;kimchy&quot;);</span><br><span class="line">            xContentBuilder.field(&quot;postDate&quot;, new Date());</span><br><span class="line">            xContentBuilder.field(&quot;message&quot;, &quot;trying out Elasticsearch&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        xContentBuilder.endObject();</span><br><span class="line">        IndexRequest source &#x3D; indexRequest.source(xContentBuilder);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 7. 也可以在_soucre 的时候直接传入键值对数据</span><br><span class="line">        indexRequest.source(&quot;user&quot;, &quot;kimchy&quot;,</span><br><span class="line">                        &quot;postDate&quot;, new Date(),</span><br><span class="line">                        &quot;message&quot;, &quot;trying out Elasticsearch&quot;);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 8. 可选参数</span><br><span class="line">        &#x2F;&#x2F; 8.1 设置路由</span><br><span class="line">        indexRequest.routing(&quot;routing&quot;);</span><br><span class="line">        &#x2F;&#x2F; 8.2 设置父索引</span><br><span class="line">        indexRequest.parent(&quot;parent&quot;);</span><br><span class="line">        &#x2F;&#x2F; 8.3 设置分片处理的超时时间</span><br><span class="line">        indexRequest.timeout(TimeValue.timeValueSeconds(1));</span><br><span class="line">        indexRequest.timeout(&quot;1s&quot;);</span><br><span class="line">        &#x2F;&#x2F; 8.4 设置刷新策略</span><br><span class="line">        indexRequest.setRefreshPolicy(WriteRequest.RefreshPolicy.WAIT_UNTIL);</span><br><span class="line">        indexRequest.setRefreshPolicy(&quot;wait_for&quot;);</span><br><span class="line">        &#x2F;&#x2F; 8.5 设置版本号</span><br><span class="line">        indexRequest.version(2);</span><br><span class="line">        &#x2F;&#x2F; 8.6 设置版本类型</span><br><span class="line">        indexRequest.versionType(VersionType.EXTERNAL);</span><br><span class="line">        &#x2F;&#x2F; 8.7 提供类型形式修改操作类型，以及以字符串形式提供的操作类型：可以创建或更新（默认）</span><br><span class="line">        indexRequest.opType(DocWriteRequest.OpType.CREATE);</span><br><span class="line">        indexRequest.opType(&quot;create&quot;);</span><br><span class="line">        &#x2F;&#x2F; 8.8 索引文档之前要执行的管道流的名称</span><br><span class="line">        indexRequest.setPipeline(&quot;pipeline&quot;);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 9. 同步方式</span><br><span class="line">        IndexResponse indexResponse &#x3D; client.index(indexRequest);</span><br><span class="line">        &#x2F;&#x2F; 10. 异步方式</span><br><span class="line">        client.indexAsync(indexRequest, new ActionListener&lt;IndexResponse&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onResponse(IndexResponse indexResponse) &#123;</span><br><span class="line">                &#x2F;&#x2F; ...</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onFailure(Exception e) &#123;</span><br><span class="line">                &#x2F;&#x2F; ....</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 11. 处理响应体内容</span><br><span class="line">        indexResponse.getIndex();</span><br><span class="line">        indexResponse.getId();</span><br><span class="line">        indexResponse.getType();</span><br><span class="line">        indexResponse.getVersion();</span><br><span class="line">        if (indexResponse.getResult() &#x3D;&#x3D; DocWriteResponse.Result.CREATED) &#123;</span><br><span class="line">            &#x2F;&#x2F; 如果是创建</span><br><span class="line"></span><br><span class="line">        &#125; else if (indexResponse.getResult() &#x3D;&#x3D; DocWriteResponse.Result.UPDATED) &#123;</span><br><span class="line">            &#x2F;&#x2F; 如果是修改</span><br><span class="line">        &#125;</span><br><span class="line">        ReplicationResponse.ShardInfo shardInfo &#x3D; indexResponse.getShardInfo();</span><br><span class="line">        if (shardInfo.getTotal() !&#x3D; shardInfo.getSuccessful()) &#123;</span><br><span class="line">            &#x2F;&#x2F; 如果存在失败分片（即返回部分信息）如何处理</span><br><span class="line">        &#125;</span><br><span class="line">        if (shardInfo.getFailed() &gt; 0) &#123;</span><br><span class="line">            for (ReplicationResponse.ShardInfo.Failure failure : shardInfo.getFailures()) &#123;</span><br><span class="line">                &#x2F;&#x2F; 获取失败原因</span><br><span class="line">                String reason &#x3D; failure.reason();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1 id="10-Elasticsearch-JAVA-API-的学习使用"><a href="#10-Elasticsearch-JAVA-API-的学习使用" class="headerlink" title="10. Elasticsearch JAVA API 的学习使用"></a>10. Elasticsearch JAVA API 的学习使用</h1><h2 id="10-1-起步："><a href="#10-1-起步：" class="headerlink" title="10.1 起步："></a>10.1 起步：</h2><h3 id="10-1-1-Maven-依赖"><a href="#10-1-1-Maven-依赖" class="headerlink" title="10.1.1 Maven 依赖"></a>10.1.1 Maven 依赖</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.elasticsearch.client&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;transport&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;6.2.4&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure><h1 id="11-Es-painless-脚本插件使用（Elasticsearch-script-plugin）"><a href="#11-Es-painless-脚本插件使用（Elasticsearch-script-plugin）" class="headerlink" title="11. Es painless 脚本插件使用（Elasticsearch script plugin）"></a>11. Es painless 脚本插件使用（Elasticsearch script plugin）</h1><p>如果需要使用原生java语言实现自定义评分，需要实现官方提供的一个scriptEngine接口，官方在git上面给出了一个案例</p><h2 id="11-1-前置条件：windows安装gradle"><a href="#11-1-前置条件：windows安装gradle" class="headerlink" title="11.1 前置条件：windows安装gradle"></a>11.1 前置条件：windows安装gradle</h2><p>官方推荐用gradle 来构建插件的Jar包，为了怕出现麻烦，直接按照官方给的要求来，这里先列出一下gradle的基本安装步骤</p><h3 id="11-1-1-官方下载地址"><a href="#11-1-1-官方下载地址" class="headerlink" title="11.1.1 官方下载地址"></a>11.1.1 官方下载地址</h3><p><a href="https://services.gradle.org/distributions/" target="_blank" rel="noopener">https://services.gradle.org/distributions/</a></p><p>下载 <strong>gradle-5.6.3-all.zip</strong> 包，注意别下错了</p><h3 id="11-1-2-将gradle放入合适位置，将gradle加入path环境变量"><a href="#11-1-2-将gradle放入合适位置，将gradle加入path环境变量" class="headerlink" title="11.1.2 将gradle放入合适位置，将gradle加入path环境变量"></a>11.1.2 将gradle放入合适位置，将gradle加入path环境变量</h3><h3 id="11-1-3-配置阿里云的镜像"><a href="#11-1-3-配置阿里云的镜像" class="headerlink" title="11.1.3 配置阿里云的镜像"></a>11.1.3 配置阿里云的镜像</h3><h1 id="N-kibana-学习es的所有内容"><a href="#N-kibana-学习es的所有内容" class="headerlink" title="N kibana 学习es的所有内容"></a>N kibana 学习es的所有内容</h1><h2 id="2019-10-14"><a href="#2019-10-14" class="headerlink" title="2019.10.14"></a>2019.10.14</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br></pre></td><td class="code"><pre><span class="line">GET _search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT &#x2F;lib&#x2F;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  &quot;settings&quot;:&#123;</span><br><span class="line"></span><br><span class="line">  &quot;index&quot;:&#123;</span><br><span class="line">  </span><br><span class="line">    &quot;number_of_shards&quot;: 5,</span><br><span class="line">    </span><br><span class="line">    &quot;number_of_replicas&quot;: 1</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET _all&#x2F;_settings</span><br><span class="line"></span><br><span class="line">POST &#x2F;lib&#x2F;user&#x2F;</span><br><span class="line">&#123;</span><br><span class="line">    &quot;first_name&quot; :  &quot;wang&quot;,</span><br><span class="line">    &quot;last_name&quot; :   &quot;laji&quot;,</span><br><span class="line">    &quot;age&quot; :         333,</span><br><span class="line">    &quot;about&quot; :       &quot;I hide to collect rock albums&quot;,</span><br><span class="line">    &quot;interests&quot;:  [ &quot;basket&quot; ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET &#x2F;+get-toge*,-get-together&#x2F;_search</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search?from&#x3D;2&amp;size&#x3D;2</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;_search?sort&#x3D;age:_id&amp;_source&#x3D;first_name,age</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search?q&#x3D;first_name:ne</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;: 2,</span><br><span class="line">  &quot;from&quot;: 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [&quot;*_name&quot;, &quot;a*&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: &#123;</span><br><span class="line">    &quot;includes&quot;: [&quot;*_name&quot;, &quot;age&quot;],</span><br><span class="line">    &quot;excludes&quot;: [&quot;first_name&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;age&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;desc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"> </span><br><span class="line">    &quot;_score&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 2,</span><br><span class="line">  &quot;_source&quot;: [&quot;*_name&quot;, &quot;age&quot;],</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;age&quot;:&quot;desc&quot;  </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;first_name&quot;: &quot;Jane&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  </span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;about&quot;: &quot;hide&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ], </span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;term&quot;: &#123;</span><br><span class="line">          &quot;first_name&quot;: &quot;wang&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;_search?q&#x3D;wang</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;query_string&quot;: &#123;</span><br><span class="line">      &quot;default_field&quot;: &quot;first_name&quot;,</span><br><span class="line">      &quot;query&quot;: &quot;first_name:wang OR first_name:jane AND age:[0 TO  999]&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;term&quot;: &#123;</span><br><span class="line">          &quot;_id&quot;: 1</span><br><span class="line">        &#125; </span><br><span class="line">        </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;terms&quot;: &#123;</span><br><span class="line">      &quot;about&quot;: [</span><br><span class="line">        &quot;i&quot;,</span><br><span class="line">        &quot;hide&quot;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;first_name&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;Jane wang&quot;,</span><br><span class="line">        &quot;operator&quot;: &quot;or&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;first_name&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;phrase_prefix&quot;,</span><br><span class="line">        &quot;query&quot;: &quot;hide&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase&quot;: &#123;</span><br><span class="line">      &quot;about&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;to rock&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase_prefix&quot;: &#123;</span><br><span class="line">      &quot;first_name&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;wa&quot;,</span><br><span class="line">        &quot;max_expansions&quot;: 5</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;wang smith&quot;,</span><br><span class="line">        &quot;fields&quot;: [&quot;first_name&quot;, &quot;last_name&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST &#x2F;lib&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match_phrase&quot;:  &#123;</span><br><span class="line">            &quot;about&quot;: &#123;</span><br><span class="line">              &quot;query&quot;: &quot;i to&quot;,</span><br><span class="line">              &quot;slop&quot;: 1</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;should&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;term&quot;: &#123;</span><br><span class="line">            &quot;first_name&quot;: &#123;</span><br><span class="line">              &quot;value&quot;: &quot;wang&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;must_not&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;query_string&quot;: &#123;</span><br><span class="line">            &quot;default_field&quot;: &quot;age&quot;,</span><br><span class="line">            &quot;query&quot;: &quot;first_name:jane&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;minimum_should_match&quot;: 1</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST &#x2F;myindex&#x2F;test&#x2F;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;lixiaolong&quot;,</span><br><span class="line">  &quot;age&quot;: 5,</span><br><span class="line">  &quot;birthday&quot;: &quot;2019-05-04&quot;,</span><br><span class="line">  &quot;test_field&quot;: &quot;zzzzzz&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;myindex&#x2F;test&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;range&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &#123;</span><br><span class="line">        &quot;gte&quot;: &quot;li&quot;,</span><br><span class="line">        &quot;lte&quot;: &quot;o&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;myindex&#x2F;test&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;prefix&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;Li&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;myindex&#x2F;test&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;wildcard&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;lix?ao*&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;myindex&#x2F;test&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;exists&quot;: &#123;</span><br><span class="line">          &quot;field&quot;: &quot;name&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;myindex&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;missing&quot;: &#123;</span><br><span class="line">          &quot;field&quot;: &quot;test_field&quot;,</span><br><span class="line">          &quot;existence&quot;: true,</span><br><span class="line">          &quot;null_value&quot;: true</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;myindex&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;query_string&quot;: &#123;</span><br><span class="line">            &quot;default_field&quot;: &quot;name&quot;,</span><br><span class="line">            &quot;query&quot;: &quot;che*&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">POST &#x2F;mymyindex&#x2F;</span><br></pre></td></tr></table></figure><h2 id="2019-10-15"><a href="#2019-10-15" class="headerlink" title="2019.10.15"></a>2019.10.15</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br></pre></td><td class="code"><pre><span class="line">GET _search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT &#x2F;lib&#x2F;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  &quot;settings&quot;:&#123;</span><br><span class="line"></span><br><span class="line">  &quot;index&quot;:&#123;</span><br><span class="line">  </span><br><span class="line">    &quot;number_of_shards&quot;: 5,</span><br><span class="line">    </span><br><span class="line">    &quot;number_of_replicas&quot;: 1</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET _all&#x2F;_settings</span><br><span class="line"></span><br><span class="line">POST &#x2F;lib&#x2F;user&#x2F;</span><br><span class="line">&#123;</span><br><span class="line">    &quot;first_name&quot; :  &quot;wang&quot;,</span><br><span class="line">    &quot;last_name&quot; :   &quot;laji&quot;,</span><br><span class="line">    &quot;age&quot; :         333,</span><br><span class="line">    &quot;about&quot; :       &quot;I hide to collect rock albums&quot;,</span><br><span class="line">    &quot;interests&quot;:  [ &quot;basket&quot; ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET &#x2F;+get-toge*,-get-together&#x2F;_search</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search?from&#x3D;2&amp;size&#x3D;2</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;_search?sort&#x3D;age:_id&amp;_source&#x3D;first_name,age</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search?q&#x3D;first_name:ne</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;: 2,</span><br><span class="line">  &quot;from&quot;: 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [&quot;*_name&quot;, &quot;a*&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: &#123;</span><br><span class="line">    &quot;includes&quot;: [&quot;*_name&quot;, &quot;age&quot;],</span><br><span class="line">    &quot;excludes&quot;: [&quot;first_name&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;age&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;desc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"> </span><br><span class="line">    &quot;_score&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 2,</span><br><span class="line">  &quot;_source&quot;: [&quot;*_name&quot;, &quot;age&quot;],</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;age&quot;:&quot;desc&quot;  </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;first_name&quot;: &quot;Jane&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  </span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;about&quot;: &quot;hide&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ], </span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;term&quot;: &#123;</span><br><span class="line">          &quot;first_name&quot;: &quot;wang&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;_search?q&#x3D;wang</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;query_string&quot;: &#123;</span><br><span class="line">      &quot;default_field&quot;: &quot;first_name&quot;,</span><br><span class="line">      &quot;query&quot;: &quot;first_name:wang OR first_name:jane AND age:[0 TO  999]&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;term&quot;: &#123;</span><br><span class="line">          &quot;_id&quot;: 1</span><br><span class="line">        &#125; </span><br><span class="line">        </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;terms&quot;: &#123;</span><br><span class="line">      &quot;about&quot;: [</span><br><span class="line">        &quot;i&quot;,</span><br><span class="line">        &quot;hide&quot;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;first_name&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;Jane wang&quot;,</span><br><span class="line">        &quot;operator&quot;: &quot;or&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;first_name&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;phrase_prefix&quot;,</span><br><span class="line">        &quot;query&quot;: &quot;hide&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase&quot;: &#123;</span><br><span class="line">      &quot;about&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;to rock&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase_prefix&quot;: &#123;</span><br><span class="line">      &quot;first_name&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;wa&quot;,</span><br><span class="line">        &quot;max_expansions&quot;: 5</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST &#x2F;lib&#x2F;user&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;wang smith&quot;,</span><br><span class="line">        &quot;fields&quot;: [&quot;first_name&quot;, &quot;last_name&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST &#x2F;lib&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match_phrase&quot;:  &#123;</span><br><span class="line">            &quot;about&quot;: &#123;</span><br><span class="line">              &quot;query&quot;: &quot;i to&quot;,</span><br><span class="line">              &quot;slop&quot;: 1</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;should&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;term&quot;: &#123;</span><br><span class="line">            &quot;first_name&quot;: &#123;</span><br><span class="line">              &quot;value&quot;: &quot;wang&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;must_not&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;query_string&quot;: &#123;</span><br><span class="line">            &quot;default_field&quot;: &quot;age&quot;,</span><br><span class="line">            &quot;query&quot;: &quot;first_name:jane&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;minimum_should_match&quot;: 1</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST &#x2F;myindex&#x2F;test&#x2F;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;lixiaolong&quot;,</span><br><span class="line">  &quot;age&quot;: 5,</span><br><span class="line">  &quot;birthday&quot;: &quot;2019-05-04&quot;,</span><br><span class="line">  &quot;test_field&quot;: &quot;zzzzzz&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;myindex&#x2F;test&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;range&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &#123;</span><br><span class="line">        &quot;gte&quot;: &quot;li&quot;,</span><br><span class="line">        &quot;lte&quot;: &quot;o&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;myindex&#x2F;test&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;prefix&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;Li&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;myindex&#x2F;test&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;wildcard&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;lix?ao*&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;myindex&#x2F;test&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;exists&quot;: &#123;</span><br><span class="line">          &quot;field&quot;: &quot;name&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;myindex&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;missing&quot;: &#123;</span><br><span class="line">          &quot;field&quot;: &quot;test_field&quot;,</span><br><span class="line">          &quot;existence&quot;: true,</span><br><span class="line">          &quot;null_value&quot;: true</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;myindex&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;query_string&quot;: &#123;</span><br><span class="line">            &quot;default_field&quot;: &quot;name&quot;,</span><br><span class="line">            &quot;query&quot;: &quot;che*&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DELETE &#x2F;mymyindex&#x2F; </span><br><span class="line"></span><br><span class="line">PUT &#x2F;mymyindex</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;analysis&quot;: &#123;</span><br><span class="line">      &quot;analyzer&quot;: &#123;</span><br><span class="line">        &quot;std_folded&quot;: &#123; </span><br><span class="line">          &quot;type&quot;: &quot;custom&quot;,</span><br><span class="line">          &quot;tokenizer&quot;: &quot;standard&quot;,</span><br><span class="line">          &quot;filter&quot;: [</span><br><span class="line">            &quot;lowercase&quot;,</span><br><span class="line">            &quot;asciifolding&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;_doc&quot;: &#123;</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;my_text&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">          &quot;analyzer&quot;: &quot;std_folded&quot; </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;mymyindex&#x2F;_mapping</span><br><span class="line"></span><br><span class="line">POST &#x2F;mymyindex&#x2F;_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;whitespace&quot;, </span><br><span class="line">  &quot;filter&quot;: [</span><br><span class="line">    &quot;reverse&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;text&quot;: &quot;The 2 QUICK Brown-Foxes jumped over the lazy dog\u0027s bone.&quot;,</span><br><span class="line">  &quot;field&quot;: &quot;my_text&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;get-together&#x2F;group&#x2F;3q8nz20BXNiyabSjyH-c&#x2F;_termvectors</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PUT &#x2F;my_index</span><br><span class="line">&#123;</span><br><span class="line">    &quot;settings&quot;: &#123;</span><br><span class="line">        &quot;analysis&quot;: &#123;</span><br><span class="line">            &quot;char_filter&quot;: &#123;</span><br><span class="line">                &quot;&amp;_to_and&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;:       &quot;mapping&quot;,</span><br><span class="line">                    &quot;mappings&quot;: [ &quot;&amp; &#x3D;&gt; and &quot;]</span><br><span class="line">            &#125;&#125;,</span><br><span class="line">            &quot;filter&quot;: &#123;</span><br><span class="line">                &quot;my_stopwords&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;:       &quot;stop&quot;,</span><br><span class="line">                    &quot;stopwords&quot;: [ &quot;the&quot;, &quot;a&quot; ]</span><br><span class="line">            &#125;&#125;,</span><br><span class="line">            &quot;analyzer&quot;: &#123;</span><br><span class="line">                &quot;my_analyzer&quot;: &#123;</span><br><span class="line">                    &quot;type&quot;:         &quot;custom&quot;,</span><br><span class="line">                    &quot;char_filter&quot;:  [ &quot;html_strip&quot;, &quot;&amp;_to_and&quot; ],</span><br><span class="line">                    &quot;tokenizer&quot;:    &quot;standard&quot;,</span><br><span class="line">                    &quot;filter&quot;:       [ &quot;lowercase&quot;, &quot;my_stopwords&quot; ]</span><br><span class="line">            &#125;&#125;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> GET &#x2F;my_index&#x2F;_mapping</span><br><span class="line"> GET &#x2F;mymyindex&#x2F;_mapping</span><br><span class="line"> </span><br><span class="line">POST &#x2F;lib&#x2F;_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;standard&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;I have, photos&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST &#x2F;lib&#x2F;_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;letter&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;The 2 QUICK Brown-Foxes jumped over the lazy dog&#39;s bone&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;lowercase&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;The 2 QUICK Brown-Foxes jumped over the lazy dog&#39;s bone.&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;whitespace&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;The 2 QUICK Brown-Foxes jumped over the lazy dog&#39;s bone.&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;whitespace&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;The 2 QUICK Brown-Foxes jumped over the lazy dog&#39;s bone.&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;uax_url_email&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;Email me at john.smith@global-international.com&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT &#x2F;asciifold_example</span><br><span class="line">&#123;</span><br><span class="line">    &quot;settings&quot; : &#123;</span><br><span class="line">        &quot;analysis&quot; : &#123;</span><br><span class="line">            &quot;analyzer&quot; : &#123;</span><br><span class="line">                &quot;default&quot; : &#123;</span><br><span class="line">                    &quot;tokenizer&quot; : &quot;standard&quot;,</span><br><span class="line">                    &quot;filter&quot; : [&quot;standard&quot;, &quot;asciifolding&quot;]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DELETE &#x2F;kstem-filter</span><br><span class="line"></span><br><span class="line">PUT &#x2F;kstem-filter</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;analysis&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;myfilter&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;kstem&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, </span><br><span class="line">      &quot;analyzer&quot;: &#123;</span><br><span class="line">        &quot;defulat&quot;: &#123;</span><br><span class="line">          &quot;tokenizer&quot;: &quot;standard&quot;,</span><br><span class="line">          &quot;filter&quot;: [&quot;lowercase&quot;, &quot;myfilter&quot;]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">GET kstem-filter&#x2F;_settings</span><br><span class="line">POST &#x2F;kstem-filter&#x2F;_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;standard&quot;, </span><br><span class="line">  &quot;text&quot;: &quot;Austrian&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET &#x2F;n-gram-filter&#x2F;_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;text&quot;: &quot;ilikebeijingjingbei&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot; synonyms&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;Email me at john.smith@global-international.com&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Elasticsearch 踩坑 - 6.2.4 版本
    
    </summary>
    
    
      <category term="Elasticsearch" scheme="http://lazytime.site/categories/Elasticsearch/"/>
    
    
      <category term="Elasticsearch" scheme="http://lazytime.site/tags/Elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>小技巧：Typera如何设置高亮和自定义快捷键？</title>
    <link href="http://lazytime.site/2020/07/26/%E5%B0%8F%E6%8A%80%E5%B7%A7%EF%BC%9ATypera%E5%A6%82%E4%BD%95%E8%AE%BE%E7%BD%AE%E9%AB%98%E4%BA%AE%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BF%AB%E6%8D%B7%E9%94%AE%EF%BC%9F/"/>
    <id>http://lazytime.site/2020/07/26/%E5%B0%8F%E6%8A%80%E5%B7%A7%EF%BC%9ATypera%E5%A6%82%E4%BD%95%E8%AE%BE%E7%BD%AE%E9%AB%98%E4%BA%AE%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BF%AB%E6%8D%B7%E9%94%AE%EF%BC%9F/</id>
    <published>2020-07-26T11:59:19.000Z</published>
    <updated>2020-07-26T12:01:00.030Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Markdown-如何给文字加上高亮效果？"><a href="#Markdown-如何给文字加上高亮效果？" class="headerlink" title="Markdown 如何给文字加上高亮效果？"></a>Markdown 如何给文字加上高亮效果？</h1><h2 id="前置工作："><a href="#前置工作：" class="headerlink" title="前置工作："></a>前置工作：</h2><ol><li>最新版本的typera</li><li>NotePad++ （包括 sublime、atom 都可，但是不建议使用记事本，后面会说明原因）</li></ol><a id="more"></a><h2 id="其他："><a href="#其他：" class="headerlink" title="其他："></a>其他：</h2><p>其实官方目前已经有了案例（包括mac os X系统）</p><p>这里分享一下地址：如下</p><p><a href="http://support.typora.io/Shortcut-Keys/#change-shortcut-keys" target="_blank" rel="noopener">http://support.typora.io/Shortcut-Keys/#change-shortcut-keys</a></p><p>如果看不懂英文可以下载谷歌浏览器翻译查看</p><h2 id="开始："><a href="#开始：" class="headerlink" title="开始："></a>开始：</h2><h3 id="第一步：随便打开一个-md后缀的文件"><a href="#第一步：随便打开一个-md后缀的文件" class="headerlink" title="第一步：随便打开一个.md后缀的文件"></a>第一步：随便打开一个.md后缀的文件</h3><p>我们可以打开typera的软件或者打开一个md 文件用typera 打开方式即可</p><h3 id="第二步：选择文件-打开偏好设置"><a href="#第二步：选择文件-打开偏好设置" class="headerlink" title="第二步：选择文件,打开偏好设置"></a>第二步：选择文件,打开偏好设置</h3><p>在打开的偏好设置里面，我们需要勾选<strong>高亮</strong>选项</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20200519224209.png?ynotemdtimestamp=1595748679079" alt="img"></p><h3 id="第三步：点击下方的高级设置，打开一个名为conf-user-json的文件"><a href="#第三步：点击下方的高级设置，打开一个名为conf-user-json的文件" class="headerlink" title="第三步：点击下方的高级设置，打开一个名为conf.user.json的文件"></a>第三步：点击下方的高级设置，打开一个名为<code>conf.user.json</code>的文件</h3><p>下面我截取了部分配置，只要参考设置快捷键即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Custom key binding, which will override the default ones.</span><br><span class="line">  &quot;keyBinding&quot;: &#123;</span><br><span class="line">    &#x2F;&#x2F; for example: </span><br><span class="line">    &#x2F;&#x2F;&quot;Always on Top&quot;: &quot;Ctrl+Shift+P&quot;,</span><br><span class="line">    &#x2F;&#x2F; 设置高亮快捷键</span><br><span class="line">&quot;Highlight&quot;: &quot;Ctrl+Shift+H&quot;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><h3 id="第四步：注意：需要重新启动typera才能生效"><a href="#第四步：注意：需要重新启动typera才能生效" class="headerlink" title="第四步：注意：需要重新启动typera才能生效"></a>第四步：注意：需要重新启动typera才能生效</h3><p>我们按下Ctrl+Shift+H就可以实现文字高亮了，是不是特别方便</p><p>重启typera之后，我们可以体验高亮功能了，高亮功能还是十分有用的，不仅在文字里面高亮，在目录里面也有对应到展示，非常直观方便，让我们抓住重点</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20200519224657.png?ynotemdtimestamp=1595748679079" alt="img"></p>]]></content>
    
    <summary type="html">
    
      Markdown 如何给文字加上高亮效果？
    
    </summary>
    
    
      <category term="笔记" scheme="http://lazytime.site/categories/%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="实用" scheme="http://lazytime.site/tags/%E5%AE%9E%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>JDK1.8 日期类</title>
    <link href="http://lazytime.site/2020/07/26/JDK1-8-%E6%97%A5%E6%9C%9F%E7%B1%BB/"/>
    <id>http://lazytime.site/2020/07/26/JDK1-8-%E6%97%A5%E6%9C%9F%E7%B1%BB/</id>
    <published>2020-07-26T11:57:44.000Z</published>
    <updated>2020-07-26T12:00:41.845Z</updated>
    
    <content type="html"><![CDATA[<h1 id="参考博客"><a href="#参考博客" class="headerlink" title="参考博客"></a><a href="https://lw900925.github.io/java/java8-newtime-api.html" target="_blank" rel="noopener">参考博客</a></h1><a id="more"></a><h1 id="获取指定时间的上一个工作日和下一个工作日（无判断节假日，调休）"><a href="#获取指定时间的上一个工作日和下一个工作日（无判断节假日，调休）" class="headerlink" title="获取指定时间的上一个工作日和下一个工作日（无判断节假日，调休）"></a>获取指定时间的上一个工作日和下一个工作日（无判断节假日，调休）</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * 获取指定时间的上一个工作日</span><br><span class="line">     *</span><br><span class="line">     * @param time           指定时间</span><br><span class="line">     * @param formattPattern 格式化参数</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static String getPreWorkDay(String time, String formattPattern) &#123;</span><br><span class="line">        DateTimeFormatter dateTimeFormatter &#x3D; generateDefualtPattern(formattPattern);</span><br><span class="line">        LocalDateTime compareTime1 &#x3D; LocalDateTime.parse(time, dateTimeFormatter);</span><br><span class="line">        compareTime1 &#x3D; compareTime1.with(temporal -&gt; &#123;</span><br><span class="line">            &#x2F;&#x2F; 当前日期</span><br><span class="line">            DayOfWeek dayOfWeek &#x3D; DayOfWeek.of(temporal.get(ChronoField.DAY_OF_WEEK));</span><br><span class="line">            &#x2F;&#x2F; 正常情况下，每次减去一天</span><br><span class="line">            int dayToMinu &#x3D; 1;</span><br><span class="line">            &#x2F;&#x2F; 如果是周日，减去2天</span><br><span class="line">            if (dayOfWeek &#x3D;&#x3D; DayOfWeek.SUNDAY) &#123;</span><br><span class="line">                dayToMinu &#x3D; 2;</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F; 如果是周六，减去一天</span><br><span class="line">            if (dayOfWeek &#x3D;&#x3D; DayOfWeek.SATURDAY) &#123;</span><br><span class="line">                dayToMinu &#x3D; 1;</span><br><span class="line">            &#125;</span><br><span class="line">            return temporal.minus(dayToMinu, ChronoUnit.DAYS);</span><br><span class="line">        &#125;);</span><br><span class="line">        return compareTime1.format(dateTimeFormatter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 获取指定时间的下一个工作日</span><br><span class="line">     *</span><br><span class="line">     * @param time           指定时间</span><br><span class="line">     * @param formattPattern 格式参数</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static String getNextWorkDay(String time, String formattPattern) &#123;</span><br><span class="line">        DateTimeFormatter dateTimeFormatter &#x3D; generateDefualtPattern(formattPattern);</span><br><span class="line">        LocalDateTime compareTime1 &#x3D; LocalDateTime.parse(time, dateTimeFormatter);</span><br><span class="line">        compareTime1 &#x3D; compareTime1.with(temporal -&gt; &#123;</span><br><span class="line">            &#x2F;&#x2F; 当前日期</span><br><span class="line">            DayOfWeek dayOfWeek &#x3D; DayOfWeek.of(temporal.get(ChronoField.DAY_OF_WEEK));</span><br><span class="line">            &#x2F;&#x2F; 正常情况下，每次增加一天</span><br><span class="line">            int dayToAdd &#x3D; 1;</span><br><span class="line">            &#x2F;&#x2F; 如果是星期五，增加三天</span><br><span class="line">            if (dayOfWeek &#x3D;&#x3D; DayOfWeek.FRIDAY) &#123;</span><br><span class="line">                dayToAdd &#x3D; 3;</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F; 如果是星期六，增加两天</span><br><span class="line">            if (dayOfWeek &#x3D;&#x3D; DayOfWeek.SATURDAY) &#123;</span><br><span class="line">                dayToAdd &#x3D; 2;</span><br><span class="line">            &#125;</span><br><span class="line">            return temporal.plus(dayToAdd, ChronoUnit.DAYS);</span><br><span class="line">        &#125;);</span><br><span class="line">        return compareTime1.format(dateTimeFormatter);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1 id="LocalDate、LocalTime、LocalDateTime-三者区别"><a href="#LocalDate、LocalTime、LocalDateTime-三者区别" class="headerlink" title="LocalDate、LocalTime、LocalDateTime 三者区别"></a>LocalDate、LocalTime、LocalDateTime 三者区别</h1><p><code>LocalDate</code>：类表示一个具体的日期，但不包含具体时间，也不包含时区信息。可以通过<code>LocalDate</code>的静态方法<code>of()</code>创建一个实例，<code>LocalDate</code>也包含一些方法用来获取年份，月份，天，星期几等</p><p><code>LocalTime</code>：和<code>LocalDate</code>类似，区别在于包含具体时间</p><p><code>LocalDateTime</code>：<code>LocalDateTime</code>类是<code>LocalDate</code>和<code>LocalTime</code>的结合体，可以通过<code>of()</code>方法直接创建，也可以调用<code>LocalDate</code>的<code>atTime()</code>方法或<code>LocalTime</code>的<code>atDate()</code>方法将<code>LocalDate</code>或<code>LocalTime</code>合并成一个<code>LocalDateTime</code>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LocalDateTime ldt1 &#x3D; LocalDateTime.of(2017, Month.JANUARY, 4, 17, 23, 52);</span><br><span class="line"></span><br><span class="line">LocalDate localDate &#x3D; LocalDate.of(2017, Month.JANUARY, 4);</span><br><span class="line">LocalTime localTime &#x3D; LocalTime.of(17, 23, 52);</span><br><span class="line">LocalDateTime ldt2 &#x3D; localDate.atTime(localTime);</span><br></pre></td></tr></table></figure><h2 id="时间戳"><a href="#时间戳" class="headerlink" title="时间戳"></a>时间戳</h2><h3 id="Instant"><a href="#Instant" class="headerlink" title="Instant"></a><code>Instant</code></h3><p><code>Instant</code>用于表示一个时间戳，它与我们常使用的<code>System.currentTimeMillis()</code>有些类似，不过<code>Instant</code>可以精确到纳秒（Nano-Second）</p><blockquote><p>注意： 内部使用了两个常量，<code>seconds</code>表示从1970-01-01 00:00:00开始到现在的秒数，<code>nanos</code>表示纳秒部分（<code>nanos</code>的值不会超过<code>999,999,999</code>）</p></blockquote><h3 id="Duration"><a href="#Duration" class="headerlink" title="Duration"></a><code>Duration</code></h3><p><code>Duration</code>的内部实现与<code>Instant</code>类似，也是包含两部分：<code>seconds</code>表示秒，<code>nanos</code>表示纳秒。两者的区别是<code>Instant</code>用于表示一个时间戳（或者说是一个时间点），而<code>Duration</code>表示一个时间段</p><h3 id="Period"><a href="#Period" class="headerlink" title="Period"></a><code>Period</code></h3><p><code>Period</code>在概念上和<code>Duration</code>类似，区别在于<code>Period</code>是以年月日来衡量一个时间段，比如2年3个月6天：</p><h1 id="问题1：错误"><a href="#问题1：错误" class="headerlink" title="问题1：错误"></a>问题1：错误</h1><p>报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Text &#39;2020-09-01&#39; could not be parsed: Unable to obtain LocalDateTime from TemporalAccessor: &#123;&#125;,ISO resolved to 2020-09-01 of type java.time.format.Parsed</span><br></pre></td></tr></table></figure><p>##　解决办法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_28988969&#x2F;article&#x2F;details&#x2F;90610580</span><br></pre></td></tr></table></figure><h1 id="问题2：-学习jdk1-8-的时间"><a href="#问题2：-学习jdk1-8-的时间" class="headerlink" title="问题2： 学习jdk1.8 的时间"></a>问题2： 学习jdk1.8 的时间</h1><p><a href="https://www.jianshu.com/p/f4abe1e38e09" target="_blank" rel="noopener">https://www.jianshu.com/p/f4abe1e38e09</a></p><h1 id="问题3-关于js端口的时间格式化问题"><a href="#问题3-关于js端口的时间格式化问题" class="headerlink" title="问题3: 关于js端口的时间格式化问题"></a>问题3: 关于js端口的时间格式化问题</h1><p>问题： new Date() 方法如何当前设备的时间是错的会出现问题</p><h1 id="问题4：-时间比较的问题"><a href="#问题4：-时间比较的问题" class="headerlink" title="问题4： 时间比较的问题"></a>问题4： 时间比较的问题</h1><p>比较的常用方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;格式化日期</span><br><span class="line">var format &#x3D; function (time, format) &#123;</span><br><span class="line">    var t &#x3D; new Date(time);</span><br><span class="line">    var tf &#x3D; function (i) &#123;</span><br><span class="line">        return (i &lt; 10 ? &#39;0&#39; : &#39;&#39;) + i</span><br><span class="line">    &#125;;</span><br><span class="line">    return format.replace(&#x2F;yyyy|MM|dd|HH|mm|ss&#x2F;g, function (a) &#123;</span><br><span class="line">        switch (a) &#123;</span><br><span class="line">            case &#39;yyyy&#39;:</span><br><span class="line">                return tf(t.getFullYear());</span><br><span class="line">                break;</span><br><span class="line">            case &#39;MM&#39;:</span><br><span class="line">                return tf(t.getMonth() + 1);</span><br><span class="line">                break;</span><br><span class="line">            case &#39;mm&#39;:</span><br><span class="line">                return tf(t.getMinutes());</span><br><span class="line">                break;</span><br><span class="line">            case &#39;dd&#39;:</span><br><span class="line">                return tf(t.getDate());</span><br><span class="line">                break;</span><br><span class="line">            case &#39;HH&#39;:</span><br><span class="line">                return tf(t.getHours());</span><br><span class="line">                break;</span><br><span class="line">            case &#39;ss&#39;:</span><br><span class="line">                return tf(t.getSeconds());</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        ;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="问题5：调用format出现Text-39-2020-06-02-15-22-22-39-could-not-be-parsed-unparsed-text-found-at-index-10"><a href="#问题5：调用format出现Text-39-2020-06-02-15-22-22-39-could-not-be-parsed-unparsed-text-found-at-index-10" class="headerlink" title="问题5：调用format出现Text &#39;2020-06-02 15:22:22&#39; could not be parsed, unparsed text found at index 10"></a>问题5：调用format出现<code>Text &#39;2020-06-02 15:22:22&#39; could not be parsed, unparsed text found at index 10</code></h1><p>问题原因：使用错误的格式去格式字符串，比如<code>yyyy-MM-dd</code> 格式化 <code>2020-05-12 12:15:33</code> 这种格式就会出现溢出 解决办法：使用正确的格式即可</p><p>学习参考</p><p><a href="https://lw900925.github.io/java/java8-newtime-api.html" target="_blank" rel="noopener">https://lw900925.github.io/java/java8-newtime-api.html</a></p><p>关于格式化的问题</p><ol><li>对于上面几个问题的根本解决办法 原因：因为localdatetime 在进行格式化的时候如何case没有找到对应的格式，那么就会出现类似<code>unsupport</code>方法</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * 生成默认的格式器</span><br><span class="line">     *</span><br><span class="line">     * @param timeFormat 指定格式</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static DateTimeFormatter generateDefualtPattern(String timeFormat) &#123;</span><br><span class="line">        return new DateTimeFormatterBuilder().appendPattern(timeFormat)</span><br><span class="line">                .parseDefaulting(ChronoField.HOUR_OF_DAY, 1)</span><br><span class="line">                .parseDefaulting(ChronoField.MINUTE_OF_HOUR, 1)</span><br><span class="line">                .parseDefaulting(ChronoField.SECOND_OF_MINUTE, 0)</span><br><span class="line">                .toFormatter(Locale.CHINA);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol><li><h1 id="问题6：关于DateTimeParseException"><a href="#问题6：关于DateTimeParseException" class="headerlink" title="问题6：关于DateTimeParseException"></a>问题6：关于DateTimeParseException</h1></li></ol><p>参考了下面到异常日志，根本的原因是<code>DateTimeFormatter</code>格式化没有<code>HH</code>选项，需要根据问题5的解决方式进行处理</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.time.format.DateTimeParseException: Text &#39;2017-02-02 08:59:12&#39; could not be parsed: Unable to obtain LocalDateTime from TemporalAccessor: &#123;MinuteOfHour&#x3D;59, NanoOfSecond&#x3D;0, SecondOfMinute&#x3D;12, MicroOfSecond&#x3D;0, MilliOfSecond&#x3D;0, HourOfAmPm&#x3D;8&#125;,ISO resolved to 2017-02-02 of type java.time.format.Parsed</span><br></pre></td></tr></table></figure><p>StackFlow地址：<a href="https://stackoverflow.com/questions/43732751/datetimeparseexception-text-could-not-be-parsed-unable-to-obtain-localdatetime" target="_blank" rel="noopener">DateTimeParseException: Text could not be parsed: Unable to obtain LocalDateTime from TemporalAccessor</a></p><p>StackFlow地址：<a href="https://stackoverflow.com/questions/43732751/datetimeparseexception-text-could-not-be-parsed-unable-to-obtain-localdatetime?rq=1" target="_blank" rel="noopener">StackFlow无法解析文本：无法从TemporalAccessor获取LocalDateTime</a></p><p>StackFlow地址：<a href="https://stackoverflow.com/questions/27454025/unable-to-obtain-localdatetime-from-temporalaccessor-when-parsing-localdatetime" target="_blank" rel="noopener">解析LocalDateTime（Java 8）时，无法从TemporalAccessor获取LocalDateTime</a></p><h1 id="其他问题收集"><a href="#其他问题收集" class="headerlink" title="其他问题收集"></a>其他问题收集</h1><h2 id="关于LocalDate-class的一个坑"><a href="#关于LocalDate-class的一个坑" class="headerlink" title="关于LocalDate.class的一个坑"></a>关于LocalDate.class的一个坑</h2><p><a href="https://stackoverflow.com/questions/23069370/format-a-date-using-the-new-date-time-api/23069408" target="_blank" rel="noopener">关于LocalDate一些源码分析</a></p><p>直接上源代码</p><ol><li><code>LocalDate</code>仅代表一个日期，而不代表DateTime。因此，在格式化时，“ HH：mm：ss”是毫无意义的</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">private int get0(TemporalField field) &#123;</span><br><span class="line">        switch ((ChronoField) field) &#123;</span><br><span class="line">            case DAY_OF_WEEK: return getDayOfWeek().getValue();</span><br><span class="line">            case ALIGNED_DAY_OF_WEEK_IN_MONTH: return ((day - 1) % 7) + 1;</span><br><span class="line">            case ALIGNED_DAY_OF_WEEK_IN_YEAR: return ((getDayOfYear() - 1) % 7) + 1;</span><br><span class="line">            case DAY_OF_MONTH: return day;</span><br><span class="line">            case DAY_OF_YEAR: return getDayOfYear();</span><br><span class="line">            case EPOCH_DAY: throw new UnsupportedTemporalTypeException(&quot;Invalid field &#39;EpochDay&#39; for get() method, use getLong() instead&quot;);</span><br><span class="line">            case ALIGNED_WEEK_OF_MONTH: return ((day - 1) &#x2F; 7) + 1;</span><br><span class="line">            case ALIGNED_WEEK_OF_YEAR: return ((getDayOfYear() - 1) &#x2F; 7) + 1;</span><br><span class="line">            case MONTH_OF_YEAR: return month;</span><br><span class="line">            case PROLEPTIC_MONTH: throw new UnsupportedTemporalTypeException(&quot;Invalid field &#39;ProlepticMonth&#39; for get() method, use getLong() instead&quot;);</span><br><span class="line">            case YEAR_OF_ERA: return (year &gt;&#x3D; 1 ? year : 1 - year);</span><br><span class="line">            case YEAR: return year;</span><br><span class="line">            case ERA: return (year &gt;&#x3D; 1 ? 1 : 0);</span><br><span class="line">        &#125;</span><br><span class="line">        throw new UnsupportedTemporalTypeException(&quot;Unsupported field: &quot; + field);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="格式化问题"><a href="#格式化问题" class="headerlink" title="格式化问题:"></a>格式化问题:</h2><p>调用DateFomatter 有可能的报错，基本是由于使用错误到格式或者使用错误的时间类</p><p><a href="https://stackoverflow.com/questions/39033525/error-java-time-format-datetimeparseexception-could-not-be-parsed-unparsed-tex" target="_blank" rel="noopener">Error java.time.format.DateTimeParseException: could not be parsed, unparsed text found at index 10</a></p><h1 id="侠说java8-LocalDateTime等时间使用手册（全）"><a href="#侠说java8-LocalDateTime等时间使用手册（全）" class="headerlink" title="侠说java8-LocalDateTime等时间使用手册（全）"></a>侠说java8-LocalDateTime等时间使用手册（全）</h1><p>侠说java8-LocalDateTime等时间使用手册（全），先mark后看 学习分享Java容器服务器：<a href="https://aijishu.com/a/1060000000087793" target="_blank" rel="noopener">https://aijishu.com/a/1060000000087793</a></p><h1 id="源码个人解读"><a href="#源码个人解读" class="headerlink" title="源码个人解读"></a>源码个人解读</h1><h2 id="TemporalAccessor"><a href="#TemporalAccessor" class="headerlink" title="TemporalAccessor"></a>TemporalAccessor</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.time.temporal.TemporalAccessor</span><br></pre></td></tr></table></figure><p>翻译:</p><blockquote><p>框架级别的接口定义对时间对象（例如日期，时间，偏移量或这些的某种组合）的只读访问。 这是日期，时间和偏移对象的基本接口类型。它由可以提供信息作为字段或查询的那些类实现。 大多数日期和时间信息可以表示为数字。使用TemporalField对它们进行建模，并使用长号保留数字以处理较大的值。年，月和月日是字段的简单示例，但它们还包括即时数和偏移量。有关标准字段集，请参见ChronoField。 日期/时间信息不能用数字表示两个日期/时间信息。可以使用TemporalQuery上定义的静态方法通过查询来访问它们。 子接口Temporal将这个定义扩展到一个还支持对更完整的临时对象进行调整和操纵的定义。 该接口是框架级别的接口，不应在应用程序代码中广泛使用。相反，应用程序应创建并传递具体类型的实例，例如LocalDate。造成这种情况的原因很多，部分原因是该接口的实现可能在ISO以外的日历系统中。请参阅java.time.chrono.ChronoLocalDate以获得有关该问题的更完整讨论。</p></blockquote><h3 id="接口方法：isSupported"><a href="#接口方法：isSupported" class="headerlink" title="接口方法：isSupported()"></a>接口方法：isSupported()</h3><p>方法签名：<code>boolean isSupported(TemporalField field);</code></p><blockquote><p>检查是否支持指定的字段。 这检查是否可以查询指定字段的日期时间。 如果为false，则调用range和get方法将引发异常。</p><p>参数： field –要检查的字段，null返回false 返回值： 如果可以查询该日期时间，则为true，否则为false implSpec： 实现必须检查并处理ChronoField中定义的所有字段。 如果支持该字段，则必须返回true，否则必须返回false。 如果该字段不是ChronoField，则通过调用TemporalField.isSupportedBy（TemporalAccessor）并将其作为参数来获取此方法的结果。 实现必须确保在调用此只读方法时，不会更改任何可观察的状态。</p></blockquote><h3 id="接口方法：range-TemporalField-field"><a href="#接口方法：range-TemporalField-field" class="headerlink" title="接口方法：range(TemporalField field)"></a>接口方法：range(TemporalField field)</h3><p>方法签名：<code>ValueRange range(TemporalField field)</code></p><blockquote><p>获取指定字段的有效值范围。 所有字段都可以表示为长整数。此方法返回一个对象，该对象描述该值的有效范围。该时间对象的值用于增强返回范围的准确性。如果日期时间不能返回范围，则由于该字段不受支持或出于其他原因，将引发异常。 请注意，结果仅描述了最小和最大有效值，重要的是不要过多地阅读这些值。例如，在该范围内可能存在对该字段无效的值。</p><p>参数： field –查询范围的字段，不为null 返回值： 该字段的有效值范围，不为null 抛出： DateTimeException-如果无法获取该字段的范围 UnsupportedTemporalTypeException-如果不支持该字段 implSpec： 实现必须检查并处理ChronoField中定义的所有字段。如果支持该字段，则必须返回该字段的范围。如果不受支持，则必须引发UnsupportedTemporalTypeException。 如果该字段不是ChronoField，则通过调用TemporalField.rangeRefinedBy（TemporalAccessorl）并将其作为参数来获取此方法的结果。 实现必须确保在调用此只读方法时，不会更改任何可观察的状态。 默认实现必须与以下代码等效： if（ChronoField的instance字段）{if（isSupported（field））{return field.range（）; }抛出新的UnsupportedTemporalTypeException（“不支持的字段：” +字段）； } return field.rangeRefinedBy（this）;</p></blockquote><h3 id="接口方法：int-get-TemporalField-field"><a href="#接口方法：int-get-TemporalField-field" class="headerlink" title="接口方法：int get(TemporalField field)"></a>接口方法：int get(TemporalField field)</h3><blockquote><p>以int形式获取指定字段的值。 这将查询日期时间以获取指定字段的值。返回的值将始终在该字段的值的有效范围内。如果日期时间由于该字段不受支持或出于某些其他原因而无法返回该值，则将引发异常。</p><p>参数： field-要获取的字段，不为null 返回值： 有效值范围内的字段值 抛出： DateTimeException-如果无法获取该字段的值或该值超出该字段的有效值范围 UnsupportedTemporalTypeException-如果不支持该字段或值的范围超出int ArithmeticException-如果发生数字溢出 implSpec： 实现必须检查并处理ChronoField中定义的所有字段。如果该字段受支持并且具有int范围，则必须返回该字段的值。如果不受支持，则必须引发UnsupportedTemporalTypeException。 如果该字段不是ChronoField，则通过调用TemporalField.getFrom（TemporalAccessor）并将其作为参数来获取此方法的结果。 实现必须确保在调用此只读方法时，不会更改任何可观察的状态。 默认实现必须与以下代码等效： if（range（field）.isIntValue（））{返回range（field）.checkValidIntValue（getLong（field），field）; }抛出新的UnsupportedTemporalTypeException（“无效字段” +字段+“ +对于get（）方法，请使用getLong（）代替”）；</p></blockquote><h3 id="接口方法：default-R-query-TemporalQuery-query"><a href="#接口方法：default-R-query-TemporalQuery-query" class="headerlink" title="接口方法：default  R query(TemporalQuery query)"></a>接口方法：default <R> R query(TemporalQuery<R> query)</h3>]]></content>
    
    <summary type="html">
    
      JDK1.8 日期类
    
    </summary>
    
    
      <category term="JAVA" scheme="http://lazytime.site/categories/JAVA/"/>
    
    
      <category term="JDK1.8" scheme="http://lazytime.site/tags/JDK1-8/"/>
    
  </entry>
  
  <entry>
    <title>《并发编程实战》笔记</title>
    <link href="http://lazytime.site/2020/07/26/%E3%80%8A%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/"/>
    <id>http://lazytime.site/2020/07/26/%E3%80%8A%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0/</id>
    <published>2020-07-26T11:54:58.000Z</published>
    <updated>2020-07-26T11:57:12.083Z</updated>
    
    <content type="html"><![CDATA[<h1 id="《并发编程实战》笔记"><a href="#《并发编程实战》笔记" class="headerlink" title="《并发编程实战》笔记"></a>《并发编程实战》笔记</h1><h2 id="1-并发编程的优势"><a href="#1-并发编程的优势" class="headerlink" title="1. 并发编程的优势"></a>1. 并发编程的优势</h2><ol><li>发挥多处理器的能力</li><li>建模简单</li><li>异步处理任务</li></ol><h2 id="2-活跃性问题和性能问题"><a href="#2-活跃性问题和性能问题" class="headerlink" title="2. 活跃性问题和性能问题"></a>2. 活跃性问题和性能问题</h2><ol><li>上下文的切换问题</li></ol><h3 id="2-1-重排序"><a href="#2-1-重排序" class="headerlink" title="2.1 重排序"></a>2.1 重排序</h3><p>重排序：当A线程修改变量，而B线程读取变量的时候，根据处理器的切换，可以出现非常复杂到可能性</p><a id="more"></a><h2 id="3-线程安全"><a href="#3-线程安全" class="headerlink" title="3. 线程安全"></a>3. 线程安全</h2><h3 id="3-1-同步带来的问题修复办法"><a href="#3-1-同步带来的问题修复办法" class="headerlink" title="3.1 同步带来的问题修复办法"></a>3.1 同步带来的问题修复办法</h3><ol><li>不再线程之前共享该变量状态</li><li>状态变量不可变</li><li>访问状态的时候同步</li></ol><h3 id="3-2-线程安全性"><a href="#3-2-线程安全性" class="headerlink" title="3.2 线程安全性"></a>3.2 线程安全性</h3><p>线程的正确性</p><ul><li>某个类到行为和规范完全一致</li><li>所见即所知</li></ul><blockquote><p>当多个线程访问某个类，不管运行环境使用什么方式调用或者线程将交替运行，主调代码不需要任何额外的同步或者协同，都能表现正确行为</p></blockquote><blockquote><p>线程安全类封装了必要到同步机制，客户端是无法进行进一步措施的</p></blockquote><blockquote><p>无状态对象一定是想线程安全的</p></blockquote><h3 id="3-3-锁的类型"><a href="#3-3-锁的类型" class="headerlink" title="3.3 锁的类型"></a>3.3 锁的类型</h3><h4 id="3-3-1-内置锁（互斥锁）"><a href="#3-3-1-内置锁（互斥锁）" class="headerlink" title="3.3.1 内置锁（互斥锁）"></a>3.3.1 内置锁（互斥锁）</h4><p>就是被<code>synchronize</code>关键字修饰到方法</p><p>特性：当用户持有内置锁的时候，只有一个线程可以持有此锁，例如：如果A持有了锁，B访问，B就会阻塞</p><ol><li>静态的<code>synchronize</code>方法以Class作为锁</li><li>java内置锁的基本代为是对象</li></ol><p>优点：</p><ol><li>可以是方法具有原子性</li><li>多个线程访问不会发生竞态条件</li></ol><p>缺点：</p><ol><li>导致代码完全同步</li><li>严重消耗性能</li></ol><h4 id="3-3-2-可重入锁"><a href="#3-3-2-可重入锁" class="headerlink" title="3.3.2 可重入锁"></a>3.3.2 可重入锁</h4><p>特性：如果一个线程持有由他自己持有的锁，将重入，意味着锁到细粒度为“线程”，不是“调用”，</p><blockquote><p>如果内置锁不是可重入的，那么将会发生死锁</p></blockquote><h3 id="3-4-用锁来保护状态"><a href="#3-4-用锁来保护状态" class="headerlink" title="3.4 用锁来保护状态"></a>3.4 用锁来保护状态</h3><blockquote><p>错误认知：</p><p>操作共享到变量的时候才需要同步</p><p>正确方式：</p></blockquote><p>只有多个线程同时访问的可变数据才需要通过锁保护</p><blockquote><p>可能被多个线程访问的可变状态常量，在访问他的时候，需要持有同一个锁，这个变量是锁保护的</p></blockquote><p>当一个方法执行时间较长，并且不会影响状态改变的时候，一定不能够使用锁</p><h3 id="3-5-内存可见性"><a href="#3-5-内存可见性" class="headerlink" title="3.5 内存可见性"></a>3.5 内存可见性</h3><p>除开原子性之外，锁的另一个重要作用是实现内存上可见</p><h4 id="3-5-1-什么是内存可见性："><a href="#3-5-1-什么是内存可见性：" class="headerlink" title="3.5.1 什么是内存可见性："></a>3.5.1 什么是内存可见性：</h4><p>内存可见性是指一个共享变量在A线程可以看到线程B的到操作，防止A读取到失效数据</p><h4 id="3-5-2-Volatie-变量"><a href="#3-5-2-Volatie-变量" class="headerlink" title="3.5.2 Volatie 变量"></a>3.5.2 Volatie 变量</h4><p>什么时候使用Volatie变量</p><ol><li>对变量的写入操作不依赖变量得值，或者确保某个单线程会修改变量才使用</li><li>此变量不会和其他状态变量一起纳入不变性条件</li><li>访问变量的时候不需要加锁</li></ol><h3 id="3-6-发布和逸出"><a href="#3-6-发布和逸出" class="headerlink" title="3.6 发布和逸出"></a>3.6 发布和逸出</h3><p>发布：指一个对象发布到另一个对象的作用域里面，脱离当前作用域</p><p>逸出：被发布的对象同时发布了其他对象的信息，这时候就是逸出</p><h2 id="4-线程封闭"><a href="#4-线程封闭" class="headerlink" title="4. 线程封闭"></a>4. 线程封闭</h2><h3 id="4-1-Ad-hoc-线程封闭"><a href="#4-1-Ad-hoc-线程封闭" class="headerlink" title="4.1 Ad-hoc 线程封闭"></a>4.1 Ad-hoc 线程封闭</h3><p>含义：线程封闭（Thread Confinement）：仅在单线程内访问数据，不需要同步。</p><h3 id="4-2-栈封闭"><a href="#4-2-栈封闭" class="headerlink" title="4.2 栈封闭"></a>4.2 栈封闭</h3><p>含义： 在栈封闭中，只能通过局部变量才能访问对象。</p><p>栈封闭（也被称为线程内部使用或者线程局部使用）比Ad-hoc线程封闭更易于维护，也更加健壮。</p><h3 id="4-3-ThreadLocal类"><a href="#4-3-ThreadLocal类" class="headerlink" title="4.3 ThreadLocal类"></a>4.3 ThreadLocal类</h3><p>这个类能使线程中的某个值与保存值的对象关联起来。ThreadLocal提供了get与set等访问接口或方法，这些方法为每个使用该变量的线程都存有一份独立的副本，因此get总是返回由当前执行线程在调用set时设置的最新值。</p><h2 id="5-不变性"><a href="#5-不变性" class="headerlink" title="5. 不变性"></a>5. 不变性</h2><blockquote><p>什么是不可变对象？</p><ol><li>创建之后不允许改变</li><li>对象的所有域都是final</li><li>对象是正确创建的（this没有逸出）</li></ol></blockquote><h2 id="Final"><a href="#Final" class="headerlink" title="Final"></a>Final</h2><ol><li>如果不需要域是不可变的，则需要尽量为private</li><li>如果对象不需要改变，尽量为private 域</li></ol><h2 id="安全发布"><a href="#安全发布" class="headerlink" title="安全发布"></a>安全发布</h2>]]></content>
    
    <summary type="html">
    
      《并发编程实战》笔记
    
    </summary>
    
    
      <category term="书籍" scheme="http://lazytime.site/categories/%E4%B9%A6%E7%B1%8D/"/>
    
    
      <category term="笔记" scheme="http://lazytime.site/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>使用Hibernate JSP 303 整合到SSM项目</title>
    <link href="http://lazytime.site/2020/07/26/%E4%BD%BF%E7%94%A8Hibernate-JSP-303-%E6%95%B4%E5%90%88%E5%88%B0SSM%E9%A1%B9%E7%9B%AE/"/>
    <id>http://lazytime.site/2020/07/26/%E4%BD%BF%E7%94%A8Hibernate-JSP-303-%E6%95%B4%E5%90%88%E5%88%B0SSM%E9%A1%B9%E7%9B%AE/</id>
    <published>2020-07-26T09:46:26.000Z</published>
    <updated>2020-07-26T09:46:47.247Z</updated>
    
    <content type="html"><![CDATA[<h1 id="需求："><a href="#需求：" class="headerlink" title="需求："></a>需求：</h1><ol><li>在项目中加入注解校验</li><li>可以控制错误的操作</li><li>对于参数错误进行全局日志记录，方便后续查看</li></ol><a id="more"></a><h1 id="使用Hibernate-JSP-303-整合到项目"><a href="#使用Hibernate-JSP-303-整合到项目" class="headerlink" title="使用Hibernate JSP 303 整合到项目"></a>使用Hibernate JSP 303 整合到项目</h1><p><a href="https://juejin.im/post/5d3fbeb46fb9a06b317b3c48" target="_blank" rel="noopener">https://juejin.im/post/5d3fbeb46fb9a06b317b3c48</a></p><p><a href="https://zhuanlan.zhihu.com/p/49589845" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/49589845</a></p><h2 id="ValidataUtils"><a href="#ValidataUtils" class="headerlink" title="ValidataUtils"></a>ValidataUtils</h2><p>此工具类配置可以大大减少配置<a href="https://github.com/hjzgg/usually_util/blob/master/spring-validate-demo/validator/ValidatorUtils.java" target="_blank" rel="noopener">https://github.com/hjzgg/usually_util/blob/master/spring-validate-demo/validator/ValidatorUtils.java</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public Validator validator() &#123;</span><br><span class="line">    return new LocalValidatorFactoryBean();</span><br><span class="line">&#125;</span><br><span class="line">@Component</span><br><span class="line">public class ValidatorUtils implements ApplicationContextAware &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException &#123;</span><br><span class="line">        ValidatorUtils.validator &#x3D; (Validator) applicationContext.getBean(&quot;validator&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static Validator validator;</span><br><span class="line"></span><br><span class="line">    public static Optional&lt;String&gt; validateResultProcess(Object obj)  &#123;</span><br><span class="line">        Set&lt;ConstraintViolation&lt;Object&gt;&gt; results &#x3D; validator.validate(obj);</span><br><span class="line">        if (CollectionUtils.isEmpty(results)) &#123;</span><br><span class="line">            return Optional.empty();</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuilder sb &#x3D; new StringBuilder();</span><br><span class="line"></span><br><span class="line">        for (Iterator&lt;ConstraintViolation&lt;Object&gt;&gt; iterator &#x3D; results.iterator(); iterator.hasNext(); ) &#123;</span><br><span class="line">            sb.append(iterator.next().getMessage());</span><br><span class="line">            if (iterator.hasNext()) &#123;</span><br><span class="line">                sb.append(&quot; ,&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return Optional.of(sb.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="自定义校验器"><a href="#自定义校验器" class="headerlink" title="自定义校验器"></a>自定义校验器</h2><p><a href="https://www.jb51.net/article/174064.htm" target="_blank" rel="noopener">https://www.jb51.net/article/174064.htm</a></p><h2 id="自定义校验规则："><a href="#自定义校验规则：" class="headerlink" title="自定义校验规则："></a>自定义校验规则：</h2><p><a href="https://songwell1024.github.io/2018/08/02/JSR303/" target="_blank" rel="noopener">https://songwell1024.github.io/2018/08/02/JSR303/</a></p><h2 id="解决思路："><a href="#解决思路：" class="headerlink" title="解决思路："></a>解决思路：</h2><h3 id="第一种：使用-Valid-加上-BindResult"><a href="#第一种：使用-Valid-加上-BindResult" class="headerlink" title="第一种：使用@Valid 加上 BindResult"></a>第一种：使用<code>@Valid</code> 加上 <code>BindResult</code></h3><p>注意事项： <code>@valid</code> 加入的DTO后面必须跟上 <code>BindResult</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@valid&#96; 加入的DTO后面必须跟上 &#96;BindResult&#96;&#96;@valid&#96; 加入的DTO后面必须跟上 &#96;BindResult</span><br></pre></td></tr></table></figure><p>，如果不按此规则，将会由Spring的 <code>bindException</code> 直接抛出异常</p><h3 id="第二种：使用切面的方式统一处理异常"><a href="#第二种：使用切面的方式统一处理异常" class="headerlink" title="第二种：使用切面的方式统一处理异常"></a>第二种：使用切面的方式统一处理异常</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Aspect</span><br><span class="line">@Component</span><br><span class="line">public class ControllerValidatorInterceptor &#123;</span><br><span class="line">    </span><br><span class="line">    &#x2F;**</span><br><span class="line">    * 设置 around 环绕通知切面</span><br><span class="line">    *&#x2F;</span><br><span class="line">    @Around(&quot;execution(* com.aerexu.web.*.*(..)) &amp;&amp; args(..,bindingResult)&quot;)</span><br><span class="line">    public Object doAround(ProceedingJoinPoint pjp, BindingResult bindingResult) throws Throwable &#123;</span><br><span class="line">        Object retVal;</span><br><span class="line">        if (bindingResult.hasErrors()) &#123;</span><br><span class="line">            retVal &#x3D; doErrorHandle();</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            retVal &#x3D; pjp.proceed();</span><br><span class="line">        &#125;</span><br><span class="line">        return retVal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="实用bindResult-到最佳实践"><a href="#实用bindResult-到最佳实践" class="headerlink" title="实用bindResult 到最佳实践"></a>实用bindResult 到最佳实践</h2><p><a href="https://vimsky.com/zh-tw/examples/detail/java-class-org.springframework.validation.BindingResult.html" target="_blank" rel="noopener">https://vimsky.com/zh-tw/examples/detail/java-class-org.springframework.validation.BindingResult.html</a></p><p>真的写的十分好，这里分享出来</p><h2 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Null  被注释的元素必须为null</span><br><span class="line">@NotNull  被注释的元素不能为null</span><br><span class="line">@AssertTrue  被注释的元素必须为true</span><br><span class="line">@AssertFalse  被注释的元素必须为false</span><br><span class="line">@Min(value)  被注释的元素必须是一个数字，其值必须大于等于指定的最小值</span><br><span class="line">@Max(value)  被注释的元素必须是一个数字，其值必须小于等于指定的最大值</span><br><span class="line">@DecimalMin(value)  被注释的元素必须是一个数字，其值必须大于等于指定的最小值</span><br><span class="line">@DecimalMax(value)  被注释的元素必须是一个数字，其值必须小于等于指定的最大值</span><br><span class="line">@Size(max,min)  被注释的元素的大小必须在指定的范围内。</span><br><span class="line">@Digits(integer,fraction)  被注释的元素必须是一个数字，其值必须在可接受的范围内</span><br><span class="line">@Past  被注释的元素必须是一个过去的日期</span><br><span class="line">@Future  被注释的元素必须是一个将来的日期</span><br><span class="line">@Pattern(value) 被注释的元素必须符合指定的正则表达式。</span><br><span class="line">@Email 被注释的元素必须是电子邮件地址</span><br><span class="line">@Length 被注释的字符串的大小必须在指定的范围内</span><br><span class="line">@NotEmpty  被注释的字符串必须非空</span><br><span class="line">@Range  被注释的元素必须在合适的范围内</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      请输入描述信息
    
    </summary>
    
    
      <category term="未分类" scheme="http://lazytime.site/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/"/>
    
    
      <category term="无" scheme="http://lazytime.site/tags/%E6%97%A0/"/>
    
  </entry>
  
  <entry>
    <title>《从零开始的架构探险》归纳总结</title>
    <link href="http://lazytime.site/2020/07/26/%E3%80%8A%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E6%9E%B6%E6%9E%84%E6%8E%A2%E9%99%A9%E3%80%8B%E5%BD%92%E7%BA%B3%E6%80%BB%E7%BB%93/"/>
    <id>http://lazytime.site/2020/07/26/%E3%80%8A%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E6%9E%B6%E6%9E%84%E6%8E%A2%E9%99%A9%E3%80%8B%E5%BD%92%E7%BA%B3%E6%80%BB%E7%BB%93/</id>
    <published>2020-07-26T09:44:54.000Z</published>
    <updated>2020-07-26T09:46:02.651Z</updated>
    
    <content type="html"><![CDATA[<h1 id="《从零开始的架构探险》归纳总结"><a href="#《从零开始的架构探险》归纳总结" class="headerlink" title="《从零开始的架构探险》归纳总结"></a>《从零开始的架构探险》归纳总结</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>去年根据这本书实现了一个基本的SpringMVC框架，作者使用SpingMVC中依赖反转和AOP这两个核心概念用自己的理解写了一个框架。个人觉得对于SpringMVC的源码阅读是非常有帮助，现在再次回顾所学的内容</p><a id="more"></a><h2 id="起步"><a href="#起步" class="headerlink" title="起步"></a>起步</h2><h3 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h3><p>框架的最终目的是为了解决现实中不断出现的某些问题，比如频繁的创建对象</p><ol><li>用户进入“客户管理”模块，列表展示所有用户</li><li>通过”用户名称”关键字查询</li><li>单击客户列表客户名称链接，可以查看客户基本信息</li><li>单击“新增”按钮，进入“新增客户界面”， 可以增加用户信息</li><li>单击“编辑”按钮，进入“编辑客户界面”， 可以编辑当前用户信息</li><li>单击“删除”按钮，可以删除当前用户，需要给出提示</li></ol><p>依照需求我们分析出基本用户信息为：</p><ol><li>名称</li><li>联系人</li><li>电话号码</li><li>邮箱</li><li>备注</li></ol><h3 id="设计接口"><a href="#设计接口" class="headerlink" title="设计接口"></a>设计接口</h3><ol><li><p>GET: /customer</p><p>进入客户列表页面</p></li><li><p>POST：/customer_search</p><p>查找对应用户</p></li><li><p>GET: /customer_show?id={id}</p><p>查看用户</p></li><li><p>GET:/customer_create</p><p>创建用户页面</p></li><li><p>POST:/customer_create</p><p>创建用户操作</p></li><li><p>GET:/customer_eidt?id={id}</p><p>修改用户页面</p></li><li><p>POST:/customer_eidt?id={id}</p><p>修改用户操作</p></li><li><p>GET:/customer_delete?id={id}</p><p>删除操作</p></li></ol><h2 id="准备开发环境："><a href="#准备开发环境：" class="headerlink" title="准备开发环境："></a>准备开发环境：</h2><h3 id="IntelinJ-IDEA"><a href="#IntelinJ-IDEA" class="headerlink" title="IntelinJ IDEA"></a>IntelinJ IDEA</h3><p>现在破解比较麻烦了，个人建议直接某宝或者某鱼上买个破解码，直接破解到2089年，没有必要浪费时间在工具的破解上面</p><h3 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h3><p>使用3.6以上的版本</p><h3 id="JDK"><a href="#JDK" class="headerlink" title="JDK"></a>JDK</h3><p>使用JDK1.8的版本</p><h3 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h3><p>使用Tomcat 8.5 的版本</p><h2 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h2><p>具体搭建流程不做演示，这里给出一个github地址作为参考</p><p><a href="https://github.com/lazyTimes/smartframwork" target="_blank" rel="noopener">https://github.com/lazyTimes/smartframwork</a></p><p>这事框架地址，具体的实验放在一个chapter3的项目里面，git的地址如下：</p><h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><h3 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h3><p><img src="https://raw.githubusercontent.com/lazyTimes/imageRepository/master/img/Snipaste_2020-02-10_11-00-25.png?ynotemdtimestamp=1595748679079" alt="img"></p><h4 id=""><a href="#" class="headerlink" title=""></a></h4><h3 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h3><p><img src="http://null/" alt="image-20200211103431175"></p><h3 id="Bean"><a href="#Bean" class="headerlink" title="Bean"></a>Bean</h3><p><img src="http://null/" alt="image-20200211131451516"></p><h3 id="框架处理工具"><a href="#框架处理工具" class="headerlink" title="框架处理工具"></a>框架处理工具</h3><p><img src="http://null/" alt="image-20200211132349636"></p><h2 id="IOC实现思路"><a href="#IOC实现思路" class="headerlink" title="IOC实现思路"></a>IOC实现思路</h2><p>不是由用户去new 对象，而是在初始化的时候框架拿到所有的controller, 根据controller 中扫描到 的所有的inject 注解，根据此注解拿到所有的服务类信息</p><p>最简单的方式</p><ol><li>通过<code>beanHelper</code> 获取所有的<code>Bean Map</code></li><li>遍历映射关系，分别取出bean类与Bean 实例，进而通过反射获取类中所有的成员变量</li><li>遍历这些成员变量，查看是否带有@Inject 注解，如果存在，则从<code>BeanMap</code>当中取出<code>Bean</code>实例，</li><li>最后通过<code>RelectionUtil#setField</code> 修改当前成员变量的值</li></ol><h3 id="如何实现控制层的加载"><a href="#如何实现控制层的加载" class="headerlink" title="如何实现控制层的加载"></a>如何实现控制层的加载</h3><ol><li>获取所有定义了<code>Controller</code>的类</li><li>反射获取所有加了<code>Action()</code>的方法</li><li>封装一个请求对象和处理对象</li><li>请求对象和处理对象建立一个映射关系</li><li>将映射加入<code>Action Map</code></li></ol><h3 id="请求转发器"><a href="#请求转发器" class="headerlink" title="请求转发器"></a>请求转发器</h3><ol><li>通过<code>ControllerHelper</code> 获取<code>Handler</code> 对象</li><li>获取<code>Controller</code>类</li><li><code>BeanHelper</code>获取所有的<code>Contoller</code>实体对象</li><li><code>HttpServlet</code>获取所有的请求参数</li></ol><h3 id="核心代码："><a href="#核心代码：" class="headerlink" title="核心代码："></a>核心代码：</h3><p>IOC的核心是在框架启动的时候扫描对应的包下面的类注解，并且使用反射的方式对于类进行初始化操作</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 类加载工具类</span><br><span class="line"> *&#x2F;</span><br><span class="line">public final class MyClassUtil &#123;</span><br><span class="line"></span><br><span class="line">    private static final Logger LOGGER &#x3D; LoggerFactory.getLogger(MyClassUtil.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * @Description: 获取类加载器</span><br><span class="line">     * @Param: 无参数</span><br><span class="line">     * @return: 类加载器</span><br><span class="line">     * @Author: zhaoxudong</span><br><span class="line">     * @Date: 2019.9.8</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static ClassLoader getClassLoader() &#123;</span><br><span class="line">        return Thread.currentThread().getContextClassLoader();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * @param className     类名</span><br><span class="line">     * @param isInitialized 是否初始化</span><br><span class="line">     * @return 实体类</span><br><span class="line">     * @Description: 加载class类</span><br><span class="line">     * @Author zhaoxudong</span><br><span class="line">     * @Date 2019.9.8</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static Class&lt;?&gt; loadClass(String className, boolean isInitialized) &#123;</span><br><span class="line">        Class&lt;?&gt; cls;</span><br><span class="line">        try &#123;</span><br><span class="line">            cls &#x3D; Class.forName(className, isInitialized, getClassLoader());</span><br><span class="line">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            LOGGER.error(&quot;load class failure&quot;, e);</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">        return cls;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 获取指定包名下面的所有类</span><br><span class="line">     * 最为复杂也是最为核心的代码</span><br><span class="line">     *</span><br><span class="line">     * @param packageName 包名</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static Set&lt;Class&lt;?&gt;&gt; getClassesSet(String packageName) &#123;</span><br><span class="line">        &#x2F;&#x2F; 1. 创建set集合</span><br><span class="line">        Set&lt;Class&lt;?&gt;&gt; result &#x3D; new HashSet&lt;Class&lt;?&gt;&gt;();</span><br><span class="line">        &#x2F;&#x2F; 2. 获取枚举迭代器，使用递归的方式迭代所有的包</span><br><span class="line">        try &#123;</span><br><span class="line">            Enumeration&lt;URL&gt; enumeration &#x3D; getClassLoader().getResources(packageName.replace(&quot;.&quot;, &quot;&#x2F;&quot;));</span><br><span class="line">            while (enumeration.hasMoreElements()) &#123;</span><br><span class="line">                URL url &#x3D; enumeration.nextElement();</span><br><span class="line">                if (null !&#x3D; url) &#123;</span><br><span class="line">                    &#x2F;&#x2F; protocol 协议，获取协议</span><br><span class="line">                    String protocool &#x3D; url.getProtocol();</span><br><span class="line">                    &#x2F;&#x2F; 如果是一个文件</span><br><span class="line">                    if (protocool.equals(&quot;file&quot;)) &#123;</span><br><span class="line">                        &#x2F;&#x2F; 替换掉特殊符号</span><br><span class="line">                        String urlPath &#x3D; url.getPath().replaceAll(&quot;%20&quot;, &quot;&quot;);</span><br><span class="line">                        addClass(result, urlPath, packageName);</span><br><span class="line">                    &#125; else if (protocool.equals(&quot;jar&quot;)) &#123;</span><br><span class="line">                        &#x2F;&#x2F; 如果是jar包，获取jar包路径</span><br><span class="line">                        JarURLConnection jarURLConnection &#x3D; (JarURLConnection) url.openConnection();</span><br><span class="line">                        if (null !&#x3D; jarURLConnection) &#123;</span><br><span class="line">                            &#x2F;&#x2F; 获取jar包文件</span><br><span class="line">                            JarFile jarFile &#x3D; jarURLConnection.getJarFile();</span><br><span class="line">                            if (null !&#x3D; jarFile) &#123;</span><br><span class="line">                                Enumeration&lt;JarEntry&gt; entries &#x3D; jarFile.entries();</span><br><span class="line">                                &#x2F;&#x2F; 枚举迭代获取所有的jar包类</span><br><span class="line">                                while (entries.hasMoreElements()) &#123;</span><br><span class="line">                                    JarEntry jarEntry &#x3D; entries.nextElement();</span><br><span class="line">                                    &#x2F;&#x2F; 获取名称</span><br><span class="line">                                    String entryName &#x3D; jarEntry.getName();</span><br><span class="line">                                    if (entryName.equals(&quot;.class&quot;)) &#123;</span><br><span class="line">                                        String className &#x3D; entryName.substring(0, entryName.lastIndexOf(&quot;.&quot;))</span><br><span class="line">                                                .replaceAll(&quot;&#x2F;&quot;, &quot;.&quot;);</span><br><span class="line">                                        doAddClass(result, className);</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            LOGGER.error(&quot;get class set failure&quot;, e);</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 将对应类型的文件路径加入到对应的set内部</span><br><span class="line">     *</span><br><span class="line">     * @param classSet      所有的应用宝</span><br><span class="line">     * @param packagePath 文件路径</span><br><span class="line">     * @param packageName 包名</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static void addClass(Set&lt;Class&lt;?&gt;&gt; classSet, String packagePath, String packageName) &#123;</span><br><span class="line">        &#x2F;&#x2F;对于文件路径进行过滤操作</span><br><span class="line">        File[] files &#x3D; new File(packagePath).listFiles(new FileFilter() &#123;</span><br><span class="line">            public boolean accept(File file) &#123;</span><br><span class="line">                &#x2F;&#x2F; 如果是class 文件或者文件夹，允许</span><br><span class="line">                return (file.isFile() &amp;&amp; file.getName().endsWith(&quot;.class&quot;)) || file.isDirectory();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        for (File file : files) &#123;</span><br><span class="line">            &#x2F;&#x2F; 当前遍历目录的文件名</span><br><span class="line">            String fileName &#x3D; file.getName();</span><br><span class="line">            &#x2F;&#x2F; 如果是文件类型</span><br><span class="line">            if (file.isFile()) &#123;</span><br><span class="line">                String className &#x3D; fileName.substring(0, fileName.lastIndexOf(&quot;.&quot;));</span><br><span class="line">                if (MyStringUtil.isNotEmpty(className)) &#123;</span><br><span class="line">                    className &#x3D; packageName + &quot;.&quot; + className;</span><br><span class="line">                &#125;</span><br><span class="line">                doAddClass(classSet, className);</span><br><span class="line"></span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                &#x2F;&#x2F; 如果不是文件，则根据路径加载文件</span><br><span class="line">                String subPackagePath &#x3D; fileName;</span><br><span class="line">                if (MyStringUtil.isNotEmpty(packagePath)) &#123;</span><br><span class="line">                    subPackagePath &#x3D; packagePath + &quot;&#x2F;&quot; + subPackagePath;</span><br><span class="line">                &#125;</span><br><span class="line">                String subPackageName &#x3D; fileName;</span><br><span class="line">                if (MyStringUtil.isNotEmpty(packageName)) &#123;</span><br><span class="line">                    subPackageName &#x3D; packageName + &quot;.&quot; + subPackageName;</span><br><span class="line">                &#125;</span><br><span class="line">                &#x2F;&#x2F; 递归获取子包下面的文件</span><br><span class="line">                addClass(classSet, subPackagePath, subPackageName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 添加类名的统一方法</span><br><span class="line">     * 主要为根据包名加载类</span><br><span class="line">     *</span><br><span class="line">     * @param result    类集合</span><br><span class="line">     * @param className 类名</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static void doAddClass(Set&lt;Class&lt;?&gt;&gt; result, String className) &#123;</span><br><span class="line">        Class&lt;?&gt; cls &#x3D; loadClass(className, false);</span><br><span class="line">        result.add(cls);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="AOP-实现思路"><a href="#AOP-实现思路" class="headerlink" title="AOP 实现思路"></a>AOP 实现思路</h2><h3 id="定义切面注解"><a href="#定义切面注解" class="headerlink" title="定义切面注解"></a>定义切面注解</h3><p>value：表示注解类，用来指定controller这一类注解</p><h3 id="搭建代理框架"><a href="#搭建代理框架" class="headerlink" title="搭建代理框架"></a>搭建代理框架</h3><ol><li>使用链式调用的方法生产代理对象</li><li>需要写一个类，提供创建代理对象的方法，输入一个目标类和一组Proxy, 输出代理对象，用于创建所有的代理对象</li><li>使用切面来管理所有的代理对象创建，因为切面需要拿到目标方法以及被调用的前后增加逻辑，<ol><li>写一个抽象类，提供模板，具体实现中扩展，定为AspectProxy</li></ol></li><li>使用一个日志切面对于代理操作进行增强</li></ol><h3 id="加载AOP框架"><a href="#加载AOP框架" class="headerlink" title="加载AOP框架"></a>加载AOP框架</h3><p>整个框架使用ProxyManager 创建代理对象</p><p>将代理对象放入框架底层的Bean Map,通过IOC将被代理的对象注入到其他对象</p><ol><li>在BeanHelper 当中增加一个添加Bean实例的方法</li><li>扩展ClassHelper , 增加一个获取某个父类的所有子类或者实现类，以及获取带有某个注解的所有类的方法</li></ol><p>获取Aspect 注解中设置的注解类，若该注解不是Aspect 类，则可以调用ClassHelper#getClassSetByAnnotation 获取相关类， 放入目标类集合， 最终返回这些集合</p><p>需要将代理类以及目标类集合的映射关系获取，一个代理对应一个或者多个目标类，代理类指定是切面类，通过以下代码或者映射关系</p><p>代理类需要扩展AspectProxy抽象类,还需要Aspect注解，只有两者都满足，才能根据Aspect注解定义的注解属性去获取改注解对应的目标类集合，才能建立代理类与目标类的集合，才能返回映射</p><h3 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">public final class AopHelper &#123;</span><br><span class="line"></span><br><span class="line">    private static final Logger LOGGER &#x3D; LoggerFactory.getLogger(AopHelper.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    static &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Map&lt;Class&lt;?&gt;, Set&lt;Class&lt;?&gt;&gt;&gt; proxyMap &#x3D; createProxyMap();</span><br><span class="line">            Map&lt;Class&lt;?&gt;, List&lt;Proxy&gt;&gt; targetMap &#x3D; createTargetMap(proxyMap);</span><br><span class="line">            for (Map.Entry&lt;Class&lt;?&gt;, List&lt;Proxy&gt;&gt; targetEntity : targetMap.entrySet()) &#123;</span><br><span class="line">                Class&lt;?&gt; targetClass &#x3D; targetEntity.getKey();</span><br><span class="line">                List&lt;Proxy&gt; proxyList &#x3D; targetEntity.getValue();</span><br><span class="line">                Object proxy &#x3D; ProxyManager.createProxy(targetClass, proxyList);</span><br><span class="line">                BeanHelper.setBeanMap(targetClass, proxy);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            LOGGER.error(&quot;aop failure&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 获取所有Aspect 目标集合</span><br><span class="line">     * @param aspect</span><br><span class="line">     * @return</span><br><span class="line">     * @throws Exception</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static Set&lt;Class&lt;?&gt;&gt; createTargetClassSet(Aspect aspect) throws Exception&#123;</span><br><span class="line">        Set&lt;Class&lt;?&gt;&gt; targetClassSet &#x3D; new HashSet&lt;Class&lt;?&gt;&gt;();</span><br><span class="line">        Class&lt;? extends Annotation&gt; annotation &#x3D; aspect.value();</span><br><span class="line">        if(annotation !&#x3D; null &amp;&amp; !annotation.equals(Aspect.class))&#123;</span><br><span class="line">            targetClassSet.addAll(ClassHelper.getClassSetByAnnotation(annotation));</span><br><span class="line">        &#125;</span><br><span class="line">        return targetClassSet;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 创建代理类和目标集合的映射</span><br><span class="line">     * @return</span><br><span class="line">     * @throws Exception</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static Map&lt;Class&lt;?&gt;, Set&lt;Class&lt;?&gt;&gt;&gt; createProxyMap() throws Exception &#123;</span><br><span class="line">        Map&lt;Class&lt;?&gt;, Set&lt;Class&lt;?&gt;&gt;&gt; proxyMap &#x3D; new HashMap&lt;Class&lt;?&gt;, Set&lt;Class&lt;?&gt;&gt;&gt;();</span><br><span class="line">        Set&lt;Class&lt;?&gt;&gt; proxySet &#x3D; ClassHelper.getClassSetBySuper(AspectProxy.class);</span><br><span class="line">        for (Class&lt;?&gt; proxyClass: proxySet) &#123;</span><br><span class="line">            if(proxyClass.isAnnotationPresent(Aspect.class))&#123;</span><br><span class="line">                Aspect aspect &#x3D; proxyClass.getAnnotation(Aspect.class);</span><br><span class="line">                Set&lt;Class&lt;?&gt;&gt; targetClassSet &#x3D; createTargetClassSet(aspect);</span><br><span class="line">                proxyMap.put(proxyClass, targetClassSet);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return proxyMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据代理类和目标集合，分析出目标类和代理对象之间的映射</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static Map&lt;Class&lt;?&gt;, List&lt;Proxy&gt;&gt; createTargetMap(Map&lt;Class&lt;?&gt;,Set&lt;Class&lt;?&gt;&gt;&gt; proxyMap) throws Exception &#123;</span><br><span class="line">        Map&lt;Class&lt;?&gt;,List&lt;Proxy&gt;&gt; targetMap &#x3D; new HashMap&lt;Class&lt;?&gt;, List&lt;Proxy&gt;&gt;();</span><br><span class="line">        for (Map.Entry&lt;Class&lt;?&gt;, Set&lt;Class&lt;?&gt;&gt;&gt; proxyEntity : proxyMap.entrySet()) &#123;</span><br><span class="line">            Class&lt;?&gt; proxyClass &#x3D; proxyEntity.getKey();</span><br><span class="line">            Set&lt;Class&lt;?&gt;&gt; targetClassSet &#x3D; proxyEntity.getValue();</span><br><span class="line">            for (Class&lt;?&gt; targetClass: targetClassSet) &#123;</span><br><span class="line">                Proxy proxy &#x3D; (Proxy)proxyClass.newInstance();</span><br><span class="line">                if(targetMap.containsKey(targetClass))&#123;</span><br><span class="line">                    targetMap.get(targetClass).add(proxy);</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    List&lt;Proxy&gt; proxyList &#x3D; new ArrayList&lt;Proxy&gt;();</span><br><span class="line">                    proxyList.add(proxy);</span><br><span class="line">                    targetMap.put(targetClass, proxyList);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return targetMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="问题汇总："><a href="#问题汇总：" class="headerlink" title="问题汇总："></a>问题汇总：</h1><h2 id="Spring是如何处理请求路径中的-quot-quot-的？"><a href="#Spring是如何处理请求路径中的-quot-quot-的？" class="headerlink" title="Spring是如何处理请求路径中的&quot;/&quot;的？"></a>Spring是如何处理请求路径中的<code>&quot;/&quot;</code>的？</h2><p>例如：<code>&quot;/hello&quot;</code>和<code>&quot;hello&quot;</code>效果是一样的</p><p>目前做了一个<code>startWith()</code>的判断操作</p>]]></content>
    
    <summary type="html">
    
      从零开始的架构探险
    
    </summary>
    
    
      <category term="书籍" scheme="http://lazytime.site/categories/%E4%B9%A6%E7%B1%8D/"/>
    
    
      <category term="JAVA" scheme="http://lazytime.site/tags/JAVA/"/>
    
  </entry>
  
  <entry>
    <title>记一次CORS踩坑记录</title>
    <link href="http://lazytime.site/2020/07/26/%E8%AE%B0%E4%B8%80%E6%AC%A1CORS%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/"/>
    <id>http://lazytime.site/2020/07/26/%E8%AE%B0%E4%B8%80%E6%AC%A1CORS%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/</id>
    <published>2020-07-26T09:43:48.000Z</published>
    <updated>2020-07-26T09:45:26.623Z</updated>
    
    <content type="html"><![CDATA[<h1 id="记一次CORS踩坑记录"><a href="#记一次CORS踩坑记录" class="headerlink" title="记一次CORS踩坑记录"></a>记一次CORS踩坑记录</h1><p>今天远程工作的内容是实现CORS的跨域访问，本来特别简单的问题，却因为Spring的封装“坑”的有点惨。下面记录下整个过程</p><a id="more"></a><h2 id="踩坑原因"><a href="#踩坑原因" class="headerlink" title="踩坑原因"></a>踩坑原因</h2><ol><li>如果存在<code>web.xml</code> 配置，访问的时候会忽略掉其他的任何i形式的配置，只生效<code>xml</code>配置</li><li>项目中配置允许post跨域无效，只能get跨域访问，原因未知</li></ol><h3 id="解决过程"><a href="#解决过程" class="headerlink" title="解决过程"></a>解决过程</h3><ol><li>在请求当中加入<code>@crossxxx</code>注解，发现无效</li><li>将请求改为具体的<code>RequestMethod.GET</code> 或者<code>POST</code></li></ol><h2 id="参考博客"><a href="#参考博客" class="headerlink" title="参考博客"></a>参考博客</h2><p>网上的博客有许多的参考解决方案 <a href="http://www.thomasyoung.cn/fontend/2017/04/01/ajax-session/" target="_blank" rel="noopener">http://www.thomasyoung.cn/fontend/2017/04/01/ajax-session/</a> 个人博客，多了参数的介绍</p><p><a href="https://segmentfault.com/a/1190000012469713" target="_blank" rel="noopener">https://segmentfault.com/a/1190000012469713</a> segament一个博客，写得非常棒</p><p>其他资料：</p><p><a href="https://www.imooc.com/qadetail/302333" target="_blank" rel="noopener">https://www.imooc.com/qadetail/302333</a> <a href="https://www.jianshu.com/p/f3840c8c02ba" target="_blank" rel="noopener">https://www.jianshu.com/p/f3840c8c02ba</a> 简书介绍CORS</p><p><a href="https://blog.csdn.net/doujinlong1/article/details/80357819" target="_blank" rel="noopener">https://blog.csdn.net/doujinlong1/article/details/80357819</a> 【业务知识——Logger日志打印规范】<a href="https://www.cnblogs.com/doit8791/p/8947024.html" target="_blank" rel="noopener">https://www.cnblogs.com/doit8791/p/8947024.html</a> 【聊聊日志打印规范问题】 研发的同时抽时间看下</p><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>使用原生的配置代替spring 的整合配置 最佳答案：<a href="http://www.thomasyoung.cn/fontend/2017/04/01/ajax-session" target="_blank" rel="noopener">http://www.thomasyoung.cn/fontend/2017/04/01/ajax-session</a></p><h2 id="更改之后的配置"><a href="#更改之后的配置" class="headerlink" title="更改之后的配置"></a>更改之后的配置</h2><ol><li>使用<code>pom.xml</code>加入新的依赖，使用Cors的原生支持</li><li>在<code>web.xml</code>当中增加如下配置</li><li>配置的更详细介绍在上面提到的博客当中，这里不多赘述</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 跨域配置:参考 http:&#x2F;&#x2F;www.thomasyoung.cn&#x2F;fontend&#x2F;2017&#x2F;04&#x2F;01&#x2F;ajax-session&#x2F;--&gt;</span><br><span class="line">    &lt;filter&gt;</span><br><span class="line">        &lt;!-- 原生Cors过滤器配置 --&gt;</span><br><span class="line">        &lt;filter-name&gt;CorsFilter&lt;&#x2F;filter-name&gt;</span><br><span class="line">        &lt;filter-class&gt;com.thetransactioncompany.cors.CORSFilter&lt;&#x2F;filter-class&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--</span><br><span class="line">非跨域请求是否可以通过此过滤器，默认为true；如果设置为false，则只有跨域的请求被允许</span><br><span class="line">          --&gt;</span><br><span class="line">        &lt;init-param&gt;</span><br><span class="line">            &lt;param-name&gt;cors.allowGenericHttpRequests&lt;&#x2F;param-name&gt;</span><br><span class="line">            &lt;param-value&gt;true&lt;&#x2F;param-value&gt;</span><br><span class="line">        &lt;&#x2F;init-param&gt;</span><br><span class="line"></span><br><span class="line">        &lt;init-param&gt;</span><br><span class="line">            &lt;param-name&gt;cors.allowOrigin&lt;&#x2F;param-name&gt;</span><br><span class="line">            &lt;param-value&gt;http:&#x2F;&#x2F;192.168.92.190:8080,http:&#x2F;&#x2F;192.168.92.145:8080,&lt;&#x2F;param-value&gt;</span><br><span class="line">        &lt;&#x2F;init-param&gt;</span><br><span class="line">        &lt;!--</span><br><span class="line">        是否允许来自allowOrigin的子域名的请求，默认不允许；子域名的概念大家应该清楚，www.example.com是example.com的子域名</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;init-param&gt;</span><br><span class="line">            &lt;param-name&gt;cors.allowSubdomains&lt;&#x2F;param-name&gt;</span><br><span class="line">            &lt;param-value&gt;false&lt;&#x2F;param-value&gt;</span><br><span class="line">        &lt;&#x2F;init-param&gt;</span><br><span class="line">        &lt;!-- cors.allowed.methods --&gt;</span><br><span class="line">        &lt;init-param&gt;</span><br><span class="line">            &lt;param-name&gt;cors.supportedMethods&lt;&#x2F;param-name&gt;</span><br><span class="line">            &lt;param-value&gt;GET,POST,HEAD,OPTIONS,PUT&lt;&#x2F;param-value&gt;</span><br><span class="line">        &lt;&#x2F;init-param&gt;</span><br><span class="line">        &lt;!-- cors.allowed.headers --&gt;</span><br><span class="line">        &lt;init-param&gt;</span><br><span class="line">            &lt;param-name&gt;cors.supportedHeaders&lt;&#x2F;param-name&gt;</span><br><span class="line">            &lt;param-value&gt;Content-Type,X-Requested-With,accept,Origin,Access-Control-Request-Method,Access-Control-Request-Headers&lt;&#x2F;param-value&gt;</span><br><span class="line">        &lt;&#x2F;init-param&gt;</span><br><span class="line"></span><br><span class="line">        &lt;init-param&gt;</span><br><span class="line">            &lt;param-name&gt;cors.exposedHeaders&lt;&#x2F;param-name&gt;</span><br><span class="line">            &lt;!--这里可以添加一些自己的暴露Headers   --&gt;</span><br><span class="line">            &lt;param-value&gt;Access-Control-Allow-Origin,Access-Control-Allow-Credentials&lt;&#x2F;param-value&gt;</span><br><span class="line">        &lt;&#x2F;init-param&gt;</span><br><span class="line">        &lt;!-- 对应 cors.support.credentials --&gt;</span><br><span class="line">        &lt;init-param&gt;</span><br><span class="line">            &lt;param-name&gt;cors.supportsCredentials&lt;&#x2F;param-name&gt;</span><br><span class="line">            &lt;param-value&gt;true&lt;&#x2F;param-value&gt;</span><br><span class="line">        &lt;&#x2F;init-param&gt;</span><br><span class="line">        &lt;!-- cors.preflight.maxage 最大缓存时间 --&gt;</span><br><span class="line">        &lt;init-param&gt;</span><br><span class="line">            &lt;param-name&gt;cors.maxAge&lt;&#x2F;param-name&gt;</span><br><span class="line">            &lt;param-value&gt;10&lt;&#x2F;param-value&gt;</span><br><span class="line">        &lt;&#x2F;init-param&gt;</span><br><span class="line">    &lt;&#x2F;filter&gt;</span><br><span class="line">  </span><br><span class="line">    &lt;filter-mapping&gt;</span><br><span class="line">        &lt;filter-name&gt;CorsFilter&lt;&#x2F;filter-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;&#x2F;*&lt;&#x2F;url-pattern&gt;</span><br><span class="line">    &lt;&#x2F;filter-mapping&gt;</span><br></pre></td></tr></table></figure><h2 id="IE8-IE9-解决拒绝访问的问题"><a href="#IE8-IE9-解决拒绝访问的问题" class="headerlink" title="IE8/IE9 解决拒绝访问的问题"></a>IE8/IE9 解决拒绝访问的问题</h2><h3 id="第一种：引入js文件"><a href="#第一种：引入js文件" class="headerlink" title="第一种：引入js文件"></a>第一种：引入js文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src&#x3D;&quot;http:&#x2F;&#x2F;cdnjs.cloudflare.com&#x2F;ajax&#x2F;libs&#x2F;jquery-ajaxtransport-xdomainrequest&#x2F;1.0.3&#x2F;jquery.xdomainrequest.min.js&quot; type&#x3D;&quot;text&#x2F;javascript&quot; charset&#x3D;&quot;utf-8&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><h3 id="第二种：Jquery开启跨域模式"><a href="#第二种：Jquery开启跨域模式" class="headerlink" title="第二种：Jquery开启跨域模式"></a>第二种：Jquery开启跨域模式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jQuery.support.cors &#x3D; true</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      记一次CORS踩坑记录
    
    </summary>
    
    
      <category term="工作" scheme="http://lazytime.site/categories/%E5%B7%A5%E4%BD%9C/"/>
    
    
      <category term="cors" scheme="http://lazytime.site/tags/cors/"/>
    
  </entry>
  
  <entry>
    <title>《Spring 实战》解读</title>
    <link href="http://lazytime.site/2020/07/26/%E3%80%8ASpring-%E5%AE%9E%E6%88%98%E3%80%8B%E8%A7%A3%E8%AF%BB/"/>
    <id>http://lazytime.site/2020/07/26/%E3%80%8ASpring-%E5%AE%9E%E6%88%98%E3%80%8B%E8%A7%A3%E8%AF%BB/</id>
    <published>2020-07-26T09:33:41.000Z</published>
    <updated>2020-07-26T09:34:11.514Z</updated>
    
    <content type="html"><![CDATA[<h1 id="《Spring-实战》解读"><a href="#《Spring-实战》解读" class="headerlink" title="《Spring 实战》解读"></a>《Spring 实战》解读</h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>DI：依赖反转</p><p>AOP：切面编程</p><a id="more"></a><h3 id="Spring应用上下文"><a href="#Spring应用上下文" class="headerlink" title="Spring应用上下文"></a>Spring应用上下文</h3><p><strong>AnnotationConfigApplicationContext</strong> ：从一个或多个基于 Java 的配置类中加载 Spring 应用上下文。</p><p><strong>AnnotationConfigWebApplicationContext</strong> ：从一个或多个基于 Java 的配置类中加载 Spring Web 应用上下文。</p><p><strong>ClassPathXmlApplicationContext</strong> ：从类路径下的一个或多个 XML 配置文件中加载上下文定义，把应用上下文的定义文件作为类资源。</p><p><strong>FileSystemXmlapplicationcontext</strong> ：从文件系统下的一个或多个 XML 配置文件中加载上下文定义。</p><p><strong>XmlWebApplicationContext</strong> ：从 Web 应用下的一个或多个 XML 配置文件中加载上下文定义。</p><h3 id="Spring的生命周期"><a href="#Spring的生命周期" class="headerlink" title="Spring的生命周期"></a>Spring的生命周期</h3><p><img src="https://raw.githubusercontent.com/lazyTimes/imageRepository/master/img/20200213191203.png?ynotemdtimestamp=1595748679079" alt="Spring生命周期"></p><ol><li>Spring 对 bean 进行实例化；</li><li>Spring 将值和 bean 的引用注入到 bean 对应的属性中；</li><li>如果 bean 实现了 BeanNameAware 接口， Spring 将 bean 的 ID 传递给 setBean-Name() 方法；</li><li>如果 bean 实现了 BeanFactoryAware 接口， Spring 将调用 setBeanFactory() 方法，将 BeanFactory 容器实例传入；</li><li>如果 bean 实现了 ApplicationContextAware 接口， Spring 将调用 setApplicationContext() 方法，将 bean 所在的应用上下文的引用传入进来；</li><li>如果 bean 实现了 BeanPostProcessor 接口， Spring 将调用它们的 post-ProcessBeforeInitialization() 方法；</li><li>如果 bean 实现了 InitializingBean 接口， Spring 将调用它们的 after-PropertiesSet() 方法。类似地，如果 bean 使用 init- method 声明了初始化方法，该方法也会被调用；</li><li>如果 bean 实现了 BeanPostProcessor 接口， Spring 将调用它们的 post-ProcessAfterInitialization() 方法；</li><li>此时， bean 已经准备就绪，可以被应用程序使用了，它们将一直驻留在应用上下文中，直到该应用上下文被销毁；</li><li>如果 bean 实现了 DisposableBean 接口， Spring 将调用它的 destroy() 接口方法。同样，如果 bean 使用 destroy-method 声明了销 毁方法，该方法也会被调用</li></ol><h3 id="Spring-模块-（4-0为例）"><a href="#Spring-模块-（4-0为例）" class="headerlink" title="Spring 模块 （4.0为例）"></a>Spring 模块 （4.0为例）</h3><p><img src="https://raw.githubusercontent.com/lazyTimes/imageRepository/master/img/20200213191506.png?ynotemdtimestamp=1595748679079" alt="Spring模块"></p><h3 id="版本新特性"><a href="#版本新特性" class="headerlink" title="版本新特性"></a>版本新特性</h3><p>3.1 ： 注解编程</p><p>3.2：增强SpringMVC，加入更多的支持</p><p>4.0：Websocket加入，JDK1.8的支持以及Lambada表达式</p><h2 id="Spring的Bean"><a href="#Spring的Bean" class="headerlink" title="Spring的Bean"></a>Spring的Bean</h2><h3 id="装配Bean的三种方式："><a href="#装配Bean的三种方式：" class="headerlink" title="装配Bean的三种方式："></a>装配Bean的三种方式：</h3><ol><li>自动装配（扫描）</li><li>XML装配</li><li>通过JAVA代码</li></ol><h3 id="自动装配"><a href="#自动装配" class="headerlink" title="自动装配"></a>自动装配</h3><blockquote><p>Q：<strong>为Bean命名有什么影响？</strong></p><p>A： <strong>@Inject</strong> 和 <strong>@Autowired</strong> 的注入会受到影响</p><p>Q：<strong>Bean默认的命名规则？</strong></p><p>A：类名的首字母小写</p><p>Q：除了@Bean定义名称之外的办法？</p><p>A：<strong>@Named</strong></p></blockquote><h3 id="JAVA配置"><a href="#JAVA配置" class="headerlink" title="JAVA配置"></a>JAVA配置</h3><p>需要注意Bean是单例的，如果引用对象也存在引用，那么对应的引用对象也是单利的</p><h3 id="XML配置"><a href="#XML配置" class="headerlink" title="XML配置"></a>XML配置</h3><ol><li>使用 <constructor-arg> 元素进行构造器参数的注入</li><li>由于xml 配置非常的繁琐，推荐Java配置</li></ol><h2 id="更高级的Bean装配"><a href="#更高级的Bean装配" class="headerlink" title="更高级的Bean装配"></a>更高级的Bean装配</h2><h3 id="profile-Bean"><a href="#profile-Bean" class="headerlink" title="profile Bean"></a>profile Bean</h3><p><code>@Profile</code> 注解指定某个 bean 属于哪一个 profile</p><blockquote><p>3.2之前：@profile只能作用于类</p></blockquote><h3 id="激活profile"><a href="#激活profile" class="headerlink" title="激活profile"></a>激活profile</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.profiles.active&#96; 和 &#96;spring.profiles.default</span><br></pre></td></tr></table></figure><p>通常情况下会选择<code>dev</code></p><h3 id="条件化-Bean"><a href="#条件化-Bean" class="headerlink" title="条件化 Bean"></a>条件化 Bean</h3><p><strong>@Conditional</strong>：SpringBoot的核心</p><p>运作基本原理：</p><p>它通过给定的 <code>ConditionContext</code>对象进而得到<code>Environment</code>对象，并使用这个对象检查环境中是否存在名为 magic 的环境属性</p><blockquote><p>通过 ConditionContext ，我们可以做到如下几点：</p><ul><li>借助 <code>getRegistry()</code> 返回的 BeanDefinitionRegistry 检查 bean 定义；</li><li>借助 <code>getBeanFactory()</code>返回的 ConfigurableListableBeanFactory 检查 bean 是否存在，甚至探查 bean 的属性；</li><li>借助 <code>getEnvironment()</code> 返回的 Environment 检查环境变量是否存在以及它的值是什么；</li><li>读取并探查 <code>getResourceLoader()</code> 返回的 ResourceLoader 所加载的资源；</li><li>借助 <code>getClassLoader()</code>返回的 ClassLoader 加载并检查类是否存在。</li></ul></blockquote><h4 id="标示首选的-bean"><a href="#标示首选的-bean" class="headerlink" title="标示首选的 bean"></a>标示首选的 bean</h4><p><code>@Primary</code>：当自动装配Bean遇到歧义的时候可以设置首选Bean</p><h4 id="限定自动装配的-bean"><a href="#限定自动装配的-bean" class="headerlink" title="限定自动装配的 bean"></a>限定自动装配的 bean</h4><p><code>@Qualifier</code>：注解是使用限定符的主要方式</p><p>注意：另一种使用方式是定义一个注解然后使用限定装配符号实现自己标记</p><h2 id="Bean的作用域"><a href="#Bean的作用域" class="headerlink" title="Bean的作用域"></a>Bean的作用域</h2><p>单例（ Singleton ）：在整个应用中，只创建 bean 的一个实例。</p><p>原型（ Prototype ）：每次注入或者通过 Spring 应用上下文获取的时候，都会创建一个新的 bean 实例。</p><p>会话（ Session ）：在 Web 应用中，为每个会话创建一个 bean 实例。</p><p>请求（ Rquest ）：在 Web 应用中，为每个请求创建一个 bean 实例。</p><p>配置方式：<code>@Scope</code></p><p>注意在创建时候使用的是代理而不是真正的New 一个对象</p><h2 id="运行时注入"><a href="#运行时注入" class="headerlink" title="运行时注入"></a>运行时注入</h2><p>Spring提供了两种办法来实现属性注入</p><ul><li>属性占位符（ Property placeholder ）</li><li>Spring 表达式语言（ SpEL ）</li></ul><h1 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h1><h3 id="DispatcherServelet"><a href="#DispatcherServelet" class="headerlink" title="DispatcherServelet"></a>DispatcherServelet</h3><p>DispatcherServlet 是 Spring MVC 的核心。在这里请求会第一次接触到框架，它要负责将请求路由到其他的组件之中。</p><p><code>AbstractAnnotationConfigDispatcherServletInitializer</code>核心实现类</p><h2 id="Spring-Web-Flow"><a href="#Spring-Web-Flow" class="headerlink" title="Spring Web Flow"></a>Spring Web Flow</h2><h2 id="是什么："><a href="#是什么：" class="headerlink" title="是什么："></a>是什么：</h2><p>一种基于会话的流程式框架</p><h2 id="为什么会有web-Flow"><a href="#为什么会有web-Flow" class="headerlink" title="为什么会有web Flow"></a>为什么会有web Flow</h2><p>在解决web与用户的交互流程方面做了很大的帮助和改进，能够实现一种类似OA的流程式业务</p><h2 id="怎么做："><a href="#怎么做：" class="headerlink" title="怎么做："></a>怎么做：</h2><ol><li>看官网：<a href="https://projects.spring.io/spring-webflow/" target="_blank" rel="noopener">https://projects.spring.io/spring-webflow/</a></li><li>简书博客：<a href="https://www.jianshu.com/p/6c44902a8e4e" target="_blank" rel="noopener">https://www.jianshu.com/p/6c44902a8e4e</a></li><li>对比：<a href="https://www.cnblogs.com/Piers/p/6588290.html" target="_blank" rel="noopener">https://www.cnblogs.com/Piers/p/6588290.html</a></li></ol><h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><p>由于大量的XML配置已经不适合当前时代的发展了，还是建议使用MVC吧</p><p>某些一对一的服务下面可能会有奇效</p><h1 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a>Spring Security</h1><h2 id="是什么？"><a href="#是什么？" class="headerlink" title="是什么？"></a>是什么？</h2><p>保护web 应用程序的权限，以及保护程序安全的一个框架</p><h2 id="为什么？"><a href="#为什么？" class="headerlink" title="为什么？"></a>为什么？</h2><p>防止非法用户的攻击行为，对于用户的权限进行限定</p><h2 id="同类产品比较："><a href="#同类产品比较：" class="headerlink" title="同类产品比较："></a>同类产品比较：</h2><p><strong>Apach Shiro</strong>：Spring4 之后倾向于使用Apach Shiro的支持，因为该框架配置更加灵活，实现更加简单，最关键是不仅仅限制在Web框架！！！</p><h2 id="怎么做：-1"><a href="#怎么做：-1" class="headerlink" title="怎么做："></a>怎么做：</h2><ol><li>看官网：<a href="https://spring.io/projects/spring-security" target="_blank" rel="noopener">https://spring.io/projects/spring-security</a></li><li>百度或者谷歌查看案例实战</li></ol><p>此框架只有遇到实际应用才能掌握，不做详细笔记</p><h2 id="注意事项："><a href="#注意事项：" class="headerlink" title="注意事项："></a>注意事项：</h2><ul><li>配置用户存储；</li><li>指定哪些请求需要认证，哪些请求不需要认证，以及所需要的权限；</li><li>提供一个自定义的登录页面，替代原来简单的默认登录页。</li></ul><h1 id="AMQP"><a href="#AMQP" class="headerlink" title="AMQP"></a>AMQP</h1><h2 id="是什么？-1"><a href="#是什么？-1" class="headerlink" title="是什么？"></a>是什么？</h2><p>一种新的消息通信协议，不同于JMS，提供更加灵活的方式进行JAVA的消息推送</p><h2 id="和JMS的区别"><a href="#和JMS的区别" class="headerlink" title="和JMS的区别"></a>和JMS的区别</h2><p>不同于使用“通道”的概念，AMQP使用<code>Exchange</code>作为消息的暂存区域</p><blockquote><p>Exchange的类型：</p><p>Direct ：如果消息的 routing key 与 binding 的 routing key 直接匹配的话，消息将会路由到该队列上； Topic ：如果消息的 routing key 与 binding 的 routing key 符合通配符匹配的话，消息将会路由到该队列上； Headers ：如果消息参数表中的头信息和值都与 bingding 参数表中相匹配，消息将会路由到该队列上； Fanout ：不管消息的 routing key 和参数表的头信息 / 值是什么，消息将会路由到所有队列上。</p></blockquote>]]></content>
    
    <summary type="html">
    
      《Spring 实战》解读
    
    </summary>
    
    
      <category term="Spring" scheme="http://lazytime.site/categories/Spring/"/>
    
    
      <category term="Spring" scheme="http://lazytime.site/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>Neo4j + VIS 数据可视化问题汇总</title>
    <link href="http://lazytime.site/2020/07/26/Neo4j-VIS-%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/"/>
    <id>http://lazytime.site/2020/07/26/Neo4j-VIS-%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</id>
    <published>2020-07-26T09:32:28.000Z</published>
    <updated>2020-07-26T09:33:11.282Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>被前端整的有点发虚，这里记录一下自己干的一些（蠢）事</p><blockquote><p>PS：这种无力感真的希望不要再有，在自己不怎么擅长的领域班门弄斧就是浪费时间</p></blockquote><a id="more"></a><h2 id="重要资料："><a href="#重要资料：" class="headerlink" title="重要资料："></a>重要资料：</h2><h2 id="VIS-DataSet-使用："><a href="#VIS-DataSet-使用：" class="headerlink" title="VIS DataSet 使用："></a>VIS DataSet 使用：</h2><p><a href="https://visjs.github.io/vis-data/data/dataset.html" target="_blank" rel="noopener">dataSet使用</a></p><p>这段时间做表标签库，内容还是比较多的，这里记录一下个人遇到的一些需求汇总问题</p><p><a href="https://zhuanlan.zhihu.com/p/36404872" target="_blank" rel="noopener">什么是neo4j</a></p><h1 id="Q：页面初始化如何控制节点的距离大小"><a href="#Q：页面初始化如何控制节点的距离大小" class="headerlink" title="Q：页面初始化如何控制节点的距离大小"></a>Q：页面初始化如何控制节点的距离大小</h1><p>A： 官方文档： <a href="https://visjs.github.io/vis-network/docs/network/physics.html" target="_blank" rel="noopener">VIS的节点物理效果</a></p><p>需要调整如下参数</p><p>在<code>options</code>调整如下变量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> &#x2F;&#x2F;力导向图效果</span><br><span class="line">physics: &#123;</span><br><span class="line">    enabled: true,   &#x2F;&#x2F; 是否开启vis引擎配置</span><br><span class="line">        barnesHut: &#123; &#x2F;&#x2F; 基于四叉树的重力模型，非分布式性能最好的求值器</span><br><span class="line">            gravitationalConstant: -4000, &#x2F;&#x2F;此参数确定了合并的远程力和各个短程力之间的边界。要过分简化，较高的值会更快，但是会产生更多的错误，较低的值会很慢，但是会减少错误。</span><br><span class="line">            centralGravity: 0.3, &#x2F;&#x2F;有一个中央引力吸引器，可将整个网络拉回到中心。</span><br><span class="line">            springLength: 120, &#x2F;&#x2F; 边缘被建模为弹簧。这里的springLength是弹簧的其余长度。</span><br><span class="line">            springConstant: 0.04, &#x2F;&#x2F;这就是弹簧的强度。值越高，表示弹簧越强。</span><br><span class="line">            damping: 0.09, &#x2F;&#x2F; 接受范围：[0 .. 1]。阻尼因子是前一次物理模拟迭代中有多少速度会延续到下一次迭代中。</span><br><span class="line">            avoidOverlap: 0 &#x2F;&#x2F; 接受范围：[0 .. 1]。大于0时，将考虑节点的大小。对于两个重力模型，将从节点的包围圆的半径计算距离。值1是最大避免重叠。</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>根据上面的值基本可以确定整个页面的物理引擎效果</p><h1 id="Q：要实现鼠标悬停到页面变为小手的样式"><a href="#Q：要实现鼠标悬停到页面变为小手的样式" class="headerlink" title="Q：要实现鼠标悬停到页面变为小手的样式"></a>Q：要实现鼠标悬停到页面变为小手的样式</h1><p>A：</p><p>官方案例：<a href="https://visjs.github.io/vis-network/examples/network/other/cursorChange.html" target="_blank" rel="noopener">https://visjs.github.io/vis-network/examples/network/other/cursorChange.html</a></p><p>参考博客：<a href="https://www.thinbug.com/q/40532596" target="_blank" rel="noopener">博客地址</a></p><p>步骤：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var networkCanvas &#x3D; document.getElementById(&quot;network_id&quot;).getElementsByTagName(&quot;canvas&quot;)[0];</span><br></pre></td></tr></table></figure><p>增加一个配置</p><p>最终解决方案：</p><p>在vis初始化<code>network</code> 之后,加入如下事件绑定代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">var cursor &#x3D;  network.canvas.body.container.style.cursor; &#x2F;&#x2F; 获取netword的cursor</span><br><span class="line">network.on(&quot;hoverNode&quot;, function (params) &#123;</span><br><span class="line">    cursor &#x3D; &#39;grab&#39;</span><br><span class="line">&#125;);</span><br><span class="line">network.on(&quot;blurNode&quot;, function() &#123;</span><br><span class="line">    cursor &#x3D; &#39;default&#39;</span><br><span class="line">&#125;);</span><br><span class="line">network.on(&quot;hoverEdge&quot;, function() &#123;</span><br><span class="line">    cursor &#x3D; &#39;grab&#39;</span><br><span class="line">&#125;);</span><br><span class="line">network.on(&quot;blurEdge&quot;, function() &#123;</span><br><span class="line">    cursor &#x3D; &#39;default&#39;</span><br><span class="line">&#125;);</span><br><span class="line">network.on(&quot;dragStart&quot;, function() &#123;</span><br><span class="line">    cursor &#x3D; &#39;grabbing&#39;</span><br><span class="line">&#125;);</span><br><span class="line">network.on(&quot;dragging&quot;, function() &#123;</span><br><span class="line">    cursor &#x3D; &#39;grabbing&#39;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="Q：如何模仿Neo4j-用vis实现节点的展开和多层折叠"><a href="#Q：如何模仿Neo4j-用vis实现节点的展开和多层折叠" class="headerlink" title="Q：如何模仿Neo4j 用vis实现节点的展开和多层折叠"></a>Q：如何模仿Neo4j 用vis实现节点的展开和多层折叠</h1><p>参考：<a href="https://www.jianshu.com/p/b22727c8fe60" target="_blank" rel="noopener">简书地址</a></p><p>个人需求：</p><p>实现节点可以扩展和缩放，双击扩展，扩展之后再次双击为收缩</p><p>难点：如何实现多层节点收缩</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var nodes &#x3D; [</span><br><span class="line">  &#123;id: 1, subids: [2, 3],allsubids:[2,3,4,5]&#125;,</span><br><span class="line">  &#123;id: 2, pid: 1&#125;,</span><br><span class="line">  &#123;id: 3, subids: [4],pid: 1,allsubids:[4,5]&#125;</span><br><span class="line">  &#123;id: 4, subids: [5],pid: 3&#125;</span><br><span class="line">  &#123;id: 5, pid: 4&#125;</span><br><span class="line">];</span><br><span class="line">var edges &#x3D; [</span><br><span class="line">  &#123;from:1,to:2&#125;,</span><br><span class="line">  &#123;from:1,to:3&#125;,</span><br><span class="line">  &#123;from:3,to:4&#125;,</span><br><span class="line">  &#123;from:4,to:5&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="个人实现："><a href="#个人实现：" class="headerlink" title="个人实现："></a>个人实现：</h2><p>目前经过查找资料发现以下代码加上</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">     *获取所有子节点</span><br><span class="line">     * network ：图形对象</span><br><span class="line">     * _thisNode ：单击的节点（父节点）</span><br><span class="line">     * _Allnodes ：用来装子节点ID的数组</span><br><span class="line">     * *&#x2F;</span><br><span class="line">    function getAllChilds(network,_thisNode,_Allnodes)&#123;</span><br><span class="line">        var _nodes &#x3D; network.getConnectedNodes(_thisNode);</span><br><span class="line">        if(_nodes.length &gt; 0)&#123;</span><br><span class="line">            for(var i&#x3D;0;i&lt;_nodes.length;i++)&#123;</span><br><span class="line">                &#x2F;&#x2F; getAllChilds(network,_nodes[i],_Allnodes);</span><br><span class="line">                _Allnodes.push(_nodes[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return _Allnodes</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure><p>增加两个<code>Array</code>的方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Array.prototype.indexOf &#x3D; function(val) &#123;</span><br><span class="line">       for (var i &#x3D; 0; i &lt; this.length; i++) &#123;</span><br><span class="line">           if (this[i] &#x3D;&#x3D; val) return i;</span><br><span class="line">       &#125;</span><br><span class="line">       return -1;</span><br><span class="line">   &#125;;</span><br><span class="line"></span><br><span class="line">   &#x2F;&#x2F;code from http:&#x2F;&#x2F;caibaojian.com&#x2F;js-splice-element.html</span><br><span class="line">   Array.prototype.remove &#x3D; function(val) &#123;</span><br><span class="line">       var index &#x3D; this.indexOf(val);</span><br><span class="line">       if (index &gt; -1) &#123;</span><br><span class="line">           this.splice(index, 1);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;;</span><br></pre></td></tr></table></figure><p>具体判断逻辑如下：</p><ol><li>设置一个标志位，第一次为true，表示扩展该节点。扩展之后将该节点的id放到一个全局的扩展节点array里面维护</li><li>如果再次点击，该标志位变成false, 执行步骤又可以分为以下几点<ul><li>使用vis.js的api获取当前节点的<code>连接</code>节点，<code>network.getConnectedNodes(_thisNode);</code>的<code>_thisNode</code>，为当前操作节点的唯一标识id（此方法还有很多的可选条件参数）</li><li>获取<code>连接</code>节点之后，调用<code>nodes.remove(_allChild)</code>，删除关联节点，此操作会直接干掉被删除节点所有的关联关系</li><li>删除完成之后，全局表的<code>已扩展</code>节点删除当前点击节点，方便下次再次扩展</li></ul></li></ol><h1 id="Q：双向两条箭头合并为一个单向双箭头"><a href="#Q：双向两条箭头合并为一个单向双箭头" class="headerlink" title="Q：双向两条箭头合并为一个单向双箭头"></a>Q：双向两条箭头合并为一个单向双箭头</h1><p>这个需求是比较特殊的例子，涉及到业务的内容不予描述</p><p>思路：</p><ol><li>拿到当前记录，获取当前记录的<code>from</code>和<code>to</code></li><li>使用两层循环嵌套，第一层遍历所有的节点一次，第二层遍历当前节点的后面节点，类似冒泡</li><li>如果当前节点的<code>from</code> == 其他节点的<code>to</code>，并且当前节点的<code>to</code> == 其他节点的<code>from</code></li></ol><p>具体代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 手动筛选掉双向关联的数据</span><br><span class="line">    function delrepeatinfo(arrName) &#123;</span><br><span class="line">        arrName &#x3D; arrName.edges;</span><br><span class="line">        if (arrName &#x3D;&#x3D; null || arrName.length &#x3D;&#x3D; 0) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        var repeat &#x3D; [];</span><br><span class="line">        for (var i &#x3D; 0; i &lt; arrName.length; i++) &#123;</span><br><span class="line">            var item &#x3D; arrName[i];</span><br><span class="line">            if(item.skip)&#123;</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line">            var fromId &#x3D; item.edgeFrom;</span><br><span class="line">            var toId &#x3D; item.edgeTo;</span><br><span class="line">            for (var j &#x3D; i+1; j &lt; arrName.length; j++) &#123;</span><br><span class="line">                var next &#x3D; arrName[j];</span><br><span class="line">                if(next.edgeTo &#x3D;&#x3D; fromId &amp;&amp; next.edgeFrom &#x3D;&#x3D; toId)&#123;</span><br><span class="line">                    repeat.push(item);</span><br><span class="line">                    next.skip &#x3D; true;</span><br><span class="line">                    break;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return repeat;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1 id="Q：如果自定义画图"><a href="#Q：如果自定义画图" class="headerlink" title="Q：如果自定义画图"></a>Q：如果自定义画图</h1><p>需求：</p><p><img src="https://raw.githubusercontent.com/lazyTimes/imageRepository/master/img/%E6%A0%87%E7%AD%BE%E5%BA%93%E9%9C%80%E6%B1%82.png?ynotemdtimestamp=1595748679079" alt="img"></p><p>A：个人无法处理，需要寻找建哥处理按钮的绘画以及按钮的事件触发操作</p><p>处理方式：</p><ol><li>使用canvas在 点击标签之后绘制对应的按钮</li><li>监听坐标，当点击了坐标内的按钮触发事件，显示对应的菜单</li></ol><p>那个多出两个自定义按钮的解决办法如下：</p><ol><li>利用canvas前端画图技术绘制按钮</li><li>监听鼠标的点击坐标，查看是否在绘制的按钮坐标内，对应的触发事件</li><li>触发相关操作</li></ol><p>VIS绘制辅助线条的办法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">context &#x3D; ctx || $(&#39;#network_id&#39;)[0].getContext(&quot;2d&quot;)</span><br><span class="line">context.lineWidth &#x3D; 1;</span><br><span class="line">context.strokeStyle &#x3D; &quot;#CECBCE&quot;;</span><br><span class="line">context.setLineDash([5]);</span><br><span class="line">var offset &#x3D; 800;</span><br><span class="line">var padding &#x3D; 50;</span><br><span class="line">for (var i &#x3D; 0; i &lt; 30; i++) &#123;</span><br><span class="line">    context.beginPath();</span><br><span class="line">    context.moveTo(offset * -1, i * padding - offset)</span><br><span class="line">    context.lineTo(2000, i * padding - offset)</span><br><span class="line">    context.stroke();</span><br><span class="line"></span><br><span class="line">    context.beginPath();</span><br><span class="line">    context.moveTo(i * padding - offset, offset * -1)</span><br><span class="line">    context.lineTo(i * padding - offset, 2000)</span><br><span class="line">    context.stroke();</span><br><span class="line">&#125;</span><br><span class="line">context.setLineDash([]);</span><br></pre></td></tr></table></figure><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>neo4j 的资料还是太少太少，多查查官方文档才是硬道理</p><p>个人接到的需求如下</p><ol><li>标签之间都是双向箭头，需要改成一条直线，或者只有单项的。</li></ol><p>无法自定义，因为数据的展示强制需要 头和尾两个参数，数据本身就是会存在互相关联的情况，所以无法实现</p><ol><li>标签之间的连接线点击不要有效果，就是颜色不要加深</li></ol><p>只需要去掉inter``</p><ol><li>标签展开后能再点击折叠收回映射关系吗？</li><li>所有图例鼠标放到上面都变成小手形状</li><li>初始化页面这些标签过于分散，需要集中一些，根据屏幕情况集中在一屏展示</li></ol><p><img src="https://raw.githubusercontent.com/lazyTimes/imageRepository/master/img/%E6%A0%87%E7%AD%BE%E5%BA%93%E9%9C%80%E6%B1%82.png?ynotemdtimestamp=1595748679079" alt="img"></p>]]></content>
    
    <summary type="html">
    
      Neo4j使用
    
    </summary>
    
    
      <category term="Neo4j" scheme="http://lazytime.site/categories/Neo4j/"/>
    
    
      <category term="Neo4j" scheme="http://lazytime.site/tags/Neo4j/"/>
    
  </entry>
  
  <entry>
    <title>整理一下个人收集到的一些好网站（持续收集）</title>
    <link href="http://lazytime.site/2020/07/26/%E6%95%B4%E7%90%86%E4%B8%80%E4%B8%8B%E4%B8%AA%E4%BA%BA%E6%94%B6%E9%9B%86%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E5%A5%BD%E7%BD%91%E7%AB%99%EF%BC%88%E6%8C%81%E7%BB%AD%E6%94%B6%E9%9B%86%EF%BC%89/"/>
    <id>http://lazytime.site/2020/07/26/%E6%95%B4%E7%90%86%E4%B8%80%E4%B8%8B%E4%B8%AA%E4%BA%BA%E6%94%B6%E9%9B%86%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E5%A5%BD%E7%BD%91%E7%AB%99%EF%BC%88%E6%8C%81%E7%BB%AD%E6%94%B6%E9%9B%86%EF%BC%89/</id>
    <published>2020-07-26T09:30:39.000Z</published>
    <updated>2020-07-26T09:31:19.445Z</updated>
    
    <content type="html"><![CDATA[<h1 id="解决日常工作问题网站"><a href="#解决日常工作问题网站" class="headerlink" title="解决日常工作问题网站"></a>解决日常工作问题网站</h1><h2 id="前端问题"><a href="#前端问题" class="headerlink" title="前端问题"></a>前端问题</h2><h3 id="thinbug"><a href="#thinbug" class="headerlink" title="thinbug"></a><a href="https://www.thinbug.com/" target="_blank" rel="noopener">thinbug</a></h3><blockquote><p>一个前端技术问题的收集网站</p><p>推荐原因：</p><ol><li>没有广告，页面简洁</li><li>问题以及回答的质量都很不错</li><li>针对工作的一些细节问题很实用</li></ol><p>缺点：</p><ol><li>搜索不是很友善</li><li>过于简单，以至于不知道怎么发文章。。。。</li></ol></blockquote><h2 id="其他："><a href="#其他：" class="headerlink" title="其他："></a>其他：</h2><h3 id="算法网"><a href="#算法网" class="headerlink" title="算法网"></a><a href="http://ddrv.cn/" target="_blank" rel="noopener">算法网</a></h3><blockquote><p>推荐原因：</p><ol><li>干货多</li></ol><p>缺点：</p><ol><li>作者也要恰饭，微信公众号可以理解</li></ol></blockquote><h3 id="谷歌"><a href="#谷歌" class="headerlink" title="谷歌"></a><a href="https://www.google.com/" target="_blank" rel="noopener">谷歌</a></h3><blockquote><p>推荐原因：</p><ol><li>比某度真好了不止一个度</li><li>各方面无可挑剔，没有之一</li></ol><p>缺点：</p><ol><li>国内需要科学上网</li></ol></blockquote><h1 id="优秀博客"><a href="#优秀博客" class="headerlink" title="优秀博客"></a>优秀博客</h1><h2 id="猎人杂货铺"><a href="#猎人杂货铺" class="headerlink" title="猎人杂货铺"></a><a href="https://hunterx.xyz/" target="_blank" rel="noopener">猎人杂货铺</a></h2><blockquote><p>推荐原因：</p><ol><li>有些东西写的真的很不错</li><li>十分钦佩每一位敢于创业的人</li></ol><p>缺点：</p><ol><li>人都要恰饭，有点广告很正常</li></ol></blockquote><h2 id="遇见西门"><a href="#遇见西门" class="headerlink" title="遇见西门"></a><a href="https://www.simon96.online/" target="_blank" rel="noopener">遇见西门</a></h2><blockquote><p>推荐原因：</p><ol><li>写得东西比较实用</li><li>页面非常简单，但是非常实用</li></ol><p>缺点：</p><ol><li>产量比较低</li></ol></blockquote><h2 id="年轻"><a href="#年轻" class="headerlink" title="年轻"></a><a href="http://www.thomasyoung.cn/" target="_blank" rel="noopener">年轻</a></h2><blockquote><p>推荐原因：</p><ol><li>写得东西比较实用</li><li>页面非常简单，但是非常实用</li></ol><p>缺点：</p><ol><li>加载网站较慢，原因未知</li></ol></blockquote><h2 id="嘟嘟"><a href="#嘟嘟" class="headerlink" title="嘟嘟"></a><a href="http://tengj.top/" target="_blank" rel="noopener">嘟嘟</a></h2><blockquote><p>推荐原因：</p><ol><li>也是干货比较多，特点是在书籍整理这一块针对花了心血</li><li>做的副业不错，目前自己也入了，现在的想法是做着玩</li><li>一些工具推荐个人觉得很受用</li></ol><p>缺点：</p><ol><li>说实话页面个人感觉花哨了些</li></ol></blockquote><h2 id="周记杂货铺"><a href="#周记杂货铺" class="headerlink" title="周记杂货铺"></a><a href="https://zhouchangju.com/" target="_blank" rel="noopener">周记杂货铺</a></h2><blockquote><p>推荐原因：</p><ol><li>东西写的很多也很好，并且产量也很高</li><li>虽然偏向于前端，但是很多东西对于后端到我来说也很有启发</li><li>特别感谢vis,js的一些问题解答对我的开发帮助良多</li></ol><p>缺点：</p><ol><li>后悔没早点知道，哈哈哈</li></ol></blockquote><h2 id="时鹏亮的blog"><a href="#时鹏亮的blog" class="headerlink" title="时鹏亮的blog"></a><a href="https://shipengliang.com/" target="_blank" rel="noopener">时鹏亮的blog</a></h2><blockquote><p>推荐原因：</p><ol><li>原本是来找资源到，意外发现也是技术人HHHHH</li><li>个人比较喜欢界面风格</li><li>东西比较基础实用</li></ol><p>缺点：</p><ol><li>存在广告</li><li>干活不多</li></ol></blockquote><h2 id="一个学习的日常"><a href="#一个学习的日常" class="headerlink" title="一个学习的日常"></a><a href="http://www.xihootech.com/" target="_blank" rel="noopener">一个学习的日常</a></h2><blockquote><p>推荐原因：</p><ol><li>里面很多“鸡汤”挺值得思考到</li><li>到目前个人认为个人品牌做得最好到一个博客，很有个人特色</li><li>一个十分有特色的博客</li></ol><p>缺点：</p><ol><li>样式排版个人不是十分喜欢，内容有点点臃肿</li><li>部分分享资源存在收费行为，不过可以理解</li></ol></blockquote><h2 id="公众号-后端进阶（目前博客已关闭）"><a href="#公众号-后端进阶（目前博客已关闭）" class="headerlink" title="公众号[后端进阶（目前博客已关闭）]"></a><a href="https://objcoding.com/" target="_blank" rel="noopener">公众号[后端进阶（目前博客已关闭）]</a></h2><blockquote><p>推荐原因：</p><ol><li>博客的内容写得都非常到清晰</li><li>着重先实战后讲原理</li><li>少数能认真看完一篇长文章的博客</li></ol><p>缺点：</p><ol><li>更新不是很频繁</li></ol></blockquote><h1 id="电影资源网站"><a href="#电影资源网站" class="headerlink" title="电影资源网站"></a>电影资源网站</h1><h2 id="人人电影网"><a href="#人人电影网" class="headerlink" title="人人电影网"></a><a href="http://www.renrendianyingwang.cn/" target="_blank" rel="noopener">人人电影网</a></h2><blockquote><p>推荐原因：</p><ol><li>免费的电影资源分享</li><li>没有恶心的套路，有就是有，没有就是没有</li></ol><p>缺点：</p><ol><li>还是存在许多电影找不到的情况</li></ol></blockquote><h2 id="80S手机电影"><a href="#80S手机电影" class="headerlink" title="80S手机电影"></a><strong><a href="http://www.y80s.com/" target="_blank" rel="noopener">80S手机电影</a></strong></h2><p>百度直接所有80s即可</p><blockquote><p>推荐原因：</p><ol><li>大部分的电影还是可以看得</li><li>比较适合手机党看电影，资源都是比较小的</li></ol><p>缺点：</p><ol><li>受制于版权很多电影还是不能看</li></ol></blockquote>]]></content>
    
    <summary type="html">
    
      解决日常工作问题网站
    
    </summary>
    
    
      <category term="博客" scheme="http://lazytime.site/categories/%E5%8D%9A%E5%AE%A2/"/>
    
    
      <category term="实用" scheme="http://lazytime.site/tags/%E5%AE%9E%E7%94%A8/"/>
    
  </entry>
  
</feed>
