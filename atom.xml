<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>LazyTimes的博客</title>
  
  <subtitle>生死有命，富贵在天</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://whitestore.top/"/>
  <updated>2021-05-20T14:58:54.333Z</updated>
  <id>https://whitestore.top/</id>
  
  <author>
    <name>阿东</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>《炎拳》读书笔记</title>
    <link href="https://whitestore.top/2021/05/20/yanquan/"/>
    <id>https://whitestore.top/2021/05/20/yanquan/</id>
    <published>2021-05-20T14:57:38.000Z</published>
    <updated>2021-05-20T14:58:54.333Z</updated>
    
    <content type="html"><![CDATA[<h1 id="《炎拳》读书笔记"><a href="#《炎拳》读书笔记" class="headerlink" title="《炎拳》读书笔记"></a>《炎拳》读书笔记</h1><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210510114029.png" alt=""></p><h1 id="资源链接："><a href="#资源链接：" class="headerlink" title="资源链接："></a>资源链接：</h1><p>​    之前的笔记都没有记录链接，这次先把链接放出来，由于使用超高清的分辨率扫描，文件体积十分庞大，<strong>请用WIFI下载</strong>（好像有4、5个G）</p><blockquote><p>链接：<span class="exturl" data-url="aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMUdUYXNrNU1UUFVqcllXeFVFSnNzVFE=" title="https://pan.baidu.com/s/1GTask5MTPUjrYWxUEJssTQ">https://pan.baidu.com/s/1GTask5MTPUjrYWxUEJssTQ<i class="fa fa-external-link"></i></span><br>提取码：kkn5<br>复制这段内容后打开百度网盘手机App，操作更方便哦–来自百度网盘超级会员V6的分享</p></blockquote><p>​    <a id="more"></a></p><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>​    本来想取名观后感的，不过感觉和小学生作文一样，还是归入读书笔记吧。平时除了读书之外，个人也经常看看漫画，其实并不是不看专业书，而是因为专业书是一个长时间积累的过程，并不能像普通书籍那样马上产出…..扯远了，再回来说说这本漫画， 这本漫画我比较犹豫要不要给读者看，因为这本漫画非常<strong>邪道</strong>。我敢打赌第一次打开这边漫画，看到前几页就会直接“卧槽”（看了就会明白）。这本书虽然只有短短83话，但是里面的人生哲学基本都有暗示。</p><p>​    这篇 “读书笔记”涉及剧透，如果不想被剧透，请自行下载上方的资源链接。</p><p>​    本文包含剧透！！！</p><p>​    本文包含剧透！！！</p><p>​    本文包含剧透！！！</p><h2 id="推荐指数"><a href="#推荐指数" class="headerlink" title="推荐指数"></a>推荐指数</h2><p>​    <strong>5星，满分五星。</strong>非常有意思的漫画，让我认识了藤本树这个人，对于人物的刻画非常细致。漫画里面的每一个人都不是无用的角色，奇特的时间观，用类似电影的描绘手法进行叙述。同时也是一部富含哲学的漫画。</p><p>​    个人还是十分推荐这本漫画的，虽然看到不少人十分矛盾要不要推荐这部漫画。</p><h2 id="推荐语"><a href="#推荐语" class="headerlink" title="推荐语"></a>推荐语</h2><p>​    <strong>对他使用炎拳吧</strong>！看完绝对让人印象深刻的一部漫画。这部漫画最核心的内容是告诉你，你可以成为你想要成为的任何人。不论是成为“炎拳”，还是成为普通人。无论是成为好人还是成为坏人，最终的来源的只是个人的想法而已。</p><p>​    整个世界从个人来看近似一个乌托邦，大概也可以当反乌托邦的漫画？</p><p>——— 分割线 ——————-</p><h1 id="内容概括"><a href="#内容概括" class="headerlink" title="内容概括"></a>内容概括</h1><p>​    这里说一下作品的几个人名，男主叫阿格尼，英文叫agone（痛苦），女主叫做尤迪。最后男主化身为了萨恩（Sun，太阳），女主变成了露娜（Luna，月亮），作者玩梗玩的挺溜的。</p><p>​    之后的内容算是个人的一些漫画感想，完全主观，所以我所说明的内容只是我的个人理解层次：</p><h2 id="漫画内容概要"><a href="#漫画内容概要" class="headerlink" title="漫画内容概要"></a>漫画内容概要</h2><p>​    这部分还是留给读者自己去看吧，相信这部漫画能带来深刻的回忆。</p><p>​    我更推荐第一遍看这部漫画直接把他当成一部电影看待。</p><h2 id="导演和演员"><a href="#导演和演员" class="headerlink" title="导演和演员"></a>导演和演员</h2><p>​    看过评论有人说这部漫画可以当成一部电影来看待，最开始的电影描述的是阿格尼隐忍和寻找自己的仇人，中间为了拯救被囚禁的祝福者们和统治者进行斗争。导演在前半部分贯穿了主线的内容，在中场为了拯救阿格尼牺牲了自己，导演退出了舞台。演员完成了复仇之后，阿格尼发现自己找不到活着的意义，原本复仇的对象变成了一个一心为了孩子们的“好人”，当阿格尼自以为杀了仇人可以得到解脱之后，却因为妹妹让自己活下去无法完成死去的这个夙愿。从这一部分之后，整个故事就显得越来越神话化了……</p><p>​    所以可以想象自己在电影院看完一整部漫画，挺有意思的。</p><h2 id="成为炎拳"><a href="#成为炎拳" class="headerlink" title="成为炎拳"></a>成为炎拳</h2><p>​    让阿格尼成为炎拳根本原因是尤迪的计划，而直接原因是火焰祝福者永不熄灭的火焰。</p><p>​    最开始的炎拳是没有自我意识，是为了复仇可以做出任何事情的人。后面阿格尼自认为放下了仇恨，然而内心深处的仇恨却让他依然把复仇对象给烧死了，顺带烧死了他的孩子们。阿格尼失忆之后，由于自己“幻想”的妹妹被人掳走，最终还是没能抵住诱惑，还是被孩子变成了炎拳。阿格尼好几次想要放弃作为炎拳活下去，想作为阿格尼活下去，但是各种的想法和自我幻想不断让自己变成炎拳伤害了自己并不想伤害的人。</p><p>​    那么炎拳究竟代表了什么呢？是为了让自己更强大的“火焰祝福者”，还是因为找不到活着意义只能盲目”自燃”的自己，是我们讨厌的自己还是我们喜欢的自己。阿格尼知道最后也没有想明白这件事，作为读者的我也并没有完全想通，最后还是靠女主的拯救得以改变。</p><p>​    作者为什么要刻画炎拳呢？炎拳在被拯救的人来说是英雄，对于导演来说是好演员，对于教徒来说是敌人，对于萨恩来说是渴望被认可的神。阿格尼很明显通过给自己洗脑和粉饰自己来逃避自己内心的罪恶感，有意无意的犯下了永远无法挽回的罪行。</p><p>​    作为读者的我们其实也不自觉的代入炎拳本身，我们甚至代入了阿格尼连同阿格尼去思考，前面或许最开始可以比他看做英雄，但是最后却可能认为是单纯发泄自己欲望的恶魔，我们似乎比阿格尼更加矛盾。</p><p>​    为什么偏偏是阿格尼活了下去并且成为了炎拳？我们无法用单纯的善恶来评判阿格尼。炎拳并不是黑白分明，非好即坏的角色，这和人类一般，人类似乎永远看不透心中藏着的炎拳。</p><h2 id="祝福与诅咒"><a href="#祝福与诅咒" class="headerlink" title="祝福与诅咒"></a>祝福与诅咒</h2><p>​    这一块对个人冲击最大的是萨恩被拉去”集中营”当“材料”的那一部分，萨恩依靠着不断灌输给自己信仰活了下来。并且向同伴不断的传递信念，坚信自己一定会被拯救。然而萨恩后面也因为信仰陷入了疯狂，迷失了自己，可叹的是萨恩最后是被自己信仰的神给结束了生命的，十分讽刺。</p><p>​    这个世界祝福者本来是可以拯救世界的，但是却被人类利用作为了工具，祝福者们也把自己的祝福是看做一种诅咒，这是整个漫画最为明显的一个对立话题。另外，整个“集中营”类似奥斯维辛集中营的映射一个末日当中疯狂的世界。从整个漫画的设定和世界观来看，对立冲突和矛盾是整个漫画的一大核心。</p><p>​    我们从漫画可以发现宗教的力量是十分巨大的，人的信仰可以发挥无穷的力量。这可以想到早期的航海时代，就是依靠着信仰不断的支撑才得以最终发现了新大陆。</p><h2 id="活下去活下去活下去"><a href="#活下去活下去活下去" class="headerlink" title="活下去活下去活下去"></a>活下去活下去活下去</h2><p>​    <strong>活下去</strong>这三个字贯穿了整个漫画，整部漫画都是阿格尼为了活下去不断寻找活着的证明，寻找自己存活的意义。阿格尼一边受着永不熄灭的火焰不断的灼烧，一边要不断的活着寻找存在的理由。在这本漫画，有很多人给了男主存在的理由，比如兵团的“罪人”，被利用的祝福者，导演（看了漫画就会知道）、到后面被阿格尼幻想成自己妹妹的尤迪。</p><p>​    这部分个人认为更贴近《活着》这本书，不管生命命运如何，<strong>活着本身的意义就是为了活着，不为了其他任何事情。</strong></p><h2 id="末日中的人性"><a href="#末日中的人性" class="headerlink" title="末日中的人性"></a>末日中的人性</h2><p>​    这本书很好的表现了末日的世界观，一个冲突的世界，对立与冲突，利用与被利用。善良的人与邪恶的人。这里令人唏嘘的是当初被阿格尼救了的人最后却反过来想要杀了阿格尼，“罪犯”们认为是阿格尼让他们感到十分的痛苦，这大概就是令人悲哀的人性。当然这个话题也类似一个无解的铁轨命题，本质就是在说个人做出的任何选择都要付出相应的代价。</p><p>​    让阿格尼成为火焰祝福者的老人（后面变成的），因为后悔自己放火烧村恳求炎拳放弃复仇，知道世界的真相之后一心想要保持末日当中作为人的最后一点人性，我不太明白作者为什么要洗白老人，我认为作为末日当中抹去人性才是正确的选择，因为<strong>生存永远是第一需要</strong>，哪怕吃人也不足为奇，毕竟<strong>失去人性，失去一些，失去兽性，失去一切</strong>。</p><p>​    <strong>人只会相信自己相信的事物，只能看到自己想要看到的事物</strong>。阿格尼拯救了兵团了犯人，人们都把他当英雄。然而因为末日阿格尼瞒着人们割下自己的肉给人们当做食物，人们又反过来想要毁灭炎拳，<strong>他们忘记了过去，只考虑现在，并认为自己变得黑暗是因为炎拳</strong>。</p><p>​    这一段让我想起了《三体》当中人类不感谢拯救了地球的罗辑，人性当中的阴暗面或许就潜藏在我们的无意识或者潜意识当中，只有时刻保持自我约束。才能让压抑我们内心黑暗的想法。</p><p>​    还有一点很奇怪的是，当炎拳拯救了实际上是罪人的“祝福者”。我们甚至感同身受的认为炎拳是一个英雄，甚至忘了他无情的夺走了很多人的性命。</p><p>​    </p><h2 id="活出自己"><a href="#活出自己" class="headerlink" title="活出自己"></a>活出自己</h2><p>​    阿格尼最开始活着是为了复仇，然而复活对象死后，他在不断的自我惩罚而堕落当中寻找活着的意义，。炎拳个人认为最为温馨的一段是尤迪第一次变成大树的计划被炎拳破坏之后两人失忆的那一段时间。阿格尼找到了真心愿意让他过得更好的“家人”。</p><p>​    然而最后炎拳还是亲手杀了自己的“家人”。阿格尼还是没有战胜自己，或许这种遗憾是每一个人的心结。</p><p>​    </p><h2 id="自救和被拯救"><a href="#自救和被拯救" class="headerlink" title="自救和被拯救"></a>自救和被拯救</h2><p>​    接下来要说下对于结局的看法，最终男主还是“找到”了目标，当然是被尤迪赋予了活着的意义。阿格尼虽然并不是靠着自己的力量完成自救，并且找到活着的意义的</p><p>​    和《肖申克的救赎》有些类似，拯救了阿格尼牺牲自己的尤迪无疑是十分伟大的，阿格尼成功获得了救赎，并且忘记了自己作为炎拳以及自己的所有过去。作为人来说，要完全放下过去，重新做人基本上是不太可能的一件事情，因为漫画的主角阿格尼有着强韧的精神力却也依然没有做到，或许这也是人之本性吧。</p><p>​    我更想看到阿格尼成功自救，走出炎拳的束缚，但是结局没有如我所愿。</p><h2 id="关于结局"><a href="#关于结局" class="headerlink" title="关于结局"></a>关于结局</h2><p>​    接上一个小节的介绍，结局是作者被尤迪（女主）所拯救。另一方面，虽然尤迪变成大树给地球带来了生机。但是由于人类对资源的掠夺，最后的结局是人类自取灭亡。</p><p>​    另外最后人类的的咎由自取有点讽刺现在的大环境。地球资源的掠夺，人类注定会自取灭亡。</p><p>​    另外，我认为结局“Luna”和”Sun“相遇有点故事的神话化，当然画面的冲击感十分强烈，总的来说还是可以接受但是不是很满意的结局。</p><p>​    这个结局我个人<strong>不太满意</strong>，因为阿格尼结局是被拯救而不是自我拯救。有一点点高开低走，最后男主借用萨恩的身份活了下来，算是完成了找到活着的意义的目的，并且看了过去的“自己”拍的电影。而女主因为长时间的等待甚至忘记了当初拯救的人是谁。结局的几张画面还是刻画的十分有美感的。虽然这个结局不是十分喜欢，但是比起隔壁某温泉店老板的作品那可真是要好太多了（说的就是你，进击的巨人）。</p><p>​    </p><h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>​    唉，该来的还是来了，希望不要拍烂吧，而且国内应该播不出。</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210427153330.png" alt=""></p><h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>​    一部漫画只要听到名字就能想起某个画面，我想这部漫画就是十分成功的漫画，这部漫画的出生也有不少的波折。关于人生的所有哲学，都可以从这部漫画各种方面看到缩影。</p><p>​    <strong>或许每一个人都是炎拳</strong>。</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      什么是炎拳,对他使用炎拳
    
    </summary>
    
    
      <category term="读书笔记" scheme="https://whitestore.top/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="炎拳" scheme="https://whitestore.top/tags/%E7%82%8E%E6%8B%B3/"/>
    
  </entry>
  
  <entry>
    <title>《给未出世的你 致2025年的世界》读书笔记</title>
    <link href="https://whitestore.top/2021/05/20/weichushi/"/>
    <id>https://whitestore.top/2021/05/20/weichushi/</id>
    <published>2021-05-20T14:55:41.000Z</published>
    <updated>2021-05-20T14:56:58.637Z</updated>
    
    <content type="html"><![CDATA[<h1 id="《给未出世的你-致2025年的世界》读书笔记"><a href="#《给未出世的你-致2025年的世界》读书笔记" class="headerlink" title="《给未出世的你 致2025年的世界》读书笔记"></a>《给未出世的你 致2025年的世界》读书笔记</h1><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>​    这是一份送给“一零后”的成人礼。1999年世纪之交，七十四岁的雅卡尔写下这封信，期待未出世的重孙在自己百年诞辰的2025年，打开它。</p><p>​    令人惊讶的是，书中的预言到现在基本全然实现，并且当智能手机以惊人的速度普及的现代，这个预言似乎来得更早了。</p><p>​    这本书适合给青少年看，适合给每一个懵懂无知并且处在迷茫徘徊的年代的读物。然而作为一个成年人，依然可以从书中诚挚的语言感动。</p><a id="more"></a><h1 id="推荐语"><a href="#推荐语" class="headerlink" title="推荐语"></a>推荐语</h1><p>​    作者的语言用朴实的语言，写下这封“信”给自己的重孙，这本书适合每一个青少年和“10后”读一读。</p><h1 id="好句摘录"><a href="#好句摘录" class="headerlink" title="好句摘录"></a>好句摘录</h1><ul><li>你并不比遭到社会抛弃的人强多少，并不比所谓强大的有社会地位的人弱多少。</li><li>毫无作为的选择是无意义的，没有理解接踵而至而盲目的作为也同样苍白无力。</li><li>不为困难迈向山顶的人，每一步都很费力，但不会放弃，因为视野开阔之际，他将得到怎样的回报。</li></ul><h1 id="内容概要"><a href="#内容概要" class="headerlink" title="内容概要"></a>内容概要</h1><p>​    可能是过了适合读这本书的年纪，对于书本的内容似乎已经麻木而且习以为常，作者对于未来的担忧到现在基本已经成真，特别是疫情后的世界，前路更加迷茫。</p><h2 id="社会与未来"><a href="#社会与未来" class="headerlink" title="社会与未来"></a>社会与未来</h2><p>​    现代基础科学也正如作者一般并没有很大的变化，基础理论的发展缓慢，更多是社会资源朝着“极限”不断的发展和蔓延。作为未来的一代，是面临人口爆炸，社会资源枯竭，竞争压力也越发的巨大。</p><p>​    技术的进步将改变人的生产甚至改变生活方式。当时基础的社会生活依然和几十年前没有多大的改变。更多的是通货膨胀，物价飞涨，社会生活到现在依然是量的积累而不是质的飞跃。</p><h2 id="因为你终究死去"><a href="#因为你终究死去" class="headerlink" title="因为你终究死去"></a>因为你终究死去</h2><p>​    “你很幸运，因为你终将死去”。这是这本书背面唯一的一句话，似乎向自己的重孙说，也是在向自己说吧。</p><p>​    年轻的时候，“死亡”经常会认为是一个遥远的话题，虽然人的生命不过3万多天，但是即使是单纯的数字，依然可以让人感觉生命的“漫长”。然而，<strong>时间并不是装在宝箱的宝藏，你每花费一点就从宝藏里面拿出一点。时间是永远流动的泉水，只不过你终将离开泉眼</strong>。作者豁达的心态令人致敬。</p><p>​    别人的死亡只不过是一系列事件的一个篇章。但是我们自己却有完全不同的地位。我们永远可以看到其他人生命的终点，但是我们永远看不到自己生命的终点。正是由于此种的原因，我们自觉永远不会离开名为时间的泉眼</p><p>​    对于死亡的忧虑，正在促成个人的不断成长，在对不死进行斗争的时候，死亡的焦虑是永恒的朋友。</p><h2 id="关于人类这物种"><a href="#关于人类这物种" class="headerlink" title="关于人类这物种"></a>关于人类这物种</h2><p>​    在科技不断发展的现在，人类越发的自觉自己是世界的主宰。人们一边忧虑世界资源的掠夺和破坏，一边却又在不断的重蹈覆辙，似乎世界是永恒的。</p><p>​    这种死循环似乎存在于一种规则一般，让人担忧却无可奈何，人类未来也将在不断的忧虑和进步当中寻找新的可能。</p><h2 id="人的构成："><a href="#人的构成：" class="headerlink" title="人的构成："></a>人的构成：</h2><p>​    对人的看法似乎从出生的那一刻就进行的划分，并不是简单的男性和女性，而是阳性，中性，阴性。人文主义的进化与发展，促成了现代人性格的多样性和独立性。然而，不论生活在任何地区，都会对人进行划分，将男人和女人进行区别对待，这便是自古遗留下来的观念。</p><p>​    和人的两极一样，世界似乎处处也存在着两极，任何的事物都拥有他的对立面，我们对于宇宙和世界的认知却如同婴儿一般。</p><p>​    </p><h2 id="世界的变革"><a href="#世界的变革" class="headerlink" title="世界的变革"></a>世界的变革</h2><p>​    作者期望的发达国家“零增长”的世界似乎永远不会到来（但是人口零增长却已经实现了）。虽然世界已经脱离了冷战时期。资源掠夺依旧在继续，大国依旧在利用核武器互相危险，然后用蹒跚的脚步不断“减量”。爱因斯坦大概永远不会知道，促成世界和平的居然是人类灭亡的核武器，而爱因斯坦醒悟的时候已经没有的回头的路。</p><p>​    </p><h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>​    作为成年人，这本书似乎永远只适合作为地铁读物，所以这本书简单看看就差不多了。但是<strong>身处与他人相遇的联系中时，任何人都不只是“他自己”。</strong></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      《给未出世的你 致2025年的世界》读书笔记
    
    </summary>
    
    
      <category term="读书笔记" scheme="https://whitestore.top/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="励志" scheme="https://whitestore.top/tags/%E5%8A%B1%E5%BF%97/"/>
    
  </entry>
  
  <entry>
    <title>《不努力好像也没关系》读书笔记</title>
    <link href="https://whitestore.top/2021/05/20/bunuli/"/>
    <id>https://whitestore.top/2021/05/20/bunuli/</id>
    <published>2021-05-20T14:51:42.000Z</published>
    <updated>2021-05-20T14:55:20.688Z</updated>
    
    <content type="html"><![CDATA[<h1 id="《不努力好像也没关系》读书笔记"><a href="#《不努力好像也没关系》读书笔记" class="headerlink" title="《不努力好像也没关系》读书笔记"></a>《不努力好像也没关系》读书笔记</h1><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210410191647.png" alt=""></p><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>​    这本书算是一本彻底的标题党的书，内容虽然和书名的意思差不多，但是由于作者是个日本人，很多东西只要看看就好。我从这本书中学到的内容并不算很多，更多的是一种感慨。这本书是那种口袋书，比较适合地铁上放松的时候看看。</p><a id="more"></a><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>​    《不努力好像也没关系》是“14岁懂社会”系列的第五本（前四本为《以书为友》，《你没那么笨》，《动物园的生死告白》，《女生的世界里总是硝烟弥漫》）。讲述了如何用“佛系”和达观的心态去看待社会和世界，用朴实和语重心长的语言以教育K君和U子两个孩子为线索，阐述了作者认为的世界观，人生观和价值观。</p><h1 id="推荐语"><a href="#推荐语" class="headerlink" title="推荐语"></a>推荐语</h1><p>​    <strong>地铁放松读物</strong>。这本书用非常“佛系”的心态让读者用释怀的角度去看待人生百态，比如避免竞争，要做有趣的人，不要做无趣的人，接纳自己的缺点，以及不要那么拼命的努力。但是并不是说真的放弃追求，而是要用活出自己的个性并且接纳自己的缺点，并且努力让自己成为“真正的人”。</p><h1 id="好句摘录"><a href="#好句摘录" class="headerlink" title="好句摘录"></a>好句摘录</h1><ul><li>人生既有风雨交加，也有晴空万里。<strong>请在悲伤的时候尽情悲伤，喜悦的时候尽情喜悦</strong>。悠闲舒畅地度过你们的人生，这就是我的希望。</li><li>K君，你一定要牢牢记住，每个人都是不同的，跟别人不一样完全没关系，也不要因为别人跟自己不一样就欺负对方，千万不要成为那样的人。这是我对你的希望。</li><li>U子，我希望你记住：人是孤独的，人的孤独是本质性的，无法消解的。在了解这个事实的前提下，你就可以尽情和世上的很多人交往。毕竟你了解到孤独是本质性的，与他人互发消息时就不会患得患失了。</li><li>我们每个人都有好奇心和求知欲，<strong>如果是为了满足自己的好奇心与求知欲而学习，肯定会很开心</strong>。</li></ul><h1 id="内容概要"><a href="#内容概要" class="headerlink" title="内容概要"></a>内容概要</h1><p>​    这本书讲述了人应该拥有自己的目标，应当关爱他人，讲述人的孤独是与生俱来的，没有人可以代替人死亡，同时批判日本社会，人际关系的冷漠以及隔阂。讲述人不应该存在竞争，同时批判社会制度的各种竞争。下面就作者的几个观点进行简述。</p><h2 id="脱离正轨"><a href="#脱离正轨" class="headerlink" title="脱离正轨"></a>脱离正轨</h2><p>​    本书讽刺了日本社会的生活用“成功“来衡量一个人，并且反对”人要于是有用”的说法，提出每一个人都是独一无二的，有缺点并不是什么坏事，相反，要在接纳自己缺点的同时，寻找自己的优点，寻找自己的热情，让自己脱离生活的正轨。</p><p>​    什么是无趣的人？什么是有趣的人呢？作者给出的答案是，无趣的人想着荣华与富贵并且为工作而活的人，而有趣的人则<strong>为自己而活</strong>。</p><p>​    这里讽刺了日本冷漠并且病态社会的社会，作者认为大家都“疯了”，社会让多数人变成无趣的人。这样病态的日本社会现实好像逐渐在映射到我们的国家。</p><h2 id="人是孤独的"><a href="#人是孤独的" class="headerlink" title="人是孤独的"></a>人是孤独的</h2><p>​    这里面作者提到了夏目漱石的《心》。这本书比较建议每一个人看看，讲了人的孤独是与生俱来的，每个人从出生到死去都是“孤独”的。所以孤独的自己更应该好好的活在这个世界上，更好的感受每一天人生。</p><p>​    对于孤独个人的理解是，觉得自己孤独的人都不是孤独的人，内心感受不到孤独的人才是真正孤独的人。</p><p>​    </p><h2 id="人的缺点"><a href="#人的缺点" class="headerlink" title="人的缺点"></a>人的缺点</h2><p>​    接纳自己的缺点，同时极力的发扬自己的长处才是正确的做法。取长补短固然是一种可行的办法，但是人生来就是不完美的，正是因为不完美每一个人才显得独立而富有个性，所以我们并不需要让自己成为完美的人，相反更应该反其道而行，极力的发挥自己的长处，因为完美的人是不存在的，完美的人是怪物。</p><p>​    对于人的缺点这一段的看法，个人认为每一个人更多的是厌恶别人的缺点，但是从来不反省自己的缺点，每个人似乎都能通过生活和细节了解和观察一个人，但是很少有人真正的了解自己。</p><h2 id="拼命工作是对的么？"><a href="#拼命工作是对的么？" class="headerlink" title="拼命工作是对的么？"></a>拼命工作是对的么？</h2><p>​    本书从蜜蜂和蚂蚁的案例，提出过多的花朵并不能让蜜蜂采到更多的蜂蜜，反而会让蜜蜂累死，而蚂蚁看起来很勤劳，但是实际上大部分的蚂蚁都在“偷懒”。最后质疑为什么一定要拼命工作，但是并不是说拼命工作是错的，而是质疑为什么一定要那样努力的工作，每个人更应该探究自己于社会的使命和活着的意义。</p><p>​    正是因为有懒惰的人，才能显得勤劳的人伟大， 社会精英永远都是少数人，即使出自同一个环境的人也会分出三六九等，我们并不需要为什么“成功“拼命的工作。</p><p>​    这种观点说的是日本压抑的社会环境，在个人看来更像是对日本阶级固化社会的一种反抗。至于对于这一个观点的看法，我个人保持保留意见，并不认可也并不反对。</p><h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>​    这本书最终个人定位还是认为是地铁上的轻松读物，看完可以让心中稍微释怀一些，但是像作者这样佛系的心态我想作为一个普通人来说还有很远的路要走。</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      人生需要拼搏,也需要休息
    
    </summary>
    
    
      <category term="读书笔记" scheme="https://whitestore.top/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="励志" scheme="https://whitestore.top/tags/%E5%8A%B1%E5%BF%97/"/>
    
  </entry>
  
  <entry>
    <title>《奇特的一生》读书笔记</title>
    <link href="https://whitestore.top/2021/05/20/qiteyisheng/"/>
    <id>https://whitestore.top/2021/05/20/qiteyisheng/</id>
    <published>2021-05-20T14:49:08.000Z</published>
    <updated>2021-05-20T14:51:13.803Z</updated>
    
    <content type="html"><![CDATA[<h1 id="《奇特的一生》读书笔记"><a href="#《奇特的一生》读书笔记" class="headerlink" title="《奇特的一生》读书笔记"></a>《奇特的一生》读书笔记</h1><p>[TOC]</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210408135045.png" alt=""></p><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>​    这本书个人认为是时间管理的一本“教材书”，需要注意的是这更像是对于一个人一生的评价和讨论。同时主人公并不是我们常见的“成功人物”。他的知名度远远不及列夫托尔斯泰，但是他是属于“不鸣则已，一鸣惊人”的典型案例。另外再说说作者，作者作为文学界“王者”用一整本书写一个人，可以看出他对柳比歇夫的尊敬态度。最后我想吐槽一句，其实这本书并不需要那么多内容，修订版凑篇幅的痕迹比较明显。</p><p>​    这本书算是自律和时间管理的教科书，用一个真实人物的案例告诉你一个自律+时间管理的人能产生多大的能量。</p><p>​    好像我看过印象比较深刻的书籍读书笔记的内容都比较长，所有这篇文章也非常长。后续根据具体情况反馈调整读书笔记的篇幅。</p><p>​    <a id="more"></a></p><h1 id="推荐指数"><a href="#推荐指数" class="headerlink" title="推荐指数"></a>推荐指数</h1><p>​    <strong>五星</strong>：我很少会认为一本书是完美的，但是这本书从个人角度来看无论是当做人物传记读一读还是学习时间管理，这都是对于个人成长十分有价值的。</p><p>​    比较遗憾看到没能早点看到这本书晚，不过还算年轻的时候看到这本书绝对是人生的一大宝藏。</p><p>​    这本书算是宝藏类型的书。是值得“浪费”人生来仔细阅读的一本书。</p><h1 id="推荐语"><a href="#推荐语" class="headerlink" title="推荐语"></a>推荐语</h1><p>​    <strong>你可以浪费时间，但是请不要浪费生命</strong>。柳比歇夫用一生贯彻自己的人生目标，他的时间统计法值得每一个人学习和借鉴，同时对于时间的感知越深，目标越伟大，越会感觉时间的短暂。</p><h1 id="好句摘录"><a href="#好句摘录" class="headerlink" title="好句摘录"></a>好句摘录</h1><ul><li><p>再伟大的人，终究不过是一个凡人，无论多么没有感情的方法，都阻挡不了幸福的冲击</p></li><li><p>一个心灵美好的人是很难遇到的，因为人不可能长进的超过善良与真诚</p></li><li><p>有些人把穿一套好衣服当做真正的乐趣，何必同这些人比赛竞争呢？</p></li><li><p>生活不会等待慢吞吞的人，人生是一场没有终点的旅行。</p></li><li><p>他拿着秒表检查自己，惩罚自己，一旦独树一帜，就不可能得到理解。</p></li><li><p>真正的时间管理是：<strong>你总是可以浪费时间做没有什么目的的事情，只要你开心，没有负罪感，你就是一个幸福的人</strong></p></li></ul><h1 id="看书之后总结几个问题"><a href="#看书之后总结几个问题" class="headerlink" title="看书之后总结几个问题"></a>看书之后总结几个问题</h1><h2 id="柳比歇夫是谁？"><a href="#柳比歇夫是谁？" class="headerlink" title="柳比歇夫是谁？"></a>柳比歇夫是谁？</h2><p>​    亚历山大·亚历山德罗维奇·柳比歇夫（1890年4月5日——1972年8月31日），前苏联的昆虫学家、<span class="exturl" data-url="aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS/lk7LlrablrrYvMzk2OA==" title="https://baike.baidu.com/item/哲学家/3968">哲学家<i class="fa fa-external-link"></i></span>、<span class="exturl" data-url="aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS/mlbDlrablrrYvMTIxMDk5MQ==" title="https://baike.baidu.com/item/数学家/1210991">数学家<i class="fa fa-external-link"></i></span>。毕业于<span class="exturl" data-url="aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS/lnKPlvbzlvpfloKHlm73nq4vlpKflraYvMjA2NDc2OA==" title="https://baike.baidu.com/item/圣彼得堡国立大学/2064768">圣彼得堡国立大学<i class="fa fa-external-link"></i></span>，一生发布了70余部学术著作，从分散分析、生物分类学到昆虫学等。</p><p>​    <strong>他在26岁时独创了一种“时间统计法”，通过记录每个事件的花销时间，通过统计和分析，进行月小结和年终总结，以此来改进工作方法、计划未来事务，从而提高对时间的利用效率。期间他不断完善这一统计方法，并一直沿用了56年直到逝世。</strong></p><p>​    – 摘自百度百科。</p><h2 id="这本书讲了什么？"><a href="#这本书讲了什么？" class="headerlink" title="这本书讲了什么？"></a>这本书讲了什么？</h2><p>​    时间是和生命同等重要的东西，而生命本质就是时间的积累和延长。但是认知和管理时间却恰恰是人所容易忽视的。</p><p>​    时间不属于任何人，同时时间是一种我们<strong>不得不花的消耗品</strong>。我们珍惜一分一秒，就是在珍惜我们的生命。</p><p>​    那么这本书到底讲了什么？这本书通过一整本书来介绍柳比歇夫，同时介绍这本书最核心的内容时间统计法也是对于时间管理思想启蒙，如果不知道如何规划自己，同时想要了解自己的时间是如何“浪费”的，可以借鉴书中的时间管理办法进行自我审视。</p><h2 id="时间统计法的具体内容？"><a href="#时间统计法的具体内容？" class="headerlink" title="时间统计法的具体内容？"></a>时间统计法的具体内容？</h2><p>​    看书吧，这本书不是说教，越看你越会发现柳比歇夫的个人魅力。</p><h3 id="柳比歇夫时间记录分析的4个步骤"><a href="#柳比歇夫时间记录分析的4个步骤" class="headerlink" title="柳比歇夫时间记录分析的4个步骤"></a>柳比歇夫时间记录分析的4个步骤</h3><p><strong>1.记录</strong>：忠实的记录自己的 <strong>完成目标相关的任务</strong>的时间开销，误差不超过15分钟。不记录吃喝拉撒的事情。了解自己的时间花在那些地方</p><p><strong>2.统计</strong>：每一个月对于自己这个月的时间开销进行归类统计，并且进行归档，严格的计算自己的时间开支s</p><p><strong>3.分析</strong>：分析那些方法是高效的，根据开销调整自己的工作方法，提高工作效率。</p><p><strong>4.反馈</strong>：反馈除了继续坚持，还意味着适当的放弃，同时，不要把所有的时间花在目标上面，<strong>人不是机器，需要适当休息，需要适当娱乐</strong>。</p><h3 id="柳比歇夫时间5个时间原则"><a href="#柳比歇夫时间5个时间原则" class="headerlink" title="柳比歇夫时间5个时间原则"></a>柳比歇夫时间5个时间原则</h3><ol><li><strong>不承担必须完成的任务</strong>：永远不接受自己无法完成的任务，只承担自己力所能及的事情</li><li><strong>不接受紧急任务</strong>：永远不接受紧急的任务，但是紧急的书信会第一时间回复。平常时间按照自己定时的三大类按部就班的完成</li><li><strong>充足的休息时间</strong>：每天睡够10个小时，柳比歇夫虽然看上去一分一刻都不浪费，但是他的睡眠时间甚至比现代绝大多数人的睡眠时间都要长。跟很多动辄每天4个小时睡眠时间的“超人”和“怪物”，柳比歇夫很注重充足的休息时间。</li><li><strong>一累了就马上休息</strong>：类似番茄工作法，劳逸结合的工作方式比长时间高强度的工作效率高很多。但是想要控制却非常难。</li><li><strong>把累人的工作同愉快的工作结合在一起</strong>：把时间分类之后，按照时间的重要程度和先后依次完成，保持乐观健康的心态进行工作。</li></ol><h2 id="柳比歇夫是普通人么？"><a href="#柳比歇夫是普通人么？" class="headerlink" title="柳比歇夫是普通人么？"></a>柳比歇夫是普通人么？</h2><p>​    先说结论：<strong>绝对不是普通人</strong>，在我看来如果人人可以做到像柳比歇夫这般，世界不但不会更精彩，只会显得无趣。但是柳比歇夫是普通人通过努力可以达到的。时间统计法适用于任何人，实际尝试就可以发现，这花不了多少时间，并且一天天的记录，通过积累可以清晰的认识到自己在干什么，因为 <strong>时间是不会骗人的</strong>。</p><p>​    </p><h2 id="为什么柳比歇夫可以如此自律？"><a href="#为什么柳比歇夫可以如此自律？" class="headerlink" title="为什么柳比歇夫可以如此自律？"></a>为什么柳比歇夫可以如此自律？</h2><p>​    <strong>他将自己的一生奉献给自己定下的目标。</strong>柳比歇夫是非常幸运的人，在年轻的时候找到了自己的使命，找到了自己真正目标和毕生的梦想，他也用行动来达成自己的目标，虽然从结果来说他可能<strong>依然还在成功的路上。</strong>但是他的成就绝对不比任何一个功成名就的人要差。</p><p>​    <strong>清楚自己浪费过时间，清楚浪费多少，怎么浪费，为什么浪费？</strong>人最容易看清的是别人，最难看清的是自己。但是柳比歇夫时刻知道自己离目标有多远，自己每一时每一刻的开销。</p><h2 id="如何像柳比歇夫一样精确感知时间？"><a href="#如何像柳比歇夫一样精确感知时间？" class="headerlink" title="如何像柳比歇夫一样精确感知时间？"></a>如何像柳比歇夫一样精确感知时间？</h2><p>​    老调重谈，还是需要<strong>坚持</strong>，只需要记住，任何具备真正价值的东西，通常都需要一个量变到质变的过程。</p><h2 id="什么是纯时间，什么是毛时间，为什么要计算纯时间？"><a href="#什么是纯时间，什么是毛时间，为什么要计算纯时间？" class="headerlink" title="什么是纯时间，什么是毛时间，为什么要计算纯时间？"></a>什么是纯时间，什么是毛时间，为什么要计算纯时间？</h2><p>​    纯时间：完成一个目标实际花费的时间，这是最能真实反映工作效率的时间。</p><p>​    毛时间：就是指从任务的开始到任务的结束总共花了多少时间，这个时间可以用来衡量。</p><p>​    多数人计算毛时间基本都可以进行大致估算，但是对于纯时间的把握是十分困难的，但是纯时间恰恰又是一个最能反映效率的时间，所以时间统计法的核心就是合理计划以及精准的估算自己花费的纯时间。尽量的减少毛时间的消耗，因为一件事情拖得越久越难完成。</p><p>​    </p><h2 id="时间统计法有什么作用？"><a href="#时间统计法有什么作用？" class="headerlink" title="时间统计法有什么作用？"></a>时间统计法有什么作用？</h2><ol><li><strong>抓住偷跑的时间</strong>。现代的科技发展让我们的生活越来越便利，大部分人基本不必担心温饱问题，不会居无定所，全球大多数人摆脱了生存的问题，到了未来甚至我们的一切衣食住行都可以由机器来帮助我们完成。但是我们却越发感到时间的不足。对于偷跑的时间，只要时刻牢记<strong>想要让你浪费时间的，多半要么是自己“想”浪费，要么是别人想从你身上赚钱</strong>，学习时间统计法就是想办法“留”更多的时间给自己成长。<ol start="2"><li><strong>有效并且高质量的利用时间。</strong>随便找一天记录一天的工作时间开销，都会发现自己其实一天真正有效的工作时间能有<strong>一半</strong>就算是非常不错了。而时间统计法可以帮助衡量时间的开销和调整计划。</li><li><strong>与时间做朋友，时间会给你回报</strong>。人人为我，我为人人，对待时间像对待自己最珍贵的朋友一样，时间迟早会给你该有的回报。</li><li><strong>学会感知时间。</strong>，用时间统计法就会发现，人类不仅工作低效，并且人对于时间这个看不见摸不着的东西 <strong>无法把握。</strong>就像我们在日常生活常觉得放假的时间太短，而上班的时间太过漫长。然而这两个时间对于一天来说都是一样的。所以用统计看看自己在那里浪费了时间，可以帮助自己更好的感知时间。</li></ol></li></ol><h2 id="紧张工作和享受生活有矛盾么？"><a href="#紧张工作和享受生活有矛盾么？" class="headerlink" title="紧张工作和享受生活有矛盾么？"></a>紧张工作和享受生活有矛盾么？</h2><p>​    从书中的内容来看，柳比歇夫拥有如此旺盛的意志力，一方面得益于有着伟大的梦想，另一方面是他非常懂得<strong>劳逸结合</strong>。他每天睡10个小时，累了就马上休息，从不拖泥带水。并且<strong>不接受任何必须完成的任务。不接受任何紧急任务。但是遇到紧急的事情会第一时间回复。</strong></p><p>​    这让我想起了<strong>《不努力也没关系》</strong>书中的一段内容：<strong>如果你想成为大师，努力训练5年就够了，但是如果每天拼命努力用所有时间来练习却要花费十年的时间</strong>。永远要相信人的意志力一种消耗品，科学也证明了人高强度工作<strong>90分钟</strong>之后效率会十分低下。所以紧张工作和生活完全可以分开，甚至可以在累了的时候马上休息，但是大多数时候我们会选择把所有的时间用来<strong>享受生活</strong>。</p><h2 id="如何更好的成长？"><a href="#如何更好的成长？" class="headerlink" title="如何更好的成长？"></a>如何更好的成长？</h2><p>​    <strong>立马行动，实践书中所有可以实践的内容。</strong>如果看完书丢到一边，那么这本书只是一个人物传记，对于读者个人的帮助微乎其微。</p><p>​    <strong>不要忘记自己的初衷</strong>。无论何时何地，遇到多少挫折，都不要忘记自己的初衷，个体的一切努力而是为了<strong>达成目标</strong>。</p><p>​    <strong>时间统计法最重要的是诚实</strong>。千万不要为了形式主义去做时间笔记，这样做没有任何帮助，也不要为了“凑数”让自己看上去很用功，努力了就是努力了，懈怠了就是懈怠了，人都会有想要放松的念头，但是如果借助时间统计法能更加精确的规划时间让自己成长，一时的浪费并不算什么大问题。</p><p>​    <strong>回想自己为目标付出了多少有效时间。</strong>学习就是一个输入和输出的过程，一直输入而不进行输出，那么知识是无法内化的，最好的状态是保持高效的同时平衡输入和输出。</p><p>​    <strong>制定大目标，小目标，年计划，月计划，周计划，时间耗费</strong>。如果你曾经依靠自律让自己获得一定的成就，相信可以理解柳比歇夫为什么要做到如此极端。根本原因是柳比歇夫的目标过于伟大，所以对于时间以及精力的管理有着异于常人的要求。<strong>其难度不亚于一个身体素质一般的普通人要去拿奥运冠军</strong>。</p><h2 id="其他建议"><a href="#其他建议" class="headerlink" title="其他建议:"></a>其他建议:</h2><p>​    个人买的奇特的一生实体书附带了一本小册子，主要讲一些读者的反馈以及自己如何实践时间统计法，下面记录一个方法摘要：</p><p>大道至简：</p><ul><li>你是看上去很努力而已</li><li>纯时间看到工作效率</li><li>柳比歇夫日程表</li><li>打造专属日程表</li></ul><p>他的要求：</p><ul><li>精确记录是第一原则</li><li>不要忘记初衷，不要忘记你的目的</li><li>适合自己的才是最好的。</li></ul><h1 id="阅读感受"><a href="#阅读感受" class="headerlink" title="阅读感受"></a>阅读感受</h1><p>​    看完整本书，我最大的感受一方面是惊叹时间统计法以及人的自律居然可以有如此强大的力量，另一方面从作者的笔墨中，也可以看到作者并不建议任何一个人效仿柳比歇夫，作者也直言不讳的表示自己也做不到柳比歇夫那样，甚至赞成一些对于柳比歇夫的极端工作的批判观点。同时可以看到，柳比歇夫并不是一个没有感情的机器人，柳比歇夫也拥有书信往来的朋友，也花时间陪家人，是一个十分具有个人魅力的人。</p><p>​    从柳比歇夫的另一个对于生活的态度，和很多的文豪作家不同富丽堂皇的家庭环境，柳比歇夫对于生活的要求标准极低，只要一个书桌，一盏灯，一把椅子，和一个安静的环境，柳比歇夫就满足了。这种务实和朴实的精神在奢靡风气横行的时代显得非常格格不入。如果用《小狗钱钱》当中的来比喻，<strong>柳比歇夫是拥有很大的圆孔，但是甜甜圈本身却很小的人</strong>。人人都有虚荣心，但是柳比歇夫的“虚荣”更像是用行动来证明自己，如果不是他自己公布自己的时间管理方法和自己成就，可能多数人认为柳比歇夫就是一个稍微有点成就的生物学家。这样的柳比歇夫，给我的感觉像是小隐隐于林，大隐隐于世的奇妙感觉。</p><p>​    柳比歇夫不但对于梦想有着极强的执念和行动力，并且拥有者独特的个人魅力。不了解这个人，可能看上去和普通人无异。但是作者越是解读柳比歇夫这个人，这个人给人的印象就越发的深刻。</p><h1 id="内容概要"><a href="#内容概要" class="headerlink" title="内容概要"></a>内容概要</h1><p>​    这本书实际去看会比看我这篇笔记有价值和有意义的多，同时内容是人物自传类型的读物，不适合作为内容概要，所以这部分内容根据个人看到的内容进行小结。这个小节的内容都是随便写写，比较自由，可以不看，不过我想没有多少人看到这里所以也就胡说八道了。</p><h2 id="柳比歇夫的读书观"><a href="#柳比歇夫的读书观" class="headerlink" title="柳比歇夫的读书观"></a>柳比歇夫的读书观</h2><p>​    “我在抄抄写写中不断积累，为我日后的发表留下材料。浮皮潦草，蜻蜓点水式的看书，是看不到深度内容的”。柳比歇夫非常擅长总结看到的内容，我想柳比歇夫是通过大量的可以练习的结果。是设定目标不断的抄写，造就了现在的柳比歇夫。</p><h2 id="碎片时间"><a href="#碎片时间" class="headerlink" title="碎片时间"></a>碎片时间</h2><p>​    碎片时间在书中被称为“时间脚下料”，个人在通勤过程中看完了很多小说，漫画，文学作品等等（也做了不少读书笔记），非常赞成好好利用“脚步上的时间”。</p><p>​    个人认知的碎片时间如下：</p><ul><li>通勤时间，上下班</li><li>旅游，出差的火车，高铁上</li><li>到店就餐或者等外卖</li><li>刷牙，洗漱</li><li>其他一切消耗时间没有价值但是必须做到事情</li></ul><p>当然，不建议吃饭的时候看书，不利于消化。</p><h2 id="人生目标的重要性"><a href="#人生目标的重要性" class="headerlink" title="人生目标的重要性"></a>人生目标的重要性</h2><p>​    26岁柳比歇夫定下了一生追求的梦想，时间统计法和他一生数不清的著作就是最有力的证据。所以任何时候定下目标都不晚，结果并不重要，重要的是享受追逐梦想的过程。</p><h2 id="把时间分类："><a href="#把时间分类：" class="headerlink" title="把时间分类："></a>把时间分类：</h2><p>​    柳比歇夫把时间分为三类：</p><pre><code>+ 工作，需要非常大精力的事情放在最重要的一类+ 把阅读和写作等并不是十分重要的事情规划为第二类+ 日常休息，娱乐等日常必需消耗的时间，则划分为第三类（也包含陪同家人的时间）。</code></pre><p>这种分类既不会让自己看上去充实，又具备明确的指向性和目的性，同时可以帮助个人培养时间观念，什么时间做什么，按部就班。</p><h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>​    你可以浪费时间，但是不能浪费人生。时间统计法是一种人人都可以做到非常简单的一种方法。目前个人结合自己的习惯定制了一套时间统计法进行实践。时间统计法在任何时候学习都不晚，只要立马行动真实的记录，对于时间的感知就会越来越强，对于目标的管理和自我管理也会越来越强。</p><p>​    另外，最近打算写个人的<strong>读书方法论（二）</strong>了，但是回顾一下发现好像该讲的都讲的差不多了（尴尬）。希望可以<strong>借用</strong>读者一些时间评论留下建议。</p><h1 id="参考文章："><a href="#参考文章：" class="headerlink" title="参考文章："></a>参考文章：</h1><p>有兴趣可以看看知乎的回答，写的比我这篇比较要简洁很多也概括的比较好。个人还需要多多练习写作技巧。（要看清自己真的是一件非常难得事情）</p><p><span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8xMTUzODAyMTM=" title="https://zhuanlan.zhihu.com/p/115380213">知乎文章1<i class="fa fa-external-link"></i></span></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3F1ZXN0aW9uLzI4NjMwMzQz" title="https://www.zhihu.com/question/28630343">知乎文章2<i class="fa fa-external-link"></i></span></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      《奇特的一生》读书笔记
    
    </summary>
    
    
      <category term="读书笔记" scheme="https://whitestore.top/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="时间管理" scheme="https://whitestore.top/tags/%E6%97%B6%E9%97%B4%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>浅谈设计模式 - 迭代器模式（十一）</title>
    <link href="https://whitestore.top/2021/05/20/diedaiqi/"/>
    <id>https://whitestore.top/2021/05/20/diedaiqi/</id>
    <published>2021-05-20T14:45:06.000Z</published>
    <updated>2021-05-20T14:46:36.741Z</updated>
    
    <content type="html"><![CDATA[<h1 id="浅谈设计模式-迭代器模式（十一）"><a href="#浅谈设计模式-迭代器模式（十一）" class="headerlink" title="浅谈设计模式 - 迭代器模式（十一）"></a>浅谈设计模式 - 迭代器模式（十一）</h1><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>迭代器模式通常只需要知道该模式的实现原理和了解结构图即可，在设计模式当中自己实现的情况几乎是没有的，所以这个模式简单的过一遍。</p><a id="more"></a><h1 id="什么是迭代器模式"><a href="#什么是迭代器模式" class="headerlink" title="什么是迭代器模式"></a>什么是迭代器模式</h1><p>定义：<strong>提供顺序的方法访问一个聚合对象的各个元素，同时又不会暴露内部的功能</strong></p><p>迭代器模式通过接管遍历的细节，让提供方不必关心迭代的具体细节，只需要提供对应的聚合对象即可。</p><blockquote><p> 迭代器模式和增强的FOR循环:</p><p> Jdk1.5之后，将泛型和增强for循环加入到语言体系，可以直接对于集合的内容进行for循环查看，其实本质上还是调用了iterator方法，而java通过语法糖的形式为我们进行的遍历的隐藏。</p></blockquote><h1 id="迭代器模式结构图"><a href="#迭代器模式结构图" class="headerlink" title="迭代器模式结构图"></a>迭代器模式结构图</h1><pre><code>迭代器模式的结构图如下：![](https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210310215705.png)</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Aggregate：聚合对象的共同接口，定义了具备遍历功能的聚合对象，通过定义创建迭代器的接口来建立与迭代器的组合</span><br><span class="line">ConcreateAggregate：具体的迭代器实现对象，通过接口方法返回具体的迭代器实现</span><br><span class="line">Iterator：迭代器接口，定义迭代器的统一规范，所以派生类都需要强制按照接口标准执行迭代器的实现。保证迭代器具备相似的行为。</span><br><span class="line">ConcreteIterator：具体的迭代器实现，内部聚合对象的同时，可以扩展迭代器的遍历方式，比如ListIterator。</span><br></pre></td></tr></table></figure><h1 id="迭代器模式特点"><a href="#迭代器模式特点" class="headerlink" title="迭代器模式特点"></a>迭代器模式特点</h1><ul><li>迭代器将遍历的细节进行了封装，<strong>聚合对象不需要在关心客户端如何操作内部的变量</strong>，而是通过委托给迭代器的形式交由迭代器去完成具体的遍历细节。</li><li>迭代器可以在<strong>不暴露内部结构的同时让外界可以访问到内部的聚合对象</strong>，所以即使是完全不同的对象也可以统一对待和处理。</li><li>迭代器是一种职责的转移，将遍历的工作从原本的聚合对象中进行独立，能在<strong>不改动数据结构的同时改变数据的操作方式</strong>。</li></ul><h1 id="迭代器的注意事项："><a href="#迭代器的注意事项：" class="headerlink" title="迭代器的注意事项："></a>迭代器的注意事项：</h1><ol><li>需要注意迭代器存在<strong>内部的迭代器</strong>和<strong>外部的迭代器</strong>，内部的迭代器供对象本身使用不对外开放，外部的迭代器通过方法返回给调用方使用。</li><li>每个责任对应一个区域，超过区域意味多了一个责任，遍历和数据操作实际上是两个操作，应该区分对待。</li><li>注意迭代器是如何体现单一职责的原则，他剥离了遍历对象的功能，将其封装到一个迭代器内部进行使用。</li><li>好的迭代器应当具备“快速失败机制”，目的是为了防止操作内部元素的指针越界，同时及时通知客户端遍历异常。</li><li><strong>如果想让方法不支持某些功能，最好使用异常机制提醒客户端我不支持某些操作。</strong></li></ol><h1 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h1><pre><code>光有理论还是不够的，这里配合代码讲解迭代器是如何实现解耦聚合对象的遍历的。</code></pre><h2 id="模拟场景："><a href="#模拟场景：" class="headerlink" title="模拟场景："></a>模拟场景：</h2><pre><code>由于迭代器在实际工作中使用概率 **几乎为0**，这里设置的场景比较简单我们使用window最常见的文件系统来作为案例，我们通常进入不同的磁盘，首先就是对该磁盘下面的第一级目录进行遍历，同时我们根据遍历方式的不同，可以将页面展示为分组，按照时间排序，显示不同的详略信息.....这些功能的本质都是遍历，只不过遍历的形式不同，为了实现对于菜单的不同形式遍历，我们通过定义不同迭代器来完成这一个目标。接着，我们会发现迭代的种类丰富还不够，我们还需要迭代其他的内容，比如任务管理器需要迭代不同的进程，同样也包含了排序的或者隐藏部分进程等等一系列的功能，所以需要让不同的对象可以支撑相似的迭代操作，并且可以自由的替换迭代的方式，当然这部分功能不会放入案例部分，案例部分为简单的迭代器实现。</code></pre><h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><pre><code>在进行具体的编码之前，先检查一下需要的基本构建类：</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Travelsable：定义对象具备迭代的功能接口。</span><br><span class="line">MissionBoard：任务栏，贮存基本的任务信息，提供迭代器供外部展示。</span><br><span class="line">TaskItemlIterator：任务迭代器，用于任务的迭代操作</span><br><span class="line">ConcreteCatalogIterator：目录迭代器的实现具体子类，定义了不同的迭代种类。</span><br><span class="line">TaskItem 任务项，定义一个任务的内容</span><br><span class="line">Computer 电脑，只需要管理任务栏和文件管理器即可。</span><br><span class="line">FileManager 文件管理器，负责管理文件夹的内容</span><br><span class="line">FileIterator 文件迭代器，管理文件夹的迭代操作</span><br><span class="line">FileItem 文件项</span><br></pre></td></tr></table></figure><pre><code>下面直接按照结构图构建具体代码：</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 电脑，只需要管理任务栏和文件管理器即可。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Computer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> FileManager fileManager;</span><br><span class="line">    <span class="keyword">private</span> MissionBoard missionBoard;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Computer</span><span class="params">(FileManager fileManager, MissionBoard missionBoard)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileManager = fileManager;</span><br><span class="line">        <span class="keyword">this</span>.missionBoard = missionBoard;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Iterator fileManagerIterator = fileManager.createIterator();</span><br><span class="line">        Iterator missionBoardIterator = missionBoard.createIterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (fileManagerIterator.hasNext())&#123;</span><br><span class="line">            Object next = fileManagerIterator.next();</span><br><span class="line">            System.out.println(next);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (missionBoardIterator.hasNext())&#123;</span><br><span class="line">            Object next = missionBoardIterator.next();</span><br><span class="line">            System.out.println(next);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件项</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileItem</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String editDate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String ceateDate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> size;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 省略部分内容</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 任务项</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskItem</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 省略部分内容</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 迭代器规范接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Travelsable</span>&lt;<span class="title">E</span> <span class="keyword">extends</span> <span class="title">Object</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建迭代器的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Iterator&lt;E&gt; <span class="title">createIterator</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 任务栏，管理任务项. 实现接口，支持迭代操作</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MissionBoard</span> <span class="keyword">implements</span> <span class="title">Travelsable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Stack&lt;TaskItem&gt; taskItems;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MissionBoard</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        taskItems = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        taskItems.push(<span class="keyword">new</span> TaskItem(<span class="string">"任务1"</span>, <span class="number">10</span>));</span><br><span class="line">        taskItems.push(<span class="keyword">new</span> TaskItem(<span class="string">"任务2"</span>, <span class="number">1230</span>));</span><br><span class="line">        taskItems.push(<span class="keyword">new</span> TaskItem(<span class="string">"任务3"</span>, <span class="number">123</span>));</span><br><span class="line">        taskItems.push(<span class="keyword">new</span> TaskItem(<span class="string">"任务4"</span>, <span class="number">414</span>));</span><br><span class="line">        taskItems.push(<span class="keyword">new</span> TaskItem(<span class="string">"任务5"</span>, <span class="number">555</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator <span class="title">createIterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TaskItemlIterator(taskItems);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件管理器，管理文件项，实现接口并且支持迭代操作</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileManager</span> <span class="keyword">implements</span> <span class="title">Travelsable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> FileItem[] fileItems;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FileManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileItems = <span class="keyword">new</span> FileItem[<span class="number">10</span>];</span><br><span class="line">        Random random = <span class="keyword">new</span> Random(<span class="number">10000</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; fileItems.length; i++) &#123;</span><br><span class="line">            fileItems[i] = <span class="keyword">new</span> FileItem(<span class="string">"文件"</span>+i, random.nextInt(<span class="number">2000</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator <span class="title">createIterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FileIterator(fileItems);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//文件迭代器</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> FileItem[] fileItems;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FileIterator</span><span class="params">(FileItem[] fileItems)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileItems = fileItems;</span><br><span class="line">        <span class="keyword">this</span>.index = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> index++ &lt; fileItems.length - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileItems[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Object ele)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"数组不支持当前操作"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 任务迭代器</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskItemlIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Stack&lt;TaskItem&gt; taskItems;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TaskItemlIterator</span><span class="params">(Stack&lt;TaskItem&gt; taskItems)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.taskItems = taskItems;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(taskItems.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        TaskItem peek = taskItems.peek();</span><br><span class="line">        <span class="keyword">return</span> peek != <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> taskItems.pop();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Object ele)</span> </span>&#123;</span><br><span class="line">        taskItems.remove(ele);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上就是迭代的大致实现案例代码，现代编程基本不会自己去设计迭代器，所以了解概念和知道样板代码即可。</p><h1 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h1><pre><code>迭代器在JAVA语言中基本已经实现到集合当中，当我们遍历集合的时候，其实就是在使用迭代器，迭代器通过**封装遍历**解耦了一堆对象的遍历和创建工作，将迭代的细节封装到一个黑盒当中，外部只需要调用接口就可以操作集合的数据。</code></pre><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      迭代器模式
    
    </summary>
    
    
      <category term="设计模式" scheme="https://whitestore.top/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="迭代器" scheme="https://whitestore.top/tags/%E8%BF%AD%E4%BB%A3%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>《自控力》读书笔记</title>
    <link href="https://whitestore.top/2021/05/20/zikongli/"/>
    <id>https://whitestore.top/2021/05/20/zikongli/</id>
    <published>2021-05-20T14:43:13.000Z</published>
    <updated>2021-05-20T14:44:21.694Z</updated>
    
    <content type="html"><![CDATA[<h1 id="《自控力》读书笔记"><a href="#《自控力》读书笔记" class="headerlink" title="《自控力》读书笔记"></a>《自控力》读书笔记</h1><p>[TOC]</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210405152653.png" alt=""></p><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>​    这本书的封面比较有意思，一个大大的甜筒。还好这是书，如果是实物我肯定已经吃起来了。这本书大致就是告诉你如何让你在看到如同封面这般诱惑的情况下依然可以保持很好的自控力。</p><p>​    如果能把一遍文章仔细看完，静下心来认认真真的做做某件事，我相信都是对自控力的挑战，这本书如果看着费力或者想偷懒，个人建议阅读每一个章节最后的部分，然后根据总结选择自己感兴趣的内容即可。当然连打开书或者看书的兴趣都没有，那可以看看我的这篇笔记，希望可以让你了解到这本书讲了那些内容。</p><a id="more"></a><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>​    本书为读者提供了清晰的框架，讲述了<strong>什么是自控力</strong>，自控力如何发生作用，以及<strong>为何自控力如此重要</strong>。</p><p>​    – 以上引用自豆瓣的简介。</p><p>​    </p><h2 id="推荐指数："><a href="#推荐指数：" class="headerlink" title="推荐指数："></a>推荐指数：</h2><p>​    <strong>4星</strong>，个人评分，因为他确实让我更加了解到了自己对于意志力的错误认知，以及以前一些自控的方式更加科学的解释。更重要的是，了解意志力本身比去提高个人意志力更为重要。</p><p>​    这本书阅读更倾向于了解意志力和一些基础效应，避开陷阱，如果想要了解自控的方法，可以看看每一章节的“意志力实验”部分，依照案例对于方法进行解释。当然部分案例比较牵强，但是有意思的案例也不少，比如点击老鼠的实验，猩猩和人的自控力对比等等。</p><h2 id="推荐语"><a href="#推荐语" class="headerlink" title="推荐语"></a>推荐语</h2><p>​    了解自控力比自控更加重要，我们可能了解他人的想法，但是很难认识到自己，<strong>想从一本书学到一劳永逸的自控力提高方法是不可能的</strong>，人的自律完全依靠自身，但是认识自控力有多重要以及为什么自己会失控，这本书可以给你答案。</p><h1 id="收获"><a href="#收获" class="headerlink" title="收获"></a>收获</h1><h2 id="自控力为何如此重要？"><a href="#自控力为何如此重要？" class="headerlink" title="自控力为何如此重要？"></a>自控力为何如此重要？</h2><p>​    <strong>自律是一个人成功的开始</strong>，任何一个成功的人不管开端如何，多数都是对于个人意志力有着自己的管理方式。通常个人在意志力本身为何物都不知道情况下，都会选择拿自控和愧疚来对付自己，然而这却恰恰是很多人失控的根本愿意，用意志力来对付自己。</p><p>​    <strong>能够定制自己幸福的人往往过得更加幸福。</strong>定制目标往往和自控有关，当你不满足于现在自己的时候，通常需要通过学习来提高自身，而通过学习提高自身往往就是所谓的自控提升自己的一个过程。</p><p>​    <strong>我们的心中都有两个自我</strong>。自控力挑战往往是使用原始本能来对付心中的“两个自我”。一个自我告诉我们放松，冲动，及时满足自己。而另一个自我则告诉我们应该勤劳，努力，改变自己。这两个自我在大部分情况下都是“更坏”的自我占据主导，因为这包含了生物的本能反应。而自控就是让失控的自己能够在更短的时间内将自己的注意力拉回来的过程。</p><h2 id="为什么要看《自控力》这本书？"><a href="#为什么要看《自控力》这本书？" class="headerlink" title="为什么要看《自控力》这本书？"></a>为什么要看《自控力》这本书？</h2><pre><code>  1. 首先是我的自控力减弱了。当初在学校的时候，我只需要专心学习，所以能保持较强的学习动力和自控力，然而进入社会，各种杂七杂八的事情充斥我们的脑海，分散我们的注意。2. 自律是走上成功的第二步，定下目标是成功的第一步。我并不想把自己年初定的FLAG到了年底一个都没有完成。3. 认识到未来的自己需要“我”的帮助。过去的我因为努力自学让自己现在有了一份比较体面而稳定的工作，我希望现在的努力能给将来的自己留下更多财产。</code></pre><h2 id="我从《自控力》学到了什么？"><a href="#我从《自控力》学到了什么？" class="headerlink" title="我从《自控力》学到了什么？"></a>我从《自控力》学到了什么？</h2><ul><li>自控力就是驾驭“我不要”、“我想要”、“我要做”这三个事情</li><li>最让人遗憾的不是没有努力，也不是不想努力，而是重复想努力到不想努力这个过程。既浪费了时间，又没有任何意义。深陷“道德许可”的陷阱中给自己一个身份牌</li><li>焦虑，恐惧，自我批评，不仅不能让我们更加自控，反而更容易让我们冲动，失控，不想努力。面对自己的人生，不要把负面情绪加到自己身上</li><li>找到自己真正的目标，幻想自己的未来，想象的越来越真实，越能走向成功。</li><li>人的脑海中有两个自己，一个想要变好的自己和想要变坏的自己，我们要全力接受“好的自己”</li><li>微笑面对未来的自己，学会延迟满足为自己的未来投资。</li><li>学会“同情”自己，为自己的挫折毫不在意，只关注自己离目标还有多远。（可以参考《食戟之灵》）</li><li>成功可能带来退步，奖励效应让自己不断的重蹈覆辙</li><li>强烈的自控力可能会危害自己的身心。如果你无法合理驾驭自己的意志力，那就把<strong>最重要的事情</strong>放到最早的时候。</li></ul><h2 id="哪一个意志力实验对我最有帮助"><a href="#哪一个意志力实验对我最有帮助" class="headerlink" title="哪一个意志力实验对我最有帮助?"></a>哪一个意志力实验对我最有帮助?</h2><p>​    <strong>学会原谅自己，而不是自我厌恶和自我批评</strong>。在人的惯性思维当中，人们犯了错之后，一般都会情绪失落或者消沉，但是在这本书中却从反方向建议读者不要进行自我批评，因为自我批评容易让人更加堕落。所以学会原谅自己可能对我我这样带有一定自卑情结的人来说更有帮助。</p><h2 id="读到那一页最让我吃惊？"><a href="#读到那一页最让我吃惊？" class="headerlink" title="读到那一页最让我吃惊？"></a>读到那一页最让我吃惊？</h2><p>​    <strong>180页</strong>的内容讲了现在的自己和未来的自己。</p><p>在仔细思考之后，我对自己做了下面的这个选择，发现自己对于未来的自己不够重视。</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210405161129.png" alt=""></p><h1 id="好句摘录"><a href="#好句摘录" class="headerlink" title="好句摘录"></a>好句摘录</h1><ol><li>省钱不是买到便宜的东西，而是在<strong>支付限额</strong>内买到便宜的东西。</li><li>想象一下过去的你为现在的你带来了什么，现在的你会为未来的你带来什么</li><li>我们经常会用“别人”的眼光评估自身，但是“我应该”的力量更能让自己坚持</li><li>梦想比任何网站都要值钱</li><li>导致堕落的并不是第一次放弃，而是第一次放弃之后的羞耻感，罪恶感和绝望感</li><li>比辱骂更为重要的是被人同情</li><li>想象冲动是海浪，虽然波涛汹涌，但是一定会遇到巨石</li><li>当你今天的决定会影响未来幸福的时候，也要想一想不这么做，以后一定会后悔。</li></ol><h1 id="内容分析"><a href="#内容分析" class="headerlink" title="内容分析"></a>内容分析</h1><h2 id="自控力的讨论"><a href="#自控力的讨论" class="headerlink" title="自控力的讨论"></a>自控力的讨论</h2><p>​    我们讨论的自控力其实就是人的意志力，人的意志力要比自己想象中的要弱的多的多，同时人是非常容易堕落和懒散的物种，稍加一不注意就会分心或者失去专注力。</p><h3 id="什么是自控力"><a href="#什么是自控力" class="headerlink" title="什么是自控力"></a>什么是自控力</h3><p>​    自控力简单理解就是驾驭<strong>我想要，我不要，我要做</strong>这三件事的能力。</p><h3 id="人为什么会失控"><a href="#人为什么会失控" class="headerlink" title="人为什么会失控"></a>人为什么会失控</h3><p>​    因为人做决定就像是自动档，不加任何约束人会变得堕落和懒散。</p><h3 id="失控的后果"><a href="#失控的后果" class="headerlink" title="失控的后果"></a>失控的后果</h3><p>​    自控力差的人很容易满足。失去欲望和奋斗的目标。</p><p>​    同时，自控力差的人通常易怒和暴躁。</p><h2 id="章节总结"><a href="#章节总结" class="headerlink" title="章节总结"></a>章节总结</h2><p>​    书中通过章节的形式，介绍了提高自控力或者如何更好管理自我的一些策略，部分策略甚至本身就存在一些冲突。下面是各个章节的个人小结（和书中的顺序不一致，同时存在合并）：</p><ul><li>第一章：我要做，我不要，我想要：什么是意志力？为什么意志力至关重要？<ul><li>自控力是把注意力不断发散和收回的过程<ul><li><strong>用冥想的方式锻炼意志力，让自己去做更加苦难的事情</strong></li><li>把注意力集中在，<strong>我不要，我想要，我要做</strong>。这三件事情上面</li><li>当你提高意志力的时候，能够学会利用自己的身体机能去调整状态</li><li>了解和认识两个自我<ul><li>意志力关键因素是正确的认识自己<ul><li>大部分人做决定就像是自动档，根本意识不到自己为什么会做决定<ul><li>如果你在自控的同时遇到其他事情，冲动会主导你的选择</li></ul></li></ul></li></ul></li></ul></li></ul></li></ul><ul><li><p>第二章：意志力存在能量</p><ul><li>利用各种运动来提高意志力</li><li>对比剑齿虎，我们更需小心奶油蛋糕的危险</li><li>自控力要合理以及适度，不要一味的压迫自己</li><li>提升意志力往往是从 <strong>我要做</strong>到 <strong>我不要</strong>。不建议直接思考“我想要”</li></ul></li><li><p>第三章：介绍意志力是存在极限的。面对意志力这种能量我们要如何合理安排</p><ul><li>自控力如同肌肉一般是存在极限的</li><li>意志力的强弱通常是从最早到最晚不断降低</li><li>意志力会消耗大量的糖，而我们可以使用低糖代替高糖</li></ul></li><li><p>第四章：为什么善行之后会有恶行，为什么我们总是在重蹈覆辙</p><ul><li>只要我们脑海中存在坏事与好事，我们行为总允许我们做一点坏事<ul><li>渴望补偿常常会使人堕落</li><li>任何可以让美德感到满足的东西，都会允许你冲动行事</li></ul></li><li>成功的陷阱<ul><li>进步有可能让人放弃为之奋斗的东西</li><li>多数情况下，我们总在寻找停下来的理由</li></ul></li><li>向明天赊账<ul><li>人们总是期望明天选择和今天不一样，然而想法本身就是错的</li><li>扪心自问，“今天赊账，明天改变”是否又开始了</li></ul></li></ul></li><li><p>第五章：来自名为多巴胺的诱惑</p><ul><li>多巴胺是大脑中含量最丰富的儿茶酚胺类神经递质<ul><li><strong>多巴胺并不会控制我们的行为，真正让我们失控的是寻求奖赏效应的大脑皮质</strong></li></ul></li><li>如何将欲望变为动力，同时不要把甜蜜陷阱当幸福</li><li>渴望让你感到快乐，同时让你感到压力<ul><li>购物的欲望与花钱的焦虑</li></ul></li><li>想要让你分泌更多多巴胺的人多半是商人<ul><li>买一送一</li><li>满减</li><li>打折</li><li>赠品</li></ul></li><li>多巴胺是虚假的幸福，但是把多巴胺用于让自己身心保持健康是非常有效的自控力武器<ul><li>跑步锻炼，强身健体</li><li>用于达成目标，“欺骗”自己</li></ul></li></ul></li><li><p>第六章：决心改善心情，改变自己而不是改变决心</p><ul><li>虚假希望综合征：当人们决心改变自己的心情实际却又无法满足自己决定的时候，人们往往会失落<ul><li>很多人乐于一次次放弃之后重新开始，而不是找到改变的真实想法</li><li>避免用改变承诺而不是改变来改善心情，回忆自己是否为压杠杆渴望点击的白鼠</li></ul></li><li>失败和堕落让人屈从诱惑，决心改变让自己更加强大<ul><li>做一个<strong>乐观的悲观主义者</strong></li><li>缓解压力最好的方式是<strong>自我同情</strong>而不是自我批评</li></ul></li></ul></li><li><p>第七章：意志力感染和未来的自己，意志力存在互相传染，未来和现在同样重要</p><ul><li>什么是意志力感染：<strong>近朱者赤，近墨者黑</strong></li><li>冷静的大脑需要在诱惑面前存在<strong>等待时间</strong></li><li>有形的奖励和无形的奖励巨大差距，根本在于一个会刺激多巴胺，而另一个会产生“延迟满足”</li><li>让未来更重要我们才能抵消“及时享乐”的行为</li><li>记住目标，时刻记住自己的承诺。</li></ul></li><li><p>第八章：”我不要”的局限性讽刺性反弹，为什么人们越是压抑想法越是失控</p><ul><li>为什么压抑想法如此艰难：操作与监控两者相辅相成<ul><li>我们精神全力操作大脑，而监控失灵</li></ul></li><li>人们越是摆脱某种意识，越是容易跑进脑海</li><li>如何规避讽刺性反弹<ul><li>学会把“我不要”变为“我想要”</li><li>接受不是放纵，抑制或者压抑，需要从根本上转变为对目标的执行。</li><li>接受自己的弱点和缺点，接受诱惑但是永远<strong>不行动</strong></li><li>想象冲动是海浪，虽然波涛汹涌，但是一定会遇到巨石</li></ul></li></ul></li></ul><p>以上是个人的总结部分，更多章节的总结可以上网查阅资料</p><h2 id="自控力实验"><a href="#自控力实验" class="headerlink" title="自控力实验"></a>自控力实验</h2><p>​    这本书的自控力实验比较多，个人挑选了以下一些印象比较深刻的实验：</p><ul><li>花一周的时间想想自己的目标，想象自己未来的生活</li><li>每天花5分钟锻炼，只需要5分钟即可，可以使走路，散步，慢跑</li><li>每天利用5分钟的时间完成冥想（除了互相不要有任何其他杂念）</li><li>找出自己自控力最薄弱的点，自己在什么情况下会失控，为什么会失控。这让你离你的目标更远还是更近？</li><li>尝试把最想要完成的事情放在早上，越早越好</li><li>良好的睡眠是意志力的有效储备</li></ul><blockquote><p>完成自控力的实验最大的阻碍是奖赏效应。</p></blockquote><h2 id="书中的几大效应"><a href="#书中的几大效应" class="headerlink" title="书中的几大效应"></a>书中的几大效应</h2><p>​    书中的对于人的行为提出了一些科学合理的解释，介绍一些人类本能所产生的一些效应。</p><h3 id="“那又如何”效应"><a href="#“那又如何”效应" class="headerlink" title="“那又如何”效应"></a>“那又如何”效应</h3><p>​    那又如何效应其实就是我们常说的一件事情做了第一次之后，就会有第二次和无数次。</p><h3 id="“道德许可”效应"><a href="#“道德许可”效应" class="headerlink" title="“道德许可”效应"></a>“道德许可”效应</h3><p>​    当自己对某事有一个明确的道德标准之后，在做出与这项道德标准相关的行为和判断时，反而更倾向于违背这项道德标准的行为。</p><h3 id="虚假希望综合征"><a href="#虚假希望综合征" class="headerlink" title="虚假希望综合征"></a>虚假希望综合征</h3><p>​    指定下目标之后却无法完成或当无法满足之后，过一段时间又产生希望，如此往复。</p><h3 id="奖赏效应"><a href="#奖赏效应" class="headerlink" title="奖赏效应"></a>奖赏效应</h3><p>​    奖赏效应是一种正性强化效应，与中脑边缘多巴胺系统密切相关。</p><p>​    当人们成功或者失落的时候，会寻找外在的事物逃避 <strong>失落的感觉</strong>。这时候人会以为奖励而失控。<strong>借酒消愁</strong>就是最简单的解释</p><h3 id="讽刺性反弹"><a href="#讽刺性反弹" class="headerlink" title="讽刺性反弹"></a>讽刺性反弹</h3><p>​    当人们试着不去想某件事时，反而会比没有控制自己的思维时想得更多,比自己有意去想的时候还要多。</p><h1 id="结语："><a href="#结语：" class="headerlink" title="结语："></a>结语：</h1><p>​    这本书看完不止从自控力方面我还从自己的过去中反思了自己，之前看评论以及 <strong>人生七年</strong> 很多人都认为阶级固化以及人的出身环境已经决定了他的一生，<strong>我不认为这是错的</strong>，这是约定俗成的规则，所以我们能做的就是不断朝着自己的目标前进。</p><p>​    自控力归根结底就是 <strong>想要过什么样的生活，想要过什么样的人生。</strong>。</p><p>​    最后，如果想对自控力进行补充，可以看看《意志力》这本书作为补充。</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      关于自控力这本书的读书笔记
    
    </summary>
    
    
      <category term="读书笔记" scheme="https://whitestore.top/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="自控力" scheme="https://whitestore.top/tags/%E8%87%AA%E6%8E%A7%E5%8A%9B/"/>
    
  </entry>
  
  <entry>
    <title>postgresql 关于日期比较的一个小坑</title>
    <link href="https://whitestore.top/2021/05/20/postgresql-date/"/>
    <id>https://whitestore.top/2021/05/20/postgresql-date/</id>
    <published>2021-05-20T14:41:32.000Z</published>
    <updated>2021-05-20T14:42:39.878Z</updated>
    
    <content type="html"><![CDATA[<h1 id="postgresql-关于日期比较的一个小坑"><a href="#postgresql-关于日期比较的一个小坑" class="headerlink" title="postgresql 关于日期比较的一个小坑"></a>postgresql 关于日期比较的一个小坑</h1><p>关于日期方面的比较方面，由于多年JAVA写法的固定观念，导致卡了一点时间排查这个问题。</p><p>按照正常的逻辑，一般情况下我们都会想到 <code>yyyy-MM-dd HH:mm:ss</code>，这样写通常没有什么问题，但是在postgre当中是存在问题的。因为 <code>HH</code>默认是<strong>12小时制</strong>！！！这个坑会导致查找数据出现下面莫名其妙的问题：</p><p>首先按照下面的sql进行查询：</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210331183239.png" alt=""></p><p>得到查询结果如下：</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210331190301.png" alt=""></p><p>这个结果是出乎预料的，因为正常来说应该查出来是0点的数据：</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210331190422.png" alt=""></p><p>将上面的<code>00:59:59</code> 时间点改为<code>01:59:59</code>，结果查出来是第一条居然是13点的数据：</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210331190640.png" alt=""></p><p>于是我停了下来，我套入各种数据不断尝试，猜想这个1点和13点都代表1点，或许使用了12小时制，果不其然，正确的写法应该如下：</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210331190839.png" alt=""></p><p>这一下结果就正确了</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210331190856.png" alt=""></p><p>总结：</p><pre><code>这周问题是习惯性思维的问题，但是个人想要吐槽一下这个设计有点点坑人=-=</code></pre><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      关于日期格式化的一个坑
    
    </summary>
    
    
      <category term="数据库" scheme="https://whitestore.top/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
      <category term="postgresql" scheme="https://whitestore.top/tags/postgresql/"/>
    
  </entry>
  
  <entry>
    <title>《小王子》读书笔记</title>
    <link href="https://whitestore.top/2021/03/28/xiaowangzi/"/>
    <id>https://whitestore.top/2021/03/28/xiaowangzi/</id>
    <published>2021-03-28T07:07:06.000Z</published>
    <updated>2021-03-28T07:08:59.540Z</updated>
    
    <content type="html"><![CDATA[<h1 id="《小王子》读书笔记"><a href="#《小王子》读书笔记" class="headerlink" title="《小王子》读书笔记"></a>《小王子》读书笔记</h1><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210328131426.png" alt=""></p><p>[TOC]</p><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>​    《小王子》这本书应该有不少人看过了，以前一直听说过他的名号，然而到了现在才来看，这本书也会我少有的看了两遍的的的书，每看一遍心理的感受都不相同。《小王子》个人阅读的版本是李继宏翻译的版本，个人认为翻译的非常棒，下面就来展开说一下这次读小王子这本书的感受。</p><a id="more"></a><h1 id="在读书之前"><a href="#在读书之前" class="headerlink" title="在读书之前"></a>在读书之前</h1><p>​    这本虽然只有短短100多页，去掉配图和前面的序并没有多少内容，在阅读正文之前，前面关于序的部分是值得仔细推敲的，了解作者的生平对于看懂这部作品比较有帮助，同时作者的经历也比较传奇，在他的作品走向巅峰的时候却突然离奇失踪，虽然已经被证实是被二战德国纳粹士兵击落，但是依然不减传奇的色彩。这个作者并不像很多伟人一般有很多名人事迹，而是通过自己当飞行员的经历和过往生活，写下来自己的作品，可能是许多名人里面经历最为“普通”的一个。</p><p>​    所以在读这本书之前，建议先了解一下作者的经历。</p><h1 id="推荐程度"><a href="#推荐程度" class="headerlink" title="推荐程度"></a>推荐程度</h1><p>​    <strong>5星</strong>：这本书是完全可以和《老人与海》媲美的一本书，将丰富的哲学和人生道理蕴含在小小的童话之中，不同的年龄段有不同的感触，每读一遍，都会有不同的想法。</p><p>​    这本书最关键的部分无非关乎狐狸和玫瑰，但是我更关注泉水和奇怪的人。</p><p>​    </p><h1 id="内容摘要"><a href="#内容摘要" class="headerlink" title="内容摘要"></a>内容摘要</h1><p>​    这本书让我印象深刻的部分有下面几个点：</p><pre><code>+ 我与小王子的相遇+ 玫瑰与庭院+ 小王子和奇怪的人+ 小王子和狐狸+ 沙漠中的泉水</code></pre><p>从整体上来看是一个非常质朴的故事，但是书中的每一段对话，每一幅画都有他深刻的含义。每看一遍都回味无穷。</p><h2 id="我与小王子的相遇"><a href="#我与小王子的相遇" class="headerlink" title="我与小王子的相遇"></a>我与小王子的相遇</h2><p>​    “我”在一次飞行任务当中出现飞行事故，迫降在非洲的沙哈拉沙漠，在沙漠当中遇到了小王子。小王子要求“我”画一只绵羊给他，我献给了“帽子”，然而却惊奇王子说不要“蛇吞象”。“我”很高兴有人可以看懂“我”的画。而我与小王子的见面引出了整个童话故事的前奏。</p><p>​    我与小王子相遇能互相理解，个人认为是作者“超我”的一种论述，用自己和自己对话的方式，用故事来讲述自己的“过去”。这种不着痕迹的隐喻是非常厉害的写作方式。</p><h2 id="玫瑰与庭院"><a href="#玫瑰与庭院" class="headerlink" title="玫瑰与庭院"></a>玫瑰与庭院</h2><p>​    在小王子懵懂无知的时候，遇到了玫瑰，玫瑰虽然美丽但是是带刺的，而玫瑰欺骗小王子说自己是世界上独一无二的花朵，虽然玫瑰欺骗了王子，但是玫瑰本意却是善良温柔的。就像小王子所说的：他为我散发芬芳，我却不懂背后的事情，在小王子不懂得爱的时候，他遇到了玫瑰，但是他和玫瑰之间是不合的，因为青涩与懵懂，小王子和玫瑰之前并不是互相理解。但是小王子和玫瑰</p><p>​    每个人在青春懵懂的时候，或明恋或暗恋都应该遇到自己的玫瑰，虽然都知道玫瑰非常美好，但是都很害怕被玫瑰的刺伤到。而玫瑰虽然和花园里万千的玫瑰并没有什么不同，但是因为为他浇过水，施过肥，除过虫，所以这朵玫瑰对于你来说就是独一无二的存在。但是当互相无法理解的感情硬扭在一起的时候，结果好像注定是分离，这样的事情在学生时代几乎是见怪不怪了。</p><p>​    但是，多少人遇到了对的玫瑰呢？</p><h2 id="小王子和奇怪的人"><a href="#小王子和奇怪的人" class="headerlink" title="小王子和奇怪的人"></a>小王子和奇怪的人</h2><p>​    小王子离开自己的星球，前往了6个星球并且拜访了下面的人：国王、虚荣的人、爱喝酒的人、做生意的人、地理学家和点灯的人。在所有人中小王子认为点灯的人是最不奇怪的，因为点灯的人照亮的是他人，也是默默奉献的人，而其他的人代表了拥有权利，荣耀，富贵，名声等形形色色的人。</p><p>​    小王子觉得星球上的人都很奇怪，并且感到无法理解。对于这一段的理解，作者批判了世俗的欲望，并且通过小王子指出这都是空虚的东西，同时也是`不重要的。但是点灯的人却不同，点灯的人默默奉献自己，是受到了作者正面肯定的。</p><p>​    </p><h2 id="小王子和狐狸"><a href="#小王子和狐狸" class="headerlink" title="小王子和狐狸"></a>小王子和狐狸</h2><p>​    小王子在看到遍地玫瑰的时候，认为自己的玫瑰欺骗了他，就在小王子迷茫无知的时候，他遇到了狐狸，狐狸希望小王子驯化他，并且作为交换分享自己的秘密，他告诉了小王子什么是爱，爱是责任和包容，爱是承担，既然选择爱上一朵玫瑰，就要为玫瑰一直负责。</p><p>​    “狐狸”曾经也是“玫瑰”，然而狐狸受过伤，害怕人类，狐狸需要隐藏和伪装自己，他是孤独和寂寞的，狐狸不被任何人需要，所以他想要朋友，想要人类驯化他，当有人驯化他，对于狐狸和驯化他的人来说，彼此都是需要的。</p><p>​    小王子和狐狸是许多人印象深刻的点。但是虽然我遇到过玫瑰，但是没有见到过狐狸，这里就不做论述的了。。。。</p><h2 id="沙漠中的泉水"><a href="#沙漠中的泉水" class="headerlink" title="沙漠中的泉水"></a>沙漠中的泉水</h2><p>​    在小王子给“我”讲述完他的故事之后，小王子打算离开回到自己的星球，在此之前，他们发现了沙漠的水井。他们一直在寻找的东西就在一汪清泉当中。他们需要的只不过是水而已。他们晚上一起看星星，并且企图找到自己的花朵所在的星星。</p><p>​    这一段富含哲理，沙漠中的泉水大致是指人类美好的心灵和纯真，然而沙漠当中要找到泉水是非常困难的，所以小王子和“我”都为找到泉水而十分的兴奋而高兴。</p><h1 id="个人感悟"><a href="#个人感悟" class="headerlink" title="个人感悟"></a>个人感悟</h1><p>​    可能我是单身狗并且是非常非常感性的人，我并没有非常看懂《小王子》，同时也对狐狸和玫瑰没有非常深的感触，所以我<strong>并没有读懂这本书</strong>。不知道这是一件好事还是坏事。在我看来，在高等教育不断普及并且个体的发展不断突出的现代，很难在找到纯粹的感情，当年龄不断增长，爱情也不断的变得物质，爱情的代价也不断的变大，很多人寻找“玫瑰”最后找到的却是“狐狸”。</p><p>​    对于作者来说，当飞行员飞上蓝天就是作者毕生的梦，所以他的经历也如同富有了传奇的色彩。无论如何，当你对某个东西付诸了心血，你既要对自己付诸心血的东西负责，时至今日，对于我们来说看不见的东西有回忆，有知识，有经历和成长。随着年龄的增长，每个人生命的厚度不断增长，每个人都在追寻生命的意义。</p><p>​    另外，书中通过沙漠的背景，以及奇怪的人，泉水等，讽刺了人类自以为很强大，但是在高空翱翔的视角来看，又是那样的渺小和脆弱，</p><p>​    <strong>看东西要用心才能看清楚，重要的东西是眼睛看不见的</strong>。爱是责任和担当，爱是成熟和稳重。</p><p>​    最后，这本书这也让我想起了小狗钱钱的甜甜圈。外在的圆圈是看的见得，每个人都应该充实外在的圆圈，但是真正重要的东西是内在的圆环，这决定了你能走多远。最重要的东西往往是看不见的。所以很多人只相信眼睛看见的东西。当然在拥有看不见的重要东西之前，我们依然需要追寻物质生活。这大概是成长的悲哀，也是人生世俗的规则。</p><p>​    </p><h1 id="精句摘录"><a href="#精句摘录" class="headerlink" title="精句摘录"></a>精句摘录</h1><pre><code>+ 看东西要用心才能看清楚，重要的东西是眼睛看不见的+ 人类自以为占据了很多空间，认为自己像猴面包树一般重要。+ 他们要寻找的东西或许就在一汪清泉当中。+ 当你爱上一朵在某颗星球上的花，当你抬头仰望星空的时候，你会很甜蜜，仿佛所有的星星都开满了鲜花。+ 如果美国是中午，那么法国就是黄昏，若果能在一分钟内达到法国，那么就可以看到日落+ 在看到第四十四次日落的时候，你是否会感到悲伤。+ **对我来说，你无非是个孩子，和其他成千上万的孩子没有区别，我不需要你，你不需要我，对你来说，我无法是只狐狸，但如果你驯化我，我们就会彼此需要。你对我来说是独一无二的，我对你来说也是独一无二的**</code></pre><h1 id="豆瓣精选书评"><a href="#豆瓣精选书评" class="headerlink" title="豆瓣精选书评"></a>豆瓣精选书评</h1><p>这里截取了一条个人十分有感触的豆瓣书评。</p><blockquote><p>小的时候有一阵心血来潮很爱读名著，于是买了这本。中英文对照版，有漂亮的插画，优雅的排版，可惜懵懵懂懂的看了一遍，并没有看懂，有点索然无味。<br>很多年后突然翻出这本书，突然发现自己能了解作者在说什么了。关于那座玫瑰花砌成的房子和那条吞了大象的蛇。还有小王子旅行的星球和那只狐狸。关于驯养和被驯养。一瞬间我看得泪流满面。<br>原来好像书的扉页所写的那样，献给曾经是孩子的大人。所有的大人都曾经是孩子，只是很少有人记得罢了。<br>可惜我也变成了那些大人中的一个。看着看着觉得自己是那样的可悲。<br>当你能读懂这样一本书的时候，你已经不再是个孩子了。现实的世界将你打磨的那么好，不管你心里究竟愿不愿意——<strong>你无可奈何的，毫无选择的被长大了。</strong><br>如今这本书是我心中的经典，没有别的可以取代。关于人生的一切哲理，你都可以在这本书里找到答案。但是我劝你不要去用它，只会让你在这个分外现实的世界里显得愈发格格不入。<br>大人还是要有大人的游戏规则。那些固执的游戏，早已过了可以任性的年纪。<br>想起李宗盛的歌：<strong>想得却不可得，你耐人生何。岁月你别催，该来的我不推。该还的还，该给的我给。</strong><br>我们就这样，一路跌跌撞撞，向前走着。<br>但愿我的孩子将来读这本书时，能像当时的我那样觉得—-这本书简直是莫名其妙</p></blockquote><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>​    童话就让他成为童话吧。或许得不到的才是最好的，想象永远要多于实际体验，我们不断的成长，终究看不到“蛇吞象”，终究只能看到一顶帽子。</p><p>​    重要的东西是眼睛看不见的。希望若干年后我再次捧起书能让我看懂。</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      小王子的读书笔记
    
    </summary>
    
    
      <category term="读书笔记" scheme="https://whitestore.top/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="读书" scheme="https://whitestore.top/tags/%E8%AF%BB%E4%B9%A6/"/>
    
  </entry>
  
  <entry>
    <title>《乌合之众》读书笔记</title>
    <link href="https://whitestore.top/2021/03/28/wuhezhizong/"/>
    <id>https://whitestore.top/2021/03/28/wuhezhizong/</id>
    <published>2021-03-28T07:05:52.000Z</published>
    <updated>2021-03-28T07:06:47.347Z</updated>
    
    <content type="html"><![CDATA[<h1 id="《乌合之众》读书笔记"><a href="#《乌合之众》读书笔记" class="headerlink" title="《乌合之众》读书笔记"></a>《乌合之众》读书笔记</h1><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>​    这本书是为了试验多多平台的书籍质量买的，也就5块钱，书本的内容大致也是扫读的，基本没有太过细看，《乌合之众》这本书是具有时代背景的局限性的，在法国大革命的背景下，作者的对于群众进行了一系列的批判，包括群众弱化个人贡献，群众降低个人能力，以及群众的盲目性等等。同时作者带有女性的各种歧视也可以从书本当中看到。我不太明白这本书为什么在国内如此推崇，所以这篇读书笔记将记录我的个人看法。</p><a id="more"></a><h1 id="推荐程度"><a href="#推荐程度" class="headerlink" title="推荐程度"></a>推荐程度</h1><p>​    <strong>2星</strong>：由于作者存在一定的<strong>精英主义</strong>和<strong>种族歧视</strong>，个人并不推荐看这本书，看这本书只要抱着提高自我认知和在群体中保持清醒认知就算是从书中多少学到点有用的东西了。</p><p>​    另外我是实在不懂为什么这本书如此被推崇，看完感到非常失望。</p><p>​    </p><h1 id="文章摘要"><a href="#文章摘要" class="headerlink" title="文章摘要"></a>文章摘要</h1><p>​    下面根据零碎的读书笔记进行阅读：</p><pre><code>+ 群体在智力上总是低于个人+ 群体因环境比个人更差或者更好</code></pre><ul><li>群体的情感和道德观<ul><li>冲动暴躁并且易怒<ul><li>自我控制力差</li><li>s容易受到轻信和暗示</li></ul></li></ul></li><li>个人崇拜：一个人把自己一切的思想资源，一切自愿服从行为，同时发自肺腑的进妄想。<ul><li>概括：不顾一切奉献一个事业或者个人的才是一个虔诚的人。</li><li>教育不会使人更道德，也不会使人更幸福</li><li>作者认为生活更能培养优秀的人，而不是理论化的学校教育</li><li>只要是人聚集的地方，必然会有一个头领</li><li>领袖使用不断重复的断言传染给其他人</li><li>名望可以产生多么无耻的陈词滥调</li></ul></li></ul><h1 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h1><p>这里需要说明的一点是<strong>人以群分，物以类聚</strong>，如果你是什么样的人，通常你就会待在什么样的群体当中。这点基本算是毋庸置疑的，同时由于个人在群体中受到了平均化，群体容易受到风向的导向而失去理智。这些例子在生活中多的数不胜数。</p><p>​    二战的纳粹正是利用了群众的希望和盲从无知，并且说明了一个群体的领导对于一个群体会造成多大的改变！但是在现代的各种精英团队之下，群众又迸发出无与伦比的力量。</p><p>​    关于个人崇拜的部分，中国历史上也有不少，由于怕被请去喝茶这里就不一一列举了，可以自行查找资料（可以看看拿破仑的事迹，在他的带领下，士兵对于拿破仑英雄的个人崇拜），贝多芬曾经也因为个人崇拜而十分后悔。</p><p>​    一个好的团队可能会有好的领导，也有可能是一个坏的领导，这并没有很好的定式，但是作者更加倾向贬低群体当中的领导。在一个群体当中一定要有清晰的认知和定位，同时不要<strong>同流合污</strong>。众人皆浊我独清，众人皆醉我独醒的状态是最好不过的。</p><p>​    最后讲领袖是如何利用断言和情报传播流言的，集团通过不断释放良好的一面，所以在一个群体当中保持时刻保持清醒是十分难得的一件事情，如果集团不管灌输一个理念，那么群众或多或少都会有人相信。</p><p>​    最后还是需要强调一句这本书并不是完全一无是处，看完可以基本了解到为什么产品很烂却依然有很多的关注，明明看起来完全不能火的东西，却有很多人追捧。这一切都是乌合之众的影响。</p><h1 id="个人感悟"><a href="#个人感悟" class="headerlink" title="个人感悟"></a>个人感悟</h1><p>​    这本书无时不刻不在说明一些我们都会认同的道理，但是我并不认为多数人都认为正确的事情就一定是合理的。</p><p>​    从书本当中可以看出作者并不是完全中立的角度去看待的问题，在字里行间存在着一些“嘲讽”的意味，部分论断甚至不具备科学依据的解释，</p><p>​    这本书只要记住让独立思考保持自己的清醒，同时不要被他人的意见轻易左右，一定要有自己的观点和看法，这样才不容易被利用。</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>​    乌合之众在生活之中无处不在，我们需要避开乌合之众，寻找优秀的群体，即跟对人，做对事。</p><p>​    最后，多多的书如果没有过多要求还是可以买来看看的，当然纸质是那种复印纸，但是价钱十分的便宜。但是这本书真的没有吹嘘的那么厉害。</p><p>​    最后借用豆瓣的话：完这本书还可以去看看《群体的智慧》，从另一个角度来解释群体性的特性，正好跟这本书互相补充</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      如何看待乌合之众
    
    </summary>
    
    
      <category term="读书笔记" scheme="https://whitestore.top/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="读书" scheme="https://whitestore.top/tags/%E8%AF%BB%E4%B9%A6/"/>
    
  </entry>
  
  <entry>
    <title>《如何有效读一本书》读书笔记</title>
    <link href="https://whitestore.top/2021/03/28/readbookok/"/>
    <id>https://whitestore.top/2021/03/28/readbookok/</id>
    <published>2021-03-28T07:04:26.000Z</published>
    <updated>2021-03-28T07:05:30.713Z</updated>
    
    <content type="html"><![CDATA[<h1 id="《如何有效读一本书》读书笔记"><a href="#《如何有效读一本书》读书笔记" class="headerlink" title="《如何有效读一本书》读书笔记"></a>《如何有效读一本书》读书笔记</h1><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210326094736.png" alt=""></p><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>​    这段时间由于搬家和布置家具，基本没怎么看书，安顿好之后，又重新开启了读书计划，这次看的一本书讲的是读书方法相关的内容，个人从中还是有不少的成长的，并且书中作者的某些做法竟然自己也在做，这本书是一本比较有意思的书。需要注意的是作者是个日本人，有些章节的参考价值不大，所以只挑选了符合“国情”的一些内容作为笔记。</p><a id="more"></a><h1 id="简介："><a href="#简介：" class="headerlink" title="简介："></a>简介：</h1><p>​    这本书是一本实用方面的书，主要讲作者的阅读习惯，以及读书笔记的记录方法，从挑选图书到读书，最后从书中提取笔记并且产出自己的思想，通过各种举证像读者“安利”自己的读书和学习方式，同时利用循序渐进的方式，像读者介绍了如何从零开始爱上编写读书笔记。在作者的观念当中，有效读书的核心就是 <strong>读书日记</strong>。通过日记不仅可以节省重读的时间，并且每看一遍笔记都会有新的收获。</p><h1 id="推荐指数"><a href="#推荐指数" class="headerlink" title="推荐指数"></a>推荐指数</h1><p><strong>3星</strong>：如果你喜欢纸质书，那这本书很值得参考，但是如果平时喜欢手机看书，或者只喜欢电子书，这本书的意义和价值不大，作者是个日本人，所以很多习惯和国人不一样，看书的时候请理解一下。</p><p>另外，如果你像我一样喜欢买二手书，也是不是特别推荐看的。因为这本书推荐的方式基本都是要对原来的书一样“动手脚”</p><h1 id="内容摘要"><a href="#内容摘要" class="headerlink" title="内容摘要"></a>内容摘要</h1><p>​    这本书个人的笔记方式：</p><pre><code>- 边看边使用便利贴的方式进行比较，记录自己感兴趣的话语- 第二遍回顾自己的便利贴，结合贴上的页码，回忆内容- 写下这篇文章，归档自己学习的内容和读书感想。形成自己的读书笔记</code></pre><p>经过了上面的步骤之后，就有了下面的思维导图笔记，下面是思维导图的部分笔记，讲真思维导图还是蛮香的，能快速构建自己的知识笔记的网络，虽然我并不讨厌码字，但是思维导图更加促进思考。</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210325230246.png" alt=""></p><p>思维导图连接：<span class="exturl" data-url="aHR0cHM6Ly9zaGFyZS5tdWJ1LmNvbS9kb2MvSm5vMVp2MDFFbA==" title="https://share.mubu.com/doc/Jno1Zv01El">思维导图<i class="fa fa-external-link"></i></span></p><blockquote><p> 无法访问的试试直接访问URL：<span class="exturl" data-url="aHR0cHM6Ly9zaGFyZS5tdWJ1LmNvbS9kb2MvSm5vMVp2MDFFbA==" title="https://share.mubu.com/doc/Jno1Zv01El">https://share.mubu.com/doc/Jno1Zv01El<i class="fa fa-external-link"></i></span></p></blockquote><p>下面的部分是根据这本书的各个章节说下个人的感想</p><h2 id="有效读书"><a href="#有效读书" class="headerlink" title="有效读书"></a>有效读书</h2><p>​    在这本书的最开头，使用“有效读书”的话题，通过各种例证说明一个读书笔记的重要性，同时对于读书来说，最重要的不是看什么书和看书的收获，最重要的是<strong>看书的目标和想要从书中学到多少有用的内容</strong>。这样才是最重要的，同时重读读书笔记也是很重要的一件事，好好写好一份读书笔记就更加重要了。</p><p>​    对于书本当中提到的读书的五个步骤，个人大致归纳为：<code>选 -&gt; 购 -&gt; 读 -&gt; 记 -&gt; 活</code>。从最开始的选出一本适合自己的好书到最后活用书中的知识，形成自己的理解。</p><p>​    值得注意的是，人的大脑是一块不定时格式化的磁盘，所以对于重要的事情，个人非常推荐买一个小本子带在身上，在上面记录重要和紧急的事情非常有用。同时不需要注意格式，类似随身携带的草稿纸，写满一本之后，找一个鞋盒收进去，塞到床底下，等哪天想起来翻开看看，肯定会对当时记笔记的自己唏嘘不已。</p><h2 id="购书清单"><a href="#购书清单" class="headerlink" title="购书清单"></a>购书清单</h2><p>​    个人的购书清单通常在<strong>别人的博客推荐</strong>上，或者通过豆瓣上高评价的作品，这样大概率都不会踩坑。这里也要说一句一本书的起名太重要了，很多好书其实本身是由于一个不太“好听”的名字而没有知名度。个人还倾向于按照封面去选书，一个好看封面的实体书会增加我阅读的兴趣。</p><p>​    购书清单这部分个人建议跳读，因为基本上喜欢读书的人都有自己的一套购书习惯，没有必要去照着作者的思路去完成，个人对这一部分保持中立的态度，购书完全看自己。</p><p>​    同时这一个章节也是跳读的，这部分的内容个人认为更加适合日本的生活习惯。日本现在还有保留阅读报纸习惯，而国内现在读书却越来越趋近于网络看书，所以购书清单个人保持中立的意见，书中提到的冲动买书个人经常做，不过个人现在通常都是买的二手书，低价买入然后再卖回去，循环利用，这样我的书架永远都有很多书但是永远都只有那么多书，这里还是要说一句二手书还是很香的存在。</p><p>​    近几年来有些声音是讨论纸质书的必要性，我认为还是有必要的，这种情景总是让我想起《三体》最后部分罗辑把人类文明刻在石头上才得以流传，这真的是一个文明的悲哀！</p><blockquote><p>这里有一个值得学习的点就是学习报纸的排版方式，虽然报纸上密密麻麻的写满了文字，但是基本上没有多少人会反感报纸的排版方式，报纸的排版是一个十分值得学习的学问，对于喜欢纸质笔记的人来说，学习报纸的排版方式算是比较推崇的。</p></blockquote><h2 id="火锅式读书法"><a href="#火锅式读书法" class="headerlink" title="火锅式读书法"></a>火锅式读书法</h2><p>​    书中的火锅式是一个生僻字，懒得记忆的我直接叫了火锅式读书法。</p><p>​    关于火锅记忆法，简单理解就是形成自己的标记模式，创建自己的标记习惯，比如作者习惯一本书读三遍并且给书折角并且对于段落进行标记。<strong>我不太喜欢这种方式</strong>，我虽然不是特别爱惜书的人，但是我拿到的书基本不会让他脏乱，如果书出现折痕，我也会比较心疼。折角对于我来说，并不能形成强烈的提醒作用。因为有时候会出现误折角，所以在我的个人观点来看，作者的读书方式对我来说<strong>参考意义不大</strong>。关于火锅式读书法的另一个特点就是重读，重读可以是段落，笔记，也可以是全文，根据当时的心情重读也有可能，我是比较懒得，对于一本书能一遍看懂就一遍看懂，看不懂也之后很长时间之后偶尔翻一翻，所以我喜欢 <strong>一遍读懂一本书</strong>。这种想法或许会受到很多人的反对，但是长久的读书习惯。让我不再想起读一遍已经读过的书。（当然技术书籍和专业书籍除外，这类书籍我会反复去看）</p><p>​    火锅式读书法对于读者来说能吸收多少完全看个人，这本书在前言部分也说了，作者是个日本人，必然有日本人的思维习惯和生活习惯。很多读书方法在中国其实是走不通的。</p><h2 id="广告部分"><a href="#广告部分" class="headerlink" title="广告部分"></a>广告部分</h2><p>​    这本书让我比较在意的部分最后一个点就是作者的广告部分，作者居然用了十多种的笔来做笔记，在我看来不是很能理解。所以对于这部分的感受，个人在思维导图列举的部分是个人<strong>可能会有意向</strong>购买的辅助工具，也算是吃到了安利。</p><ul><li>便携阅读架：个人有一个nice202d 的阅读架，实际体验非常棒，架在桌子上加一个台灯很有读书的氛围。当然也比较贵。同时比较沉，适合放家里。买一个便携阅读架是看书之后才有的想法，因为有时候拿出书本记笔记的时候，书会自己合上非常恼火，一个夹书的工具对我来说很有必要</li><li>玻璃镇纸：压书神器</li><li>票夹：让书摊开最简单的工具，对于书本的伤害也是最大的</li><li>钢笔：虽然我字丑，但是我比较喜欢钢笔的外观以及写字的感受。</li><li>便利贴：便利贴挺好的，不过淘宝买的便利贴老是自己掉，下次买国誉的试一试</li><li>三菱彩色铅笔：做笔记感觉不错，各种颜色很醒目。当然也比较贵</li></ul><blockquote><p>不得不说，文具这一块日本完全是霸主的地位，国内还需要好好努力。</p></blockquote><h1 id="个人感悟"><a href="#个人感悟" class="headerlink" title="个人感悟"></a>个人感悟</h1><p>​    这本书准确来说就是作者的经验之谈，作者在反复强调调用兴趣和简单记录来让自己坚持写读书笔记，并且一次次的“安利”读书笔记的妙用。我的有效读书手段是无时无刻把书摆到离自己最近的位置。让自己可以随时碰到，同时只要是休息时间就拿出来翻一翻，这样可以激起我的兴趣。书中关于重读这部分是个人需要改进的部分，因为我发现自己很少去回顾以前的内容，总是在需要的时候着急找，这样挺不好的，后续会制定个人的复习计划，”重读”自己以前的记录。</p><p>​    个人比较认同的部分是作者对于为什么要写读书笔记，讲到了<strong>人连昨天吃的饭都会忘记，不要指望人可以融入多少知识</strong>，写的非常真实，因为很多人甚至连刚刚想起的事情都会马上忘记。另外个人还比较认同作者的信息一元化的观念，我的观念也是信息一元化，个人不擅长整理，同时比较自由放荡（家里很乱就可以看出）。所以我的方式基本也是按照时间轴的顺序记录，这种记录方式对我的作用一方面是可以很快的查找，因为一个月一个月翻，总能翻到想要的内容。这种简单快速的方式，不仅让我只需要关注每一个月该干什么，同时可以关注到每一个月干了什么。比如这个月搬家找房子浪费了很多时间，产出少了，从月份记录中明显就可以看出。</p><p>​    最后说下我对有效读书的看法，所谓有效读书最基本的还是要调动兴趣，个人观念认为很多人其实不适合看书，更适合有人讲书中的内容给他听，至于为什么有的人读书想睡觉，其实这其中有一定的科学依据，以前翻资料的时候有过了解，但是后来忘了，总之就是对于由于大脑的思考释放的休息信号。这里其实简单想象一下为什么很多人喜欢看各种网文和小说，一方面生活的压力之下很难集中精神，上班拥挤的公交地铁上，网文正好既可以补充这段空档，所以很多人喜欢看网文，但是遇到需要大脑思考的内容，大脑会因为保护机制释放休息信号，从而造成催眠的效果。</p><p>​    总之，不管形式如何，有效读书的最终法则还是形成个人记录和感悟。如果想要知道我的读书观念和习惯，可以看看往期读书方法论的文章，希望对你有帮助：</p><blockquote><p>文章链接：</p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuNTJwb2ppZS5jbi90aHJlYWQtMTM2MjgzNC0xLTEuaHRtbA==" title="https://www.52pojie.cn/thread-1362834-1-1.html">读书方法论（一）<i class="fa fa-external-link"></i></span></p></blockquote><h1 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h1><p>​    我的读书笔记比较自由，没有什么条条框框和格式，只要是记录本身就会让我很开心，虽然质量可能不如人意，哈哈，但是真心建议每一位读者好好思考下你的工作和人生经历留下了多少回忆，我个人喜欢用照片去回忆，喜欢每天记录自己的生活去回忆，可以看到过去那个“傻傻”的自己，后续打算看看小王子和时间管理方面的书籍，不知不觉21年过去4分之一，时间过得太快了，搬家之后，要多多读书和充实自己，今天的读书笔记分享就到这了。</p><blockquote><p>另外，这次搬家搬了20多本书，下决心买了一块大的墨水屏幕，Ireader smart2，为了防止有人说我安利，我这里直接截个图：</p><p>（不要问为什么要花1800大洋去买一个“电子垃圾”，买Ipad它不香么这种话。我只想说：谁用谁知道）</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/lADPBFDk-NZ-GifNBQDNA8A_960_1280.jpg" alt=""></p></blockquote><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      如何正确的对待读书笔记，如何有效读书
    
    </summary>
    
    
      <category term="读书笔记" scheme="https://whitestore.top/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="笔记" scheme="https://whitestore.top/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>一次大数据文件处理日记</title>
    <link href="https://whitestore.top/2021/03/28/bigdatacompile/"/>
    <id>https://whitestore.top/2021/03/28/bigdatacompile/</id>
    <published>2021-03-28T07:02:44.000Z</published>
    <updated>2021-03-28T07:04:00.796Z</updated>
    
    <content type="html"><![CDATA[<h1 id="一次大数据文件处理日记"><a href="#一次大数据文件处理日记" class="headerlink" title="一次大数据文件处理日记"></a>一次大数据文件处理日记</h1><h1 id="文章推荐"><a href="#文章推荐" class="headerlink" title="文章推荐"></a>文章推荐</h1><p><span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvX0dTcS1VWG5EaGdHNmswcUhxTS02QQ==" title="https://mp.weixin.qq.com/s/_GSq-UXnDhgG6k0qHqM-6A">https://mp.weixin.qq.com/s/_GSq-UXnDhgG6k0qHqM-6A<i class="fa fa-external-link"></i></span></p><h1 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h1><p>​    最近在做业务功能的时候，拿到一个非常”简单”的需求，把一个 <strong>30万行</strong>的数据文件按照特定的格式进行入库，文件格式和字段的内容都有对应的规定。这种需求其实还算比较常见，通常这一类需求不管系统配置多么强悍，都不可能无脑的读取插入。趁着这个需求搜集了一下几种常见的做法。下面就来介绍一下解决这种大数据文件的常用套路。</p><a id="more"></a><h1 id="文章目的："><a href="#文章目的：" class="headerlink" title="文章目的："></a>文章目的：</h1><ol><li>在JAVA中如何安全的将一份超大文件进行安全入库处理方式。</li><li>大文件读写可能产生的性能问题和瓶颈分析</li><li>关于分析大文件读写的常见套路<ol><li>使用单线程还是多线程</li><li>多线程的相关问题讨论</li></ol></li></ol><h1 id="文件内容分析"><a href="#文件内容分析" class="headerlink" title="文件内容分析"></a>文件内容分析</h1><p>​    由于实际的情况复杂多变，在做具体的编码之前，需要先梳理有可能存在的情况，下面简单列举系统有可能的存在的问题，和一些常见的注意事项：</p><ul><li>系统硬件水平，服务器是否会因为读写大量的数据文件占用大量资源<ul><li>内存问题：加载大数据最容易出的问题那就是爆内存，建议至少使用<strong>缓冲流</strong>进行读写</li><li>硬盘问题：读写的限制另一种体现就是硬盘的好坏，固态优于机械的读写.</li></ul></li><li>文件的读写方式，JAVA的IO比较复杂，这里简化为三种也就是常见的BIO、NIO、和AIO（具体代表含义请自行百度）。<ul><li>异步IO虽然看起来很美，但是需要考虑顺序入库的问题。</li><li>多线程异步读写比较考验机器性能，请谨慎使用。</li><li>顺序读写永远是硬盘最快捷的一种方式</li></ul></li><li>完成一次完整的操作时间估量，既然是大文件，就必然需要考虑整个操作的执行时间，一份几十万的数据跑一轮下来不管如何优化肯定需要不少的时间，所以操作的时间消耗需要考虑在可接受的范围</li><li>大数据文件读写的时间选择<ul><li>通常比较重和累的活都放大半夜去干</li><li>估量整个任务的执行时间消耗</li></ul></li></ul><p>这些分析只是一些最基本的要求，不同的业务场景会有更多的细节考量，文章不可能面面俱到，这些分析更多的是帮助个人提高警惕性，只有考虑到所有可能想到的细节，这样的大文件读写才可能是安全可靠的，同时可以保证突发情况可以及时的反应。</p><p>最后，这类开销比较大的操作，对于<strong>日志打印和记录</strong>的计算需要额外小心，最好在一次较大操作中记录操作成功失败记录数，同时在整个记录完成之后通过日志持久化整个操作的结果。</p><h1 id="大文件读写的常见套路"><a href="#大文件读写的常见套路" class="headerlink" title="大文件读写的常见套路"></a>大文件读写的常见套路</h1><p>​    其实这些套路网上多看看资料基本都可以有自己的一套方案，下面给出的建议可能不是最好的方式，有些可能在实际业务场景下走不通。（完全有可能）但是借着这些套路希望可以给读者一些启发，下面我们直接进入主题。</p><h2 id="分批入库"><a href="#分批入库" class="headerlink" title="分批入库"></a>分批入库</h2><p>​    分批入库是最容易想到的方式，也是最保险最稳妥的方式，这里包含了一个隐式的条件，就是数据都是<strong>增量不改动</strong>数据，大致意思就是不会改动的固定数据库数据。</p><p>​    现在我们来看下分批入库是如何处理的，分批的意思就是说每N条进行一次操作，防止数据库突然收到一个巨量的Insert请求导致锁表并且影响业务（弱一点的服务器直接满载），下面根据一段案例代码来说明做法：</p><blockquote><p>个人公司的电脑是一块SATA的固态硬盘，在开启批量操作之后，经常100%读写占用系统假死，所以如果要进行试验，建议先设置一个很小的值慢慢加量，否则你的电脑可能会卡的动不了。</p></blockquote><ul><li>首先需要编写一个批量插入的sql语句，网上对应案例的语句如下（如果是mybatis，需要使用<foreach>标签标记需要循环的对象内容）：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO table ( &quot;clo1&quot;, &quot;col2&quot;, &quot;col3&quot;, &quot;col4&quot;, &quot;col5&quot; )</span><br><span class="line">VALUES</span><br><span class="line">( 1, 10, NULL, &#39;2019-12-19 13:38:35&#39;, &#39;新年活动16张卡券&#39;),</span><br><span class="line">( 2, 11, NULL, &#39;2019-12-19 15:05:13&#39;, &#39;圣诞活动11张卡券&#39;),</span><br><span class="line">( 3, 12, NULL, &#39;2019-12-19 15:05:13&#39;, &#39;圣诞活动12张卡券&#39;),</span><br><span class="line">( 4, 13, NULL, &#39;2019-12-19 15:05:13&#39;, &#39;圣诞活动13张卡券&#39;);</span><br></pre></td></tr></table></figure><ul><li>下面是分批操作的JAVA代码，大致逻辑是打开一个文件，然后将一行数据转为一个对象，同时塞入到一个集合当中，当集合的内容超过限制的时候，进行一次入库的操作。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">private void insert2DbByBatchList(Config config, String line) throws IOException &#123;</span><br><span class="line">        List&lt;VisaNewBinVo&gt; insertList &#x3D; new ArrayList&lt;&gt;(1000);</span><br><span class="line">        Map configValue &#x3D; readConfigValue();</span><br><span class="line">        while (StringUtils.isNotEmpty(line)) &#123;</span><br><span class="line">            Timestamp timestamp &#x3D; new Timestamp(System.currentTimeMillis());</span><br><span class="line">            VisaNewBin visaNewBin &#x3D; new VisaNewBin();</span><br><span class="line">            configValue.forEach((key, value) -&gt; &#123;</span><br><span class="line">                Map&lt;String, Object&gt; visaBinField &#x3D; (Map&lt;String, Object&gt;) value;</span><br><span class="line">                Integer endInex &#x3D; (Integer) visaBinField.get(&quot;endInex&quot;);</span><br><span class="line">                Integer startIndex &#x3D; (Integer) visaBinField.get(&quot;startIndex&quot;);</span><br><span class="line">                if (startIndex &lt; line.length() &amp;&amp; endInex &lt; line.length()) &#123;</span><br><span class="line">                    String substring &#x3D; line.substring(startIndex, endInex);</span><br><span class="line">                    FieldReflectionUtil.setFieldValueByFieldName(visaNewBin, key.toString(), substring);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            VisaNewBinVo visaNewBinVo &#x3D; new VisaNewBinVo();</span><br><span class="line">            BeanUtils.copyProperties(visaNewBin, visaNewBinVo);</span><br><span class="line">            visaNewBinVo.setBinId(UUID.randomUUID().toString());</span><br><span class="line">            visaNewBinVo.setBatchNo(getVisaNewCardBinDecAfterFileName(config));</span><br><span class="line">            visaNewBinVo.setCreateTime(timestamp);</span><br><span class="line">            insertList.add(visaNewBinVo);</span><br><span class="line">            &#x2F;&#x2F; 限制部分</span><br><span class="line">            if (rechLimitValue(insertList)) &#123;</span><br><span class="line">                int count &#x3D; visaNewBinMapper.batchInsertNewBins(insertList);</span><br><span class="line">                logger.info(&quot;当前批次数据为：&#123;&#125; 条，成功入库: &#123;&#125; 条数据&quot;, insertList.size(), count);</span><br><span class="line">                insertList.clear();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#x2F;&#x2F; 存在纰漏，在最后一批不足的情况下，需要把剩下的数据入库</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private boolean rechLimitValue(List insertList) &#123;</span><br><span class="line">        return insertList.size() % 500 &#x3D;&#x3D; 0;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><p>小贴士：很多人可能会认为可以用<code>Thread.sleep(1000)</code>类似的线程休眠的方式让计算机“冷静”一下，给数据库一些缓冲时间，但是其实从大文件读写的角度来看，<strong>没有太大的意义</strong>，因为我们的文件读写要么需要开一条“河流”，要么就像新的方式直接开一条“矿道”（底层IO）。我们一旦打开流或者开通矿道就是在占用系统资源。用这种休眠的方式无非就是拉长了整个工作的时间，其实并没有太大的实际意义。</p><p>​    当然这种形式并不是完全没有任何作用，有些情况下比如之前个人曾经做过关于一个百度的分析接口存在<strong>QPS个位数限制</strong>的情况下，这种时候最简单的方法就是使用线程休眠来限制调用。</p><p>​    当然这种形式在编码里面比价丑陋，可以使用JDK的工具类<code>TimeUtil</code>来更加优雅的细粒度控制线程休眠时间控制。</p></blockquote><blockquote><p>这里有个八股文的面试题<code>Thread.sleep(0)</code>的含义。</p></blockquote><h3 id="分批入库存在的问题"><a href="#分批入库存在的问题" class="headerlink" title="分批入库存在的问题"></a>分批入库存在的问题</h3><p>​    分批入库虽然是最无脑的一种方式，但是这里其实是存在限制的，一般会存在下面这些问题：</p><ul><li>数据库对于preSql的占位符限制：<strong>比如postgreSql 的限制为Short类型的最大值</strong>，即<strong>32747</strong>，超过这个值就会抛出如下的异常：</li></ul><blockquote><p><strong>Tried to send an out-of-range integer as a 2-byte value</strong></p><p>github上面有人提过这个issue，里面还有一些老外的吐槽，挺有意思的，文章连接：</p><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BnamRiYy9wZ2pkYmMvaXNzdWVzLzEzMTE=" title="https://github.com/pgjdbc/pgjdbc/issues/1311">https://github.com/pgjdbc/pgjdbc/issues/1311<i class="fa fa-external-link"></i></span> <code>如何解决&quot;尝试将超范围整数发送为 2 个按次值&quot;的错误#1311</code></p><p><span class="exturl" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjc2MzkyMzkvcG9zdGdyZXNxbC1lcnJvci1pbnNlcnQtaGFzLW1vcmUtdGFyZ2V0LWNvbHVtbnMtdGhhbi1leHByZXNzaW9ucy13aGVuLWl0LWRvZXNu77yI6ZyA6KaB6Ieq5aSH5bel5YW377yJ" title="https://stackoverflow.com/questions/27639239/postgresql-error-insert-has-more-target-columns-than-expressions-when-it-doesn（需要自备工具）">https://stackoverflow.com/questions/27639239/postgresql-error-insert-has-more-target-columns-than-expressions-when-it-doesn（需要自备工具）<i class="fa fa-external-link"></i></span> <code>PostgreSQL ERROR: INSERT has more target columns than expressions, when it doesn&#39;t</code></p><p>如果想要绕开这个问题，可以自己手写一个实现类进行替换。还有一种办法就是减少占位符，增加批次然后减少每次批次的插入数据量。</p></blockquote><ul><li>硬件水平的限制：这里主要说的是硬盘上的限制，一块差点的硬盘即使是分批操作也会卡死，需要注意分批之后不是高枕无忧了</li></ul><blockquote><p>硬件问题不能完全作为无法解决问题的借口。</p></blockquote><ul><li>程序中断的影响：分批的方式比较常见的一个问题是处理入库过程中 <strong>程序异常</strong>，<strong>断电</strong>，<strong>系统故障（蓝屏）</strong>。</li></ul><blockquote><p>一种推荐的解决方式是数据库设置唯一校验字段，每次入库之前检查是否存在标记，可以使用redis进行辅助。（布隆过滤器）</p></blockquote><h2 id="多线程读写"><a href="#多线程读写" class="headerlink" title="多线程读写"></a>多线程读写</h2><p>多线程的处理方式也比较容易理解，既然一个人读写吃力，那就把文件“劈”成很多份，比如文件的第1条到1万条为线程1，第10001条到20000条为线程2， 依次类推，这种方式需要提前计算数据行的总量，然后开启线程将数据行分配给多个线程，由于个人处理的时候，被禁止使用多线程的处理方式，这里的代码为一些案例作用。</p><p>（建议PC端查看）</p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3F1ZXN0aW9uLzIwMTQ5Mzk1" title="https://www.zhihu.com/question/20149395">java读取大文件，采用多线程处理对提高效率可有帮助？<i class="fa fa-external-link"></i></span></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2dpdGh1Yl8zNzM4MjMxOS9hcnRpY2xlL2RldGFpbHMvMTA0NzIzNDIx" title="https://blog.csdn.net/github_37382319/article/details/104723421">使用多线程会加快文件读取速度吗？<i class="fa fa-external-link"></i></span></p><h1 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h1><p>​    通过这次的小需求整理了一下大数据问题的处理经验，也算是对个人的一点提升。比较关键的是掌握多线程写入文件，需要考虑的内容还不少。不过网上的资料并不是特别多，还需要花更多的时间去研究。</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      如何对于一个巨型文件进行分批处理
    
    </summary>
    
    
      <category term="日常" scheme="https://whitestore.top/categories/%E6%97%A5%E5%B8%B8/"/>
    
    
      <category term="实用" scheme="https://whitestore.top/tags/%E5%AE%9E%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>如何实现update select 语句</title>
    <link href="https://whitestore.top/2021/03/28/updateselect/"/>
    <id>https://whitestore.top/2021/03/28/updateselect/</id>
    <published>2021-03-28T07:01:30.000Z</published>
    <updated>2021-03-28T07:02:22.974Z</updated>
    
    <content type="html"><![CDATA[<h1 id="如何实现update-select-语句"><a href="#如何实现update-select-语句" class="headerlink" title="如何实现update select 语句"></a>如何实现update select 语句</h1><h2 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h2><p>​    有些时候我们会遇到如下情况，我们需要依赖一张表的查询结果来更新另一张表，比如我们存在一张主表和一张关联表，我们需要把关联表的部分字段数据同步到主表的里面。</p><p>​    这次的文章出现也是因为这样一个类似的需求，个人需要把一个<strong>30万行</strong>（后续会发文介绍常见的处理手段）的数据文件入库，同时需要将部分字段迁移到另一张表，两个表之间通过<strong>两个字段</strong>进行and匹配。下面画一下结构图：</p><p>​    <img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210315133417.png" alt=""></p><p>​    处理方式也比较简单，直接使用sql就可以完成，这篇文章针对这个小需求，总结一下update select 的几种实现方式。</p><a id="more"></a><h1 id="文章目的："><a href="#文章目的：" class="headerlink" title="文章目的："></a>文章目的：</h1><ol><li>实现update select 的几种常见方法<ol><li>join</li><li>merge</li><li>子查询</li></ol></li><li>merge的踩坑和问题</li></ol><h1 id="准备数据"><a href="#准备数据" class="headerlink" title="准备数据"></a>准备数据</h1><p>​    为了更好的进行实际操作，这里构建两张简单的表来模拟场景。直接复制下面的db即可，由于不同数据库sql不同，这里使用的是<strong>postgreSql</strong> 数据库。</p><h2 id="旧表"><a href="#旧表" class="headerlink" title="旧表"></a>旧表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">"public"</span>.<span class="string">"olddb"</span> (</span><br><span class="line">  <span class="string">"id"</span> int4 <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">"relevance1"</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> <span class="string">"pg_catalog"</span>.<span class="string">"default"</span>,</span><br><span class="line">  <span class="string">"relevance2"</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> <span class="string">"pg_catalog"</span>.<span class="string">"default"</span>,</span><br><span class="line">  <span class="string">"new_field"</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> <span class="string">"pg_catalog"</span>.<span class="string">"default"</span>,</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">"olddb_pkey"</span> PRIMARY <span class="keyword">KEY</span> (<span class="string">"id"</span>)</span><br><span class="line">)</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">"public"</span>.<span class="string">"olddb"</span> </span><br><span class="line">  OWNER <span class="keyword">TO</span> <span class="string">"postgres"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> <span class="string">"public"</span>.<span class="string">"olddb"</span>.<span class="string">"id"</span> <span class="keyword">IS</span> <span class="string">'主键'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> <span class="string">"public"</span>.<span class="string">"olddb"</span>.<span class="string">"relevance1"</span> <span class="keyword">IS</span> <span class="string">'关联字段1'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> <span class="string">"public"</span>.<span class="string">"olddb"</span>.<span class="string">"relevance2"</span> <span class="keyword">IS</span> <span class="string">'关联字段2'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> <span class="string">"public"</span>.<span class="string">"olddb"</span>.<span class="string">"new_field"</span> <span class="keyword">IS</span> <span class="string">'新字段，需要由关联表同步'</span>;</span><br></pre></td></tr></table></figure><p>表成功创建之后，在内部加入一些简单的数据：</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210315134419.png" alt=""></p><h2 id="新表"><a href="#新表" class="headerlink" title="新表"></a>新表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">"public"</span>.<span class="string">"newdb"</span> (</span><br><span class="line">  <span class="string">"id"</span> int4 <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">"relevance1"</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> <span class="string">"pg_catalog"</span>.<span class="string">"default"</span>,</span><br><span class="line">  <span class="string">"relevance2"</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> <span class="string">"pg_catalog"</span>.<span class="string">"default"</span>,</span><br><span class="line">  <span class="string">"new_field"</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> <span class="string">"pg_catalog"</span>.<span class="string">"default"</span>,</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">"newdb_pkey"</span> PRIMARY <span class="keyword">KEY</span> (<span class="string">"id"</span>)</span><br><span class="line">)</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">"public"</span>.<span class="string">"newdb"</span> </span><br><span class="line">  OWNER <span class="keyword">TO</span> <span class="string">"postgres"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> <span class="string">"public"</span>.<span class="string">"newdb"</span>.<span class="string">"id"</span> <span class="keyword">IS</span> <span class="string">'主键'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> <span class="string">"public"</span>.<span class="string">"newdb"</span>.<span class="string">"relevance1"</span> <span class="keyword">IS</span> <span class="string">'关联字段1'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> <span class="string">"public"</span>.<span class="string">"newdb"</span>.<span class="string">"relevance2"</span> <span class="keyword">IS</span> <span class="string">'关联字段2'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMENT</span> <span class="keyword">ON</span> <span class="keyword">COLUMN</span> <span class="string">"public"</span>.<span class="string">"newdb"</span>.<span class="string">"new_field"</span> <span class="keyword">IS</span> <span class="string">'新字段，需要同步到旧表'</span>;</span><br></pre></td></tr></table></figure><blockquote><p>提醒：注意数据库是<strong>postgresql</strong>，其他数据库可能存在字段等差别而无法成功 </p></blockquote><p>表成功创建之后，在内部加入一些简单的数据：</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210315134505.png" alt=""></p><h1 id="实现方式汇总"><a href="#实现方式汇总" class="headerlink" title="实现方式汇总"></a>实现方式汇总</h1><h2 id="join"><a href="#join" class="headerlink" title="join"></a>join</h2><p>​    第一种的连接方式使用的是连接表的<code>join</code>方法，我们通过关联字段查出对应的关联记录，同时在关联之后将关联新字段的数据更新到旧表，这样就实现了每关联一条记录就更新一条记录数据：</p><p>​    实现方式也比较简单，只需要使用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">UPDATE olddb aa</span><br><span class="line">SET new_field &#x3D; bb.new_field</span><br><span class="line">FROM</span><br><span class="line"> newdb bb where aa.relevance1 &#x3D; bb.relevance1 </span><br><span class="line">AND aa.relevance2 &#x3D; bb.relevance2</span><br></pre></td></tr></table></figure><p>他的执行结果如下：</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210315143721.png" alt=""></p><blockquote><p>下面的下方是错的，这时候sql会抛出一个错误。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> olddb <span class="keyword">ALIAS</span> </span><br><span class="line"><span class="keyword">SET</span> ( new_field ) = (</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">( bb.new_field ) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">olddb aa</span><br><span class="line"><span class="keyword">JOIN</span> newdb bb <span class="keyword">ON</span> aa.relevance2 = bb.relevance2 </span><br><span class="line"><span class="keyword">AND</span> aa.relevance1 = bb.relevance1 </span><br><span class="line">)</span><br></pre></td></tr></table></figure></blockquote><h2 id="Merge（未验证）"><a href="#Merge（未验证）" class="headerlink" title="Merge（未验证）"></a>Merge（未验证）</h2><p>第二种方式可能比较陌生，因为<code>merge</code>算是对于insert以及update的一个统合，粗略了解了一下发现能干不少事情，下面说下。</p><p>注意下面的方法在postgresql <strong>报错</strong>，原因是是我的postgresql<strong>版本太低</strong>，但是个人在升级过后还不能支持使用merge方法 ，所以这里保存了sql，可以改动后尝试到其它的数据库语言进行使用。</p><blockquote><p>ERROR:  syntax error at or near “MERGE” </p><p>很头疼，在stackflow也没用找到答案。</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">merge</span> <span class="keyword">into</span> olddb <span class="keyword">as</span> olds</span><br><span class="line"><span class="keyword">using</span> newdb news <span class="keyword">on</span> olds.new_field = news.new_field</span><br><span class="line"><span class="keyword">when</span> <span class="keyword">matched</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">set</span> </span><br><span class="line">olds.new_field = news.new_field</span><br></pre></td></tr></table></figure><p>需要注意的是不同的数据库对于merge的特性是不一致的，建议查看当前安装数据库的版本以及文档进行确认比较稳妥。</p><p>下面是 <strong>postgresql</strong> 的<code>merge</code>使用案例，注意一般建议版本为<code>11</code>以上再使用<code>merge</code>。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MERGE INTO wines </span><br><span class="line">USING (VALUES(&#39;Chateau Lafite 2003&#39;, &#39;24&#39;)) v</span><br><span class="line">ON v.column1 &#x3D; w.winename</span><br><span class="line">WHEN NOT MATCHED </span><br><span class="line">  INSERT VALUES(v.column1, v.column2)</span><br><span class="line">WHEN MATCHED</span><br><span class="line">  UPDATE SET stock &#x3D; stock + v.column2;</span><br></pre></td></tr></table></figure><h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><p>​    子查询是最简单也是最容易想到的一种方式，不过子查询有一个明显的缺点就是数据量较大的情况下通常性能都比较差， 这种操作通常适合数据量比较小的情况，下面是对应的案例语法：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> olddb </span><br><span class="line"><span class="keyword">SET</span> new_field = ( <span class="keyword">SELECT</span> newdb.new_field <span class="keyword">FROM</span> newdb <span class="keyword">WHERE</span> olddb.relevance1 = newdb.relevance1 <span class="keyword">AND</span> olddb.relevance2 = newdb.relevance2 )</span><br></pre></td></tr></table></figure><p>下面是子查询需要注意的点：</p><ul><li>如果子查询无法找到任何匹配的行，则更新后的值将被更改为NULL</li><li>如果子查询找到多个匹配的行，update查询将返回一个错误。</li></ul><blockquote><p>错误的信息如下：</p><p><code>&gt; ERROR:  more than one row returned by a subquery used as an expression</code></p><p>(&gt;错误:作为表达式使用的子查询返回多行)</p></blockquote><ul><li>多数情况下子查询的性能较差，尽量避免使用</li></ul><h1 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h1><p>​    由于merge个人使用经验不足，花了较多时间依然没有解决，所以文章标题进行了标记，后续使用了其他的方式避开问题。</p><p>​    update select的实现实际情况复杂多变，这里只列举了最简单的使用情况。</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      一个数据库的使用经验技巧
    
    </summary>
    
    
      <category term="数据库" scheme="https://whitestore.top/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
      <category term="实用" scheme="https://whitestore.top/tags/%E5%AE%9E%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>Navicat如何复制数据库</title>
    <link href="https://whitestore.top/2021/03/28/navicatcopy/"/>
    <id>https://whitestore.top/2021/03/28/navicatcopy/</id>
    <published>2021-03-28T06:34:25.000Z</published>
    <updated>2021-03-28T07:01:11.527Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Navicat如何复制数据库"><a href="#Navicat如何复制数据库" class="headerlink" title="Navicat如何复制数据库"></a>Navicat如何复制数据库</h1><h2 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h2><p>​    这篇文章简单记录一下如何通过navicat备份一整个数据库留个记录，节省后面百度的时间。</p><p>​    注意，这里依照<code>postgres</code>数据库作为案例。</p><h2 id="第一步：备份数据库"><a href="#第一步：备份数据库" class="headerlink" title="第一步：备份数据库"></a>第一步：备份数据库</h2><p>​    首先我们选择任意想要复制的数据库，选择备份按钮。</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210311155316.png" alt=""></p><p>​    接着，我们可以在常规里面进行基本的配置，，可以在对象选择里面进行基本的配置。</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210311155453.png" alt=""></p><p>​    点击备份之后，我们可以看到信息日志，navicat正在为我们备份整改数据库的内容。</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210311155534.png" alt=""></p><p>​    备份完成之后，在备份的列表里面，可以看到生成对应的日期时间戳生成的对应db文件。</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210311155721.png" alt=""></p><p>​    <strong>关键的地方来了，到了这一步，说明整个库的数据和结构我们都备份好了，现在我们需要将其提取到sql里面，用做新的数据库导入</strong>。右击需要导出sql文件的备份，点击<code>提取SQL</code>。</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210311161408.png" alt=""></p><p>​    接着我们选择<code>提取sql</code>，然后指定一个目录的位置，确定之后，navicat就开始将整个备份导出到sql。同样耐心等待信息日志。</p><blockquote><p>这个过程可能会很长，请耐心等待</p></blockquote><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210311161528.png" alt=""></p><h2 id="第二步：新建需要复制的数据"><a href="#第二步：新建需要复制的数据" class="headerlink" title="第二步：新建需要复制的数据"></a>第二步：新建需要复制的数据</h2><p>​    这个操作应该简单的不能再简单了，就是新建一个新的数据库。</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210311155906.png" alt=""></p><h2 id="第三步：导入备份数据库"><a href="#第三步：导入备份数据库" class="headerlink" title="第三步：导入备份数据库"></a>第三步：导入备份数据库</h2><p>​    这一步也是非常简单的，右击选择数据库，，选择<code>运行sql文件</code>，找到刚刚提取出来的sql文件导入，然后耐心等待即可。</p><blockquote><p>这个过程比较长，数据库大的话几分钟，甚至小时都是有可能的，这时候可以去干干别的事情，<strong>进度条不动不一定是死机了，可能是数据过大没有加载进度条</strong></p></blockquote><p>​    <img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210311161722.png" alt=""></p><h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><p>​    这次简单记录的一下如何快速的复制一个数据库，当然更快的方式是使用<code>pq_dump</code>(针对不同数据库有不同的备份命令)。速度要比navicat 快上好几倍。但是通常情况下我们连接数据库的服务器或者客户端都不在本地，这种方式备份和复制整个库是十分方便的。</p><p>​    同时养成良好的备份习惯有助于严重失误的时候进行回溯。</p><p>​    </p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      Navicat如何复制数据库一次实战笔记
    
    </summary>
    
    
      <category term="数据库" scheme="https://whitestore.top/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
      <category term="实用" scheme="https://whitestore.top/tags/%E5%AE%9E%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>《洛丽塔》读书笔记</title>
    <link href="https://whitestore.top/2021/03/07/luolita/"/>
    <id>https://whitestore.top/2021/03/07/luolita/</id>
    <published>2021-03-07T09:04:28.000Z</published>
    <updated>2021-03-07T11:27:44.341Z</updated>
    
    <content type="html"><![CDATA[<h1 id="《洛丽塔》读书笔记"><a href="#《洛丽塔》读书笔记" class="headerlink" title="《洛丽塔》读书笔记"></a>《洛丽塔》读书笔记</h1><h1 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h1><p>​    首先说明一下，个人看的版本是主万翻译的版本，这本书我只<strong>看了一半</strong>之后实在看不下去了（原因下文会进行说明），就跑去看了97版本的电影，62版本的黑白电影也看了一部分片段，这本书是之前看B站某UP主直播从弹幕看到有人强烈推荐这本书，本着好奇去搜了一下，没想要作者是个王者，惭愧。这次的读书笔记注定只是片段。</p><a id="more"></a><h1 id="文章目的"><a href="#文章目的" class="headerlink" title="文章目的"></a>文章目的</h1><p>​    简略的介绍一下个人的读书笔记感受。</p><p>​    留坑，后续看其他翻译版本进行补完。</p><h1 id="推荐指数："><a href="#推荐指数：" class="headerlink" title="推荐指数："></a>推荐指数：</h1><p>​    不做评价，个人不会推荐一本自己都没有看完的书。</p><p>​    但是主观上还是不建议看到评论就单纯的当一本那方面的书去看的。</p><p>​    推荐看看电影，注意是<strong>97版本</strong>的，拍的很不错，基本把这本书所要表达的含义表达出来了。</p><h1 id="个人感悟"><a href="#个人感悟" class="headerlink" title="个人感悟"></a>个人感悟</h1><p>​    这本书牵扯的话题比较敏感，算是一本禁书，里面更多的细节个人也不做过多的介绍，仅仅表达下我对这本书的一本看法。</p><h2 id="从翻译的角度来说"><a href="#从翻译的角度来说" class="headerlink" title="从翻译的角度来说"></a>从翻译的角度来说</h2><p>​    从翻译本身来看，主万这个版本在我看来翻译的不太行，很多句子读不通，网上网友对比一下各种翻译版本资料差距发现还是挺大的，看了一部分英文原版简单几句就可以看出文学的功底不一般，所以有兴趣的读者建议去看下英文原版。</p><h2 id="男女主角的看法"><a href="#男女主角的看法" class="headerlink" title="男女主角的看法"></a>男女主角的看法</h2><p>​    说实话我很不擅长记忆外国人的人名，包括日本四个字的人名我有时候记两个字都记不住=-=，但是对于整个剧情的记忆却比较擅长。</p><p>​    关于这本书的男主亨伯特，实体书背后的一段文字可以看到亨伯特算是有精神相关的疾病的（书中也有描述住了一段时间精神病院），亨伯特因为初恋因病去世导致对于女性的追求停留在一个很特殊的年纪，所以整本书他对洛丽塔所有的爱都是不正常的，拥有洛丽塔的爱对于亨伯特来说就是毕生的梦想，但是在道德的层面让男主不断的进行抉择，而得到洛丽塔之后失去洛丽塔的亨伯特也注定悲惨的命运。</p><p>​    再来说下女主，女主洛丽塔是在最特殊的年纪遇到了最不该遇见的人，因为家庭的关系缺少父爱，导致在青春期没有受到很好的教育和引导，对于男主的各种诱惑是在完全不自觉的情况下进行的，如果洛丽塔没有遇到亨伯特，并且母亲也能进行很好的教导，相信洛丽塔会有完全不同的人生。</p><p>​    整本书是一个彻头彻尾的悲剧，但是我认为悲剧并不能完全算是男主一手造成的，从电影可以看到，影片中有一段学校校长和主任找男主说洛丽塔比同龄人早熟，并且希望男主注意性这一方面教育让我有比较深的印象，其实对于性教育这一块国外一直都比较开放，但是学校注意到却不加引导，完全推给亨伯特，然而亨伯特是最不该干涉的那一个人，可以看出洛丽塔的悲剧也有社会环境的一面。</p><h2 id="作者以及这本书"><a href="#作者以及这本书" class="headerlink" title="作者以及这本书"></a>作者以及这本书</h2><p>​    作者的经历和亨伯特有相似之处，作者在美国经历了美国的从盛转衰，或许洛丽塔后来变为“枯叶”，但是亨伯特只要看上一眼就会觉得无比的幸福，感觉温馨而美好，</p><p>​    这种情感不是不能理解，或许这就是回忆吧，不管他在现实如何的扭曲或者痛苦，人总是会对这一段回忆不断的怀念。</p><h2 id="整本书的感受"><a href="#整本书的感受" class="headerlink" title="整本书的感受"></a>整本书的感受</h2><p>​    说实话这本书看了一部分还是比较<strong>后悔</strong>的，看完电影的想法更是如此，翻译让我对这本书的印象大打折扣，这本书的翻译总是让我想起《JAVA编程思想》的那种翻译，本来一本不算薄的书带上渣翻译对于作品本身的品质就是一种大打折扣，还是建议有想法看这本书的不要选 <strong>主万</strong>翻译的版本，不然看书会很痛苦（确实很痛苦）。书中的有些句子真的很美，可以看到文学的集大成作品，虽然作品存在很多的辞藻堆砌，但是看完不会觉得是废话，这是需要很深的文学功底的。</p><p>​    这本书是富含浪漫主义和现实批判的一本书，这本书承载的内容要比文字本身要重很多，或许每一个人的心理都有一个洛丽塔，不管如何改变，只要看上一眼心中就会无比的温暖。</p><p>​    </p><h1 id="精句摘录"><a href="#精句摘录" class="headerlink" title="精句摘录"></a>精句摘录</h1><ul><li><strong>人生多奇怪啊，我们不断摆脱我们所追求的命运</strong></li><li><code>Lotila, light of my life, fire of my lions. My sin, my soul. Lo-lee-ta: the tip of hte tongue taking a trip of three steps down the palate to tap, at three, on the teeth. Lo. Lee. Ta.</code></li><li><strong>人有三样东西是无法隐瞒的，咳嗽、穷困和爱；你想隐瞒越欲盖弥彰。人有三样东西是不该挥霍的，身体、金钱和爱；你想挥霍却得不偿失。人有三样东西是无法挽留的，时间、生命和爱；你想挽留却渐行渐远。人有三样东西是不该回忆的，灾难、死亡和爱；你想回忆却苦不堪言。</strong> ——《洛丽塔》</li></ul><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>​    本着对书的尊重，我还是打算去网上找找其他的译本坚持读完，或许会有不同的感受（看到网友推荐于晓丹版本），这本书算是告一段落了，个人的这次读书笔记也算是一个警告，买外国翻译书之前先去评论看下翻译质量，否则不但影响阅读体验，还容易导致错误的认知。</p><p>​    现在看来，想要读一本好书确实不容易！</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      洛丽塔和读书笔记
    
    </summary>
    
    
      <category term="读书笔记" scheme="https://whitestore.top/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="读书笔记" scheme="https://whitestore.top/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>浅谈设计模式 - 模板方法（十）</title>
    <link href="https://whitestore.top/2021/03/07/templatemethod/"/>
    <id>https://whitestore.top/2021/03/07/templatemethod/</id>
    <published>2021-03-07T09:04:19.000Z</published>
    <updated>2021-03-07T11:26:35.366Z</updated>
    
    <content type="html"><![CDATA[<h1 id="浅谈设计模式-模板方法（十）"><a href="#浅谈设计模式-模板方法（十）" class="headerlink" title="浅谈设计模式 - 模板方法（十）"></a>浅谈设计模式 - 模板方法（十）</h1><h1 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h1><p>​    模板方法模式在JAVA当中最为熟知的就是<code>spring</code>的<code>template</code>对象，模板方法和策略这两个模式需要小心的区分，关于模板方法模式只需要重点记忆一句话：<strong>模板方法的模式定义了算法的骨架</strong>。同时针对模板方法的的一项设计原则<strong>好莱坞原则</strong>也是对 <strong>依赖倒转</strong>原则一种很好的补充和扩展。</p><a id="more"></a><h1 id="文章目的："><a href="#文章目的：" class="headerlink" title="文章目的："></a>文章目的：</h1><ol><li>了解模板方法，同时了解模板方法是如何体现好莱坞原则的。</li><li>模板方法与策略模式的对比，以及模板方法灵活运用钩子函数。</li><li>模板方法的简单案例，以及在spring框架当中的具体体现。</li></ol><h1 id="什么是模板方法"><a href="#什么是模板方法" class="headerlink" title="什么是模板方法"></a>什么是模板方法</h1><h2 id="基本定义"><a href="#基本定义" class="headerlink" title="基本定义"></a>基本定义</h2><p>定义：在一个方法当中定义了算法的骨架，而将具体的实现延迟到子类当中。模板方法在不改变算法结构的情况下，重构算法的某些步骤。</p><h2 id="从现实看模板方法"><a href="#从现实看模板方法" class="headerlink" title="从现实看模板方法"></a>从现实看模板方法</h2><p>​    我们都知道现代各式各样的蛋糕都是使用模具做成的，而同一个形状的蛋糕却可以使用不同的配料，此时模具便是模板方法的骨架，通过定义具体的配料细节对应了“算法”的细节。</p><h2 id="钩子函数"><a href="#钩子函数" class="headerlink" title="钩子函数"></a>钩子函数</h2><p>​    钩子函数是一种编程上比较常用的技巧，在框架设计当中十分常见，什么是钩子呢？从个人的理解来看，钩子像是可以延迟定义的匿名函数，钩子可以“勾”住某个算法的中间过程，让外部环境可以干涉内部算法实现的同时，又能让内部的函数进行自由控制钩子的使用。</p><p>​    钩子函数一般实现方式为抽象类或者不做任何动作的函数。</p><p>​    钩子函数在脚本语言里面经常被用作回调函数。包括java的许多框架也用钩子让用户可以干涉一些算法的细节。但是需要注意的是，钩子这个东西很容易破坏代码的可阅读性，所以不建议经常使用这种函数，可以用组合以及其他的设计模式对于结构进行优化。</p><h2 id="模板方法的结构图"><a href="#模板方法的结构图" class="headerlink" title="模板方法的结构图"></a>模板方法的结构图</h2><p>​    下面是模板方法的结构图，模板方法对比其他设计模式应该算是最简单的一个结构图了，比较容易理解：</p><p>​    模板方法的模式定义了算法的骨架，那么什么是定义算法的骨架，从下面的图表很好的看到，父类定义为抽象类，定义模板的算法方法和抽象的算法细节。</p><p>这里要实现算法需要由子类实现具体的算法业务</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210305225616.png" alt="模板方法结构图"></p><h2 id="模板方法的优缺点"><a href="#模板方法的优缺点" class="headerlink" title="模板方法的优缺点"></a>模板方法的优缺点</h2><p>优点：</p><ul><li>模板方法可以让算法的细节掩盖在子类，同时抽取公共的算法，提高代码复用程度</li><li>模板方法可以让修改控制在子类，而父类方法不需要进行改动，符合开放关闭原则。</li></ul><p>缺点：</p><ul><li>模板方法类的改动对于所有的算法实现子类都会产生影响，同时模板父类改动违背“开放-关闭”原则</li><li>模板方法由于利用钩子控制父类方法，会导致反向控制代码，对于代码的阅读不是十分友好。</li></ul><h2 id="模板方法与好莱坞原则"><a href="#模板方法与好莱坞原则" class="headerlink" title="模板方法与好莱坞原则"></a>模板方法与好莱坞原则</h2><p>什么是好莱坞原则？</p><pre><code>首先需要了解一下什么是好莱坞原则：**让我们调用你们，而不是让你们调用我**。</code></pre><p>和依赖倒转原则有什么关联？</p><p>​    好莱坞原则更像是对于依赖倒转的一种扩展技巧。依赖倒转更加关注的是如何在设计中避免面向实现编程，而好莱坞则是将实现的调用在低层的结构进行隐藏。</p><p>为什么不建议低层组件调用高层组件？</p><p>​    为了防止环形依赖，在高层组件里面调用了抽象方法，而抽象方法又调用高层组件的方法。</p><h2 id="策略模式和模板方法对比"><a href="#策略模式和模板方法对比" class="headerlink" title="策略模式和模板方法对比"></a>策略模式和模板方法对比</h2><p>策略模式和模板方法模式的对比</p><ol><li>策略是定义一整个算法，使用组合的形式实现不同的对象切换</li><li>模板方法的是定义一个超类，在超类中通过高层调用底层实现的具体方法的实现，来实现方法的延迟功能</li></ol><h1 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h1><p>​    这次的案例以个人小时候做过的一件事情举例，以前外婆兼职从厂里拿来一堆玩具零件的成品，而工作就是把成品进行“反转”（就是把做好的玩具翻面），还非常清楚的记得大概是一分钱一个，靠着帮忙那时候还拿了一些零花钱，每天放学做完作业之后就是帮外婆做“兼职”。这种重复性劳动，在代码的构建很容易想到模板方法的模式，由于各种玩具的形状不同，所以翻面的方式以及效率和速度都不同，我们将重复劳动的部分定义为顶层的模板，而具体的玩具构建细节，需要根据不同的玩具进行不同的操作，下面定义这个工作的大致流程：</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210307112758.png" alt="玩具构建流程图"></p><p>下面是根据结构图绘制一个基本的代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 玩具制造模板类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">TemplateWorkFlow</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">productToy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        takeToy();</span><br><span class="line">        reverseToy();</span><br><span class="line">        putBasket();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">putBasket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"把玩具放到玩具篮"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">takeToy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"拿起玩具"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">reverseToy</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AntlersToyWorkFlow</span> <span class="keyword">extends</span> <span class="title">TemplateWorkFlow</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reverseToy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"把主干翻面"</span>);</span><br><span class="line">        System.out.println(<span class="string">"把鹿角的分叉翻页"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChristmasHatWorkFlow</span> <span class="keyword">extends</span> <span class="title">TemplateWorkFlow</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reverseToy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"圣诞帽反转"</span>);</span><br><span class="line">        System.out.println(<span class="string">"圣诞帽帽子顶部的小秋顶出去"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TemplateWorkFlow templateWorkFlow = <span class="keyword">new</span> ChristmasHatWorkFlow();</span><br><span class="line">        TemplateWorkFlow templateWorkFlow1 = <span class="keyword">new</span> AntlersToyWorkFlow();</span><br><span class="line">        templateWorkFlow.productToy();</span><br><span class="line">        templateWorkFlow1.productToy();</span><br><span class="line">    &#125;<span class="comment">/*</span></span><br><span class="line"><span class="comment">    拿起玩具</span></span><br><span class="line"><span class="comment">    圣诞帽反转</span></span><br><span class="line"><span class="comment">    圣诞帽帽子顶部的小秋顶出去</span></span><br><span class="line"><span class="comment">    把玩具放到玩具篮</span></span><br><span class="line"><span class="comment">    拿起玩具</span></span><br><span class="line"><span class="comment">    把主干翻面</span></span><br><span class="line"><span class="comment">    把鹿角的分叉翻页</span></span><br><span class="line"><span class="comment">    把玩具放到玩具篮</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果不使用设计模式，他大致的设计代码如下，可以看到很多方法都干了相似的事情，这些方法可能本质上只是一两行代码甚至只是取名不一样，当然现代的编译器都很“聪明”，会发现重复的点，所以最最基本的要求，是编写出编译器都无法发现的重复代码，当然仅仅凭借这一点显然要求有点低</p><p>​    下面看下不使用模板方法的代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChristmasHatWorkFlow</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">productToy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        takeToy();</span><br><span class="line">        reverseToy();</span><br><span class="line">        putBasket();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">putBasket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"把玩具放到玩具篮"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">takeToy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"拿起玩具"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reverseToy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"圣诞帽反转"</span>);</span><br><span class="line">        System.out.println(<span class="string">"圣诞帽帽子顶部的小秋顶出去"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AntlersToyWorkFlow</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">productToy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        takeToy();</span><br><span class="line">        reverseToy();</span><br><span class="line">        putBasket();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">putBasket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"把玩具放到玩具篮"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">takeToy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"拿起玩具"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reverseToy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"把主干翻面"</span>);</span><br><span class="line">        System.out.println(<span class="string">"把鹿角的分叉翻页"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        AntlersToyWorkFlow antlersToyWorkFlow = <span class="keyword">new</span> AntlersToyWorkFlow();</span><br><span class="line">        antlersToyWorkFlow.productToy();</span><br><span class="line">        ChristmasHatWorkFlow christmasHatWorkFlow = <span class="keyword">new</span> ChristmasHatWorkFlow();</span><br><span class="line">        christmasHatWorkFlow.productToy();</span><br><span class="line"></span><br><span class="line">    &#125;<span class="comment">/*</span></span><br><span class="line"><span class="comment">    拿起玩具</span></span><br><span class="line"><span class="comment">    把主干翻面</span></span><br><span class="line"><span class="comment">    把鹿角的分叉翻页</span></span><br><span class="line"><span class="comment">    把玩具放到玩具篮</span></span><br><span class="line"><span class="comment">    拿起玩具</span></span><br><span class="line"><span class="comment">    圣诞帽反转</span></span><br><span class="line"><span class="comment">    圣诞帽帽子顶部的小秋顶出去</span></span><br><span class="line"><span class="comment">    把玩具放到玩具篮</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="spring当中的模板方法"><a href="#spring当中的模板方法" class="headerlink" title="spring当中的模板方法"></a>spring当中的模板方法</h2><p>spring最为典型的案例便是<code>Tempalte</code>框架，但是需要注意spring多数情况下并没有使用经典的模板方法结构，而是使用了<code>CallBack函数</code>的形式，避开了继承结构的同时，每个类可以单独实现自己的具体功能：</p><p>我们看一下<code>RedisTempalte</code>当中的<code>StringRedisTemplate</code>，这里调用父类的<code>afterPropertiesSet()</code>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringRedisTemplate</span> <span class="keyword">extends</span> <span class="title">RedisTemplate</span>&lt;<span class="title">String</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Constructs a new &lt;code&gt;StringRedisTemplate&lt;/code&gt; instance ready to be used.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> connectionFactory connection factory for creating new connections</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">StringRedisTemplate</span><span class="params">(RedisConnectionFactory connectionFactory)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>();</span><br><span class="line">      setConnectionFactory(connectionFactory);</span><br><span class="line">      afterPropertiesSet();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> RedisConnection <span class="title">preProcessConnection</span><span class="params">(RedisConnection connection, <span class="keyword">boolean</span> existingConnection)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> DefaultStringRedisConnection(connection);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>父类同样继承的手段，在如下方法当中调用了<code>afterProperteisSet()</code>，通过super引用父类的方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 注意</span></span><br><span class="line">   <span class="keyword">super</span>.afterPropertiesSet();</span><br><span class="line"></span><br><span class="line">   <span class="keyword">boolean</span> defaultUsed = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (defaultSerializer == <span class="keyword">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">      defaultSerializer = <span class="keyword">new</span> JdkSerializationRedisSerializer(</span><br><span class="line">            classLoader != <span class="keyword">null</span> ? classLoader : <span class="keyword">this</span>.getClass().getClassLoader());</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (enableDefaultSerializer) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (keySerializer == <span class="keyword">null</span>) &#123;</span><br><span class="line">         keySerializer = defaultSerializer;</span><br><span class="line">         defaultUsed = <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (valueSerializer == <span class="keyword">null</span>) &#123;</span><br><span class="line">         valueSerializer = defaultSerializer;</span><br><span class="line">         defaultUsed = <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (hashKeySerializer == <span class="keyword">null</span>) &#123;</span><br><span class="line">         hashKeySerializer = defaultSerializer;</span><br><span class="line">         defaultUsed = <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (hashValueSerializer == <span class="keyword">null</span>) &#123;</span><br><span class="line">         hashValueSerializer = defaultSerializer;</span><br><span class="line">         defaultUsed = <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (enableDefaultSerializer &amp;&amp; defaultUsed) &#123;</span><br><span class="line">      Assert.notNull(defaultSerializer, <span class="string">"default serializer null and not all serializers initialized"</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (scriptExecutor == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.scriptExecutor = <span class="keyword">new</span> DefaultScriptExecutor&lt;&gt;(<span class="keyword">this</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   initialized = <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面引用父类<code>RedisAccesor</code>类当中的<code>afterPropertiesSet()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   Assert.state(getConnectionFactory() != <span class="keyword">null</span>, <span class="string">"RedisConnectionFactory is required"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过定义<code>getConnectionFactory()</code>方法，子类可以自由的配置连接工厂，也可以直接沿用父类的默认实现。</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>​    模板方法是一个比较重要的设计模式，他可以从结构上帮助程序员构建一个良好的抽象概念，同时模板方法提供的钩子函数，通过定义抽象方法延迟到子类实现这一技巧非常符合“开放-关闭”原则，灵活运用模板方法模式有利于构建更加灵活的软件骨架，同时可以定义各种多变的算法体系。但是需要注意的是传统的模板方法这种继承的结构 <strong>并不推崇</strong>，因为我们都知道继承对于所有子类都会产生影响。</p><p>​    另外模板方法这个模式对于阅读代码的体验不是很好，经常需要各个类之间不断切换，有时候甚至会莫名其妙为什么突然跑到另一个方法里面，模板方法有时候比较影响阅读体验。</p><p>​    另外设计模式最大的目的就是 <strong>减少重复代码</strong> 以及 <strong>用最小的代价进行扩展</strong>，个人认为如果代码符合这两个点基本就是一个好代码，然而这个点确实日常工作最难实现的。</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      模板方法提取公共方法，并且延迟算法到子类实现
    
    </summary>
    
    
      <category term="设计模式" scheme="https://whitestore.top/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="设计模式" scheme="https://whitestore.top/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>浅谈设计模式 - 外观模式（九）</title>
    <link href="https://whitestore.top/2021/03/07/outward/"/>
    <id>https://whitestore.top/2021/03/07/outward/</id>
    <published>2021-03-07T09:04:08.000Z</published>
    <updated>2021-03-07T11:25:06.461Z</updated>
    
    <content type="html"><![CDATA[<h1 id="浅谈设计模式-外观模式（九）"><a href="#浅谈设计模式-外观模式（九）" class="headerlink" title="浅谈设计模式 - 外观模式（九）"></a>浅谈设计模式 - 外观模式（九）</h1><h1 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h1><p>外观模式可以说是最容易理解，也是最容易掌握的一个设计模式了，概念比较简单，主要作用是将一堆复杂的接口和功能进行简化设计，让接口的功能更加简单，从另一个角度来看，外观是对原有的旧系统提供了一个门户，当其他所有的系统接入旧系统的时候，不需要纠结旧接口的功能实现，而只要关心和外观对象打交道，而外观模式很好的将两个系统之间构建沟通的桥梁。</p><a id="more"></a><h1 id="文章目的"><a href="#文章目的" class="headerlink" title="文章目的"></a>文章目的</h1><ol><li>了解什么是外观模式</li><li>外观模式和迪米特法则</li><li>外观模式的一些实际应用场景</li></ol><h1 id="什么是外观模式？"><a href="#什么是外观模式？" class="headerlink" title="什么是外观模式？"></a>什么是外观模式？</h1><p>定义：定义一个统一的接口，访问子系统当中的一群接口，外部定义高层接口简化接口的调用，对于复杂系统的功能只提供最少的接口对外调用，隐藏大量实现类的实现细节。外观模式更像是构建一个统一门户，让子系统复杂错综的方法进行整合，当一个系统依赖许多子系统的方法的时候，外观模式将会派上用处。</p><p>外观是一种<strong>结构型模式</strong>，他让子系统和外部系统之间建立一层门户接口。</p><h2 id="外观模式结构图"><a href="#外观模式结构图" class="headerlink" title="外观模式结构图"></a>外观模式结构图</h2><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210303223258.png" alt=""></p><h2 id="生活当中的模式理解："><a href="#生活当中的模式理解：" class="headerlink" title="生活当中的模式理解："></a>生活当中的模式理解：</h2><p>如果用生活的案例比喻的话，我们最为常见的网上购物便是一个很好的例子，我们在网络上进行网上购物的时候，通常是由购物平台与我们交互，当我们下订单并且要求商家发货之后，商家会联系仓库打包，银行扣款，送货员配送，物流运输…..这中间的所有步骤都与客户无关，客户需要关心什么时候会配送，以及需要支付多少钱即可。</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210303230136.png" alt="购物平台案例"></p><blockquote><p>从上面这个案例也可以看到，对于客户来说，最关心的门面这一块，如果购物平台崩溃，那么就直接无法交互，但是对于门面这一边来说，事情就比较复杂了，可以看到任何一个环节出错都有可能造成无法满足客户的要求，门面几乎是与所有的子系统连在了一起**。</p></blockquote><h2 id="外观模式的优缺点："><a href="#外观模式的优缺点：" class="headerlink" title="外观模式的优缺点："></a>外观模式的优缺点：</h2><p>优点：</p><ol><li>让接口方法更加简单，将子系统与外界交互的任务进行聚合</li><li>统一子系统，提供门户并且整合子系统的方法</li></ol><p>缺点：</p><ol><li>子系统的任意改动加直接影响外观接口的行为，同时外观的接口方法变动也可能出现意想不到的情况</li><li>外观类的接口修改对于程序的影响较大，同时不符合“开放-关闭”的原则</li></ol><h2 id="外观模式的特点："><a href="#外观模式的特点：" class="headerlink" title="外观模式的特点："></a>外观模式的特点：</h2><ul><li>外观模式通常只需要一个 <strong>单例</strong>的类就足够了，因为在遵从迪米特</li><li>外观更像是与所有子系统绑定的顶层系统</li></ul><h2 id="外观模式和适配器模式的关系"><a href="#外观模式和适配器模式的关系" class="headerlink" title="外观模式和适配器模式的关系"></a>外观模式和适配器模式的关系</h2><pre><code>外观模式和适配器模式有点儿像，但是实际上两者侧重点是完全不一样的，**外观的意图是包装接口，而适配器的意图是转换大量的接口**</code></pre><h2 id="外观模式和迪米特原则"><a href="#外观模式和迪米特原则" class="headerlink" title="外观模式和迪米特原则"></a>外观模式和迪米特原则</h2><h3 id="什么是迪米特原则？"><a href="#什么是迪米特原则？" class="headerlink" title="什么是迪米特原则？"></a>什么是迪米特原则？</h3><p>一个类应该只知道最少的事情。意味着接口的职责应该越简单越好。</p><h3 id="外观模式是对迪米特法则最好应用"><a href="#外观模式是对迪米特法则最好应用" class="headerlink" title="外观模式是对迪米特法则最好应用"></a>外观模式是对迪米特法则最好应用</h3><p>由于外观模式将子系统当中大量复杂的类和方法进行整合，将所有的子系统功能结合到了自己的门面当中对外使用。所以外观模式是最能体现迪米特法则的一种设计模式。</p><h1 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h1><h2 id="外观模式另一种使用方式："><a href="#外观模式另一种使用方式：" class="headerlink" title="外观模式另一种使用方式："></a>外观模式另一种使用方式：</h2><pre><code>下面的内容来自《How tomcat work》这本书的一个章节，我们忽略关于`HttpRequest`和`HttpResponse`以及处理http请求的所有细节部分。来看看外观模式的一种巧妙的用法这次的案例比较特殊，我们直接从servlet开始。（一）我们先从servlet入手，我们先来看一下`servlet`这个接口的定义，我们重点关注`service`这个方法：</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Servlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig var1)</span> <span class="keyword">throws</span> ServletException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ServletConfig <span class="title">getServletConfig</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重点关注</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest var1, ServletResponse var2)</span> <span class="keyword">throws</span> ServletException, IOException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">getServletInfo</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>（二）接着我们依照上面这个接口方法的要求，动手实现一个我们自己的`HttpRequest`和`HttpResponse`，对于下面的两个类，我们不需要关注细节，只需要大概看一眼一些方法和实现。</code></pre><p>HttpRequest.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpRequest</span> <span class="keyword">implements</span> <span class="title">ServletRequest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 缓冲区的大小为 1M</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BUFFER_COUNT = <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 请求路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String uri;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 请求流</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> InputStream inputStream;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HttpRequest</span><span class="params">(InputStream inputStream)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.inputStream = inputStream;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解析inputstream 对于内容进行解析</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">parse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 字符串缓冲池</span></span><br><span class="line">        StringBuffer stringBuffer = <span class="keyword">new</span> StringBuffer(BUFFER_COUNT);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] byteBuffer = <span class="keyword">new</span> <span class="keyword">byte</span>[BUFFER_COUNT];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (inputStream == <span class="keyword">null</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">"未找到套接字"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> read = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 读取数据到byte数组</span></span><br><span class="line">            read = inputStream.read(byteBuffer);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.exit(-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//读取byte数组的数据进入到stringbuffer</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; read; i++) &#123;</span><br><span class="line">            stringBuffer.append((<span class="keyword">char</span>)byteBuffer[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 打印stringbuffer</span></span><br><span class="line">        System.err.println(stringBuffer.toString());</span><br><span class="line">        <span class="comment">// 获取uri</span></span><br><span class="line">        uri = parseUri(stringBuffer.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解析请求，获取请求Uri</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> requestString 需要处理的uri</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">parseUri</span><span class="params">(String requestString)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 建立index1 和 2</span></span><br><span class="line">        <span class="keyword">int</span> index1, index2;</span><br><span class="line">        <span class="comment">// 获取到第一个空行</span></span><br><span class="line">        index1 = requestString.indexOf(<span class="string">' '</span>);</span><br><span class="line">        <span class="keyword">if</span>(index1 != -<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="comment">// 从index1 开始找</span></span><br><span class="line">            index2 = requestString.indexOf(<span class="string">' '</span>, index1 + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(index2 &gt; index1)&#123;</span><br><span class="line">                <span class="comment">// 获取请求路径</span></span><br><span class="line">                <span class="keyword">return</span> requestString.substring(index1 + <span class="number">1</span>, index2);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此处省略大量覆写方法</span></span><br><span class="line">    <span class="comment">//.....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>HttpResponse.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpResponse</span> <span class="keyword">implements</span> <span class="title">ServletResponse</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 组合httprequest</span></span><br><span class="line"><span class="comment">     * 根据request返回对应到信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> HttpRequest request;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出流</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> OutputStream outputStream;</span><br><span class="line"></span><br><span class="line">    PrintWriter writer;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 缓冲区大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BUFFER_COUNT = <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HttpResponse</span><span class="params">(OutputStream outputStream)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.outputStream = outputStream;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置静态资源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setResource</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String errMsg = <span class="string">"404 msg"</span>;</span><br><span class="line">        <span class="comment">// 字节缓存区</span></span><br><span class="line">        <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[BUFFER_COUNT];</span><br><span class="line">        <span class="comment">// 读取静态资源</span></span><br><span class="line">        File file = <span class="keyword">new</span> File(Constants.WEBROOT, request.getUri());</span><br><span class="line">        <span class="keyword">if</span> (file.exists()) &#123;</span><br><span class="line">            <span class="comment">// 文件流</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                FileInputStream fileInputStream = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">                <span class="comment">// 读取字节</span></span><br><span class="line">                <span class="keyword">int</span> ch = fileInputStream.read(bytes, <span class="number">0</span>, BUFFER_COUNT);</span><br><span class="line">                <span class="comment">// 输出</span></span><br><span class="line">                <span class="keyword">while</span> (ch != -<span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="comment">// 写入流</span></span><br><span class="line">                    outputStream.write(bytes, <span class="number">0</span>, ch);</span><br><span class="line">                    <span class="comment">// 重复读取数据到缓冲区</span></span><br><span class="line">                    ch = fileInputStream.read(bytes, <span class="number">0</span>, BUFFER_COUNT);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                System.err.println(e.getMessage());</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (outputStream != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    outputStream.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                outputStream.write(errMsg.getBytes());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (outputStream != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    outputStream.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 此处省略大量覆写方法</span></span><br><span class="line">    <span class="comment">//.....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>（三）我们定义了请求request和响应respnse之后，构建一个servlet处理器，来统一处理客户端发送过来的http请求，所以我们需要一个`ServletProcessor`处理器类：</code></pre><p>可以看到，下面的<code>servlet.service(requestFace, responseFace);</code>当中，使用的不是上面定义的<code>HttpRequest</code>和<code>HttpResponse</code>，而是使用了两个<code>RequestFace</code>和<code>ResponseFace</code>，这是为什么呢？</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServletProcess</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(HttpRequest request, HttpResponse response)</span> </span>&#123;</span><br><span class="line">        String uri = request.getUri();</span><br><span class="line">        String serveletName = uri.substring(uri.lastIndexOf(<span class="string">"/"</span>) + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 创建Url加载器</span></span><br><span class="line">        URL[] urls = <span class="keyword">new</span> URL[<span class="number">1</span>];</span><br><span class="line">        File classPath = <span class="keyword">new</span> File(Constants.WEBROOT);</span><br><span class="line">        URLClassLoader loader = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            URLStreamHandler streamHandler = <span class="keyword">null</span>;</span><br><span class="line">            String repository = (<span class="keyword">new</span> URL(<span class="string">"file"</span>, <span class="keyword">null</span>, classPath.getCanonicalPath() + File.separator)).toString();</span><br><span class="line">            urls[<span class="number">0</span>] = <span class="keyword">new</span> URL(<span class="keyword">null</span>, repository, streamHandler);</span><br><span class="line">            loader = <span class="keyword">new</span> URLClassLoader(urls);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.err.println(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        Class myclass = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            myclass = loader.loadClass(serveletName);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            System.err.println(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Servlet servlet = <span class="keyword">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//===== 下面的部分是重点 =====</span></span><br><span class="line">        <span class="comment">//使用face 封装</span></span><br><span class="line">        RequestFace requestFace = <span class="keyword">new</span> RequestFace(request);</span><br><span class="line">        ResponseFace responseFace = <span class="keyword">new</span> ResponseFace(response);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            servlet = (Servlet) myclass.newInstance();</span><br><span class="line">            servlet.service(requestFace, responseFace);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException | IllegalAccessException | ServletException | IOException e) &#123;</span><br><span class="line">            System.err.println(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>这两个外观类从代码上来看看起来是可有可无的存在，因为它看上去既没有影响代码的扩展（至少从处理器这一块看来）。我们先设想一下如果不使用这个外观会出现什么情况？我们通过`service()`方法，为`servlet`定义请求的处理的整个细节，但是很显然，**我们暴露了`HttpRequest`和`HttpResponse`**，如果servlet在处理完成之后，将这两个对象分发给外部系统，那么就意味着外部系统可以通过这两个对象直接拿到整个servlet进而可以设法窥探到请求的细节并且寻找漏洞！！！这里加入外观类的作用就是为了保护我们上面所述的两个对象，接着再公布一下外观类的方法，就可以很清楚的了解到这样做的效果：</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestFace</span> <span class="keyword">implements</span> <span class="title">ServletRequest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ServletRequest servletRequest;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RequestFace</span><span class="params">(HttpRequest servletRequest)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.servletRequest = servletRequest;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestFace</span> <span class="keyword">implements</span> <span class="title">ServletRequest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ServletRequest servletRequest;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RequestFace</span><span class="params">(HttpRequest servletRequest)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.servletRequest = servletRequest;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//.... 省略一堆方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从代码结构来看，这一块代码的行为和<code>装饰器模式</code>有点儿相似的意思，但是实际上两者的思考方式是完全不相干的，装饰器模式是隐蔽的为目标类更多的功能侧重于让整个对象的某种行为得到更好的加强，而<code>外观模式</code>则更加突出在于隐蔽子系统的一些内部细节，这里的代码很好的体现了这一点，当使用了门面之后，诸如<code>HttpRequest</code>当中的<code>parse()</code>被外观的设计很好的隐藏了起来，即使拿到外观对象，也无法直接访问<code>HttpRequest</code>，外观在这里充当了一层保护层</p><h1 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h1><p>外观模式算是整个设计模式当中最好理解的一个设计模式，他在系统当中的应用还是十分重要的，外观有点像披着“羊皮”的狼，看似简单的接口背后，却是隐藏着各种丰富的接口和功能。</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      外观模式整合了许多的接口
    
    </summary>
    
    
      <category term="设计模式" scheme="https://whitestore.top/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="设计模式" scheme="https://whitestore.top/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>浅谈设计模式 - 适配器模式（八）</title>
    <link href="https://whitestore.top/2021/03/07/adaptermethod/"/>
    <id>https://whitestore.top/2021/03/07/adaptermethod/</id>
    <published>2021-03-07T09:03:56.000Z</published>
    <updated>2021-03-07T11:23:29.955Z</updated>
    
    <content type="html"><![CDATA[<h1 id="浅谈设计模式-适配器模式（八）"><a href="#浅谈设计模式-适配器模式（八）" class="headerlink" title="浅谈设计模式 - 适配器模式（八）"></a>浅谈设计模式 - 适配器模式（八）</h1><h1 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h1><p>适配器模式大概是系统用的最多的模式，在<code>spring</code>框架当中可以看到他的各种应用，比如我们想要注册自己的拦截器，或者需要沿用旧接口完成一些自己的实现，都可以使用适配器模式进行实现，适配器模式是一种非常贴合<strong>最少知识原则</strong>的设计模式，这篇文章将会详细介绍一下适配器模式。</p><h2 id="文章目的："><a href="#文章目的：" class="headerlink" title="文章目的："></a>文章目的：</h2><ol><li>了解什么是适配器模式</li><li>适配器模式的优缺点</li><li>实战，了解适配器模式</li></ol><a id="more"></a><h1 id="什么是适配器模式？"><a href="#什么是适配器模式？" class="headerlink" title="什么是适配器模式？"></a>什么是适配器模式？</h1><p>定义：在不改动客户代码的情况下实现一个接口向另一个接口的自由转化，让原本不能适配的接口具备相似的功能。</p><p>适配器存在三个角色，客户端，适配器，被适配者。适配器实现目标的接口，并且持有被适配者的实例</p><p>适配器模式是一种：<strong>行为型模式</strong>。因为他将一个接口的行为转化为另一个接口的行为。</p><h1 id="适配器模式优缺点："><a href="#适配器模式优缺点：" class="headerlink" title="适配器模式优缺点："></a>适配器模式优缺点：</h1><p>先说说适配器模式的优点：</p><ol><li>可以让客户从接口的实现当中解放</li><li>让客户由原本的面向实现转变为面向接口</li><li>让被适配对象具备接口功能的同时可以实现自由的扩展</li></ol><p>下面说说缺点，其实适配器的缺点也比较明显：</p><ol><li>由于JAVA不支持多继承，无法完成多个对象的适配工作，只能使用多接口的形式适配，实现起来要比其他的语言稍微复杂一些。</li><li>适配器最难改动的地方在于适配目标的方法，假设适配目标的方法组合了多个被适配对象，此时改动任意一个被适配对象，都会对适配的方法带来影响，同时适配方法也是最难以改动的。</li></ol><blockquote><p>关于适配器使用的建议：</p><ol><li>一个适配器最好做一个类的适配工作。</li><li>如果一个适配器需要适配多个类，需要考虑是否存在关联性</li><li><strong>可以使用双向接口适配器，既可以实现旧接口的方法不改动，同时实现新接口的新实现。要做到这一步，关键是确保：两个接口</strong></li></ol></blockquote><h1 id="使用继承还是使用组合"><a href="#使用继承还是使用组合" class="headerlink" title="使用继承还是使用组合"></a>使用继承还是使用组合</h1><pre><code>对于适配这一个概念，我们可以使用两种形式：**继承** 和 **组合**首先说下继承，继承是指对于一个类进行“超类”的扩展，如果此时我们使用继承的形式去扩展目标对象，虽然从理论上可以实现一个适配器直接具备两个对象的功能，但是由于JAVA本身是不支持多继承的，同时**多用组合，少用继承**是软件设计行业一条非常推崇的定律。所以继承的形式“不太友好”。再说下使用组合的形式，组合是比较推崇的形式，我们在实现目标接口的基础之上，组合被适配的对象，让旧接口的功能可以兼容新接口的实现。这也是JAVA代码当中经常会见到的一种形式，同时在框架中以类似“套版”的形式出现。</code></pre><h1 id="适配器模式的特点："><a href="#适配器模式的特点：" class="headerlink" title="适配器模式的特点："></a>适配器模式的特点：</h1><p><strong>适配器的实现就是把客户类的请求转化为对适配者的相应接口的调用</strong>，当客户端进行请求的时候，目标对象通过适配器，将请求的逻辑转变为“适合”被适配对象的请求，由适配器完成这一转化细节，适配过后执行被适配对象的功能，这种转化对于客户端来说是隐蔽的，同时会让客户端误认为是目标对象完成的了工作，所以这种模式的最大特点是：<strong>请求代码可以完全不需要改变</strong>。</p><h1 id="适配器模式理解"><a href="#适配器模式理解" class="headerlink" title="适配器模式理解"></a>适配器模式理解</h1><p>下面根据适配器模式，介绍一下个人对于适配器模式的一些理解。</p><h2 id="从插头引申适配器模式"><a href="#从插头引申适配器模式" class="headerlink" title="从插头引申适配器模式"></a>从插头引申适配器模式</h2><pre><code>插头有很多中规范，但是日常生活常用的插头一般是两孔或者三孔的插头，一般情况下一个新厂商的插头需要兼容旧厂商生产的插头，同时需要兼容旧厂商的方法，不想改变旧厂商的实现情况下，需要实现新厂商的实现，这时候通常需要依赖一个适配器去做适配，适配器如同一个中间通信人，可以将看起来毫不相干的两个对象之间产生一定的关联特性。</code></pre><h2 id="单向适配和双向适配"><a href="#单向适配和双向适配" class="headerlink" title="单向适配和双向适配"></a>单向适配和双向适配</h2><pre><code>需要注意的是适配器模式一定不要教条的认为只能单向的适配，适配器是可以进行双向适配的，但是此时我们通常需要**两个接口**来完成双向的适配。</code></pre><h2 id="适配器模式和最少知识原则"><a href="#适配器模式和最少知识原则" class="headerlink" title="适配器模式和最少知识原则"></a>适配器模式和最少知识原则</h2><p>适配器模式对应的一个软件设计原则是：<strong>最少知识原则</strong></p><p>最少知识原则：接口负责尽可能少的功能。用白话来讲就是<strong>简洁</strong></p><h3 id="遵循最少知识原则"><a href="#遵循最少知识原则" class="headerlink" title="遵循最少知识原则"></a>遵循最少知识原则</h3><p>对于任何对象，在他的方法内他应该做这些事情</p><ul><li>只操作对象自己本身</li><li>传递的对象参数或者和该对象返回的结果对象（但是会有依赖传递的问题）</li><li>方法本身创建的对象</li><li>对象的任何组件：HAS-A（组合）的内部对象</li></ul><blockquote><p>这里需要小心依赖磁铁，也就是依赖了依赖对象的对象，简单理解就是使用了其他对象返回的另一个对象，这种情况很容易被忽视，而且通常情况下是 <strong>不会出现问题</strong>的，但是一旦要进行重构，这种代码就很容易造成逻辑混乱。</p></blockquote><h2 id="适配器的调用流程"><a href="#适配器的调用流程" class="headerlink" title="适配器的调用流程"></a>适配器的调用流程</h2><ol><li>客户端通过目标接口调用适配器的方法发送对应的请求。</li><li>适配器用适配方法转化为一个或者多个被适配器的多种方法</li><li>客户端得到的接口会误以为是目标对象在工作。同时不需要进行任何变动就可以实现新的功能或者方法。</li></ol><h1 id="适配器模式的结构图"><a href="#适配器模式的结构图" class="headerlink" title="适配器模式的结构图"></a>适配器模式的结构图</h1><p>下面是适配器模式的结构图：</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210301230256.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+ client 客户端</span><br><span class="line">+ Target 目标接口，</span><br><span class="line">+ Adapter 适配器，负责将两个对象进行关联，产生相似的业务</span><br><span class="line">+ Appropriate object 被适配对象,代表了需要适配的对象内容</span><br></pre></td></tr></table></figure><p>上面的结构图展示了如何目标接口转化为被适配对象的行为。</p><h1 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h1><p>说了不少的理论内容，下面我们根据一个模拟场景制定一份适配器的代码：</p><h2 id="模拟场景"><a href="#模拟场景" class="headerlink" title="模拟场景"></a>模拟场景</h2><pre><code>在任天堂发售的`switch`在日版和港版的两个版本当中，充电充电器的设计是不一样的，由于港版沿用了英国使用的是三插式（大部分电器都是这种情况），而我国使用的是较为通用二插式，日本在设计的时候也是使用二插式，所以在充电器的设计下，日本不需要进行适配，直接可以插到我国的插座上，而港版通常需要购买转接头或者买其他的适配器。</code></pre><h2 id="不使用设计模式"><a href="#不使用设计模式" class="headerlink" title="不使用设计模式"></a>不使用设计模式</h2><pre><code>笔者在构思这一块没有考虑好不使用设计模式如何实现，其实这种情况下，不使用设计模式最好办法通常就是找一个第三方工具进行替代，比如我们可以买一个switch的充电宝，每次充电只要充充电宝就行了，连充电器都省了......</code></pre><h2 id="使用设计模式"><a href="#使用设计模式" class="headerlink" title="使用设计模式"></a>使用设计模式</h2><pre><code>还是直接从设计模式开干把，很显然，既然港版都是用的转接头，那么我们的代码就使用转接头来实现这一块的功能：</code></pre><p>下面是根据模拟场景进行分析，我们依照适配器的结构设计出基本对象：</p><ul><li>switch：我们姑且把它想象是客户端，我们把它想象成一个想要充电的“人”。发起了充电这一个请求来匹配合适的充电器</li><li>JapanMouth：日版充电器，直接对标国内的插口</li><li>Mouth：插口接口。</li><li>EngMouth：英式插口，按照英国的标准设计的插口。</li><li>Adapter：适配器，在这里充当的是转接器，负责转接插口</li></ul><p>有了上面这些定义，下面根据具体的设计出代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Switch</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TwoHoleCharge twoHoleCharge;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Switch</span><span class="params">(TwoHoleCharge twoHoleCharge)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.twoHoleCharge = twoHoleCharge;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模拟充电方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">recharge</span><span class="params">()</span></span>&#123;</span><br><span class="line">        twoHoleCharge.jack();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TwoHoleCharge <span class="title">getTwoHoleCharge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> twoHoleCharge;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTwoHoleCharge</span><span class="params">(TwoHoleCharge twoHoleCharge)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.twoHoleCharge = twoHoleCharge;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 插口接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Mouth</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">jack</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JapanMouth</span> <span class="keyword">implements</span> <span class="title">Mouth</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jack</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"日版：开始充电"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EngMouth</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">specialJack</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"港版：开始充电"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//==关键==适配器</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">implements</span> <span class="title">Mouth</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> EngMouth engMouth;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Adapter</span><span class="params">(EngMouth engMouth)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.engMouth = engMouth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        engMouth.specialJack();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 日版插口可以直接使用</span></span><br><span class="line">        Mouth mouth = <span class="keyword">new</span> JapanCharge();</span><br><span class="line">        Switch aSwitch = <span class="keyword">new</span> Switch(mouth);</span><br><span class="line">        aSwitch.recharge();</span><br><span class="line">        <span class="comment">// 港版插口需要转接口</span></span><br><span class="line">        Mouth mouth2 = <span class="keyword">new</span> Adapter(<span class="keyword">new</span> EngMouth());</span><br><span class="line">        aSwitch.setMouth(mouth2);</span><br><span class="line">        aSwitch.recharge();</span><br><span class="line">    &#125;<span class="comment">/*运行结果：</span></span><br><span class="line"><span class="comment">    日版：开始充电</span></span><br><span class="line"><span class="comment">    港版：开始充电</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码比较简单，应该比较好理解，这里重点关注一下<code>Adapter</code>的适配器对象，通过组合的形式，将被适配对象“隐藏”到了目标对象的方法内部，实现了接口的适配，客户在使用的时候，只需要用一个适配器就可以让港版可以直接兼容到国内的电网。</p><p>当然，在现实生活中使用适配器其实比较麻烦，因为总要多带点东西，比如我个人就比较反感现在的手机都把耳机孔给削掉了，出门用个有线听歌还得买个转接口……</p><h2 id="总结案例"><a href="#总结案例" class="headerlink" title="总结案例"></a>总结案例</h2><p>适配器的案例生活中还是十分常见的，可以举出许许多多的场景出来，同时不需要考虑过多的其他因素，适配器非常贴合“开放-关闭”的原则，对于修改进行了开放，对于原有的代码没有进行修改，然开发人员只需要关注如何适配，而不需要太关心原来的实现，</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><pre><code>适配器模式是一个重点模式，他可以实现在不改动旧代码的基础上对于一个目标对象进行二次扩展和升级，并且只需要付出很小的代价就可以完成很多自定义的操作，总体上来说，适配器的弊端在实际的编码过程中往往被规范化的设计而弱化，当然，更多的使用场景可能还是在框架当中，因为框架中使用适配器是一种很常见的行为。</code></pre><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      适配器是一种新瓶装酒的设计模式
    
    </summary>
    
    
      <category term="设计模式" scheme="https://whitestore.top/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="设计模式" scheme="https://whitestore.top/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>浅谈设计模式 - 命令模式（七）</title>
    <link href="https://whitestore.top/2021/03/07/command/"/>
    <id>https://whitestore.top/2021/03/07/command/</id>
    <published>2021-03-07T09:03:43.000Z</published>
    <updated>2021-03-07T11:22:04.771Z</updated>
    
    <content type="html"><![CDATA[<h1 id="浅谈设计模式-命令模式（七）"><a href="#浅谈设计模式-命令模式（七）" class="headerlink" title="浅谈设计模式 - 命令模式（七）"></a>浅谈设计模式 - 命令模式（七）</h1><h1 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h1><p>命令模式也是一种比较常见的行为型模式，可以想象我们的手机智能遥控器，通过按动按钮的形式开启各种家具，说白了，就是将一系列的请求命令封装起来，不直接调用真正执行者的方法，这样比较好扩展。需要注意的是命令模式和策略模式相似，所以有时候可能容易弄混，这篇文章将会详细介绍命令模式。</p><a id="more"></a><h1 id="文章目的："><a href="#文章目的：" class="headerlink" title="文章目的："></a>文章目的：</h1><ol><li>了解命令的模式的特点</li><li>简单对比命令模式和策略模式</li><li>命令模式的优缺点总结</li></ol><h1 id="什么是命令模式？"><a href="#什么是命令模式？" class="headerlink" title="什么是命令模式？"></a>什么是命令模式？</h1><p>解释：把“请求”封装为对应的对象，使用不同的请求参数化对象，命令模式支持撤销撤销的操作</p><p>命令模式是一种行为型模式，实现了接口调用对象和返回对象，用命令对象作为桥梁实现调用者和具体实现者之间的解耦和交互。</p><h1 id="命令模式的特点："><a href="#命令模式的特点：" class="headerlink" title="命令模式的特点："></a>命令模式的特点：</h1><ul><li>将发出请求的对象和执行请求的对象解耦</li><li>调用者可以自由定义命令参数进行自由的组合</li><li>命令可以用来实现日志或者<strong>事务系统</strong>（undo操作）</li></ul><h1 id="命令模式结构图："><a href="#命令模式结构图：" class="headerlink" title="命令模式结构图："></a>命令模式结构图：</h1><p>下面根据命令模式的定义，以及上面对于命令模式的理解，构建具体的结构图</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210222141114.png" alt=""></p><p>+ <strong>Client 客户端：</strong>客户端需要创建具体的命令类，并且通过发送请求给执行者调用具体的对象，发送方和接收方不存在关联，统一由命令对象进行连接。</p><p>+ <strong>Invoker 执行者</strong>：请求的发送者，负责将请求分发给具体的命令实现类，由实现类调用实际的执行者进行执行操作</p><p>+ <strong>Command 接口：</strong>命令接口，定义命令的规范</p><p>+ <strong>ConcreteCommand 命令接口实现类</strong>：实现命令的同时组合具体对象。</p><p>+ <strong>ConcreteObject 具体实现类</strong>：定义截图的实现生产对象。</p><p>+ <strong>Receive 执行者</strong>：请求的真正执行者，可以是任意对象，通常以 <strong>组合</strong>形式出现在执行者的内部</p><h1 id="命令模式的理解"><a href="#命令模式的理解" class="headerlink" title="命令模式的理解"></a>命令模式的理解</h1><p>这里参考<strong>《Head firtst设计模式》</strong>的案例，模拟具体的交互流程</p><h2 id="对象村餐厅交互过程"><a href="#对象村餐厅交互过程" class="headerlink" title="对象村餐厅交互过程"></a>对象村餐厅交互过程</h2><p>我们到餐厅点餐，一般会经历如下的流程</p><ol><li><p>客人负责下订单，由服务员接受订单</p></li><li><p>服务器接收订单，调用订单柜台的下订单的方法，不需要关注细节</p></li><li><p>订单柜台通知厨师进行生产</p></li><li><p>厨师生产订单物品之后，交给服务员上菜</p></li></ol><p>根据上面的步骤利用伪代码的表现如下：</p><ul><li><code>createCommandObject()</code> 构建命令对象</li><li><code>setCommand()</code> 传递命令</li><li><code>execute()</code> 命令执行</li><li><code>action1()</code>，<code>action2()</code> 执行者实际执行</li></ul><h2 id="交互流程图"><a href="#交互流程图" class="headerlink" title="交互流程图"></a>交互流程图</h2><p>我们根据上面的交互过程介绍，构建具体的交互流程图，我们可以看到里面有角色：<code>客人</code>、<code>服务员</code>、<code>订单柜台</code>、<code>厨师</code>，他们本身并没有关联，而是通过餐厅的形式彼此产生了具体的关联，同时我们对比上面的结构图，看下对象村餐厅对应的结构图：</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210224115250.png" alt=""></p><p>下面根据结构图说一下各种角色的职责：</p><p>客人：相当于client客户端，负责指挥服务员进行下单的操作。</p><p>服务员：充当请求的发送者，接受客户端的请求，调用下订单的接口到具体的订单柜台，但是不需要关心具体的细节，只具备下订单这一个操作</p><p>订单柜台：通过服务员传递的订单，安排厨师执行具体的任务</p><p>厨师：根据订单柜台的订单做菜，将结果返回给服务员（或客人）</p><p>我们从上面的角色图再来看具体的命令模式定义，可以看到基本都是一一对应的情况。</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210222141114.png" alt=""></p><h1 id="命令模式和策略模式的对比"><a href="#命令模式和策略模式的对比" class="headerlink" title="命令模式和策略模式的对比"></a>命令模式和策略模式的对比</h1><p>命令模式和策略模式的结构图有些许的类似，下面我们来对比看一下这两张图的异同：</p><p>策略模式结构图：</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210126230854.png" alt="策略模式"></p><p>命令模式结构图：</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210222141114.png" alt="命令模式"></p><p>相同点：</p><ol><li>命令模式通过定义命令规范接口，由子类实现命令的执行细节，策略同样定义策略行为同时用子类实现不同的策略功能</li><li>命令模式和策略都解耦了请求的发送者和执行者</li></ol><p><strong>不同点：</strong></p><ol><li>命令模式利用了命令组合执行对象的形式执行实现具体实现，而策略模式依靠上下文对象进行切换</li><li>策略模式针对某个对象实现不同的策略效果，而命令模式关注请求发送者和实现者之间的业务解耦组合</li></ol><h1 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h1><h2 id="模拟场景："><a href="#模拟场景：" class="headerlink" title="模拟场景："></a>模拟场景：</h2><pre><code>这次的案例还是模拟《Head First》设计模式的当中对于遥控器遥控电器的一个案例，我们定义如下的内容：</code></pre><p>遥控器：命令的发送方，负责根据不同的操作按钮调用不同的设备工作，生成具体的命令对象调用接口执行具体的命令</p><p>命令接口：负责定义命令的实现规范，充当遥控器里面的每一个按钮，对应都有具体的实现</p><p>命令实现类：负责实现命令的接口，同时调用具体的实现对象执行命令</p><p>实现对象：命令的真正执行者，一般夬在命令实现类的内部，比如电视，灯泡等</p><h2 id="不适用设计模式"><a href="#不适用设计模式" class="headerlink" title="不适用设计模式"></a>不适用设计模式</h2><p>在不使用设计模式的情况下，我们通常通过对象组合的形式组合不同的实体对象执行命令，下面通过一些简单的代码说明一下设计的弊端：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 灯泡</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Light</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">on</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"打开灯光"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">off</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"关闭灯光"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 电视机</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Television</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">on</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"打开电视"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">off</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"关闭电视"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 遥控器</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RemoteControl</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Light light;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Television television;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RemoteControl</span><span class="params">(Light light, Television television)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.light = light;</span><br><span class="line">        <span class="keyword">this</span>.television = television;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">button1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        light.on();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">button2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        television.on();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 单元测试</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Television television = <span class="keyword">new</span> Television();</span><br><span class="line">        Light light = <span class="keyword">new</span> Light();</span><br><span class="line">        RemoteControl remoteControl = <span class="keyword">new</span> RemoteControl(light, television);</span><br><span class="line">        remoteControl.button1();</span><br><span class="line">        remoteControl.button2();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="comment">/*运行结果：</span></span><br><span class="line"><span class="comment">打开灯光</span></span><br><span class="line"><span class="comment">打开电视</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>从上面的简单代码可以看到，如果我们继续增加电器，同时增加方法，不仅会导致遥控器要随着电器的改动不断改动，同时每次新增一个电器，遥控器要进行类似“注册”的行为，需要将电器<strong>接入</strong>到遥控器，这样显然是不符合逻辑的，因为我们都知道，遥控器是单纯的指挥者，他不参与任何命令的操作细节，同时虽然真正工作的方法是具体对象的方法，但是这种形式类似将电器“塞”到了遥控器的内部执行，这样也是存在问题，我们下面需要修改一下这种严重耦合的设计。</p><h2 id="使用命令模式改写："><a href="#使用命令模式改写：" class="headerlink" title="使用命令模式改写："></a>使用命令模式改写：</h2><p>我们按照命令模式的结构图，改写案例，我们需要定义下面的类和对应的接口：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+ RemoteControl 遥控器</span><br><span class="line">+ Command(接口) 命令规范接口，用于接入到遥控器内部</span><br><span class="line">+ LightCommandConcrete 控制电器的亮灭命令实现</span><br><span class="line">+ SwitchCommandConcrete 控制电器的开关命令实现</span><br><span class="line">+ Light 灯泡</span><br><span class="line">+ Television 电视机</span><br></pre></td></tr></table></figure><p>首先，我们定义命令的接口，定义接口的规范方法。然后定义实现子类实现不同命令的操作效果，在命令实现类的内部，我们组合实际执行对象，在接口方法调用实际的对象方法，这样就做到了执行者和发送者之间的解耦。</p><p>接着，我们改写控制器，他不在持有任何实际的对象方法，通过组合命令的接口，让客户端传入实现的功能，通过这种方式，遥控器不在需要依赖具体的电器实现调用具体方法，而是关注命令的接口方法，一切的细节都在命令的子类内部。</p><p>下面代码是依照命令模式进行的最简单的一个实现。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 命令接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 接口备份</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LightCommandConcrete</span> <span class="keyword">implements</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Light light = <span class="keyword">new</span> Light();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        light.on();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwitchCommandConcrete</span> <span class="keyword">implements</span> <span class="title">Command</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Television television = <span class="keyword">new</span> Television();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        television.on();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遥控器</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RemoteControl</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Command command;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RemoteControl</span><span class="params">(Command command)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.command = command;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>&#123;</span><br><span class="line">        command.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Command <span class="title">getCommand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> command;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCommand</span><span class="params">(Command command)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.command = command;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RemoteControl remoteControl = <span class="keyword">new</span> RemoteControl(<span class="keyword">new</span> LightCommandConcrete());</span><br><span class="line">        remoteControl.execute();</span><br><span class="line">        remoteControl.setCommand(<span class="keyword">new</span> SwitchCommandConcrete());</span><br><span class="line">        remoteControl.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>经过上面的代码改造，我们成功上面的代码改造为命令模式的代码，使用设计模式之后，我们将调用者和实际执行者进行了解耦，控制器不需要知道执行的细节，只需要组合自己的命令接口，由客户端指定希望实现的内容，执行相对应的具体命令。</p><h2 id="案例的额外扩展："><a href="#案例的额外扩展：" class="headerlink" title="案例的额外扩展："></a>案例的额外扩展：</h2><p>下面是对应案例如何进行后续的扩展，对于这部分内容文章篇幅有限，同时本着不重复造轮子的理念，请阅读<strong>《Head First设计模式》</strong>关于命令模式这一个章节，同时安利一下这本书，非常通俗易懂的讲解设计模式，对于个人的提升帮助很大。</p><h3 id="对于上面的设计，如何加入Undo的操作？"><a href="#对于上面的设计，如何加入Undo的操作？" class="headerlink" title="对于上面的设计，如何加入Undo的操作？"></a>对于上面的设计，如何加入<strong>Undo</strong>的操作？</h3><p>Undo是一个很常见的功能，如果想要让Undo的操作集成到案例内部，需要按照如下的步骤进行操作：</p><ol><li>Command 接口增加<code>Undo</code>的操作，让所有命令支持<code>undo</code></li><li>在控制器记录<strong>最后一个命令的执行对象</strong>，记录最后的操作命令，实现控制器支持undo操作</li><li>具体Command实现增加对于<code>undo()</code>方法调用，并且根据实际的组合对象调用方法</li><li>具体实现类实现<code>undo()</code>操作的具体行为效果。</li></ol><h3 id="如果undo里面，存在一些变量如何处理？"><a href="#如果undo里面，存在一些变量如何处理？" class="headerlink" title="如果undo里面，存在一些变量如何处理？"></a>如果undo里面，存在一些变量如何处理？</h3><p>在命令的实现类内部，需要增加一个<strong>最后变量值</strong>的记录，用于记录当前最后一步操作的属性和变量</p><h3 id="如何做到宏命令？"><a href="#如何做到宏命令？" class="headerlink" title="如何做到宏命令？"></a>如何做到宏命令？</h3><p>实现一个命令类，通过组合<strong>数组</strong>或者<strong>堆栈</strong>组合多个其他命令对象，通过for循环的形式依次调用。</p><p>undo也可以使用这种方式进行调用的，但是要注意**调用的顺序相反</p><h1 id="命令模式的优缺点："><a href="#命令模式的优缺点：" class="headerlink" title="命令模式的优缺点："></a>命令模式的优缺点：</h1><p>优点：</p><ul><li>命令模式实现了请求发送方和实现方解耦，不论是发送方还是接收方都不需要</li><li>命令模式可以实现不同实现对象的自由组合，通过命令组合可以实现一连串简单功能</li></ul><p>缺点：</p><ul><li>和策略模式类似，命令模式很容易造成子类的膨胀</li></ul><h1 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h1><pre><code>命令模式是一种非常常见的设计模式，这种模式更多的关注点是解耦请求的发送方和实现方，命令模式在系统设计中使用还是十分常见的，是一种值得关注的设计模式。</code></pre><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      命令模式解耦了请求发送者和接受者
    
    </summary>
    
    
      <category term="设计模式" scheme="https://whitestore.top/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="设计模式" scheme="https://whitestore.top/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>浅谈设计模式 - 工厂模式（六）</title>
    <link href="https://whitestore.top/2021/03/07/factorymethod2/"/>
    <id>https://whitestore.top/2021/03/07/factorymethod2/</id>
    <published>2021-03-07T08:50:34.000Z</published>
    <updated>2021-03-07T11:20:55.709Z</updated>
    
    <content type="html"><![CDATA[<h1 id="浅谈设计模式-工厂模式（六）"><a href="#浅谈设计模式-工厂模式（六）" class="headerlink" title="浅谈设计模式 - 工厂模式（六）"></a>浅谈设计模式 - 工厂模式（六）</h1><h2 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h2><pre><code>在第一篇里面已经介绍过简单工厂了，但是工厂模式里面不仅仅是简单工厂，还存在工厂方法和抽象工厂，并且从严格意义来讲简单工厂不能算是一种设计模式，本次的文章针对工厂的进化来展开讲一讲工厂模式的三种常见形式：简单工厂、工厂方法、抽象工厂。</code></pre><h2 id="文章目的"><a href="#文章目的" class="headerlink" title="文章目的"></a>文章目的</h2><ol><li>了解简单工厂这种代码编写形式的优点，回顾工厂模式</li><li>了解如何从简单工厂扩展到工厂方法以及抽象工厂</li><li>对比工厂方法和抽象工厂的异同。</li><li>总结简单工厂，工厂方法和抽象工厂，对比优缺点和特点</li></ol><a id="more"></a><h2 id="如何辨别工厂模式"><a href="#如何辨别工厂模式" class="headerlink" title="如何辨别工厂模式"></a>如何辨别工厂模式</h2><p>工厂模式一般从类的命名就可以直接看到含义，所以一般情况下很容易看出工厂模式的应用。</p><ul><li>工厂模式主要是负责对象的创建</li><li>无论是创建者还是使用者，都是针对一个抽象对象的实现。</li><li>工厂模式最关注的是对象是如何创建的而不是对象的使用。它针对的是创建这一个过程。</li></ul><h2 id="工厂模式的具体介绍"><a href="#工厂模式的具体介绍" class="headerlink" title="工厂模式的具体介绍"></a>工厂模式的具体介绍</h2><h3 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a>简单工厂模式</h3><p>简单工厂模式的介绍：<span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82OTIyMDY1NzkyNjQ1MjAxOTM0" title="https://juejin.cn/post/6922065792645201934">https://juejin.cn/post/6922065792645201934<i class="fa fa-external-link"></i></span></p><p>之前文章已经介绍过简单工厂模式，我们直接看一下简单工厂是如何设计的，从严格的意义上来说，简单工厂是一种良好的“编程习惯”，他很好的解耦了创建对象和使用对象这两个不同的过程。做到“单一职责”的原则</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210214170935.png" alt="简单工厂"></p><p>从上面的图当中我们构建基本的工厂类和对应的实现子类以及对应的产品抽象类。</p><p>下面回顾一下简单工厂的优缺点</p><p>优点：</p><ol><li>使用创建工厂的方法，我们实现了获取具体对象和生产对象的解耦，由生产对象的工厂通过我们传入的参数生产对应的对象，调用方只需要传递需要生产的对象来实现具体的效果。</li><li>解耦了<strong>创建</strong>和<strong>被创建</strong>的过程。</li><li>根据不同的逻辑判断生成不同的具体对象。</li></ol><p>缺点：</p><ol><li>每增加一个工厂对象具体的实现类，就需要增加<code>if/else</code>不利于维护</li><li>大量的子类会造成工厂类的代码迅速膨胀和臃肿</li><li>简单工厂的方法一般处理简单的业务逻辑，如果创建逻辑复杂<strong>不建议</strong>使用。</li></ol><p>从上面的优缺点分析可以知道，简单工厂并不能完全解决对象的创建解耦，对于对象的创建细节容易造成耦合，同时如果创建的对象过多容易出现臃肿的工厂代码。</p><h3 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h3><p>工厂方法模式：定义了创建对象的接口方法，但是具体的创建过程由子类来决定。工厂方法将<strong>创建的过程延迟到子类</strong>，工厂方法是对简单工厂的扩展和升级，为了解决简单工厂破坏了“开放-关闭原则”的问题而做的改进。我们将具体的产品进行了抽象的同时，将创建对象的过程<strong>延迟到子类</strong>进行实现。</p><h4 id="工厂方法的结构图"><a href="#工厂方法的结构图" class="headerlink" title="工厂方法的结构图"></a>工厂方法的结构图</h4><p>下面为工厂方法的结构图，我们由简单工厂转变为工厂方法之后，工厂类定义增加了抽象的对象创建方法，由子类通过继承的方式实现工厂的抽象方法并且实现自己的构建过程。</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210216124726.png" alt="工厂方法"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+ Product 产品类，定义产品的公用方法和抽象类</span><br><span class="line">+ ConcreteProduct 产品的具体实现子类，包含具体产品的实现</span><br><span class="line">+ Factory 工厂类，定义工厂的创建方法以及需要子类继承实现的方法</span><br><span class="line">+ ConcreteFactory 工厂的实现类，由子工厂来决定生成的具体产品和定义生产的具体过程。</span><br></pre></td></tr></table></figure><h4 id="工厂方法的特点"><a href="#工厂方法的特点" class="headerlink" title="工厂方法的特点"></a>工厂方法的特点</h4><p>下面是工厂方法的具体特点</p><ul><li>创建的过程解耦到子类，由子类决定创建的过程和结果</li><li>具体的产品和工厂之间存在必要关联，同时可以使用任意子类产品进行替换</li><li>需要依靠<strong>继承</strong>的形式由子工厂来决定生产的过程，子类决定产品创建的结果</li></ul><blockquote><p>提醒：子类决定创建的结果并不是字面上的创建，而是由调用者决定的。子类决定的是具体针对哪一个实例进行生产，但是生成的具体结果还是控制在创建者的身上</p></blockquote><h4 id="简单工厂和工厂方法有什么区别"><a href="#简单工厂和工厂方法有什么区别" class="headerlink" title="简单工厂和工厂方法有什么区别"></a>简单工厂和工厂方法有什么区别</h4><ol><li>简单工厂是对产品的创建过程进行“封装”，同时创建新的产品必须改动工厂代码。</li><li>工厂方法是对简单工厂的升级，工厂方法可以控制具体对象的创建以及由子类来决定具体需要创建哪一个对象。</li><li>简单工厂只是单纯的解耦创建者和使用者，但是简单工厂无法改变创建的结果。</li></ol><h3 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h3><p>抽象工厂模式：提供接口，通过定义抽象方法的形式，通过实现具体工厂方法实现创建具体对象家族，同时不需要指定特殊的类。</p><p>抽象工厂的内部往往使用工厂方法进行实现，两者经常被弄混，从结构上来看，他们最大的区别在于工厂方法往往使用继承实现，而抽象工厂往往使用内部继承工厂方法的接口实现。区分工厂方法和抽象工厂也是工厂模式的学习关键。</p><h4 id="抽象工厂的结构图"><a href="#抽象工厂的结构图" class="headerlink" title="抽象工厂的结构图"></a>抽象工厂的结构图</h4><p>由于抽象工厂更像是对工厂方法的改进，我们定义抽象工厂的结构图，抽象工厂的结构相比工厂方法要复杂一些：</p><blockquote><p>可以参考抽象工厂和工厂方法的结构图，看看两者的异同</p></blockquote><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210216234144.png" alt="抽象工厂"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ FactoryInterface 抽象工厂接口，定义一批抽象对象的生产接口</span><br><span class="line"> + ConcreteFactoryA抽象工厂实现类A，实现抽象工厂接口。</span><br><span class="line"> + ConcreteFactoryB抽象工厂实现类B，实现抽象工厂接口。</span><br><span class="line">+ ProductA抽象产品A，定义公共的抽象方法或者公用属性</span><br><span class="line"> + ConcreteProductA具体实现产品A</span><br><span class="line"> + ConcreteProductA具体实现产品A</span><br><span class="line">+ ProductB抽象产品B，定义公共的抽象方法或者公用属性</span><br><span class="line"> + ConcreteProductB具体实现产品B</span><br><span class="line"> + ConcreteProductB具体实现产品B</span><br></pre></td></tr></table></figure><h4 id="抽象工厂的特点："><a href="#抽象工厂的特点：" class="headerlink" title="抽象工厂的特点："></a>抽象工厂的特点：</h4><ol><li>所有的具体工厂都实现同一个抽象工厂接口。</li><li>生产的结果实现类可以自由实现具体类或者其扩展类的实例。</li><li>抽象工厂的痛点在于扩展一个新的产品生产会造成所有的具体工厂的改动，也包含了产品类的变动。</li><li>抽象工厂往往包含了一系列的工厂方法</li></ol><h4 id="抽象工厂和工厂方法的区别"><a href="#抽象工厂和工厂方法的区别" class="headerlink" title="抽象工厂和工厂方法的区别"></a>抽象工厂和工厂方法的区别</h4><ol><li>抽象工厂定义抽象接口依靠子类实现创建的过程，而工厂方法针对子类实现具体的对象创建细节</li><li>工厂方法需要使用继承的手段实现工厂方法“埋藏”工厂创建具体对象的细节</li><li>工厂方法对于处理“独立”产品的创建非常有效，而抽象工厂往往用于处理生产多个存在关联的产品对象。</li></ol><h2 id="实际案例"><a href="#实际案例" class="headerlink" title="实际案例"></a>实际案例</h2><p>依旧参考坦克大战的案例，介绍如何改造坦克大战的具体代码。</p><h3 id="模拟场景"><a href="#模拟场景" class="headerlink" title="模拟场景"></a>模拟场景</h3><p> 依然以经典的任天堂游戏坦克大战为例，在进入游戏的关卡的时候，会出现我方的坦克和敌人的坦克，我方坦克和地方坦克不仅形状不同，而且很脆，但是敌人的坦克根据颜色需要打好几枪才会毁灭，那么如果用代码来模拟是什么样的呢？</p><h3 id="简单工厂实现："><a href="#简单工厂实现：" class="headerlink" title="简单工厂实现："></a>简单工厂实现：</h3><p>使用简单工厂实现的代码如下:</p><p>使用简单工厂类来管理坦克的创建过程，简单工厂顾名思义，就是简单的将创建对象的过程进行管理。</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210126000032.png" alt=""></p><p>增加工厂类 <code>TankFactory.java</code></p><p>用工厂来管理具体的坦克创建过程:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 坦克工厂，专门负责生产坦克</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zxd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/1/25 22:27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TankFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建坦克</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Tank <span class="title">createTank</span><span class="params">(String check)</span></span>&#123;</span><br><span class="line">        Tank tank = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(Objects.equals(check, <span class="string">"my"</span>))&#123;</span><br><span class="line">            tank = <span class="keyword">new</span> MyTank();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(Objects.equals(check, <span class="string">"mouse"</span>))&#123;</span><br><span class="line">            tank = <span class="keyword">new</span> MouseTank();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (Objects.equals(check, <span class="string">"big"</span>))&#123;</span><br><span class="line">            tank = <span class="keyword">new</span> BigTank();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"当前坦克不支持生产"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> tank;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面是对应的坦克以及坦克的子类实现</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 坦克的父类，定义坦克的行为</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zxd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/1/25 0:14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Tank</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 坦克hp</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> hp;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 坦克子弹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> List&lt;Object&gt; bullet;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移动的方法s</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 攻击</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">attack</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 停止</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我方的坦克继承坦克的父类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 我方坦克</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zxd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/1/25 21:58</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTank</span> <span class="keyword">extends</span> <span class="title">Tank</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyTank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 我方坦克假设只有一条命</span></span><br><span class="line">        hp = <span class="number">1</span>;</span><br><span class="line">        bullet = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">// 初始化添加三发子弹</span></span><br><span class="line">        bullet.add(<span class="keyword">new</span> Object());</span><br><span class="line">        bullet.add(<span class="keyword">new</span> Object());</span><br><span class="line">        bullet.add(<span class="keyword">new</span> Object());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">move</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.err.println(<span class="string">"移动"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">attack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.err.println(<span class="string">"攻击地方坦克"</span>);</span><br><span class="line">        <span class="comment">// ..弹出子弹</span></span><br><span class="line">        <span class="keyword">if</span>(bullet.size() == <span class="number">0</span>)&#123;</span><br><span class="line">            System.err.println(<span class="string">"没有子弹了"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        bullet.remove(bullet.get(bullet.size() -<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.err.println(<span class="string">"停止"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>敌人的坦克如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 老鼠坦克</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zxd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/1/25 22:02</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MouseTank</span> <span class="keyword">extends</span> <span class="title">Tank</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.err.println(<span class="string">"长得尖尖的，很像老鼠"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MouseTank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 坦克假设只有一条命</span></span><br><span class="line">        hp = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">this</span>).start();</span><br><span class="line">        bullet = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">// 初始化添加六发子弹</span></span><br><span class="line">        bullet.add(<span class="keyword">new</span> Object());</span><br><span class="line">        bullet.add(<span class="keyword">new</span> Object());</span><br><span class="line">        bullet.add(<span class="keyword">new</span> Object());</span><br><span class="line">        bullet.add(<span class="keyword">new</span> Object());</span><br><span class="line">        bullet.add(<span class="keyword">new</span> Object());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">move</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.err.println(<span class="string">"老鼠坦克移动"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">attack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.err.println(<span class="string">"老鼠坦克开枪"</span>);</span><br><span class="line">        <span class="comment">// ..弹出子弹</span></span><br><span class="line">        <span class="keyword">if</span> (bullet.size() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">"老鼠坦克没有子弹了"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 老鼠坦克一次性开两枪</span></span><br><span class="line">        bullet.remove(bullet.get(bullet.size() - <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.err.println(<span class="string">"停止"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="comment">// 一旦创建就开始移动</span></span><br><span class="line">            move();</span><br><span class="line">            <span class="comment">// 漫无目的开枪</span></span><br><span class="line">            attack();</span><br><span class="line">            attack();</span><br><span class="line">            <span class="comment">// 做完一轮操作歇一秒</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 随机停止</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">new</span> Random(<span class="number">100</span>).nextInt() % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                stop();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后编写单元测试如下，我们使用简单工厂生产出不同的坦克，但是客户端不需要纠结生产的细节：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 单元测试</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zxd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/1/25 22:15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 我们将生产坦克的过程全部交给了工厂来处理</span></span><br><span class="line"><span class="comment">     * 可能还是奇怪，这和刚才没有什么区别呀？</span></span><br><span class="line"><span class="comment">     * 我们来看下区别：</span></span><br><span class="line"><span class="comment">     * 1. 创建的过程没有了，虽然是一个简单的new，但是new的过程交给了工厂</span></span><br><span class="line"><span class="comment">     * 2. 我们后续如果要在坦克加入别的东西，只需要去改工厂类和具体的实现类，不需要该此处代码</span></span><br><span class="line"><span class="comment">     * 3. 如果不支持的操作，工厂还可以通知我们这样做不对</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        TankFactory tankFactory = <span class="keyword">new</span> TankFactory();</span><br><span class="line"></span><br><span class="line">        Tank my = tankFactory.createTank(<span class="string">"my"</span>);</span><br><span class="line">        Tank mouse = tankFactory.createTank(<span class="string">"mouse"</span>);</span><br><span class="line">        Tank big = tankFactory.createTank(<span class="string">"big"</span>);</span><br><span class="line">        <span class="comment">// 我要一个没有的设计过的坦克</span></span><br><span class="line">        Tank mybig = tankFactory.createTank(<span class="string">"mybig"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;<span class="comment">/*//</span></span><br><span class="line"><span class="comment">    运行结果：</span></span><br><span class="line"><span class="comment">    Exception in thread "main" 老鼠坦克移动</span></span><br><span class="line"><span class="comment">    巨型坦克移动</span></span><br><span class="line"><span class="comment">    老鼠坦克开枪</span></span><br><span class="line"><span class="comment">    巨型坦克开枪</span></span><br><span class="line"><span class="comment">    老鼠坦克开枪</span></span><br><span class="line"><span class="comment">    java.lang.UnsupportedOperationException: 当前坦克不支持生产</span></span><br><span class="line"><span class="comment">at com.headfirst.factory.use.TankFactory.createTank(TankFactory.java:27)</span></span><br><span class="line"><span class="comment">at com.headfirst.factory.use.Main.main(Main.java:33)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从上面的代码可以看到，对于坦克的创建和使用过程虽然进行解耦了，但是可以看到创建的过程耦合在了简单工厂的内部，工厂创建的方法耦合了过多的细节，同时如果需要创建新的产品需要改动工厂代码，这违背了开放-关闭原则。</p><p>针对上面的问题，我们显然需要使用工厂方法进行改良，我们让工厂的创建细节延迟到子类去实现，子类只需要关注创建的细节，不需要了解客户端的调用，下面我们针对上面的代码使用工厂方法进行改进。</p><blockquote><p>这种改动也符合开放-关闭原则</p></blockquote><h3 id="工厂方法实现："><a href="#工厂方法实现：" class="headerlink" title="工厂方法实现："></a>工厂方法实现：</h3><p>从简单工厂可以看出，如果每次修改产品都需要牵动工厂的代码改动，同时针对创建的过程都被“耦合”在单独的工厂创建方法内部，我们根据工厂方法的结构图看一下如何改进坦克大战的代码：</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210216124726.png" alt="工厂方法"></p><p>首先，我们需要依照工厂方法的定义，将原本的简单工厂类改造为具备工厂方法的工厂，在下面的代码当中，工厂类具备两个方法，一个用于创建具体的对象，由客户端调用，并且提供一个抽象的方法，由工厂子类实现并且定义具体的工厂生产过程。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 坦克工厂</span></span><br><span class="line"><span class="comment"> * 工厂增加抽象方法由子类进行构建</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zxd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/2/16 17:33</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">TankFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建坦克</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Tank <span class="title">createTank</span><span class="params">(String check)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createConcreteTankMethod(check);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构建具体产品过程的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> Tank <span class="title">createConcreteTankMethod</span><span class="params">(String check)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>子类不需要关心<code>createTank()</code>方法是如何运行的，只需要实现自己的工厂方法同时定义生产的细节提供支持即可。</p><p>下面的代码为我方坦克的生产工厂</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 我方坦克的创建工厂</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zxd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/2/16 14:28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OurTankFactory</span> <span class="keyword">extends</span> <span class="title">TankFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Tank <span class="title">createConcreteTankMethod</span><span class="params">(String check)</span> </span>&#123;</span><br><span class="line">        Tank tank = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(Objects.equals(check, <span class="string">"my"</span>))&#123;</span><br><span class="line">            tank = <span class="keyword">new</span> MyTank();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> tank;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面的代码为敌人的坦克的生产工厂实现子类。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 敌人坦克的构建工厂</span></span><br><span class="line"><span class="comment"> * 老鼠坦克</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zxd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/2/16 14:28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MouseTankFactory</span> <span class="keyword">extends</span> <span class="title">TankFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Tank <span class="title">createConcreteTankMethod</span><span class="params">(String check)</span> </span>&#123;</span><br><span class="line">        Tank tank = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(Objects.equals(check, <span class="string">"mouse"</span>))&#123;</span><br><span class="line">            tank = <span class="keyword">new</span> MouseTank();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> tank;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过这样的调整之后，我们每次增加新的产品，只需要继承具备工厂方法的工厂并且实现对应的方法完成自己的坦克创建细节，就将原本耦合的创建规则从父类从剥离，延迟到子类完成，下面来看下单元测试的代码，可以看到工厂的生产具体具体化到子类工厂的内部，而对外依旧是坦克的生成工厂，这样既符合<code>依赖倒转</code>的原则，也方便后续的扩展和更多实现工厂的添加：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 工厂方法的单元测试</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zxd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/2/16 17:50</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TankFactory tankFactory = <span class="keyword">new</span> MouseTankFactory();</span><br><span class="line">        TankFactory ourTankFactory = <span class="keyword">new</span> OurTankFactory();</span><br><span class="line">        Tank my = tankFactory.createTank(<span class="string">"mouse"</span>);</span><br><span class="line">        Tank mouse = ourTankFactory.createTank(<span class="string">"my"</span>);</span><br><span class="line">        System.err.println(my);</span><br><span class="line">        System.err.println(mouse);</span><br><span class="line">    &#125;<span class="comment">/*运行结果：</span></span><br><span class="line"><span class="comment">    com.headfirst.factory.use.MouseTank@677327b6</span></span><br><span class="line"><span class="comment">    老鼠坦克移动</span></span><br><span class="line"><span class="comment">    com.headfirst.factory.use.MyTank@14ae5a5</span></span><br><span class="line"><span class="comment">    老鼠坦克开枪</span></span><br><span class="line"><span class="comment">    老鼠坦克开枪</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>工厂方法的问题：虽然工厂方法很好的为我们解决了创建过程由子类进行构建的问题，但是如果我们需要往坦克的产品里面提供配对的零件，此时会发现一些问题，<strong>我们的工厂方法只能提供一种产品的生产</strong>，如果我们需要生产很多的产品，工厂方法此时就遇到的瓶颈，因为需要调整继承结构，同时扩展非常不便。</p><blockquote><p>注意点：工厂方法的另一个问题在于他需要依赖继承来实现对象创建过程定义，此时如果改动整个顶层的抽象方法会导致依赖磁铁导致所有的子类都需要改变。假如需要加入多个产品的生产，此时对于所有的子类改动来看都是十分麻烦的事情.</p></blockquote><p>总结：工厂方法在构建一类产品的时候非常有效，但是需要构建很多种产品的时候会产生大量的继承具体化问题</p><h3 id="抽象工厂的实现："><a href="#抽象工厂的实现：" class="headerlink" title="抽象工厂的实现："></a>抽象工厂的实现：</h3><p>我们之前讲过抽象工厂实际上是对工厂方法的进一步提取，抽象工厂需要的是一系列产品的接口，由子工厂负责一系列产品的接口生产，同时更多的需要依赖组合的形式为具体的产品进行扩展。</p><p>在具体的案例代码介绍之前，我们需要对于案例进行改动，由于之前只存在坦克父类和具体的实现子类，为了详细介绍抽象工厂，我们针对坦克类增加一个大炮类，大炮类提供展示外观的方法，和坦克类的产品完全不同，我们需要定义坦克的大炮产品父类和具体的不同实现子类，在抽象工厂提供大炮的生产接口抽象同时，我们需要在大炮的类内部组合大炮的对象，为坦克增加不同的大炮外观，下面我们根据抽象工厂的结构图，构建如下的结构图：</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210216234144.png" alt="抽象工厂"></p><p>我们参考结构图，定义类似的坦克结构，下面是加入新需求之后的结构图：</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210216195237.png" alt="根据抽象工厂绘制"></p><p>根据上面的结构图，我们先将工厂有具体类改造为工厂接口，不再持有具体的创建过程，将一系列创建的细节分布到子类进行，同时定义接口的方式可以创建多个产品。（这里简化为2个不同的产品）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 坦克工厂，专门负责生产坦克</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zxd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/1/25 22:27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TankFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 坦克创建方法抽象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Tank <span class="title">createTank</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 大炮的创建方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Cannon <span class="title">createCannon</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来我们根据抽象工厂接口创建具体的生产工厂，我们在子类可以返回具体的产品子类也可以返回抽象的父类，下面定义我方坦克的工厂类，同时定义一个特定敌人坦克的工厂类。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 我方坦克的创建工厂</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zxd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/2/16 14:28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OurTankFactory</span> <span class="keyword">implements</span> <span class="title">TankFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建自带大炮的坦克</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Tank <span class="title">createTanAndCannon</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Tank myTank = createTank();</span><br><span class="line">        myTank.setCannon(createCannon());</span><br><span class="line">        <span class="keyword">return</span> myTank;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Tank <span class="title">createTank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyTank();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cannon <span class="title">createCannon</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Artillery();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>敌人坦克的工厂实现子类:敌人的坦克工厂实现子类，可以生产不同抽象产品的不同具体实现子类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 敌人坦克的构建工厂</span></span><br><span class="line"><span class="comment"> * 老鼠坦克</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zxd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/2/16 14:28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MouseTankFactory</span> <span class="keyword">implements</span> <span class="title">TankFactory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MouseTank <span class="title">createTank</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MouseTank();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cannon <span class="title">createCannon</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RocketLauncher();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接着我们定义另一个独立的产品，定义顶层的抽象类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 大炮抽象类</span></span><br><span class="line"><span class="comment"> * 子类具备不同的大炮形式</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zxd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/2/16 18:15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Cannon</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 外观</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根据对应上面的抽象父类，定义对应点具体实现子类，这里为了简单将两个具体实现子类放到一块：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 火炮</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zxd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/2/16 19:06</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Artillery</span> <span class="keyword">extends</span> <span class="title">Cannon</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"火箭炮"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 火箭炮</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zxd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/2/16 19:06</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RocketLauncher</span> <span class="keyword">extends</span> <span class="title">Cannon</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"火箭炮"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里扩展了一下坦克类，为坦克类组合了大炮的对象：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 坦克的父类，定义坦克的行为</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zxd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/1/25 0:14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Tank</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 坦克hp</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> hp;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 坦克子弹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> List&lt;Object&gt; bullet;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Cannon cannon;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移动的方法s</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 攻击</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">attack</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 停止</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cannon <span class="title">getCannon</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cannon;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCannon</span><span class="params">(Cannon cannon)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cannon = cannon;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Tank&#123;"</span> +</span><br><span class="line">                <span class="string">"hp="</span> + hp +</span><br><span class="line">                <span class="string">", bullet="</span> + bullet +</span><br><span class="line">                <span class="string">", cannon="</span> + cannon +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面是单元测试代码，我们在坦克的对象里面设置或者组合其他的对象，并且由工厂提供生产：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 单元测试</span></span><br><span class="line"><span class="comment"> * 抽象工厂</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zxd</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/2/16 16:32</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TankFactory ourTankFactory = <span class="keyword">new</span> OurTankFactory();</span><br><span class="line">        TankFactory mouseTankFactory = <span class="keyword">new</span> MouseTankFactory();</span><br><span class="line">        Tank ourTankFactoryTank = ourTankFactory.createTank();</span><br><span class="line">        Cannon cannon = ourTankFactory.createCannon();</span><br><span class="line">        Tank mouseTankFactoryTank = mouseTankFactory.createTank();</span><br><span class="line">        Cannon cannon1 = mouseTankFactory.createCannon();</span><br><span class="line">        ourTankFactoryTank.setCannon(cannon);</span><br><span class="line">        mouseTankFactoryTank.setCannon(cannon1);</span><br><span class="line">        System.err.println(<span class="string">"our = "</span> + ourTankFactoryTank);</span><br><span class="line">        System.err.println(<span class="string">"mouse = "</span> + mouseTankFactoryTank);</span><br><span class="line">    &#125;<span class="comment">/*</span></span><br><span class="line"><span class="comment">        our = Tank&#123;hp=1, bullet=[java.lang.Object@677327b6, java.lang.Object@14ae5a5, java.lang.Object@7f31245a],</span></span><br><span class="line"><span class="comment">        cannon=com.headfirst.factory.abstractfac.Artillery@6d6f6e28&#125;</span></span><br><span class="line"><span class="comment">        老鼠坦克移动</span></span><br><span class="line"><span class="comment">        mouse = Tank&#123;hp=1, bullet=[java.lang.Object@135fbaa4, java.lang.Object@45ee12a7, java.lang.Object@330bedb4, java.lang.Object@2503dbd3, java.lang.Object@4b67cf4d],</span></span><br><span class="line"><span class="comment">        cannon=com.headfirst.factory.abstractfac.RocketLauncher@7ea987ac&#125;</span></span><br><span class="line"><span class="comment">        老鼠坦克开枪</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>工厂模式的变化：</p><p>从上面的案例和具体实现我们分析了工厂模式的三种变化：<strong>简单工厂、工厂方法、抽象工厂</strong>。他们的递进次序也是<code>简单工厂 -&gt; 工厂方法 -&gt; 抽象工厂</code>这种顺序。</p><p>我们可以发现简单工厂是一种非常简单的设计思路，他仅仅定义了的创建和使用过程的接口，同时产品具备最基本的抽象和继承设计，这类设计往往用于<strong>简单的对象构建</strong>。而一旦出现大量的具体对象，简单工厂的代码将会不断的膨胀，同时产生很多的<code>if/else</code>代码。</p><p>此时就需要使用工厂方法对于简单工厂的结构进行升级，工厂方法通过继承的方式（定义抽象的方法），<strong>推迟具体对象的创建到子类</strong>，工厂父类既可以控制子类的创建结果，同时又不需要关心具体对象的创建过程，这种设计非常巧妙，很好的解决了工厂的对象创建方法代码臃肿的问题。</p><p>但是我们也发现了问题，工厂方法扩展会导致所有的子类进行强制实现，不利于后期的维护，同时如果需要一系列相关产品的生成，使用工厂方法进行继承实现会造成高度的继承耦合，不利于工厂的产品生产扩展，此时就可以运用抽象工厂进行改进，我们用抽象工厂扩展工厂方法，使用接口的形式定义一批接口，由子类工厂进行实现和后续的所有生产细节，同时还可以自定义生产的具体产品。</p><p>上面是根据案例对于本次的设计模式进行一个模式的总结，可以看到工厂模式的应用还是非常多的，在WEB领域最常用的<code>Spring</code>框架就是的Bean工厂就是一个非常良好的工厂模式的实践案例。</p><h2 id="工厂模式的总结："><a href="#工厂模式的总结：" class="headerlink" title="工厂模式的总结："></a>工厂模式的总结：</h2><p>下面用一张表格总结工厂模式的三种形态，优缺点以及相关总结：</p><table><thead><tr><th>模式名称</th><th>简单工厂</th><th>工厂方法</th><th>抽象方法</th></tr></thead><tbody><tr><td>特点</td><td>根据产品按照客户端的需求生产不同的具体对象，将生产和使用的过程进行解耦</td><td>将工厂的创建细节延迟到工厂的子类实现。</td><td>定义一系列工厂方法，由子工厂负责具体的多类产品的生产</td></tr><tr><td>派生方式</td><td>需要修改简单工厂的代码</td><td>顶层工厂增加方法需要所有的子类强制实现。生产多个产品需要改动继承结构</td><td>扩展产品和生产具体产品非常方便。但是扩展新对象需要改动抽象工厂接口</td></tr><tr><td>优点</td><td>1. 简单工厂将创建对象的过程和使用对象的过程进行解耦<br />2. 工厂可以创建生产对象的不同实现子类，扩展子类实现非常方便</td><td>1. 工厂方法将工厂生产对象的创建细节延迟到子类<br />2.  克服了简单工厂部分缺点，比如符合开放-关闭原则<br />3.  同样可以对客户端和创建对象工厂进行解耦</td><td>1. 有利于多个产品的对象创建扩展<br />2.  将抽象类转变为接口，可以定义更高级的抽象。方便向上扩展<br />3.  类似制定工厂的生产规则，而具体的细节交由实现接口的子类完成</td></tr><tr><td>缺点</td><td>1. 工厂扩展新的对象需要改动代码，不符合开放-关闭原则<br />2. 简单工厂对应简单的创建过程，所以创建过程复杂会造成工厂的臃肿</td><td>1. 不利于维护，加入工厂方法需要扩展所有的子类都需要实现工厂方法<br />2. 当需要多个产品类的时候，更改会相当的麻烦</td><td>1.  面对新的产品，需要所有的工厂实现类进行实现。<br />2.  最大的缺点是难以扩展新的产品，或者说扩展新产品的代价很大</td></tr><tr><td>总结</td><td>是一种良好的编码和思考方式，但是严格意义上不能算是设计模式</td><td>将具体对象的创建过程延迟到子类，符合开放-关闭原则</td><td>抽象工厂是对工厂方法的升级，分离了多个产品的生产同时，子工厂可以对多个产品的生产细节进行自由控制。</td></tr></tbody></table><h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><p>本次设计模式的文章内容比较长，由于本次设计模式虽然是一个设计模式，但是他存在三种“变体”，所以在什么使用哪一种设计还是需要依靠具体的需求环境来决定。可以看到该设计模式最容易混淆的是工厂方法和抽象工厂。希望通过本文的总结和案例可以让读者更好的了解工厂模式下这两者的使用场景和区别。</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      工厂模式三种形式转变
    
    </summary>
    
    
      <category term="设计模式" scheme="https://whitestore.top/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="设计模式" scheme="https://whitestore.top/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>钉钉机器人简单使用</title>
    <link href="https://whitestore.top/2021/02/14/dingding/"/>
    <id>https://whitestore.top/2021/02/14/dingding/</id>
    <published>2021-02-14T03:40:42.000Z</published>
    <updated>2021-02-14T04:21:01.431Z</updated>
    
    <content type="html"><![CDATA[<h1 id="钉钉自定义机器人简单使用"><a href="#钉钉自定义机器人简单使用" class="headerlink" title="钉钉自定义机器人简单使用"></a>钉钉自定义机器人简单使用</h1><h1 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h1><p>年前公司的需求里面有用到钉钉机器人，使用之后发现真的非常简单，不得不感叹阿里的牛逼，这篇文章总结了一下个人使用钉钉机器人的经验，同时介绍个人据此构建一个工具类来方便后续直接“开箱即用”，希望对于读者有所启发。</p><a id="more"></a><h1 id="文章目的："><a href="#文章目的：" class="headerlink" title="文章目的："></a>文章目的：</h1><ol><li>简单的说明一下钉钉自定义机器人使用，注意是自定义机器人</li><li>说明一下个人针对钉钉机器人设计了一个工具类，说明一下设计的思路。（重点）</li><li>汇总一些个人使用钉钉机器人的小坑，同时提供解决办法希望读者参考可以解决问题</li></ol><h1 id="钉钉文档："><a href="#钉钉文档：" class="headerlink" title="钉钉文档："></a>钉钉文档：</h1><p>机器人的使用还是非常简单的，直接参考文档就可以进行构建，如果了解过这一部分可以直接跳到编写工具类的部分进行文章的后续阅读。</p><p><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLmRpbmd0YWxrLmNvbS9kb2N1bWVudC9hcHAvY3VzdG9tLXJvYm90LWFjY2Vzcw==" title="https://developers.dingtalk.com/document/app/custom-robot-access">https://developers.dingtalk.com/document/app/custom-robot-access<i class="fa fa-external-link"></i></span></p><blockquote><p>由于钉钉的官方文档更新较为频繁，这里的连接可能在以后会失效</p></blockquote><h1 id="如何创建一个机器人"><a href="#如何创建一个机器人" class="headerlink" title="如何创建一个机器人"></a>如何创建一个机器人</h1><p>文档里面介绍的比较详细了，我们根据文档的内容进行实战一下即可。这里使用了 <strong>新手体验群</strong> 创建的机器人进行实验。下面的内容包括创建自定义机器人以及测试机器人如何使用。</p><h2 id="创建一个自定义机器人"><a href="#创建一个自定义机器人" class="headerlink" title="创建一个自定义机器人"></a>创建一个自定义机器人</h2><p>随意点击一个机器人，右击菜单，出现“更多机器人”，进入到界面</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210213173000.png?ynotemdtimestamp=1613223296738" alt="img"></p><p>点击“更多机器人”</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210213173037.png?ynotemdtimestamp=1613223296738" alt="img"></p><p>选择钉钉的自定义机器人进行使用：</p><blockquote><p>这里还有很多其他的机器人，如果感兴趣可以查看钉钉的文档进行更多的了解</p></blockquote><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210213173121.png?ynotemdtimestamp=1613223296738" alt="img"></p><p>在下面的界面选择添加：</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210213173313.png?ynotemdtimestamp=1613223296738" alt="img"></p><p>到达下一个界面，根据指示需要填写如下的内容：</p><ul><li>机器人的名称：自己取一个合适的名字，自己喜欢就行</li><li>添加到群组：<strong>关键</strong>的一步，意味着你的机器人要添加到哪一个具体的群组里面进行使用。也意味着只有在这个群组里面的人才可以收到对应的通知。</li></ul><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210213173703.png?ynotemdtimestamp=1613223296738" alt="img"></p><p>下面说明一下安全设置的内容：</p><ul><li>自定义关键词：<strong>关键配置</strong>，这里自定义关键词可以按照自己的喜好进行设置。但是一旦设置在发送请求的时候<strong>必须要携带关键词</strong>，请求才会生效，否则会返回对应的错误码<code>31000</code>和对应的错误信息。</li><li>加签：<strong>建议勾上</strong>，这里加签可以在请求中更好的保护接口，同时注意一下加上签名之后要复制一下内容</li><li><strong>IP地址（段）</strong>：这里个人没有进行过测试，所以没有进行勾选，正式的生产环境建议使用IP限制，保证万无一失</li></ul><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210213175804.png?ynotemdtimestamp=1613223296738" alt="img"></p><blockquote><p>这里建议保存一下前面和关键字，当然忘记了也可以在构建完成之后从设置里面查看：</p><p>签名：<code>SECf075e3890b7d79ca645e51b42644fc57c2402577d5a955bce51cb980cec0a3b6</code></p><p>关键词：<code>新人</code></p></blockquote><p>至此，我们成功创建了一个钉钉的自定义机器人，整个过程十分简单，这里记得保存一下对应的信息：</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210213180638.png?ynotemdtimestamp=1613223296738" alt="img"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;oapi.dingtalk.com&#x2F;robot&#x2F;send?access_token&#x3D;381c2f405e0f906fd556b27cea9f66864120860b5d8b117bb046e10b6599b050</span><br></pre></td></tr></table></figure><p>上面为个人的配置。发文的时候此机器人<strong>已经删除</strong>，所以读者自己实验即可。</p><h2 id="测试机器人是否可以正常使用"><a href="#测试机器人是否可以正常使用" class="headerlink" title="测试机器人是否可以正常使用"></a>测试机器人是否可以正常使用</h2><p>通过上面的步骤，我们已经构建了一个基本的机器人为我们使用，再进行下一步之前，我们需要验证一下钉钉机器人是否可以正常使用。这里针对不同的平台说下比较简单快捷的验证方法。</p><h3 id="windows-验证方式："><a href="#windows-验证方式：" class="headerlink" title="windows 验证方式："></a>windows 验证方式：</h3><p>windows 推荐使用<code>git</code>的一个<code>shell</code>命令框进行测试，因为windows 本身是没有<code>curl</code>这个命令的，当然也有其他的办法，但是为了图省事直接使用<code>git</code>给我们开发的一个小工具即可。</p><p>如下图所示，我们选择<code>Git Bash Here</code>，打开命令行的界面</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210213173435.png?ynotemdtimestamp=1613223296738" alt="img"></p><p>我们根据上一步的机器人配置，构建一个<code>CURL</code>请求进行测试：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl &#39;https:&#x2F;&#x2F;oapi.dingtalk.com&#x2F;robot&#x2F;send?access_token&#x3D;381c2f405e0f906fd556b27cea9f66864120860b5d8b117bb046e10b6599b050&amp;timestamp&#x3D;1613211530113&amp;secret&#x3D;SEC2e67120c5e4affa1177ac25fe8dc77ba1c5b49284a9dc7e1888770bc3b76b1fc&#39; \</span><br><span class="line">   -H &#39;Content-Type: application&#x2F;json&#39; \</span><br><span class="line">   -d &#39;&#123;&quot;msgtype&quot;: &quot;text&quot;,&quot;text&quot;: &#123;&quot;content&quot;: &quot;新人内容测试&quot;&#125;&#125;&#39;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210213180959.png?ynotemdtimestamp=1613223296738" alt="img"></p><p>不出所料，这里按照官方文档给的方式<strong>验证失败</strong>了，这是为什么呢？原因有几个：</p><ul><li>加签密文：我们设置了加签，所以在请求参数里面要加入对应的<strong>签名密文</strong>，也就是在添加这一步勾选了<strong>签名</strong>这一步。</li><li>时间戳：请求需要传递<strong>时间戳</strong>，但是我们没有在请求参数里面附带时间戳，同时时间戳必须在<strong>系统时间的一小时之内</strong>，超过这个时间即使请求参数正确也无法通过</li></ul><blockquote><p>timestamp = 1613212103494 sign = MO79EJ58O9lmuQJo1dB1KGMhkZI%2BM5KkyD0NYuNe8%2B8%3D</p></blockquote><p>我们根据上面的说明修复一下，注意在URL增加了两个参数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl &#39;https:&#x2F;&#x2F;oapi.dingtalk.com&#x2F;robot&#x2F;send?access_token&#x3D;381c2f405e0f906fd556b27cea9f66864120860b5d8b117bb046e10b6599b050&amp;timestamp&#x3D;1613212722591&amp;sign&#x3D;SsKKlkvwM%2F4tsCPE6YoGls8vgkQqWJGHYpvWbW7hTGM%3D&#39; \</span><br><span class="line">   -H &#39;Content-Type: application&#x2F;json&#39; \</span><br><span class="line">   -d &#39;&#123;&quot;msgtype&quot;: &quot;text&quot;,&quot;text&quot;: &#123;&quot;content&quot;: &quot;新人为什么你这么牛逼&quot;&#125;&#125;&#39;</span><br></pre></td></tr></table></figure><blockquote><p>关于这一部分内容，已经汇总到“问题汇总”这一部分，如果还是感到迷惑可以参考。</p></blockquote><p>我们再次验证一下，发现<strong>依然失败</strong>，比较奇怪，个人设置的关键字在请求content里面却失败了：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">zhaoxudong@LAPTOP-MEUFMP1M MINGW64 &#x2F;d&#x2F;Users&#x2F;zhaoxudong&#x2F;Desktop</span><br><span class="line">$ curl &#39;https:&#x2F;&#x2F;oapi.dingtalk.com&#x2F;robot&#x2F;send?access_token&#x3D;381c2f405e0f906fd556b27cea9f66864120860b5d8b117bb046e10b6599b050&amp;timestamp&#x3D;1613212722591&amp;sign&#x3D;SsKKlkvwM%2F4tsCPE6YoGls8vgkQqWJGHYpvWbW7hTGM%3D&#39; \</span><br><span class="line">&gt;    -H &#39;Content-Type: application&#x2F;json&#39; \</span><br><span class="line">&gt;    -d &#39;&#123;&quot;msgtype&quot;: &quot;text&quot;,&quot;text&quot;: &#123;&quot;content&quot;: &quot;新人为什么你这么牛逼&quot;&#125;&#125;&#39;</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100   178  100   115  100    63    991    543 --:--:-- --:--:-- --:--:--  1534</span><br><span class="line">&#123;&quot;errcode&quot;:310000,&quot;errmsg&quot;:&quot;keywords not in content, more: [https:&#x2F;&#x2F;ding-doc.dingtalk.com&#x2F;doc#&#x2F;serverapi2&#x2F;qf2nxq]&quot;&#125;</span><br></pre></td></tr></table></figure><p>排查问题之后发现由于windows系统默认使用了<code>gb2312</code>的编码，所以我们此时需要切换一下系统的编码，为了证明是系统编码的问题，我们先验证一下编码：</p><p>打开window的<code>cmd</code>窗口，我们输入<code>chcp</code>命令进入到具体的页面，可以看到下面936，百度一下发现就是<code>GB2312</code>，在请求发送的过程中被转码导致乱码。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\zhaoxudong&gt;chcp</span><br><span class="line">活动代码页: 936</span><br></pre></td></tr></table></figure><p>解决办法也比较简单，改一下整改系统的编码即可，关于设置的方法：<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JvYmluaHVuYW4vYXJ0aWNsZS9kZXRhaWxzLzEwNjA0NzM0NQ==" title="https://blog.csdn.net/robinhunan/article/details/106047345">https://blog.csdn.net/robinhunan/article/details/106047345<i class="fa fa-external-link"></i></span></p><blockquote><p>插曲：个人在设置过后，因为编码的问题导致编辑器无法编译，经过核实发现是由于<strong>文件夹的编码乱码</strong>找不到类的问题，所以这里建议放置Java项目的时候放置到<strong>全英文</strong>的目录。所以更推荐linux的方式，可以省去很多麻烦</p></blockquote><h3 id="linux-验证方式："><a href="#linux-验证方式：" class="headerlink" title="linux 验证方式："></a>linux 验证方式：</h3><p>linux 验证比较简单，而且出问题的概率比较小，根据window内容得知最后需要<strong>三个</strong>参数才能请求成功，这里直接给出一个相似的CURL请求作为案例说明：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl &#39;https:&#x2F;&#x2F;oapi.dingtalk.com&#x2F;robot&#x2F;send?access_token&#x3D;381c2f405e0f906fd556b27cea9f66864120860b5d8b117bb046e10b6599b050&amp;timestamp&#x3D;1613212722591&amp;sign&#x3D;SsKKlkvwM%2F4tsCPE6YoGls8vgkQqWJGHYpvWbW7hTGM%3D&#39; \</span><br><span class="line">   -H &#39;Content-Type: application&#x2F;json&#39; \</span><br><span class="line">   -d &#39;&#123;&quot;msgtype&quot;: &quot;text&quot;,&quot;text&quot;: &#123;&quot;content&quot;: &quot;新人为什么你这么牛逼&quot;&#125;&#125;&#39;</span><br></pre></td></tr></table></figure><p>我们把这个请求放到<code>linux</code>命令行里面进行运行，如果errorcode返回0，说明请求成功：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;errcode&quot;:0,&quot;errmsg&quot;:&quot;ok&quot;&#125;</span><br></pre></td></tr></table></figure><p>请求成功之后，我们可以看到对应的结果：</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210213185434.png?ynotemdtimestamp=1613223296738" alt="img"></p><blockquote><p>注意一下钉钉机器人不能请求过于频繁。建议限制一下每分钟的请求QPS</p></blockquote><h1 id="编写工具类"><a href="#编写工具类" class="headerlink" title="编写工具类"></a>编写工具类</h1><p>从上一节可以看到，整个钉钉机器人的构建还是十分简单的。但是使用起来不是特别的方便，个人之前有使用钉钉做过一个预警的小需求，为了后续可以直接开箱即用，自己构建了工具类，下面的部分主要说个人的工具类的设计以及个人的构建思路</p><blockquote><p>个人水平有限，工具类还有很大的改进空间，但是对于我来说暂时没有遇到使用的瓶颈。</p></blockquote><h2 id="工具类的代码地址"><a href="#工具类的代码地址" class="headerlink" title="工具类的代码地址"></a>工具类的代码地址</h2><p>这里个人的小工具类整合到了个人小项目里面，想要参考的可以直接进行下载，下面的文章代码也是来源于这个项目里面。</p><blockquote><p><strong>具体请查看：<code>com.zxd.interview.dingrobot</code>这个包</strong></p></blockquote><p>具体的代码地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRlZS5jb20vbGF6eVRpbWVzL2ludGVydmlldy90cmVlL21hc3Rlci9zcmMvbWFpbi9qYXZhL2NvbS96eGQvaW50ZXJ2aWV3L2Rpbmdyb2JvdA==" title="https://gitee.com/lazyTimes/interview/tree/master/src/main/java/com/zxd/interview/dingrobot">https://gitee.com/lazyTimes/interview/tree/master/src/main/java/com/zxd/interview/dingrobot<i class="fa fa-external-link"></i></span></p><h2 id="构建工具类的思路"><a href="#构建工具类的思路" class="headerlink" title="构建工具类的思路"></a>构建工具类的思路</h2><p>把整个请求的流程需要的组件分为了以下的几个部分：</p><p><strong>构建基本的请求环境</strong>：也就是需要的请求地址，请求签名或者关键字等参数，这些参数都是必须的，否则请求无法正常运行，所以我们提出来作为<strong>环境</strong>使用。</p><p><strong>构建请求参数</strong>：由于钉钉支持非常多的<code>msgtype</code>也就是文本类型，个人参考了一下SDK，对应构建了一个请求的参数类，为了方便扩展，设计了一个接口进行后续的扩展和兼容。</p><p><strong>使用JAVA代码发送请求</strong>：本着最小依赖的原则，使用最常见的<code>HttpClient</code>进行模拟JAVA的请求发送。但是在这个基础上做了一点点的封装，方便后续扩展</p><ol><li>HttpClient的封装，将请求所需要的一些请求参数封装到一个配置对象进行管理</li><li>请求方法的封装，这里用了一个对象进行封装，也可以直接使用Spring封装的<code>org.springframework.web.bind.annotation.RequestMethod</code>或者直接使用枚举构建常量即可。</li><li>构建钉钉请求工具类：最后我们整合上面所有步骤构建一个核心请求工具类，通过环境参数构建请求URL和一些Header设置，以及构建不同的请求方法发送请求，调用HttpClient工具类进行请求发送，以及发送之后转化为结果对象等一系列操作均由该工具类完成，是本次工具类最核心的类。</li><li>构建钉钉的请求Msg：该对象包含了请求所支持的所有JSON参数格式对应的实体对象，根据参数格式构建对应的对象，个人利用<strong>内部类</strong>全部封装到一个对象里面，方便客户端理解调用。</li></ol><p><strong>返回请求结果</strong>：包含了错误码，错误信息，以及其他的参数等，也可以修改为直接返回字符串，由客户端决定如何处理</p><p><strong>请求之后返回结果</strong>：将上面的错误码或者错误信息等封装为一个简单对象进行返回，同样如果不喜欢也可以改为返回字符串的结果。</p><h2 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h2><p>在介绍正式的结果之前，我们看下结果，下面是效果截图，包含了钉钉文档里面的所有类型，包含了目前钉钉文档支持的几种主要的类型：</p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210213230526.png?ynotemdtimestamp=1613223296738" alt="测试结果1"></p><p><img src="https://gitee.com/lazyTimes/imageReposity/raw/master/img/20210213230806.png?ynotemdtimestamp=1613223296738" alt="测试截图2"></p><p>下面为单元测试的代码，整个单元测试测试各种不同请求类型，调用工具包发送请求：</p><blockquote><p>注意下面的请求text里面包含了之前请求示例里面设置的关键字，没有关键字是无法请求成功的</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br></pre></td><td class="code"><pre><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import org.apache.commons.codec.binary.Base64;</span><br><span class="line">import org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line">import javax.crypto.Mac;</span><br><span class="line">import javax.crypto.spec.SecretKeySpec;</span><br><span class="line">import java.net.URLEncoder;</span><br><span class="line">import java.nio.charset.StandardCharsets;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.Arrays;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @author zxd</span><br><span class="line"> * @version v1.0.0</span><br><span class="line"> * @Package : com.zxd.interview.dingrobot</span><br><span class="line"> * @Description : 钉钉机器人测试类</span><br><span class="line"> * @Create on : 2021&#x2F;2&#x2F;7 11:06</span><br><span class="line"> **&#x2F;</span><br><span class="line">public class DingRobotUtilsTest &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">   运行下面五个单元测试的结果</span><br><span class="line">    *&#x2F; </span><br><span class="line">    @Test</span><br><span class="line">    public void testAll() &#123;</span><br><span class="line">        testText();</span><br><span class="line">        testLink();</span><br><span class="line">        testMarkdown();</span><br><span class="line">        testActionCard();</span><br><span class="line">        testFeedCard();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 构建当前的系统时间戳</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void generateSystemCurrentTime() throws Exception &#123;</span><br><span class="line">        long currentTimeMillis &#x3D; System.currentTimeMillis();</span><br><span class="line">        String secret &#x3D; &quot;SEC2e67120c5e4affa1177ac25fe8dc77ba1c5b49284a9dc7e1888770bc3b76b1fc&quot;;</span><br><span class="line">        String sign &#x3D; generateSign(currentTimeMillis, secret);</span><br><span class="line">        System.out.println(&quot;timestamp &#x3D; &quot; + currentTimeMillis);</span><br><span class="line">        System.out.println(&quot;sign &#x3D; &quot; + sign);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 测试link类型的请求</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void testLink() &#123;</span><br><span class="line">        DingRobotRequest.Builder builder &#x3D; new DingRobotRequest.Builder();</span><br><span class="line">        DingRobotRequest build &#x3D; builder.secret(&quot;SEC2e67120c5e4affa1177ac25fe8dc77ba1c5b49284a9dc7e1888770bc3b76b1fc&quot;)</span><br><span class="line">                .url(&quot;https:&#x2F;&#x2F;oapi.dingtalk.com&#x2F;robot&#x2F;send&quot;)</span><br><span class="line">                .accessToken(&quot;381c2f405e0f906fd556b27cea9f66864120860b5d8b117bb046e10b6599b050&quot;)</span><br><span class="line">                .msg(generateLink()).build();</span><br><span class="line">        try &#123;</span><br><span class="line">            DingRobotResponseMsg dingRobotResponseMsg &#x3D; DingRobotUtils.notifyRobot(build);</span><br><span class="line">            System.err.println(JSON.toJSONString(dingRobotResponseMsg));</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 测试text类型</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void testText() &#123;</span><br><span class="line">        DingRobotRequest.Builder builder &#x3D; new DingRobotRequest.Builder();</span><br><span class="line">        DingRobotRequest build &#x3D; builder.secret(&quot;SEC2e67120c5e4affa1177ac25fe8dc77ba1c5b49284a9dc7e1888770bc3b76b1fc&quot;)</span><br><span class="line">                .url(&quot;https:&#x2F;&#x2F;oapi.dingtalk.com&#x2F;robot&#x2F;send&quot;)</span><br><span class="line">                .accessToken(&quot;381c2f405e0f906fd556b27cea9f66864120860b5d8b117bb046e10b6599b050&quot;)</span><br><span class="line">                .msg(generateText()).build();</span><br><span class="line">        try &#123;</span><br><span class="line">            DingRobotResponseMsg dingRobotResponseMsg &#x3D; DingRobotUtils.notifyRobot(build);</span><br><span class="line">            System.err.println(JSON.toJSONString(dingRobotResponseMsg));</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**测试markdown 类型 *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void testMarkdown() &#123;</span><br><span class="line">        DingRobotRequest.Builder builder &#x3D; new DingRobotRequest.Builder();</span><br><span class="line">        DingRobotRequest build &#x3D; builder.secret(&quot;SEC2e67120c5e4affa1177ac25fe8dc77ba1c5b49284a9dc7e1888770bc3b76b1fc&quot;)</span><br><span class="line">                .url(&quot;https:&#x2F;&#x2F;oapi.dingtalk.com&#x2F;robot&#x2F;send&quot;)</span><br><span class="line">                .accessToken(&quot;381c2f405e0f906fd556b27cea9f66864120860b5d8b117bb046e10b6599b050&quot;)</span><br><span class="line">                .msg(generateMarkdown()).build();</span><br><span class="line">        try &#123;</span><br><span class="line">            DingRobotResponseMsg dingRobotResponseMsg &#x3D; DingRobotUtils.notifyRobot(build);</span><br><span class="line">            System.err.println(JSON.toJSONString(dingRobotResponseMsg));</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     &#x2F;**测试ActionCard 类型 *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void testActionCard() &#123;</span><br><span class="line">        DingRobotRequest.Builder builder &#x3D; new DingRobotRequest.Builder();</span><br><span class="line">        DingRobotRequest build &#x3D; builder.secret(&quot;SEC2e67120c5e4affa1177ac25fe8dc77ba1c5b49284a9dc7e1888770bc3b76b1fc&quot;)</span><br><span class="line">                .url(&quot;https:&#x2F;&#x2F;oapi.dingtalk.com&#x2F;robot&#x2F;send&quot;)</span><br><span class="line">                .accessToken(&quot;381c2f405e0f906fd556b27cea9f66864120860b5d8b117bb046e10b6599b050&quot;)</span><br><span class="line">                .msg(generateActionCard()).build();</span><br><span class="line">        try &#123;</span><br><span class="line">            DingRobotResponseMsg dingRobotResponseMsg &#x3D; DingRobotUtils.notifyRobot(build);</span><br><span class="line">            System.err.println(JSON.toJSONString(dingRobotResponseMsg));</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**测试FeedCard 类型 *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void testFeedCard() &#123;</span><br><span class="line">        DingRobotRequest.Builder builder &#x3D; new DingRobotRequest.Builder();</span><br><span class="line">        DingRobotRequest build &#x3D; builder.secret(&quot;SEC2e67120c5e4affa1177ac25fe8dc77ba1c5b49284a9dc7e1888770bc3b76b1fc&quot;)</span><br><span class="line">                .url(&quot;https:&#x2F;&#x2F;oapi.dingtalk.com&#x2F;robot&#x2F;send&quot;)</span><br><span class="line">                .accessToken(&quot;381c2f405e0f906fd556b27cea9f66864120860b5d8b117bb046e10b6599b050&quot;)</span><br><span class="line">                .msg(generateFeed()).build();</span><br><span class="line">        try &#123;</span><br><span class="line">            DingRobotResponseMsg dingRobotResponseMsg &#x3D; DingRobotUtils.notifyRobot(build);</span><br><span class="line">            System.err.println(JSON.toJSONString(dingRobotResponseMsg));</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private DingRobotRequestBody generateFeed() &#123;</span><br><span class="line">        List&lt;DingRobotRequestBody.FeedCard.FeedItem&gt; list &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">        DingRobotRequestBody dingRobotRequestBody &#x3D; new DingRobotRequestBody();</span><br><span class="line">        DingRobotRequestBody.FeedCard feedCard &#x3D; new DingRobotRequestBody.FeedCard();</span><br><span class="line">        DingRobotRequestBody.FeedCard.FeedItem feedItem &#x3D; new DingRobotRequestBody.FeedCard.FeedItem();</span><br><span class="line">        feedItem.setMessageURL(&quot;https:&#x2F;&#x2F;www.dingtalk.com&#x2F;&quot;);</span><br><span class="line">        feedItem.setTitle(&quot;新人时代的火车向前开&quot;);</span><br><span class="line">        feedItem.setPicURL(&quot;https:&#x2F;&#x2F;img.alicdn.com&#x2F;tfs&#x2F;TB1NwmBEL9TBuNjy1zbXXXpepXa-2400-1218.png&quot;);</span><br><span class="line">        list.add(feedItem);</span><br><span class="line">        feedCard.setLinks(list);</span><br><span class="line">        dingRobotRequestBody.setFeedCard(feedCard);</span><br><span class="line">        dingRobotRequestBody.setMsgType(&quot;feedCard&quot;);</span><br><span class="line">        return dingRobotRequestBody;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private DingRobotRequestBody generateActionCard() &#123;</span><br><span class="line">        DingRobotRequestBody dingRobotRequestBody &#x3D; new DingRobotRequestBody();</span><br><span class="line">        DingRobotRequestBody.ActionCard actionCard &#x3D; new DingRobotRequestBody.ActionCard();</span><br><span class="line">        actionCard.setBtnOrientation(&quot;0&quot;);</span><br><span class="line">        actionCard.setSingleTitle(&quot;阅读全文&quot;);</span><br><span class="line">        actionCard.setSingleURL(&quot;https:&#x2F;&#x2F;www.dingtalk.com&#x2F;&quot;);</span><br><span class="line">        actionCard.setText(&quot;新人![screenshot](https:&#x2F;&#x2F;gw.alicdn.com&#x2F;tfs&#x2F;TB1ut3xxbsrBKNjSZFpXXcXhFXa-846-786.png) \n&quot; +</span><br><span class="line">                &quot; ### 乔布斯 20 年前想打造的苹果咖啡厅 \n&quot; +</span><br><span class="line">                &quot; Apple Store 的设计正从原来满满的科技感走向生活化，而其生活化的走向其实可以追溯到 20 年前苹果一个建立咖啡馆的计划&quot;);</span><br><span class="line">        actionCard.setTitle(&quot;乔布斯 20 年前想打造一间苹果咖啡厅，而它正是 Apple Store 的前身&quot;);</span><br><span class="line">        dingRobotRequestBody.setMsgType(&quot;actionCard&quot;);</span><br><span class="line">        dingRobotRequestBody.setActionCard(actionCard);</span><br><span class="line">        return dingRobotRequestBody;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private DingRobotRequestBody generateMarkdown() &#123;</span><br><span class="line">        DingRobotRequestBody dingRobotRequestBody &#x3D; new DingRobotRequestBody();</span><br><span class="line">        DingRobotRequestBody.MarkDown markDown &#x3D; new DingRobotRequestBody.MarkDown();</span><br><span class="line">        dingRobotRequestBody.setMsgType(&quot;markdown&quot;);</span><br><span class="line">        markDown.setTitle(&quot;杭州天气&quot;);</span><br><span class="line">        markDown.setText(&quot;新人测试 标题\n&quot; +</span><br><span class="line">                &quot;# 一级标题\n&quot; +</span><br><span class="line">                &quot;## 二级标题\n&quot; +</span><br><span class="line">                &quot;### 三级标题\n&quot; +</span><br><span class="line">                &quot;#### 四级标题\n&quot; +</span><br><span class="line">                &quot;##### 五级标题\n&quot; +</span><br><span class="line">                &quot;###### 六级标题\n&quot; +</span><br><span class="line">                &quot;\n&quot; +</span><br><span class="line">                &quot;引用\n&quot; +</span><br><span class="line">                &quot;&gt; A man who stands for nothing will fall for anything.\n&quot; +</span><br><span class="line">                &quot;\n&quot; +</span><br><span class="line">                &quot;文字加粗、斜体\n&quot; +</span><br><span class="line">                &quot;**bold**\n&quot; +</span><br><span class="line">                &quot;*italic*\n&quot; +</span><br><span class="line">                &quot;\n&quot; +</span><br><span class="line">                &quot;链接\n&quot; +</span><br><span class="line">                &quot;[this is a link](http:&#x2F;&#x2F;name.com)\n&quot; +</span><br><span class="line">                &quot;\n&quot; +</span><br><span class="line">                &quot;图片\n&quot; +</span><br><span class="line">                &quot;![](http:&#x2F;&#x2F;name.com&#x2F;pic.jpg)\n&quot; +</span><br><span class="line">                &quot;\n&quot; +</span><br><span class="line">                &quot;无序列表\n&quot; +</span><br><span class="line">                &quot;- item1\n&quot; +</span><br><span class="line">                &quot;- item2\n&quot; +</span><br><span class="line">                &quot;\n&quot; +</span><br><span class="line">                &quot;有序列表\n&quot; +</span><br><span class="line">                &quot;1. item1\n&quot; +</span><br><span class="line">                &quot;2. item2&quot;);</span><br><span class="line">        dingRobotRequestBody.setMarkDown(markDown);</span><br><span class="line">        return dingRobotRequestBody;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private DingRobotRequestBody generateText() &#123;</span><br><span class="line">        DingRobotRequestBody dingRobotRequestBody &#x3D; new DingRobotRequestBody();</span><br><span class="line">        DingRobotRequestBody.Text text &#x3D; new DingRobotRequestBody.Text();</span><br><span class="line">        text.setContent(&quot;新人为什么这么牛逼&quot;);</span><br><span class="line">        DingRobotRequestBody.At at &#x3D; getnerateAt();</span><br><span class="line">        dingRobotRequestBody.setMsgType(&quot;text&quot;);</span><br><span class="line">        dingRobotRequestBody.setAt(at);</span><br><span class="line">        dingRobotRequestBody.setText(text);</span><br><span class="line">        return dingRobotRequestBody;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private DingRobotRequestBody generateLink() &#123;</span><br><span class="line">        DingRobotRequestBody dingRobotRequestBody &#x3D; new DingRobotRequestBody();</span><br><span class="line">        DingRobotRequestBody.Link link &#x3D; new DingRobotRequestBody.Link();</span><br><span class="line">        link.setMessageUrl(&quot;https:&#x2F;&#x2F;www.dingtalk.com&#x2F;s?__biz&#x3D;MzA4NjMwMTA2Ng&#x3D;&#x3D;&amp;mid&#x3D;2650316842&amp;idx&#x3D;1&amp;sn&#x3D;60da3ea2b29f1dcc43a7c8e4a7c97a16&amp;scene&#x3D;2&amp;srcid&#x3D;09189AnRJEdIiWVaKltFzNTw&amp;from&#x3D;timeline&amp;isappinstalled&#x3D;0&amp;key&#x3D;&amp;ascene&#x3D;2&amp;uin&#x3D;&amp;devicetype&#x3D;android-23&amp;version&#x3D;26031933&amp;nettype&#x3D;WIFI&quot;);</span><br><span class="line">        link.setPicUrl(&quot;&quot;);</span><br><span class="line">        link.setTitle(&quot;时代的火车向前开&quot;);</span><br><span class="line">        link.setText(&quot;新人：这个即将发布的新版本,创始人xx称它为红树林。而在此之前,每当面临重大升级,产品经理们都会取一个应景的代号,这一次,为什么是红树林&quot;);</span><br><span class="line">        DingRobotRequestBody.At at &#x3D; getnerateAt();</span><br><span class="line">        dingRobotRequestBody.setMsgType(&quot;link&quot;);</span><br><span class="line">        dingRobotRequestBody.setAt(at);</span><br><span class="line">        dingRobotRequestBody.setLink(link);</span><br><span class="line">        return dingRobotRequestBody;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 构建at请求</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private DingRobotRequestBody.At getnerateAt() &#123;</span><br><span class="line">        DingRobotRequestBody.At at &#x3D; new DingRobotRequestBody.At();</span><br><span class="line">        at.setAtAll(true);</span><br><span class="line">        at.setAtMobiles(Arrays.asList(&quot;xxxxx&quot;, &quot;123456789&quot;));</span><br><span class="line">        return at;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 构建签名方法</span><br><span class="line">     *</span><br><span class="line">     * @param timestamp 时间戳</span><br><span class="line">     * @param secret    秘钥</span><br><span class="line">     * @return</span><br><span class="line">     * @throws Exception</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private String generateSign(Long timestamp, String secret) throws Exception &#123;</span><br><span class="line">        String stringToSign &#x3D; timestamp + &quot;\n&quot; + secret;</span><br><span class="line">        Mac mac &#x3D; Mac.getInstance(&quot;HmacSHA256&quot;);</span><br><span class="line">        mac.init(new SecretKeySpec(secret.getBytes(StandardCharsets.UTF_8), &quot;HmacSHA256&quot;));</span><br><span class="line">        byte[] signData &#x3D; mac.doFinal(stringToSign.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        return URLEncoder.encode(new String(Base64.encodeBase64(signData)), &quot;UTF-8&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="构建工具类："><a href="#构建工具类：" class="headerlink" title="构建工具类："></a>构建工具类：</h2><p>下面就上面的单元测试，说明一下个人的基本设计。我们根据思路构建一个支持拿来即用的钉钉工具类。</p><h3 id="类结构介绍："><a href="#类结构介绍：" class="headerlink" title="类结构介绍："></a>类结构介绍：</h3><h4 id="Maven依赖："><a href="#Maven依赖：" class="headerlink" title="Maven依赖："></a>Maven依赖：</h4><p>在进行具体的代码编写之前，需要引入对应的依赖，个人秉持最小依赖的原则，使用的三方jar包仅仅为一些测试工具包和Httpclient请求工具包还有最熟悉的fastjson的工具包。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.apache.httpcomponents&#x2F;httpclient --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.httpcomponents&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;httpclient&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.5.6&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;com.alibaba&#x2F;fastjson --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;fastjson&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.75&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;junit&#x2F;junit --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.12&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure><h4 id="类结构"><a href="#类结构" class="headerlink" title="类结构:"></a>类结构:</h4><p>类结构包含了之前设计思路里面说明的情况，包含请求类，工具类，参数封装和请求对象结构封装等。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ DingRobotRequest.java钉钉请求对象</span><br><span class="line">+ DingRobotRequestAble.java请求接口，允许发送钉钉请求的接口</span><br><span class="line">+ DingRobotRequestBody.java 允许发送钉钉请求的接口具体的实现类，比较重要，对接文档的钉钉对象</span><br><span class="line">+ DingRobotRequestMsg.java废弃对象，但是依然保留s</span><br><span class="line">+ DingRobotResponseMsg.java请求返回对象</span><br><span class="line">+ DingRobotUtils.java钉钉请求工具类，非常重要的一个类</span><br><span class="line">+ HttpClientUtil.javahttpclient请求工具类</span><br><span class="line">+ HttpConfig.java请求参数构建类</span><br><span class="line">+ HttpMethods.java请求方法类</span><br></pre></td></tr></table></figure><h3 id="构建基本的请求环境"><a href="#构建基本的请求环境" class="headerlink" title="构建基本的请求环境"></a>构建基本的请求环境</h3><p>构建基本的请求环境，我们使用对象来封装所有的环境参数，并且使用建造模式构建一个建造器，使用建造来构建我们需要的环境参数，它的使用方式如下：</p><ul><li>构建请求URL</li><li>构建请求accessToken</li><li>构建请求msg，<strong>重点</strong>，可以通过构建对应的请求来实现发送不同的信息</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DingRobotRequest build &#x3D; builder.secret(&quot;SEC2e67120c5e4affa1177ac25fe8dc77ba1c5b49284a9dc7e1888770bc3b76b1fc&quot;)</span><br><span class="line">                .url(&quot;https:&#x2F;&#x2F;oapi.dingtalk.com&#x2F;robot&#x2F;send&quot;)</span><br><span class="line">                .accessToken(&quot;381c2f405e0f906fd556b27cea9f66864120860b5d8b117bb046e10b6599b050&quot;)</span><br><span class="line">                .msg(generateActionCard()).build();</span><br></pre></td></tr></table></figure><p>具体的源代码如下，包含了几个简单的必要参数，以及一个建造器，注意对于构造器的私有化，对外只允许使用构建器进行初始化：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * @author zxd</span><br><span class="line"> * @version v1.0.0</span><br><span class="line"> * @Package : com.dcc.common.field</span><br><span class="line"> * @Description : 钉钉机器人请求实体类</span><br><span class="line"> * @Create on : 2021&#x2F;2&#x2F;5 15:40</span><br><span class="line"> **&#x2F;</span><br><span class="line">public class DingRobotRequest &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 请求URL</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private String url;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * token</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private String accessToken;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 秘钥</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private String secret;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 请求msg</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private DingRobotRequestBody msg;</span><br><span class="line"></span><br><span class="line">    private DingRobotRequest()&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private DingRobotRequest(Builder builder) &#123;</span><br><span class="line">        this.url &#x3D; builder.url;</span><br><span class="line">        this.accessToken &#x3D; builder.accessToken;</span><br><span class="line">        this.secret &#x3D; builder.secret;</span><br><span class="line">        this.msg &#x3D; builder.msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static class Builder &#123;</span><br><span class="line"></span><br><span class="line">        private String url;</span><br><span class="line">        private String accessToken;</span><br><span class="line">        private String secret;</span><br><span class="line">        private DingRobotRequestBody msg;</span><br><span class="line"></span><br><span class="line">        public DingRobotRequest.Builder url(String url)&#123;</span><br><span class="line">            this.url &#x3D; url;</span><br><span class="line">            return this;</span><br><span class="line">        &#125;</span><br><span class="line">        public DingRobotRequest.Builder accessToken(String accessToken)&#123;</span><br><span class="line">            this.accessToken &#x3D; accessToken;</span><br><span class="line">            return this;</span><br><span class="line">        &#125;</span><br><span class="line">        public DingRobotRequest.Builder secret(String secret)&#123;</span><br><span class="line">            this.secret &#x3D; secret;</span><br><span class="line">            return this;</span><br><span class="line">        &#125;</span><br><span class="line">        public DingRobotRequest.Builder msg(DingRobotRequestBody msg)&#123;</span><br><span class="line">            this.msg &#x3D; msg;</span><br><span class="line">            return this;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public DingRobotRequest build()&#123;</span><br><span class="line">            return new DingRobotRequest(this);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUrl() &#123;</span><br><span class="line">        return url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUrl(String url) &#123;</span><br><span class="line">        this.url &#x3D; url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getAccessToken() &#123;</span><br><span class="line">        return accessToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setAccessToken(String accessToken) &#123;</span><br><span class="line">        this.accessToken &#x3D; accessToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSecret() &#123;</span><br><span class="line">        return secret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSecret(String secret) &#123;</span><br><span class="line">        this.secret &#x3D; secret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public DingRobotRequestBody getMsg() &#123;</span><br><span class="line">        return msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMsg(DingRobotRequestBody msg) &#123;</span><br><span class="line">        this.msg &#x3D; msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;DingRobotRequest&#123;&quot; +</span><br><span class="line">                &quot;url&#x3D;&#39;&quot; + url + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, accessToken&#x3D;&#39;&quot; + accessToken + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, secret&#x3D;&#39;&quot; + secret + &#39;\&#39;&#39; +</span><br><span class="line">                &quot;, msg&#x3D;&#39;&quot; + msg + &#39;\&#39;&#39; +</span><br><span class="line">                &#39;&#125;&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="构建请求参数"><a href="#构建请求参数" class="headerlink" title="构建请求参数"></a>构建请求参数</h3><p>下面是请求参数的构建案例，我们可以使用链式调用的方式构建不同的request请求：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">    * 钉钉机器人的默认配置</span><br><span class="line">    *</span><br><span class="line">    * @param dingRobotRequest    钉钉机器人请求对象</span><br><span class="line">    * @param dingRobotRequestMsg 钉钉机器人请求实体</span><br><span class="line">    * @return</span><br><span class="line">    *&#x2F;</span><br><span class="line">   private static HttpConfig buildDefaultHttpConfig(DingRobotRequest dingRobotRequest, DingRobotRequestAble dingRobotRequestMsg) &#123;</span><br><span class="line">       return HttpConfig.custom().headers(defaultBasicHeader())</span><br><span class="line">               .url(dingRobotRequest.getUrl())</span><br><span class="line">               .encoding(&quot;UTF-8&quot;)</span><br><span class="line">               .method(HttpMethods.POST)</span><br><span class="line">               .json(JSON.toJSONString(dingRobotRequestMsg));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>从上面的案例可以看到下面对于请求配置类，构建<code>HttpConfig</code>请求，同样类似构建器进行对象的参数构建，我们定义了基本的请求<code>encoding</code>、请求<code>header</code>，请求方法参数，请求的context等对应的参数配置。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 请求配置类</span><br><span class="line"> *</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class HttpConfig &#123;</span><br><span class="line"></span><br><span class="line">    private HttpConfig() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 传入参数特定类型</span><br><span class="line">    public static final String ENTITY_STRING &#x3D; &quot;$ENTITY_STRING$&quot;;</span><br><span class="line">    public static final String ENTITY_MULTIPART &#x3D; &quot;$ENTITY_MULTIPART$&quot;;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 获取实例</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static HttpConfig custom() &#123;</span><br><span class="line">        return new HttpConfig();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * HttpClient对象</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private HttpClient client;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Header头信息</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private Header[] headers;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 是否返回response的headers</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private boolean isReturnRespHeaders;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 请求方法</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private HttpMethods method &#x3D; HttpMethods.GET;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 请求方法名称</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private String methodName;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 用于cookie操作</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private HttpContext context;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 传递参数</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private Map&lt;String, Object&gt; map;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 以json格式作为输入参数</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private String json;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 输入输出编码</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private String encoding &#x3D; Charset.defaultCharset().displayName();</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 输入编码</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private String inenc;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 输出编码</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private String outenc;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 解决多线程下载时，strean被close的问题</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static final ThreadLocal&lt;OutputStream&gt; outs &#x3D; new ThreadLocal&lt;OutputStream&gt;();</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 解决多线程处理时，url被覆盖问题</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static final ThreadLocal&lt;String&gt; urls &#x3D; new ThreadLocal&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * HttpClient对象</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public HttpConfig client(HttpClient client) &#123;</span><br><span class="line">        this.client &#x3D; client;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 资源url</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public HttpConfig url(String url) &#123;</span><br><span class="line">        urls.set(url);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Header头信息</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public HttpConfig headers(Header[] headers) &#123;</span><br><span class="line">        this.headers &#x3D; headers;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Header头信息(是否返回response中的headers)</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public HttpConfig headers(Header[] headers, boolean isReturnRespHeaders) &#123;</span><br><span class="line">        this.headers &#x3D; headers;</span><br><span class="line">        this.isReturnRespHeaders &#x3D; isReturnRespHeaders;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 请求方法</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public HttpConfig method(HttpMethods method) &#123;</span><br><span class="line">        this.method &#x3D; method;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 请求方法</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public HttpConfig methodName(String methodName) &#123;</span><br><span class="line">        this.methodName &#x3D; methodName;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * cookie操作相关</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public HttpConfig context(HttpContext context) &#123;</span><br><span class="line">        this.context &#x3D; context;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 传递参数</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public HttpConfig map(Map&lt;String, Object&gt; map) &#123;</span><br><span class="line">        synchronized (getClass()) &#123;</span><br><span class="line">            if (this.map &#x3D;&#x3D; null || map &#x3D;&#x3D; null) &#123;</span><br><span class="line">                this.map &#x3D; map;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                this.map.putAll(map);</span><br><span class="line">                ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 以json格式字符串作为参数</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public HttpConfig json(String json) &#123;</span><br><span class="line">        this.json &#x3D; json;</span><br><span class="line">        map &#x3D; new HashMap&lt;String, Object&gt;();</span><br><span class="line">        map.put(ENTITY_STRING, json);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 上传文件时用到</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public HttpConfig files(String[] filePaths) &#123;</span><br><span class="line">        return files(filePaths, &quot;file&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 上传文件时用到</span><br><span class="line">     *</span><br><span class="line">     * @param filePaths 待上传文件所在路径</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public HttpConfig files(String[] filePaths, String inputName) &#123;</span><br><span class="line">        return files(filePaths, inputName, false);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 上传文件时用到</span><br><span class="line">     *</span><br><span class="line">     * @param filePaths                     待上传文件所在路径</span><br><span class="line">     * @param inputName                     即file input 标签的name值，默认为file</span><br><span class="line">     * @param forceRemoveContentTypeChraset</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public HttpConfig files(String[] filePaths, String inputName, boolean forceRemoveContentTypeChraset) &#123;</span><br><span class="line">        synchronized (getClass()) &#123;</span><br><span class="line">            if (this.map &#x3D;&#x3D; null) &#123;</span><br><span class="line">                this.map &#x3D; new HashMap&lt;String, Object&gt;();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        map.put(ENTITY_MULTIPART, filePaths);</span><br><span class="line">        map.put(ENTITY_MULTIPART + &quot;.name&quot;, inputName);</span><br><span class="line">        map.put(ENTITY_MULTIPART + &quot;.rmCharset&quot;, forceRemoveContentTypeChraset);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 输入输出编码</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public HttpConfig encoding(String encoding) &#123;</span><br><span class="line">        &#x2F;&#x2F;设置输入输出</span><br><span class="line">        inenc(encoding);</span><br><span class="line">        outenc(encoding);</span><br><span class="line">        this.encoding &#x3D; encoding;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 输入编码</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public HttpConfig inenc(String inenc) &#123;</span><br><span class="line">        this.inenc &#x3D; inenc;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 输出编码</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public HttpConfig outenc(String outenc) &#123;</span><br><span class="line">        this.outenc &#x3D; outenc;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 输出流对象</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public HttpConfig out(OutputStream out) &#123;</span><br><span class="line">        outs.set(out);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public HttpClient client() &#123;</span><br><span class="line">        return client;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Header[] headers() &#123;</span><br><span class="line">        return headers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean isReturnRespHeaders() &#123;</span><br><span class="line">        return isReturnRespHeaders;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String url() &#123;</span><br><span class="line">        return urls.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public HttpMethods method() &#123;</span><br><span class="line">        return method;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String methodName() &#123;</span><br><span class="line">        return methodName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public HttpContext context() &#123;</span><br><span class="line">        return context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Map&lt;String, Object&gt; map() &#123;</span><br><span class="line">        return map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String json() &#123;</span><br><span class="line">        return json;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String encoding() &#123;</span><br><span class="line">        return encoding;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String inenc() &#123;</span><br><span class="line">        return inenc &#x3D;&#x3D; null ? encoding : inenc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String outenc() &#123;</span><br><span class="line">        return outenc &#x3D;&#x3D; null ? encoding : outenc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public OutputStream out() &#123;</span><br><span class="line">        return outs.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用JAVA代码发送请求"><a href="#使用JAVA代码发送请求" class="headerlink" title="使用JAVA代码发送请求"></a>使用JAVA代码发送请求</h3><p>之前说明，我们使用最常用的<code>Httpclient</code>进行设计请求，根据<code>Httpclient</code>请求工具包构建一个基本的工具类：</p><blockquote><p>这个类是一个很难复用和扩展的高耦合类，并且设计不是非常良好。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * httpclient 请求工具封装类</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class HttpClientUtil &#123;</span><br><span class="line"></span><br><span class="line">public static String doGet(String url, Map&lt;String, String&gt; param) &#123;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 创建Httpclient对象</span><br><span class="line">CloseableHttpClient httpclient &#x3D; HttpClients.createDefault();</span><br><span class="line"></span><br><span class="line">String resultString &#x3D; &quot;&quot;;</span><br><span class="line">CloseableHttpResponse response &#x3D; null;</span><br><span class="line">try &#123;</span><br><span class="line">&#x2F;&#x2F; 创建uri</span><br><span class="line">URIBuilder builder &#x3D; new URIBuilder(url);</span><br><span class="line">if (param !&#x3D; null) &#123;</span><br><span class="line">for (String key : param.keySet()) &#123;</span><br><span class="line">builder.addParameter(key, param.get(key));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">URI uri &#x3D; builder.build();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 创建http GET请求</span><br><span class="line">HttpGet httpGet &#x3D; new HttpGet(uri);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 执行请求</span><br><span class="line">response &#x3D; httpclient.execute(httpGet);</span><br><span class="line">&#x2F;&#x2F; 判断返回状态是否为200</span><br><span class="line">if (response.getStatusLine().getStatusCode() &#x3D;&#x3D; 200) &#123;</span><br><span class="line">resultString &#x3D; EntityUtils.toString(response.getEntity(), &quot;UTF-8&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; finally &#123;</span><br><span class="line">try &#123;</span><br><span class="line">if (response !&#x3D; null) &#123;</span><br><span class="line">response.close();</span><br><span class="line">&#125;</span><br><span class="line">httpclient.close();</span><br><span class="line">&#125; catch (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return resultString;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static String doGet(String url) &#123;</span><br><span class="line">return doGet(url, null);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static String doPost(String url, Map&lt;String, String&gt; param) &#123;</span><br><span class="line">&#x2F;&#x2F; 创建Httpclient对象</span><br><span class="line">CloseableHttpClient httpClient &#x3D; HttpClients.createDefault();</span><br><span class="line">CloseableHttpResponse response &#x3D; null;</span><br><span class="line">String resultString &#x3D; &quot;&quot;;</span><br><span class="line">try &#123;</span><br><span class="line">&#x2F;&#x2F; 创建Http Post请求</span><br><span class="line">HttpPost httpPost &#x3D; new HttpPost(url);</span><br><span class="line">&#x2F;&#x2F; 创建参数列表</span><br><span class="line">if (param !&#x3D; null) &#123;</span><br><span class="line">List&lt;NameValuePair&gt; paramList &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">for (String key : param.keySet()) &#123;</span><br><span class="line">paramList.add(new BasicNameValuePair(key, param.get(key)));</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 模拟表单</span><br><span class="line">UrlEncodedFormEntity entity &#x3D; new UrlEncodedFormEntity(paramList);</span><br><span class="line">httpPost.setEntity(entity);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 执行http请求</span><br><span class="line">response &#x3D; httpClient.execute(httpPost);</span><br><span class="line">resultString &#x3D; EntityUtils.toString(response.getEntity(), &quot;utf-8&quot;);</span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; finally &#123;</span><br><span class="line">try &#123;</span><br><span class="line">response.close();</span><br><span class="line">&#125; catch (IOException e) &#123;</span><br><span class="line"></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">return resultString;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static String doPost(String url) &#123;</span><br><span class="line">return doPost(url, null);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static String doPostJson(String url, String json) &#123;</span><br><span class="line">&#x2F;&#x2F; 创建Httpclient对象</span><br><span class="line">CloseableHttpClient httpClient &#x3D; HttpClients.createDefault();</span><br><span class="line">CloseableHttpResponse response &#x3D; null;</span><br><span class="line">String resultString &#x3D; &quot;&quot;;</span><br><span class="line">try &#123;</span><br><span class="line">&#x2F;&#x2F; 创建Http Post请求</span><br><span class="line">HttpPost httpPost &#x3D; new HttpPost(url);</span><br><span class="line">&#x2F;&#x2F; 创建请求内容</span><br><span class="line">StringEntity entity &#x3D; new StringEntity(json, ContentType.APPLICATION_JSON);</span><br><span class="line">httpPost.setEntity(entity);</span><br><span class="line">&#x2F;&#x2F; 执行http请求</span><br><span class="line">response &#x3D; httpClient.execute(httpPost);</span><br><span class="line">resultString &#x3D; EntityUtils.toString(response.getEntity(), &quot;utf-8&quot;);</span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; finally &#123;</span><br><span class="line">try &#123;</span><br><span class="line">if(response !&#x3D; null)&#123;</span><br><span class="line">response.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125; catch (IOException e) &#123;</span><br><span class="line"></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">return resultString;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 根据请求Config 进行请求发送</span><br><span class="line"> * @param httpConfig</span><br><span class="line"> * @return</span><br><span class="line"> *&#x2F;</span><br><span class="line">public static String send(HttpConfig httpConfig) &#123;</span><br><span class="line">return doPostJson(httpConfig.url(), httpConfig.json());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接着根据请求的结果设计一个钉钉机器人的返回对象，返回对象的设计也比较的简单。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * @author zxd</span><br><span class="line"> * @version v1.0.0</span><br><span class="line"> * @Package : com.dcc.common.field</span><br><span class="line"> * @Description : 钉钉机器人返回对象</span><br><span class="line"> * @Create on : 2021&#x2F;2&#x2F;5 18:26</span><br><span class="line"> **&#x2F;</span><br><span class="line">public class DingRobotResponseMsg &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 错误码</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private String errcode;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 错误信息</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private String errmsg;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 更多链接</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private String more;</span><br><span class="line"></span><br><span class="line">    public DingRobotResponseMsg(String errcode, String errmsg, String more) &#123;</span><br><span class="line">        this.errcode &#x3D; errcode;</span><br><span class="line">        this.errmsg &#x3D; errmsg;</span><br><span class="line">        this.more &#x3D; more;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public DingRobotResponseMsg() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getErrcode() &#123;</span><br><span class="line">        return errcode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getErrmsg() &#123;</span><br><span class="line">        return errmsg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getMore() &#123;</span><br><span class="line">        return more;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setErrcode(String errcode) &#123;</span><br><span class="line">        this.errcode &#x3D; errcode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setErrmsg(String errmsg) &#123;</span><br><span class="line">        this.errmsg &#x3D; errmsg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMore(String more) &#123;</span><br><span class="line">        this.more &#x3D; more;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后，也是最重要的，我们要根据钉钉的文档，构建一个所有类型的请求对象类，这个类包含了钉钉文档目前支持的所有类型。内部使用了大量的内部类，客户端需要了解一定的细节才可以具体的调用。下面简要说明一下内容类的基本使用结构。</p><ul><li>At 艾特对象内部类</li><li>Text 文本类型</li><li>Link 请求链接类型</li><li>MarkDown markdown类型</li><li>ActionCard 整体跳转类型</li><li>FeedCard 分享卡片类型</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * @author zxd</span><br><span class="line"> * @version v1.0.0</span><br><span class="line"> * @Package : com.dcc.common.field</span><br><span class="line"> * @Description : 钉钉机器人请求实体对象</span><br><span class="line"> * 请求案例：&#123;&quot;msgtype&quot;: &quot;text&quot;,&quot;text&quot;: &#123;&quot;content&quot;: &quot;自定义具体内容&quot;&#125;&#125;</span><br><span class="line"> * @link &#123;https:&#x2F;&#x2F;developers.dingtalk.com&#x2F;document&#x2F;app&#x2F;custom-robot-access&#125;</span><br><span class="line"> *</span><br><span class="line"> * @Create on : 2021&#x2F;2&#x2F;5 11:55</span><br><span class="line"> **&#x2F;</span><br><span class="line">public class DingRobotRequestBody implements DingRobotRequestAble &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 艾特对象内容</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private At at;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 类型</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private String msgtype;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 文本类型</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private Text text;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 连接类型</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private Link link;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * markdown 类型</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private MarkDown markdown;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 整体跳转ActionCard类型</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private ActionCard actionCard;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * FeedCard类型</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private FeedCard feedCard;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * FeedCard类型</span><br><span class="line">     *</span><br><span class="line">     * msgtype    String是此消息类型为固定feedCard。</span><br><span class="line">     * title    String是单条信息文本。</span><br><span class="line">     * messageURLString是点击单条信息到跳转链接。</span><br><span class="line">     * picURL    String是单条信息后面图片的URL。</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static class FeedCard&#123;</span><br><span class="line"></span><br><span class="line">        private List&lt;FeedItem&gt; links;</span><br><span class="line"></span><br><span class="line">        &#x2F;**</span><br><span class="line">         * 代表 FeedCard类型 子类型</span><br><span class="line">         *&#x2F;</span><br><span class="line">        public static class FeedItem&#123;</span><br><span class="line"></span><br><span class="line">            private String title;</span><br><span class="line"></span><br><span class="line">            private String messageURL;</span><br><span class="line"></span><br><span class="line">            private String picURL;</span><br><span class="line"></span><br><span class="line">            public String getTitle() &#123;</span><br><span class="line">                return title;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            public void setTitle(String title) &#123;</span><br><span class="line">                this.title &#x3D; title;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            public String getMessageURL() &#123;</span><br><span class="line">                return messageURL;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            public void setMessageURL(String messageURL) &#123;</span><br><span class="line">                this.messageURL &#x3D; messageURL;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            public String getPicURL() &#123;</span><br><span class="line">                return picURL;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            public void setPicURL(String picURL) &#123;</span><br><span class="line">                this.picURL &#x3D; picURL;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public List&lt;FeedItem&gt; getLinks() &#123;</span><br><span class="line">            return links;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setLinks(List&lt;FeedItem&gt; links) &#123;</span><br><span class="line">            this.links &#x3D; links;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 整体跳转ActionCard类型</span><br><span class="line">     * msgtype        String是消息类型，此时固定为：actionCard。</span><br><span class="line">     * title        String是首屏会话透出的展示内容。</span><br><span class="line">     * text            String是markdown格式的消息。</span><br><span class="line">     * singleTitle    String是单个按钮的标题。</span><br><span class="line">     *</span><br><span class="line">     * 注意 设置此项和singleURL后，btns无效。</span><br><span class="line">     *</span><br><span class="line">     * singleURL    String是点击singleTitle按钮触发的URL。</span><br><span class="line">     * btnOrientationString否0：按钮竖直排列1：按钮横向排列</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static class ActionCard&#123;</span><br><span class="line"></span><br><span class="line">        private String title;</span><br><span class="line"></span><br><span class="line">        private String text;</span><br><span class="line"></span><br><span class="line">        private String btnOrientation;</span><br><span class="line"></span><br><span class="line">        private String singleTitle;</span><br><span class="line"></span><br><span class="line">        private String singleURL;</span><br><span class="line"></span><br><span class="line">        public String getTitle() &#123;</span><br><span class="line">            return title;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setTitle(String title) &#123;</span><br><span class="line">            this.title &#x3D; title;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getText() &#123;</span><br><span class="line">            return text;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setText(String text) &#123;</span><br><span class="line">            this.text &#x3D; text;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getBtnOrientation() &#123;</span><br><span class="line">            return btnOrientation;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setBtnOrientation(String btnOrientation) &#123;</span><br><span class="line">            this.btnOrientation &#x3D; btnOrientation;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getSingleTitle() &#123;</span><br><span class="line">            return singleTitle;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setSingleTitle(String singleTitle) &#123;</span><br><span class="line">            this.singleTitle &#x3D; singleTitle;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getSingleURL() &#123;</span><br><span class="line">            return singleURL;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setSingleURL(String singleURL) &#123;</span><br><span class="line">            this.singleURL &#x3D; singleURL;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 艾特类</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static class At&#123;</span><br><span class="line"></span><br><span class="line">        &#x2F;**</span><br><span class="line">         * 是否通知全部人</span><br><span class="line">         *&#x2F;</span><br><span class="line">        private boolean atAll;</span><br><span class="line"></span><br><span class="line">        &#x2F;**</span><br><span class="line">         * 需要@的手机号数组</span><br><span class="line">         *&#x2F;</span><br><span class="line">        private List&lt;String&gt; atMobiles;</span><br><span class="line"></span><br><span class="line">        public boolean isAtAll() &#123;</span><br><span class="line">            return atAll;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setAtAll(boolean atAll) &#123;</span><br><span class="line">            this.atAll &#x3D; atAll;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public List&lt;String&gt; getAtMobiles() &#123;</span><br><span class="line">            return atMobiles;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setAtMobiles(List&lt;String&gt; atMobiles) &#123;</span><br><span class="line">            this.atMobiles &#x3D; atMobiles;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     *</span><br><span class="line">     * markdown 类型， 可以发送markdown 的语法格式</span><br><span class="line">     * msgtype    String是消息类型，此时固定为：markdown。</span><br><span class="line">     * title    String是首屏会话透出的展示内容。</span><br><span class="line">     * text        String是markdown格式的消息。</span><br><span class="line">     * atMobilesArray否被@人的手机号。 注意 在text内容里要有@人的手机号。</span><br><span class="line">     * isAtAllBoolean否是否@所有人。</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static class MarkDown&#123;</span><br><span class="line"></span><br><span class="line">        private String title;</span><br><span class="line"></span><br><span class="line">        private String text;</span><br><span class="line"></span><br><span class="line">        public String getTitle() &#123;</span><br><span class="line">            return title;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setTitle(String title) &#123;</span><br><span class="line">            this.title &#x3D; title;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getText() &#123;</span><br><span class="line">            return text;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setText(String text) &#123;</span><br><span class="line">            this.text &#x3D; text;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 钉钉请求：链接类型</span><br><span class="line">     *</span><br><span class="line">         msgtype    String是消息类型，此时固定为：link。</span><br><span class="line">         title        String是消息标题。</span><br><span class="line">         text        String是消息内容。如果太长只会部分展示。</span><br><span class="line">         messageUrl    String是点击消息跳转的URL。</span><br><span class="line">         picUrl        String否图片URL。</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static class Link&#123;</span><br><span class="line"></span><br><span class="line">        private String text;</span><br><span class="line"></span><br><span class="line">        private String messageUrl;</span><br><span class="line"></span><br><span class="line">        private String picUrl;</span><br><span class="line"></span><br><span class="line">        private String title;</span><br><span class="line"></span><br><span class="line">        public String getText() &#123;</span><br><span class="line">            return text;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setText(String text) &#123;</span><br><span class="line">            this.text &#x3D; text;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getMessageUrl() &#123;</span><br><span class="line">            return messageUrl;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setMessageUrl(String messageUrl) &#123;</span><br><span class="line">            this.messageUrl &#x3D; messageUrl;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getPicUrl() &#123;</span><br><span class="line">            return picUrl;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setPicUrl(String picUrl) &#123;</span><br><span class="line">            this.picUrl &#x3D; picUrl;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getTitle() &#123;</span><br><span class="line">            return title;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setTitle(String title) &#123;</span><br><span class="line">            this.title &#x3D; title;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 钉钉请求：纯文本类型</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static class Text&#123;</span><br><span class="line"></span><br><span class="line">        &#x2F;**</span><br><span class="line">         * text请求内容</span><br><span class="line">         *&#x2F;</span><br><span class="line">        private String content;</span><br><span class="line"></span><br><span class="line">        public String getContent() &#123;</span><br><span class="line">            return content;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setContent(String content) &#123;</span><br><span class="line">            this.content &#x3D; content;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setMsgType(String msgtype) &#123;</span><br><span class="line">        this.msgtype &#x3D; msgtype;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setText(Text text) &#123;</span><br><span class="line">        this.text &#x3D; text;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setLink(Link link) &#123;</span><br><span class="line">        this.link &#x3D; link;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setMarkDown(MarkDown markDown) &#123;</span><br><span class="line">        this.markdown &#x3D; markDown;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setActionCard(ActionCard actionCard) &#123;</span><br><span class="line">        this.actionCard &#x3D; actionCard;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setFeedCard(FeedCard feedCard) &#123;</span><br><span class="line">        this.feedCard &#x3D; feedCard;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public At getAt() &#123;</span><br><span class="line">        return at;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setAt(At at) &#123;</span><br><span class="line">        this.at &#x3D; at;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getMsgtype() &#123;</span><br><span class="line">        return msgtype;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Text getText() &#123;</span><br><span class="line">        return text;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Link getLink() &#123;</span><br><span class="line">        return link;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public MarkDown getMarkdown() &#123;</span><br><span class="line">        return markdown;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ActionCard getActionCard() &#123;</span><br><span class="line">        return actionCard;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public FeedCard getFeedCard() &#123;</span><br><span class="line">        return feedCard;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>插曲：在生成具体的钉钉对应请求对象时候，我们构建了一个对应的接口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * @author zxd</span><br><span class="line"> * @version v1.0.0</span><br><span class="line"> * @Package : com.zxd.interview.dingrobot</span><br><span class="line"> * @Description : 允许发送钉钉请求的接口</span><br><span class="line"> * @Create on : 2021&#x2F;2&#x2F;7 11:45</span><br><span class="line"> **&#x2F;</span><br><span class="line">public interface DingRobotRequestAble &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 所有的子类需要集成该接口</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    void setMsgType(String msgType);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 普通文本类型</span><br><span class="line">     * @param text</span><br><span class="line">     *&#x2F;</span><br><span class="line">    void setText(DingRobotRequestBody.Text text);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * link类型</span><br><span class="line">     * @param link</span><br><span class="line">     *&#x2F;</span><br><span class="line">    void setLink(DingRobotRequestBody.Link link);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * markdown 类型</span><br><span class="line">     * @param markDown</span><br><span class="line">     *&#x2F;</span><br><span class="line">    void setMarkDown(DingRobotRequestBody.MarkDown markDown);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 整体跳转ActionCard类型</span><br><span class="line">     * @param actionCard</span><br><span class="line">     *&#x2F;</span><br><span class="line">    void setActionCard(DingRobotRequestBody.ActionCard actionCard);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * feedcard 类型</span><br><span class="line">     * @param feedCard</span><br><span class="line">     *&#x2F;</span><br><span class="line">    void setFeedCard(DingRobotRequestBody.FeedCard feedCard);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><h3 id="构建钉钉请求工具类"><a href="#构建钉钉请求工具类" class="headerlink" title="构建钉钉请求工具类"></a>构建钉钉请求工具类</h3><p>介绍完上面所有的辅助对象之后，我们着手构建核心的钉钉请求工具类，钉钉的请求工具类包含了基本的请求步骤，提供对外的请求方法，调用者根据请求对象构建对应的请求参数即可，从下面的代码可以看到最核心的方法是<code>notifyRobot</code>这个方法，这个方法非常简单，内部的逻辑分为如下的几步：</p><ul><li>构建请求环境参数</li><li>构建请求的URL和对应的携带参数</li><li>构建具体的请求参数</li><li>将请求返回的JSON字符串进行转化</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * @author zxd</span><br><span class="line"> * @version v1.0.0</span><br><span class="line"> * @Package : com.dcc.common.utils</span><br><span class="line"> * @Description : 钉钉机器人工具类</span><br><span class="line"> * @Create on : 2021&#x2F;2&#x2F;4 00:11</span><br><span class="line"> **&#x2F;</span><br><span class="line">public class DingRobotUtils &#123;</span><br><span class="line"></span><br><span class="line">    private static final Logger LOGGER &#x3D; LoggerFactory.getLogger(DingRobotUtils.class);</span><br><span class="line"></span><br><span class="line">    public static DingRobotResponseMsg notifyRobot(DingRobotRequest dingRobotRequest, long currentTimeMillis) throws Exception &#123;</span><br><span class="line">        Map&lt;String, Object&gt; param &#x3D; buildParam(dingRobotRequest, currentTimeMillis);</span><br><span class="line">        String s &#x3D; buildParamUrl(param);</span><br><span class="line">        &#x2F;&#x2F; 钉钉的请求参数需要拼接到URL链接</span><br><span class="line">        dingRobotRequest.setUrl(String.format(&quot;%s?%s&quot;, dingRobotRequest.getUrl(), s));</span><br><span class="line">        HttpConfig httpConfig &#x3D; buildDefaultHttpConfig(dingRobotRequest, dingRobotRequest.getMsg());</span><br><span class="line">        return parseResponse(notifyRobot(httpConfig));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 转化为对应对象</span><br><span class="line">     *</span><br><span class="line">     * @param notifyRobot 转化JSON</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static DingRobotResponseMsg parseResponse(String notifyRobot) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            return JSON.parseObject(notifyRobot, DingRobotResponseMsg.class);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            LOGGER.error(&quot;类型转化失败，失败原因为:&#123;&#125;&quot;, e.getMessage());</span><br><span class="line">            throw e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 按照自定时间戳进行通知</span><br><span class="line">     *</span><br><span class="line">     * @param dingRobotRequest 钉钉机器人请求</span><br><span class="line">     * @throws Exception</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public static DingRobotResponseMsg notifyRobot(DingRobotRequest dingRobotRequest) throws Exception &#123;</span><br><span class="line">        long currentTimeMillis &#x3D; System.currentTimeMillis();</span><br><span class="line">        return notifyRobot(dingRobotRequest, currentTimeMillis);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 构建请求环境参数</span><br><span class="line">     *</span><br><span class="line">     * @param dingRobotRequest  请求request</span><br><span class="line">     * @param currentTimeMillis 当前时间戳</span><br><span class="line">     * @return</span><br><span class="line">     * @throws Exception</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static Map&lt;String, Object&gt; buildParam(DingRobotRequest dingRobotRequest, long currentTimeMillis) throws Exception &#123;</span><br><span class="line">        Map&lt;String, Object&gt; param &#x3D; new HashMap&lt;&gt;(3);</span><br><span class="line">        param.put(&quot;access_token&quot;, dingRobotRequest.getAccessToken());</span><br><span class="line">        param.put(&quot;timestamp&quot;, currentTimeMillis);</span><br><span class="line">        param.put(&quot;sign&quot;, generateSign(currentTimeMillis, dingRobotRequest.getSecret()));</span><br><span class="line">        return param;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 钉钉机器人的默认配置</span><br><span class="line">     *</span><br><span class="line">     * @param dingRobotRequest    钉钉机器人请求对象</span><br><span class="line">     * @param dingRobotRequestMsg 钉钉机器人请求实体</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static HttpConfig buildDefaultHttpConfig(DingRobotRequest dingRobotRequest, DingRobotRequestAble dingRobotRequestMsg) &#123;</span><br><span class="line">        return HttpConfig.custom().headers(defaultBasicHeader())</span><br><span class="line">                .url(dingRobotRequest.getUrl())</span><br><span class="line">                .encoding(&quot;UTF-8&quot;)</span><br><span class="line">                .method(HttpMethods.POST)</span><br><span class="line">                .json(JSON.toJSONString(dingRobotRequestMsg));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 默认headers配置</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static Header[] defaultBasicHeader() &#123;</span><br><span class="line">        Header[] headers &#x3D; new Header[1];</span><br><span class="line">        headers[0] &#x3D; new BasicHeader(&quot;Content-Type&quot;, &quot;application&#x2F;json&quot;);</span><br><span class="line">        return headers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static String notifyRobot(HttpConfig httpConfig) throws Exception &#123;</span><br><span class="line">        String send &#x3D; &quot;&quot;;</span><br><span class="line">        try &#123;</span><br><span class="line">            send &#x3D; HttpClientUtil.send(httpConfig);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            LOGGER.error(&quot;HTTPClient请求发送失败, 失败原因为:&#123;&#125;&quot;, e.getMessage());</span><br><span class="line">            throw e;</span><br><span class="line">        &#125;</span><br><span class="line">        return send;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据时间戳和秘钥生成一份签名</span><br><span class="line">     *</span><br><span class="line">     * @param timestamp 时间戳</span><br><span class="line">     * @param secret    秘钥</span><br><span class="line">     * @return</span><br><span class="line">     * @throws Exception</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static String generateSign(Long timestamp, String secret) throws Exception &#123;</span><br><span class="line">        String stringToSign &#x3D; timestamp + &quot;\n&quot; + secret;</span><br><span class="line">        Mac mac &#x3D; Mac.getInstance(&quot;HmacSHA256&quot;);</span><br><span class="line">        mac.init(new SecretKeySpec(secret.getBytes(StandardCharsets.UTF_8), &quot;HmacSHA256&quot;));</span><br><span class="line">        byte[] signData &#x3D; mac.doFinal(stringToSign.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        return URLEncoder.encode(new String(Base64.encodeBase64(signData)), &quot;UTF-8&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 构建URL参数</span><br><span class="line">     *</span><br><span class="line">     * @param param 请求MAP参数</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private static String buildParamUrl(Map&lt;String, Object&gt; param) &#123;</span><br><span class="line">        if (null &#x3D;&#x3D; param || param.size() &#x3D;&#x3D; 0) &#123;</span><br><span class="line">            return &quot;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuilder stringBuilder &#x3D; new StringBuilder();</span><br><span class="line">        param.forEach((key, value) -&gt; &#123;</span><br><span class="line">            stringBuilder.append(key).append(&quot;&#x3D;&quot;).append(value);</span><br><span class="line">            stringBuilder.append(&quot;&amp;&quot;);</span><br><span class="line">        &#125;);</span><br><span class="line">        stringBuilder.deleteCharAt(stringBuilder.length() - 1);</span><br><span class="line">        return stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面是本工具类的使用方式，只需要传入环境参数并且传入必须的请求msg，就可以直接发送请求并且返回对应的结果。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> DingRobotRequest.Builder builder &#x3D; new DingRobotRequest.Builder();</span><br><span class="line">DingRobotRequest build &#x3D; builder.secret(&quot;SEC2e67120c5e4affa1177ac25fe8dc77ba1c5b49284a9dc7e1888770bc3b76b1fc&quot;)</span><br><span class="line">    .url(&quot;https:&#x2F;&#x2F;oapi.dingtalk.com&#x2F;robot&#x2F;send&quot;)</span><br><span class="line">    .accessToken(&quot;381c2f405e0f906fd556b27cea9f66864120860b5d8b117bb046e10b6599b050&quot;)</span><br><span class="line">    .msg(generateActionCard()).build();</span><br><span class="line">try &#123;</span><br><span class="line">    DingRobotResponseMsg dingRobotResponseMsg &#x3D; DingRobotUtils.notifyRobot(build);</span><br><span class="line">    System.err.println(JSON.toJSONString(dingRobotResponseMsg));</span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>至此，一个工具类构建就完成了，整个构建的过程还是十分简单的。这次的工具代码也是不断进行小改动的成果。个人的代码水平功底有限，如果有什么意见欢迎点评。</p><h1 id="问题汇总："><a href="#问题汇总：" class="headerlink" title="问题汇总："></a>问题汇总：</h1><p>下面汇总了一些个人使用钉钉花的时间比较多的点。</p><blockquote><p>吐槽：其实个人感觉钉钉的机器人在错误码这一块并不是特别的直观，下面说下个人踩到的一些小坑。</p></blockquote><h2 id="关于加签测试机器人出现31000的问题"><a href="#关于加签测试机器人出现31000的问题" class="headerlink" title="关于加签测试机器人出现31000的问题"></a>关于加签测试机器人出现<code>31000</code>的问题</h2><p>如果在添加机器人的时候进行加签是需要加入对应的<code>sign</code>和<code>timestamp</code>参数才可以测试成功，这里个人卡了一会儿才明白设计者的意图，虽然很好理解，但是对于第一次使用的人不是十分友好，同时在文档里面明显对于这一块的描述比较少，这里提供一下个人的小坑说明：</p><p>首先，我们需要根据请求的时间戳和秘钥生成签名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">.....</span><br><span class="line">&#x2F;**</span><br><span class="line"> * 构建当前的系统时间戳</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Test</span><br><span class="line">public void generateSystemCurrentTime() throws Exception &#123;</span><br><span class="line">    long l &#x3D; System.currentTimeMillis();</span><br><span class="line">    String secret &#x3D; &quot;SEC2e67120c5e4affa1177ac25fe8dc77ba1c5b49284a9dc7e1888770bc3b76b1fc&quot;;</span><br><span class="line">    String sign &#x3D; generateSign(l, secret);</span><br><span class="line">    System.out.println(&quot;timestamp &#x3D; &quot;+ l);</span><br><span class="line">    System.out.println(&quot;sign &#x3D; &quot; + sign);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private String generateSign(Long timestamp, String secret) throws Exception &#123;</span><br><span class="line">    String stringToSign &#x3D; timestamp + &quot;\n&quot; + secret;</span><br><span class="line">    Mac mac &#x3D; Mac.getInstance(&quot;HmacSHA256&quot;);</span><br><span class="line">    mac.init(new SecretKeySpec(secret.getBytes(StandardCharsets.UTF_8), &quot;HmacSHA256&quot;));</span><br><span class="line">    byte[] signData &#x3D; mac.doFinal(stringToSign.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">    return URLEncoder.encode(new String(Base64.encodeBase64(signData)), &quot;UTF-8&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">....</span><br></pre></td></tr></table></figure><p>生成签名之后，我们需要把<strong>时间戳</strong>和<strong>签名</strong>放入到请求的URL参数里面，测试方可通过：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;oapi.dingtalk.com&#x2F;robot&#x2F;send?access_token&#x3D;381c2f405e0f906fd556b27cea9f66864120860b5d8b117bb046e10b6599b050&amp;timestamp&#x3D;1613212722591&amp;sign&#x3D;SsKKlkvwM%2F4tsCPE6YoGls8vgkQqWJGHYpvWbW7hTGM%3D</span><br></pre></td></tr></table></figure><blockquote><p>提示：还是注意一下，在设置里面增加了加签</p></blockquote><h1 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h1><p>本文主要为记录个人使用钉钉的一些心得体会，以及以此编写了一个工具包方便以后有需要的时候可以直接拿来使用。</p><p>钉钉机器人的使用就告一段落了，目前工具类已经应用到公司项目正常的发送请求通知。后续看心情对于HttpClient请求工具类重构，但是目前个人还在参考和学习设计记录，发现可以拆分的对象还是不少的。包含请求方法，请求Header，请求编码等各种形式的转化。</p><p>最后，个人最近从<strong>《代码简洁之道》</strong>里面学习了很多有用的编程技巧和编写代码的细节问题，推荐读者看一看这本书，对于写出一个好代码和好注释或者想要学习改良自己的代码都是很有好处的，后续个人也会写一篇学习笔记，感兴趣的可以关注一波。</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
    
    <summary type="html">
    
      如何快捷简单的使用钉钉机器人
    
    </summary>
    
    
      <category term="笔记" scheme="https://whitestore.top/categories/%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="笔记" scheme="https://whitestore.top/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
</feed>
